;(function() {
try{
  var loadStart = Date.now()
  this.globalThis || (this.globalThis = this)
  var wxVersion = wx.version && wx.version.version
  if (wxVersion) {
    function compareVersion(v1, v2) {
      v1 = v1.split('.')
      v2 = v2.split('.')
      var len = Math.max(v1.length, v2.length)
    
      while (v1.length < len) {
        v1.push('0')
      }
      while (v2.length < len) {
        v2.push('0')
      }
    
      for (var i = 0; i < len; i++) {
        var num1 = parseInt(v1[i])
        var num2 = parseInt(v2[i])
    
        if (num1 > num2) {
          return 1
        } else if (num1 < num2) {
          return -1
        }
      }
    
      return 0
    }
    var cmp = compareVersion('2.23.1', wxVersion)
    if (cmp !== 1) {
      console.log('cloud sdk (build ts 1685330827011) injection skipped for sdk version', wxVersion)
      return
    }
  }
var __cloudSDK__=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/index.ts")}({"../../node_modules/.pnpm/@protobufjs+aspromise@1.1.2/node_modules/@protobufjs/aspromise/index.js":function(e,t,r){e.exports=function(e,t){var r=new Array(arguments.length-1),n=0,i=2,o=!0;for(;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,s){r[n]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,s(e))}})}},"../../node_modules/.pnpm/@protobufjs+base64@1.1.2/node_modules/@protobufjs/base64/index.js":function(e,t,r){var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=new Array(64),o=new Array(123),s=0;s<64;)o[i[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;n.encode=function(e,t,r){for(var n,o=null,s=[],a=0,u=0;t<r;){var c=e[t++];switch(u){case 0:s[a++]=i[c>>2],n=(3&c)<<4,u=1;break;case 1:s[a++]=i[n|c>>4],n=(15&c)<<2,u=2;break;case 2:s[a++]=i[n|c>>6],s[a++]=i[63&c],u=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=i[n],s[a++]=61,1===u&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};n.decode=function(e,t,r){for(var n,i=r,s=0,a=0;a<e.length;){var u=e.charCodeAt(a++);if(61===u&&s>1)break;if(void 0===(u=o[u]))throw Error("invalid encoding");switch(s){case 0:n=u,s=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,s=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,s=3;break;case 3:t[r++]=(3&n)<<6|u,s=0}}if(1===s)throw Error("invalid encoding");return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},"../../node_modules/.pnpm/@protobufjs+eventemitter@1.1.0/node_modules/@protobufjs/eventemitter/index.js":function(e,t,r){function n(){this._listeners={}}e.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},"../../node_modules/.pnpm/@protobufjs+float@1.0.2/node_modules/@protobufjs/float/index.js":function(e,t,r){function n(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function o(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:o,e.writeFloatBE=n?o:i,e.readFloatLE=n?s:a,e.readFloatBE=n?a:s}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>3.4028234663852886e38)e((i<<31|2139095040)>>>0,r,n);else if(t<1.1754943508222875e-38)e((i<<31|Math.round(t/1.401298464324817e-45))>>>0,r,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,o=n>>>23&255,s=8388607&n;return 255===o?s?NaN:i*(1/0):0===o?1.401298464324817e-45*i*s:i*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,o),e.readFloatLE=r.bind(null,s),e.readFloatBE=r.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function o(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:o,e.writeDoubleBE=n?o:i,e.readDoubleLE=n?s:a,e.readDoubleBE=n?a:s}():function(){function t(e,t,r,n,i,o){var s=n<0?1:0;if(s&&(n=-n),0===n)e(0,i,o+t),e(1/n>0?0:2147483648,i,o+r);else if(isNaN(n))e(0,i,o+t),e(2146959360,i,o+r);else if(n>1.7976931348623157e308)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+r);else{var a;if(n<2.2250738585072014e-308)e((a=n/5e-324)>>>0,i,o+t),e((s<<31|a/4294967296)>>>0,i,o+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(a=n*Math.pow(2,-u))>>>0,i,o+t),e((s<<31|u+1023<<20|1048576*a&1048575)>>>0,i,o+r)}}}function r(e,t,r,n,i){var o=e(n,i+t),s=e(n,i+r),a=2*(s>>31)+1,u=s>>>20&2047,c=4294967296*(1048575&s)+o;return 2047===u?c?NaN:a*(1/0):0===u?5e-324*a*c:a*Math.pow(2,u-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=r.bind(null,s,0,4),e.readDoubleBE=r.bind(null,a,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=n(n)},"../../node_modules/.pnpm/@protobufjs+inquire@1.1.0/node_modules/@protobufjs/inquire/index.js":function(module,exports,__webpack_require__){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},"../../node_modules/.pnpm/@protobufjs+pool@1.1.0/node_modules/@protobufjs/pool/index.js":function(e,t,r){e.exports=function(e,t,r){var n=r||8192,i=n>>>1,o=null,s=n;return function(r){if(r<1||r>i)return e(r);s+r>n&&(o=e(n),s=0);var a=t.call(o,s,s+=r);return 7&s&&(s=1+(7|s)),a}}},"../../node_modules/.pnpm/@protobufjs+utf8@1.1.0/node_modules/@protobufjs/utf8/index.js":function(e,t,r){var n=t;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],s=0;t<r;)(n=e[t++])<128?o[s++]=n:n>191&&n<224?o[s++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(n>>10),o[s++]=56320+(1023&n)):o[s++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(e,t,r){for(var n,i,o=r,s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(s+1)))?(n=65536+((1023&n)<<10)+(1023&i),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-o}},"../../node_modules/.pnpm/base64-js@1.5.1/node_modules/base64-js/index.js":function(e,t,r){t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=c(e),s=n[0],a=n[1],u=new o(function(e,t,r){return 3*(t+r)/4-r}(0,s,a)),l=0,d=a>0?s-4:s;for(r=0;r<d;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===a&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,u[l++]=255&t);1===a&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(d(e,s,s+16383>a?a:s+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=s.length;a<u;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function d(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(l(n));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},"../../node_modules/.pnpm/buffer@4.9.2/node_modules/buffer/index.js":function(e,t,r){(function(e){var n=r("../../node_modules/.pnpm/base64-js@1.5.1/node_modules/base64-js/index.js"),i=r("../../node_modules/.pnpm/ieee754@1.2.1/node_modules/ieee754/index.js"),o=r("../../node_modules/.pnpm/isarray@1.0.0/node_modules/isarray/index.js");function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return c(this,e,t,r)}function c(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|_(t,r),i=(e=a(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(u.isBuffer(t)){var r=0|p(t.length);return 0===(e=a(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?a(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=a(e,t<0?0:0|p(t)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function f(e,t){var r=t.length<0?0:0|p(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function _(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return q(e).length;default:if(n)return G(e).length;t=(""+t).toLowerCase(),n=!0}}function h(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function E(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):m(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){var o,s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=r;o<a;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var d=!0,f=0;f<u;f++)if(c(e,o+f)!==c(t,f)){d=!1;break}if(d)return o}return-1}function g(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function v(e,t,r,n){return W(G(t,e.length-r),e,r,n)}function S(e,t,r,n){return W(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function y(e,t,r,n){return S(e,t,r,n)}function T(e,t,r,n){return W(q(t),e,r,n)}function A(e,t,r,n){return W(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function b(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function C(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,u,c=e[i],l=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=r)switch(d){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,d=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=d}return function(e){var t=e.length;if(t<=O)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=O));return r}(n)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,r){return c(null,e,t,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,r){return function(e,t,r,n){return l(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}(null,e,t,r)},u.allocUnsafe=function(e){return d(null,e)},u.allocUnsafeSlow=function(e){return d(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},u.byteLength=_,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)h(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?C(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return w(this,t,r);case"utf8":case"utf-8":return C(this,t,r);case"ascii":return I(this,t,r);case"latin1":case"binary":return R(this,t,r);case"base64":return b(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,r,n,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var o=i-n,s=r-t,a=Math.min(o,s),c=this.slice(n,i),l=e.slice(t,r),d=0;d<a;++d)if(c[d]!==l[d]){o=c[d],s=l[d];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return E(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return E(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return g(this,e,t,r);case"utf8":case"utf-8":return v(this,e,t,r);case"ascii":return S(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return T(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var O=4096;function I(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function w(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=j(e[o]);return i}function N(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function D(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,r,n,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function M(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function P(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function U(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function x(e,t,r,n,o){return o||U(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function B(e,t,r,n,o){return o||U(e,0,r,8),i.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r,n=this.length;if(e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;r=new u(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},u.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},u.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},u.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||L(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},u.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||L(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},u.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,r){return x(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return x(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return B(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return B(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=u.isBuffer(e)?e:G(new u(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var k=/[^+\/0-9A-Za-z-_]/g;function j(e){return e<16?"0"+e.toString(16):e.toString(16)}function G(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function q(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(k,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r("../../node_modules/.pnpm/webpack@4.46.0_webpack-command@0.4.2/node_modules/webpack/buildin/global.js"))},"../../node_modules/.pnpm/ieee754@1.2.1/node_modules/ieee754/index.js":function(e,t){t.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,d=r?i-1:0,f=r?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+d],d+=f,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+d],d+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,_=n?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+d>=1?f/u:f*Math.pow(2,1-d))*u>=2&&(s++,u/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*u-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=_,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[r+p]=255&s,p+=_,s/=256,c-=8);e[r+p-_]|=128*h}},"../../node_modules/.pnpm/isarray@1.0.0/node_modules/isarray/index.js":function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_Symbol.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_root.js").default.Symbol;t.default=n},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_baseGetTag.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_Symbol.js"),i=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_getRawTag.js"),o=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_objectToString.js"),s="[object Null]",a="[object Undefined]",u=n.default?n.default.toStringTag:void 0;t.default=function(e){return null==e?void 0===e?a:s:u&&u in Object(e)?Object(i.default)(e):Object(o.default)(e)}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_baseTrim.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_trimmedEndIndex.js"),i=/^\s+/;t.default=function(e){return e?e.slice(0,Object(n.default)(e)+1).replace(i,""):e}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_freeGlobal.js":function(e,t,r){r.r(t),function(e){var r="object"==typeof e&&e&&e.Object===Object&&e;t.default=r}.call(this,r("../../node_modules/.pnpm/webpack@4.46.0_webpack-command@0.4.2/node_modules/webpack/buildin/global.js"))},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_getRawTag.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_Symbol.js"),i=Object.prototype,o=i.hasOwnProperty,s=i.toString,a=n.default?n.default.toStringTag:void 0;t.default=function(e){var t=o.call(e,a),r=e[a];try{e[a]=void 0;var n=!0}catch(e){}var i=s.call(e);return n&&(t?e[a]=r:delete e[a]),i}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_objectToString.js":function(e,t,r){r.r(t);var n=Object.prototype.toString;t.default=function(e){return n.call(e)}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_root.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_freeGlobal.js"),i="object"==typeof self&&self&&self.Object===Object&&self,o=n.default||i||Function("return this")();t.default=o},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_trimmedEndIndex.js":function(e,t,r){r.r(t);var n=/\s/;t.default=function(e){for(var t=e.length;t--&&n.test(e.charAt(t)););return t}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/debounce.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/isObject.js"),i=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/now.js"),o=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/toNumber.js"),s="Expected a function",a=Math.max,u=Math.min;t.default=function(e,t,r){var c,l,d,f,p,_,h=0,E=!1,m=!1,g=!0;if("function"!=typeof e)throw new TypeError(s);function v(t){var r=c,n=l;return c=l=void 0,h=t,f=e.apply(n,r)}function S(e){var r=e-_;return void 0===_||r>=t||r<0||m&&e-h>=d}function y(){var e=Object(i.default)();if(S(e))return T(e);p=setTimeout(y,function(e){var r=t-(e-_);return m?u(r,d-(e-h)):r}(e))}function T(e){return p=void 0,g&&c?v(e):(c=l=void 0,f)}function A(){var e=Object(i.default)(),r=S(e);if(c=arguments,l=this,_=e,r){if(void 0===p)return function(e){return h=e,p=setTimeout(y,t),E?v(e):f}(_);if(m)return clearTimeout(p),p=setTimeout(y,t),v(_)}return void 0===p&&(p=setTimeout(y,t)),f}return t=Object(o.default)(t)||0,Object(n.default)(r)&&(E=!!r.leading,d=(m="maxWait"in r)?a(Object(o.default)(r.maxWait)||0,t):d,g="trailing"in r?!!r.trailing:g),A.cancel=function(){void 0!==p&&clearTimeout(p),h=0,c=_=l=p=void 0},A.flush=function(){return void 0===p?f:T(Object(i.default)())},A}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/isObject.js":function(e,t,r){r.r(t),t.default=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/isObjectLike.js":function(e,t,r){r.r(t),t.default=function(e){return null!=e&&"object"==typeof e}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/isSymbol.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_baseGetTag.js"),i=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/isObjectLike.js"),o="[object Symbol]";t.default=function(e){return"symbol"==typeof e||Object(i.default)(e)&&Object(n.default)(e)==o}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/now.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_root.js");t.default=function(){return n.default.Date.now()}},"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/toNumber.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/_baseTrim.js"),i=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/isObject.js"),o=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/isSymbol.js"),s=NaN,a=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;t.default=function(e){if("number"==typeof e)return e;if(Object(o.default)(e))return s;if(Object(i.default)(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Object(i.default)(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Object(n.default)(e);var r=u.test(e);return r||c.test(e)?l(e.slice(2),r?2:8):a.test(e)?s:+e}},"../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js":function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var u,c=[],l=!1,d=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):d=-1,c.length&&p())}function p(){if(!l){var e=a(f);l=!0;for(var t=c.length;t;){for(u=c,c=[];++d<t;)u&&u[d].run();d=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function _(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new _(e,t)),1!==c.length||l||a(p)},_.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/minimal.js":function(e,t,r){e.exports=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/index-minimal.js")},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/index-minimal.js":function(e,t,r){var n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/writer.js"),n.BufferWriter=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/writer_buffer.js"),n.Reader=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/reader.js"),n.BufferReader=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/reader_buffer.js"),n.util=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/util/minimal.js"),n.rpc=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/rpc.js"),n.roots=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/roots.js"),n.configure=i,i()},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/reader.js":function(e,t,r){e.exports=u;var n,i=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/util/minimal.js"),o=i.LongBits,s=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")},l=function(){return i.Buffer?function(e){return(u.create=function(e){return i.Buffer.isBuffer(e)?new n(e):c(e)})(e)}:c};function d(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function f(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new o(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}u.create=l(),u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return e}}(),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return f(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|f(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},u.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){n=e,u.create=l(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/reader_buffer.js":function(e,t,r){e.exports=o;var n=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/reader.js");(o.prototype=Object.create(n.prototype)).constructor=o;var i=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/util/minimal.js");function o(e){n.call(this,e)}o._configure=function(){i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice)},o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},o._configure()},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/roots.js":function(e,t,r){e.exports={}},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/rpc.js":function(e,t,r){t.Service=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/rpc/service.js")},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/rpc/service.js":function(e,t,r){e.exports=i;var n=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/util/minimal.js");function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,o,s){if(!o)throw TypeError("request must be specified");var a=this;if(!s)return n.asPromise(e,a,t,r,i,o);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(e,r){if(e)return a.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof i))try{r=i[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",r,t),s(null,r)}a.end(!0)})}catch(e){return a.emit("error",e,t),void setTimeout(function(){s(e)},0)}else setTimeout(function(){s(Error("already ended"))},0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/util/longbits.js":function(e,t,r){e.exports=i;var n=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/util/minimal.js");function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var s=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===s?o:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/util/minimal.js":function(e,t,r){(function(e){var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function o(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:()=>e,set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r("../../node_modules/.pnpm/@protobufjs+aspromise@1.1.2/node_modules/@protobufjs/aspromise/index.js"),n.base64=r("../../node_modules/.pnpm/@protobufjs+base64@1.1.2/node_modules/@protobufjs/base64/index.js"),n.EventEmitter=r("../../node_modules/.pnpm/@protobufjs+eventemitter@1.1.0/node_modules/@protobufjs/eventemitter/index.js"),n.float=r("../../node_modules/.pnpm/@protobufjs+float@1.0.2/node_modules/@protobufjs/float/index.js"),n.inquire=r("../../node_modules/.pnpm/@protobufjs+inquire@1.1.0/node_modules/@protobufjs/inquire/index.js"),n.utf8=r("../../node_modules/.pnpm/@protobufjs+utf8@1.1.0/node_modules/@protobufjs/utf8/index.js"),n.pool=r("../../node_modules/.pnpm/@protobufjs+pool@1.1.0/node_modules/@protobufjs/pool/index.js"),n.LongBits=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/util/longbits.js"),n.isNode=Boolean(void 0!==e&&e&&e.process&&e.process.versions&&e.process.versions.node),n.global=n.isNode&&e||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||globalThis,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=o,n.ProtocolError=o("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}).call(this,r("../../node_modules/.pnpm/webpack@4.46.0_webpack-command@0.4.2/node_modules/webpack/buildin/global.js"))},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/writer.js":function(e,t,r){e.exports=l;var n,i=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/util/minimal.js"),o=i.LongBits,s=i.base64,a=i.utf8;function u(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function c(){}function l(){this.len=0,this.head=new u(c,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(l.create=function(){return new n})()}:function(){return new l}};function f(e,t,r){t[r]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function _(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function h(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}l.create=d(),l.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(l.alloc=i.pool(l.alloc,i.Array.prototype.subarray)),l.prototype._push=function(e,t,r){return this.tail=this.tail.next=new u(e,t,r),this.len+=t,this},p.prototype=Object.create(u.prototype),p.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},l.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},l.prototype.int32=function(e){return e<0?this._push(_,10,o.fromNumber(e)):this.uint32(e)},l.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},l.prototype.uint64=function(e){var t=o.from(e);return this._push(_,t.length(),t)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(_,t.length(),t)},l.prototype.bool=function(e){return this._push(f,1,e?1:0)},l.prototype.fixed32=function(e){return this._push(h,4,e>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(e){var t=o.from(e);return this._push(h,4,t.lo)._push(h,4,t.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},l.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var E=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};l.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var r=l.alloc(t=s.length(e));s.decode(e,r,0),e=r}return this.uint32(t)._push(E,t,e)},l.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(f,1,0)},l.prototype.fork=function(){return this.states=new function(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}(this),this.head=this.tail=new u(c,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(c,0,0),this.len=0),this},l.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},l.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},l._configure=function(e){n=e,l.create=d(),n._configure()}},"../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/writer_buffer.js":function(e,t,r){e.exports=o;var n=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/writer.js");(o.prototype=Object.create(n.prototype)).constructor=o;var i=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/src/util/minimal.js");function o(){n.call(this)}function s(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}o._configure=function(){o.alloc=i._Buffer_allocUnsafe,o.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},o.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(o.writeBytesBuffer,t,e),this},o.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(s,t,e),this},o._configure()},"../../node_modules/.pnpm/setimmediate@1.0.5/node_modules/setimmediate/setImmediate.js":function(e,t,r){(function(e,t){!function(e,r){if(!e.setImmediate){var n,i=1,o={},s=!1,a=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick(function(){l(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?function(){var t="setImmediate$"+Math.random()+"$",r=function(r){r.source===e&&"string"==typeof r.data&&0===r.data.indexOf(t)&&l(+r.data.slice(t.length))};e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),n=function(r){e.postMessage(t+r,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){l(e.data)},n=function(t){e.port2.postMessage(t)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var e=a.documentElement;n=function(t){var r=a.createElement("script");r.onreadystatechange=function(){l(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}():n=function(e){setTimeout(l,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var s={callback:e,args:t};return o[i]=s,n(i),i++},u.clearImmediate=c}function c(e){delete o[e]}function l(e){if(s)setTimeout(l,0,e);else{var t=o[e];if(t){s=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n)}}(t)}finally{c(e),s=!1}}}}}("undefined"==typeof self?void 0===e?globalThis:e:self)}).call(this,r("../../node_modules/.pnpm/webpack@4.46.0_webpack-command@0.4.2/node_modules/webpack/buildin/global.js"),r("../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js"))},"../../node_modules/.pnpm/timers-browserify@2.0.12/node_modules/timers-browserify/main.js":function(e,t,r){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r("../../node_modules/.pnpm/setimmediate@1.0.5/node_modules/setimmediate/setImmediate.js"),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||globalThis&&globalThis.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||globalThis&&globalThis.clearImmediate}).call(this,r("../../node_modules/.pnpm/webpack@4.46.0_webpack-command@0.4.2/node_modules/webpack/buildin/global.js"))},"../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js":function(e,t,r){r.r(t),r.d(t,"__extends",function(){return i}),r.d(t,"__assign",function(){return o}),r.d(t,"__rest",function(){return s}),r.d(t,"__decorate",function(){return a}),r.d(t,"__param",function(){return u}),r.d(t,"__metadata",function(){return c}),r.d(t,"__awaiter",function(){return l}),r.d(t,"__generator",function(){return d}),r.d(t,"__createBinding",function(){return f}),r.d(t,"__exportStar",function(){return p}),r.d(t,"__values",function(){return _}),r.d(t,"__read",function(){return h}),r.d(t,"__spread",function(){return E}),r.d(t,"__spreadArrays",function(){return m}),r.d(t,"__spreadArray",function(){return g}),r.d(t,"__await",function(){return v}),r.d(t,"__asyncGenerator",function(){return S}),r.d(t,"__asyncDelegator",function(){return y}),r.d(t,"__asyncValues",function(){return T}),r.d(t,"__makeTemplateObject",function(){return A}),r.d(t,"__importStar",function(){return C}),r.d(t,"__importDefault",function(){return O}),r.d(t,"__classPrivateFieldGet",function(){return I}),r.d(t,"__classPrivateFieldSet",function(){return R}),r.d(t,"__classPrivateFieldIn",function(){return w});var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){Object.defineProperty(this,"constructor",{value:e})}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function a(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}function u(e,t){return function(r,n){t(r,n,e)}}function c(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(s,a)}u((n=n.apply(e,t||[])).next())})}function d(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}var f=Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function p(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||f(t,e,r)}function _(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function E(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e}function m(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n}function g(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function v(e){return this instanceof v?(this.v=e,this):new v(e)}function S(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){i[e]&&(n[e]=function(t){return new Promise(function(r,n){o.push([e,t,r,n])>1||a(e,t)})})}function a(e,t){try{!function(e){e.value instanceof v?Promise.resolve(e.value.v).then(u,c):l(o[0][2],e)}(i[e](t))}catch(e){l(o[0][3],e)}}function u(e){a("next",e)}function c(e){a("throw",e)}function l(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function y(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:v(e[n](t)),done:"return"===n}:i?i(t):t}:i}}function T(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=_(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,i,(t=e[r](t)).done,t.value)})}}}function A(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var b=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function C(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&f(t,e,r);return b(t,e),t}function O(e){return e&&e.__esModule?e:{default:e}}function I(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function R(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r}function w(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/index.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v1.js");r.d(t,"v1",function(){return n.default});var i=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v3.js");r.d(t,"v3",function(){return i.default});var o=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v4.js");r.d(t,"v4",function(){return o.default});var s=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v5.js");r.d(t,"v5",function(){return s.default});var a=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/nil.js");r.d(t,"NIL",function(){return a.default});var u=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/version.js");r.d(t,"version",function(){return u.default});var c=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/validate.js");r.d(t,"validate",function(){return c.default});var l=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/stringify.js");r.d(t,"stringify",function(){return l.default});var d=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/parse.js");r.d(t,"parse",function(){return d.default})},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/md5.js":function(e,t,r){function n(e){return 14+(e+64>>>9<<4)+1}function i(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function o(e,t,r,n,o,s){return i(function(e,t){return e<<t|e>>>32-t}(i(i(t,e),i(n,s)),o),r)}function s(e,t,r,n,i,s,a){return o(t&r|~t&n,e,t,i,s,a)}function a(e,t,r,n,i,s,a){return o(t&n|r&~n,e,t,i,s,a)}function u(e,t,r,n,i,s,a){return o(t^r^n,e,t,i,s,a)}function c(e,t,r,n,i,s,a){return o(r^(t|~n),e,t,i,s,a)}r.r(t),t.default=function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,n=0;n<r;n+=8){var i=e[n>>5]>>>n%32&255,o=parseInt("0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[n(t)-1]=t;for(var r=1732584193,o=-271733879,l=-1732584194,d=271733878,f=0;f<e.length;f+=16){var p=r,_=o,h=l,E=d;r=s(r,o,l,d,e[f],7,-680876936),d=s(d,r,o,l,e[f+1],12,-389564586),l=s(l,d,r,o,e[f+2],17,606105819),o=s(o,l,d,r,e[f+3],22,-1044525330),r=s(r,o,l,d,e[f+4],7,-176418897),d=s(d,r,o,l,e[f+5],12,1200080426),l=s(l,d,r,o,e[f+6],17,-1473231341),o=s(o,l,d,r,e[f+7],22,-45705983),r=s(r,o,l,d,e[f+8],7,1770035416),d=s(d,r,o,l,e[f+9],12,-1958414417),l=s(l,d,r,o,e[f+10],17,-42063),o=s(o,l,d,r,e[f+11],22,-1990404162),r=s(r,o,l,d,e[f+12],7,1804603682),d=s(d,r,o,l,e[f+13],12,-40341101),l=s(l,d,r,o,e[f+14],17,-1502002290),o=s(o,l,d,r,e[f+15],22,1236535329),r=a(r,o,l,d,e[f+1],5,-165796510),d=a(d,r,o,l,e[f+6],9,-1069501632),l=a(l,d,r,o,e[f+11],14,643717713),o=a(o,l,d,r,e[f],20,-373897302),r=a(r,o,l,d,e[f+5],5,-701558691),d=a(d,r,o,l,e[f+10],9,38016083),l=a(l,d,r,o,e[f+15],14,-660478335),o=a(o,l,d,r,e[f+4],20,-405537848),r=a(r,o,l,d,e[f+9],5,568446438),d=a(d,r,o,l,e[f+14],9,-1019803690),l=a(l,d,r,o,e[f+3],14,-187363961),o=a(o,l,d,r,e[f+8],20,1163531501),r=a(r,o,l,d,e[f+13],5,-1444681467),d=a(d,r,o,l,e[f+2],9,-51403784),l=a(l,d,r,o,e[f+7],14,1735328473),o=a(o,l,d,r,e[f+12],20,-1926607734),r=u(r,o,l,d,e[f+5],4,-378558),d=u(d,r,o,l,e[f+8],11,-2022574463),l=u(l,d,r,o,e[f+11],16,1839030562),o=u(o,l,d,r,e[f+14],23,-35309556),r=u(r,o,l,d,e[f+1],4,-1530992060),d=u(d,r,o,l,e[f+4],11,1272893353),l=u(l,d,r,o,e[f+7],16,-155497632),o=u(o,l,d,r,e[f+10],23,-1094730640),r=u(r,o,l,d,e[f+13],4,681279174),d=u(d,r,o,l,e[f],11,-358537222),l=u(l,d,r,o,e[f+3],16,-722521979),o=u(o,l,d,r,e[f+6],23,76029189),r=u(r,o,l,d,e[f+9],4,-640364487),d=u(d,r,o,l,e[f+12],11,-421815835),l=u(l,d,r,o,e[f+15],16,530742520),o=u(o,l,d,r,e[f+2],23,-995338651),r=c(r,o,l,d,e[f],6,-198630844),d=c(d,r,o,l,e[f+7],10,1126891415),l=c(l,d,r,o,e[f+14],15,-1416354905),o=c(o,l,d,r,e[f+5],21,-57434055),r=c(r,o,l,d,e[f+12],6,1700485571),d=c(d,r,o,l,e[f+3],10,-1894986606),l=c(l,d,r,o,e[f+10],15,-1051523),o=c(o,l,d,r,e[f+1],21,-2054922799),r=c(r,o,l,d,e[f+8],6,1873313359),d=c(d,r,o,l,e[f+15],10,-30611744),l=c(l,d,r,o,e[f+6],15,-1560198380),o=c(o,l,d,r,e[f+13],21,1309151649),r=c(r,o,l,d,e[f+4],6,-145523070),d=c(d,r,o,l,e[f+11],10,-1120210379),l=c(l,d,r,o,e[f+2],15,718787259),o=c(o,l,d,r,e[f+9],21,-343485551),r=i(r,p),o=i(o,_),l=i(l,h),d=i(d,E)}return[r,o,l,d]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(n(t)),i=0;i<t;i+=8)r[i>>5]|=(255&e[i/8])<<i%32;return r}(e),8*e.length))}},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/nil.js":function(e,t,r){r.r(t),t.default="00000000-0000-0000-0000-000000000000"},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/parse.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/validate.js");t.default=function(e){if(!Object(n.default)(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/regex.js":function(e,t,r){r.r(t),t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/rng.js":function(e,t,r){var n;r.r(t),r.d(t,"default",function(){return o});var i=new Uint8Array(16);function o(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)}},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/sha1.js":function(e,t,r){function n(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:return t^r^n;case 2:return t&r^t&n^r&n;case 3:return t^r^n}}function i(e,t){return e<<t|e>>>32-t}r.r(t),t.default=function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var o=unescape(encodeURIComponent(e));e=[];for(var s=0;s<o.length;++s)e.push(o.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var a=e.length/4+2,u=Math.ceil(a/16),c=new Array(u),l=0;l<u;++l){for(var d=new Uint32Array(16),f=0;f<16;++f)d[f]=e[64*l+4*f]<<24|e[64*l+4*f+1]<<16|e[64*l+4*f+2]<<8|e[64*l+4*f+3];c[l]=d}c[u-1][14]=8*(e.length-1)/Math.pow(2,32),c[u-1][14]=Math.floor(c[u-1][14]),c[u-1][15]=8*(e.length-1)&4294967295;for(var p=0;p<u;++p){for(var _=new Uint32Array(80),h=0;h<16;++h)_[h]=c[p][h];for(var E=16;E<80;++E)_[E]=i(_[E-3]^_[E-8]^_[E-14]^_[E-16],1);for(var m=r[0],g=r[1],v=r[2],S=r[3],y=r[4],T=0;T<80;++T){var A=Math.floor(T/20),b=i(m,5)+n(A,g,v,S)+y+t[A]+_[T]>>>0;y=S,S=v,v=i(g,30)>>>0,g=m,m=b}r[0]=r[0]+m>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+v>>>0,r[3]=r[3]+S>>>0,r[4]=r[4]+y>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/stringify.js":function(e,t,r){r.r(t);for(var n=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/validate.js"),i=[],o=0;o<256;++o)i.push((o+256).toString(16).substr(1));t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!Object(n.default)(r))throw TypeError("Stringified UUID is invalid");return r}},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v1.js":function(e,t,r){r.r(t);var n,i,o=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/rng.js"),s=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/stringify.js"),a=0,u=0;t.default=function(e,t,r){var c=t&&r||0,l=t||new Array(16),d=(e=e||{}).node||n,f=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==f){var p=e.random||(e.rng||o.default)();null==d&&(d=n=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==f&&(f=i=16383&(p[6]<<8|p[7]))}var _=void 0!==e.msecs?e.msecs:Date.now(),h=void 0!==e.nsecs?e.nsecs:u+1,E=_-a+(h-u)/1e4;if(E<0&&void 0===e.clockseq&&(f=f+1&16383),(E<0||_>a)&&void 0===e.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=_,u=h,i=f;var m=(1e4*(268435455&(_+=122192928e5))+h)%4294967296;l[c++]=m>>>24&255,l[c++]=m>>>16&255,l[c++]=m>>>8&255,l[c++]=255&m;var g=_/4294967296*1e4&268435455;l[c++]=g>>>8&255,l[c++]=255&g,l[c++]=g>>>24&15|16,l[c++]=g>>>16&255,l[c++]=f>>>8|128,l[c++]=255&f;for(var v=0;v<6;++v)l[c+v]=d[v];return t||Object(s.default)(l)}},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v3.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v35.js"),i=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/md5.js"),o=Object(n.default)("v3",48,i.default);t.default=o},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v35.js":function(e,t,r){r.r(t),r.d(t,"DNS",function(){return o}),r.d(t,"URL",function(){return s});var n=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/stringify.js"),i=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/parse.js");var o="6ba7b810-9dad-11d1-80b4-00c04fd430c8",s="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.default=function(e,t,r){function a(e,o,s,a){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof o&&(o=Object(i.default)(o)),16!==o.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+e.length);if(u.set(o),u.set(e,o.length),(u=r(u))[6]=15&u[6]|t,u[8]=63&u[8]|128,s){a=a||0;for(var c=0;c<16;++c)s[a+c]=u[c];return s}return Object(n.default)(u)}try{a.name=e}catch(e){}return a.DNS=o,a.URL=s,a}},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v4.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/rng.js"),i=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/stringify.js");t.default=function(e,t,r){var o=(e=e||{}).random||(e.rng||n.default)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){r=r||0;for(var s=0;s<16;++s)t[r+s]=o[s];return t}return Object(i.default)(o)}},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v5.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v35.js"),i=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/sha1.js"),o=Object(n.default)("v5",80,i.default);t.default=o},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/validate.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/regex.js");t.default=function(e){return"string"==typeof e&&n.default.test(e)}},"../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/version.js":function(e,t,r){r.r(t);var n=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/validate.js");t.default=function(e){if(!Object(n.default)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},"../../node_modules/.pnpm/webpack@4.46.0_webpack-command@0.4.2/node_modules/webpack/buildin/global.js":function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},"./src/cloud/index.ts":function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceCloud=t.DefaultCloud=t.getCloudAPI=t.getCloudInstance=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/merge.ts"),o=r("./src/services/index.ts"),s=r("@web"),a=r("./src/utils/error.ts"),u=r("./src/utils/type.ts"),c=r("./src/network/tunnel.ts"),l=r("./src/config/error.config.ts"),d=r("./src/externals/public-lib/appserviceSdk.ts"),f=r("./src/externals/globals/wxconfig.ts"),p=r("./src/utils/report.ts"),_=r("./src/config/app.config.ts"),h=r("./src/runtime/runtime.ts"),E=r("@web"),m=r("./src/utils/service-endpoint.ts"),g=r("./src/utils/utils.ts"),v=r("./src/utils/userAgent.ts"),S=r("./src/externals/globals/wxconfig.ts");t.getCloudInstance=function(e){void 0===e&&(e={});var t=e.sdk,r=e.identifiers||{};return t&&(0,d.setSDK)(r,t),new y(r,!1)};t.getCloudAPI=function(e){return void 0===e&&(e={}),(0,t.getCloudInstance)(e).exportAPI};var y=function(){function t(t,i){var s=this;this.inited=!1,this.services={},this.apiServiceMap={},this.debug=!1,this.testSpeed=function(){return n.__awaiter(s,void 0,void 0,function(){var e,t,r;return n.__generator(this,function(n){return e=+new Date,t=e,r=(0,c.constructTunnelReq)({cloud:this,apiName:"tcbapi_testspeed",serializedReqData:null}),[2,(0,c.tunnel)(r,{fireOnIdle:!0,onFire:function(){e=+new Date,t=e}}).then(function(r){(0,p.reportAPISpeed)({apiName:"cloud.testspeed",apiEndTime:+new Date,apiStartTime:e,tunnelEndTime:+new Date,tunnelStartTime:t,tunnelTimeNoCSNetCost:r.data.baseresponse.stat.qbase_cost_time})}).catch(function(e){0})]})})},this.identifiers=t,this.isInstance=i,this.runtimeInfo=(0,h.getRuntimeInfo)(),this.serviceEndpoint=new m.ServiceEndpoint(t),this.request=(0,c.getBoundTunnelRequest)({cloud:this});var a=this;this.exportAPI={init:this.init.bind(this)},this.isInstance||(this.exportAPI.Cloud=function(e){return new T(t,a,e).exportAPI}),(0,o.registerServices)(this),this.meta={session_id:Date.now()+""},e.env.WEB&&(this.meta.session_id=r("../../node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/index.js").v4()),this.serviceEndpoint.setMetaData(this.getMetaData()),this.serviceEndpoint.setTunnelRequest(this.request),this.config={database:A()},this.appConfig=n.__assign({},_.default),this.apiPermissions={};try{f.default.onReady(function(){setTimeout(function(){(0,p.init)()},2e3),(0,v.getUA)()}),e.env.TEST&&(this.exportAPI.getCloudInstance=function(){return s})}catch(e){}}return t.prototype.getMetaData=function(){var t;if(!this.meta.sdk_version){var r=(0,d.getSDK)(this.identifiers);if(r){var n=r.wx;n&&n.version&&("miniprogram"===this.runtimeInfo.env?this.meta.sdk_version="wx-miniprogram-sdk/".concat(n.version.version," (").concat(Date.parse("".concat(n.version.updateTime," GMT+0800")),")"):this.meta.sdk_version="wx-web-sdk/".concat(e.env.SDKVERSION," (").concat(Date.parse("".concat(e.env.SDKVERSION_UPDATETIME," GMT+0800")),")"))}}return this.meta.filter_user_info="singlePage"===(null===(t=S.default.appLaunchInfo)||void 0===t?void 0:t.mode),this.meta},t.prototype.getConfig=function(){return this.config},t.prototype.getEnvForService=function(e){if(this.isInstance)return this.instanceOptions.resourceEnv;var t=this.config;if(t.env)switch((0,u.getType)(t.env)){case"string":return t.env;case"object":return t.env[e];default:return}},t.prototype.checkAPIPermission=function(e){return!this.apiPermissions.hasOwnProperty(e)||1===this.apiPermissions[e]},t.prototype.init=function(e){var t=this;void 0===e&&(e={}),this.inited=!0,this.initConfig(e),setTimeout(function(){r("./src/utils/asmcrypto.ts")}),e.prefetch&&this.serviceEndpoint.getEndpoint("container").catch(function(e){});try{(0,g.privateGetBackgroundFetchData)(500,this.identifiers)}catch(e){null===g._wxConsole||void 0===g._wxConsole||g._wxConsole.log("privateGetBackgroundFetchData error",e)}return Promise.all([this.sendInitRequest().then(function(){t.testSpeed()})]).then(function(){})},t.prototype.initConfig=function(e){this.config=JSON.parse(JSON.stringify(e)),this.config.database?this.config.database=(0,i.default)(this.config.database,A()):this.config.database=A()},t.prototype.sendInitRequest=function(){var e=this,t="string"==typeof this.config.env?this.config.env:void 0,r=JSON.stringify({trace_user:!1!==this.config.traceUser,env:t,region:this.config.region}),i=+new Date,o=i;return this.request(n.__assign(n.__assign({},this.config),{apiName:"tcbapi_init",serializedReqData:r,env:t})).then(function(t){var r=+new Date,s=t.data;e.appConfig=n.__assign(n.__assign({},e.appConfig),s.config);for(var a=s.tcb_api_list||[],u=0,c=a.length;u<c;u++)e.apiPermissions[a[u].apiname]=a[u].status;(0,p.reportAPISpeed)({apiName:"cloud.init",apiEndTime:+new Date,apiStartTime:i,tunnelEndTime:r,tunnelStartTime:o,tunnelTimeNoCSNetCost:s.baseresponse.stat.qbase_cost_time})}).catch(function(e){console.error("cloud init error: ",e)})},t.prototype.registerService=function(e){this.services[e.name]=e;var t=e.getAPIs();for(var r in t)if(this.apiServiceMap[r]=e.name,"function"==typeof t[r])this.registerFunction(r,!0,t[r]);else{var n=t[r],i=n.initRequired,o=n.fn;this.registerFunction(r,i,o)}},t.prototype.registerFunction=function(e,t,r){var n=this;this.exportAPI[e]=t?function(){if(!n.inited)throw new a.CloudSDKError({errMsg:"Cloud API isn't enabled, please call wx.cloud.init first\n wx.cloud.init()  API"});if(!n.checkAPIPermission(e))throw new a.CloudSDKError({errCode:l.ERR_CODE.SDK_API_PERMISSION_DENIED,errMsg:l.ERR_CODE[l.ERR_CODE.SDK_API_PERMISSION_DENIED]});return r.apply(n,arguments)}:r},t.prototype.toJSON=function(){},t}();t.DefaultCloud=y;var T=function(e){function t(t,r,n){var o=e.call(this,t,!0)||this;if("web"===o.runtimeInfo.env){if(!n.identityless&&!n.appid)throw new Error("appid must be provided");if(!n.resourceAppid)throw new Error("resourceAppid must be provided")}if(!n.resourceEnv)throw new Error("resourceEnv must be provided");if(n.config||(n.config={}),o.defaultInstance=r,o.instanceOptions=JSON.parse(JSON.stringify(n)),o.meta=r.meta,o.apiPermissions=r.apiPermissions,o.instanceOptions.config.database=(0,i.default)(A(),o.instanceOptions.config.database||{}),"web"===o.runtimeInfo.env){if(o.exportAPI.init=o.webInit.bind(o),o.webRequest=(0,E.getBoundAuthRequest)(o),o.registerService((0,s.createWebService)(o)),!o.instanceOptions.identityless&&(o.authStorage=o.defaultInstance.authStorage,!o.authStorage))throw new Error("authStorage not found")}else o.exportAPI.init=o.miniprogramInit.bind(o);return o.instanceOptions.resourceAppid&&(o.exportAPI.refreshAuth=o.refreshAuth.bind(o)),o}return n.__extends(t,e),t.prototype.miniprogramInit=function(){return n.__awaiter(this,void 0,void 0,function(){var t,r;return n.__generator(this,function(n){switch(n.label){case 0:return this.inited?[2]:this.instanceOptions.resourceAppid?[4,this.refreshAuth()]:[3,2];case 1:return t=n.sent(),0===(r=t.data.env_auth_info).errCode?(e.prototype.init.call(this),[2,{errCode:r.errCode,errMsg:r.errMsg,expireTime:1e3*r.expire_time}]):[2,{errCode:r.errCode,errMsg:r.errMsg}];case 2:return e.prototype.init.call(this),[2]}})})},t.prototype.webInit=function(){return n.__awaiter(this,void 0,void 0,function(){var t,r,i=this;return n.__generator(this,function(n){switch(n.label){case 0:return this.inited?[2]:this.instanceOptions.identityless?[3,2]:[4,this.refreshAuth()];case 1:return t=n.sent(),0===(r=t.data.env_auth_info).errCode?(this.sendInitRequest().then(function(){i.testSpeed()}),e.prototype.init.call(this),[2,{errCode:r.errCode,errMsg:r.errMsg,expireTime:1e3*r.expire_time}]):[2,{errCode:r.errCode,errMsg:r.errMsg}];case 2:return this.inited=!0,[2]}})})},t.prototype.webRefreshToken=function(){return n.__awaiter(this,void 0,void 0,function(){var e=this;return n.__generator(this,function(t){return this._webCurrentRefreshTokenPromise?[2,this._webCurrentRefreshTokenPromise]:(this._webCurrentRefreshTokenPromise=new Promise(function(t,r){return n.__awaiter(e,void 0,void 0,function(){var e,i,o;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,3,4]),[4,this.webRequest({url:"/refresh_token",method:"POST",json:{appid:this.instanceOptions.appid,refresh_token:this.authStorage.getItem("refreshToken")}})];case 1:return e=n.sent(),i=e.data,this.authStorage.setItem("appid",i.access_token),t(),[3,4];case 2:return o=n.sent(),r(o),[3,4];case 3:return this._webCurrentRefreshTokenPromise=void 0,[7];case 4:return[2]}})})}),[2,this._webCurrentRefreshTokenPromise])})})},t.prototype.refreshAuth=function(){var e=JSON.stringify({resource_appid:this.instanceOptions.resourceAppid,resource_env:this.instanceOptions.resourceEnv}),t=+new Date,r=t,n=this.request({apiName:"tcbapi_getenvauth",serializedReqData:e});return n.then(function(e){var n=+new Date;(0,p.reportAPISpeed)({apiName:"cloud.refreshAuth",apiEndTime:+new Date,apiStartTime:t,tunnelEndTime:n,tunnelStartTime:r})}),n},t}(y);function A(){return{realtime:{maxReconnect:_.clientConfigDefaults.REALTIME_DB_MAX_RECONNECT,reconnectInterval:_.clientConfigDefaults.REALTIME_DB_WS_RECONNECT_INTERVAL,totalConnectionTimeout:_.clientConfigDefaults.REALTIME_DB_TOTAL_CONNECTION_TIMEOUT}}}t.InstanceCloud=T}).call(this,r("../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js"))},"./src/config/app.config.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.clientConfigDefaults=t.serverConfigurable=void 0,t.serverConfigurable={db_doc_size_limit:524288,db_realtime_ping_interval:15e3,db_realtime_pong_wait_timeout:15e3,db_realtime_query_event_cache_timeout:18e4,upload_max_file_size:20971520,get_temp_file_url_max_requests:50,call_function_poll_max_retry:10,call_function_max_req_data_size:5242880,call_function_client_poll_timeout:15e3,call_function_valid_start_retry_gap:6e4,call_container_poll_max_retry:10,call_container_client_poll_timeout:15e3,call_container_valid_start_retry_gap:6e4,call_container_max_req_data_size:5242880,call_container_use_private_http:0},t.clientConfigDefaults={REALTIME_DB_MAX_RECONNECT:5,REALTIME_DB_WS_RECONNECT_INTERVAL:5e3,REALTIME_DB_TOTAL_CONNECTION_TIMEOUT:1/0},t.default=t.serverConfigurable},"./src/config/error.config.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_CODE=void 0,t.ERR_CODE={"-1":"",UNKNOWN_ERROR:-1,"-401001":"api permission denied",SDK_API_PERMISSION_DENIED:-401001,"-401002":"api parameter error",SDK_API_PARAMETER_ERROR:-401002,"-401003":"api parameter type error",SDK_API_PARAMETER_TYPE_ERROR:-401003,"-402001":"circular reference detected",SDK_DATABASE_CIRCULAR_REFERENCE:-402001,"-402002":"realtime listener init watch fail",SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:-402002,"-402003":"realtime listener reconnect ws fail",SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WS_FAIL:-402003,"-402004":"realtime listener rebuild watch fail",SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL:-402004,"-402005":"realtime listener close watch fail",SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL:-402005,"-402006":"realtime listener receive server error msg",SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG:-402006,"-402007":"realtime listener receive invalid server data",SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA:-402007,"-402008":"realtime listener websocket connection error",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR:-402008,"-402009":"realtime listener websocket connection closed",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED:-402009,"-402010":"realtime listener check last fail",SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL:-402010,"-402011":"realtime listener unexpected fatal error",SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR:-402011,"-402012":"realtime listener init ws fail",SDK_DATABASE_REALTIME_LISTENER_INIT_WS_FAIL:-402012,"-403001":"max upload file size exceeded",SDK_STORAGE_EXCEED_MAX_UPLOAD_SIZE:-403001,"-403002":"internal server error: empty upload url",SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL:-403002,"-403003":"internal server error: empty download url",SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL:-403003,"-404001":"empty call result",SDK_FUNCTIONS_EMPTY_CALL_RESULT:-404001,"-404002":"empty event id",SDK_FUNCTIONS_EMPTY_EVENT_ID:-404002,"-404003":"empty poll url",SDK_FUNCTIONS_EMPTY_POLL_URL:-404003,"-404004":"empty poll result json",SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON:-404004,"-404005":"exceed max poll retry",SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY:-404005,"-404006":"empty poll result base resp",SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP:-404006,"-404007":"poll result base resp ret abnormal",SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL:-404007,"-404008":"poll result status code error",SDK_FUNCTIONS_POLL_RESULT_STATUS_CODE_ERROR:-404008,"-404009":"poll error",SDK_FUNCTIONS_POLL_ERROR:-404009,"-404010":"result expired",SDK_FUNCTIONS_POLL_RESULT_EXPIRED:-404010,"-404011":"cloud function execution error",SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR:-404011,"-404012":"polling exceed max timeout retry",SDK_FUNCTIONS_EXCEED_MAX_TIMEOUT_POLL_RETRY:-404012,"-404013":"polling exceed max system error retry",SDK_FUNCTIONS_EXCEED_MAX_SYSTEM_ERROR_POLL_RETRY:-404013,"-405001":"empty call result",SDK_CONTAINER_EMPTY_CALL_RESULT:-405001,"-405002":"empty event id",SDK_CONTAINER_EMPTY_EVENT_ID:-405002,"-405003":"empty poll url",SDK_CONTAINER_EMPTY_POLL_URL:-405003,"-405004":"empty poll result json",SDK_CONTAINER_EMPTY_POLL_RESULT_JSON:-405004,"-405005":"exceed max poll retry",SDK_CONTAINER_EXCEED_MAX_POLL_RETRY:-405005,"-405006":"empty poll result base resp",SDK_CONTAINER_EMPTY_POLL_RESULT_BASE_RESP:-405006,"-405007":"poll result base resp ret abnormal",SDK_CONTAINER_POLL_RESULT_BASE_RESP_RET_ABNORMAL:-405007,"-405008":"poll result status code error",SDK_CONTAINER_POLL_RESULT_STATUS_CODE_ERROR:-405008,"-405009":"poll error",SDK_CONTAINER_POLL_ERROR:-405009,"-405010":"result expired",SDK_CONTAINER_POLL_RESULT_EXPIRED:-405010,"-405012":"polling exceed max timeout retry",SDK_CONTAINER_EXCEED_MAX_TIMEOUT_POLL_RETRY:-405012,"-405013":"polling exceed max system error retry",SDK_CONTAINER_EXCEED_MAX_SYSTEM_ERROR_POLL_RETRY:-405013,"-405014":"cannot download result (cdn)",SDK_CONTAINER_DOWNLOAD_RESULT_FROM_CDN_FAIL:-405014,"-601001":"system error",WX_SYSTEM_ERROR:-601001,"-601002":"system args error",WX_SYSTEM_ARGS_ERROR:-601002,"-601003":"system network error",WX_SYSTEM_NETWORK_ERROR:-601003,"-601004":"api permission denied",WX_API_PERMISSION_DENIED:-601004,"-601005":"invalid cloudID",WX_INVALID_CLOUDID:-601005,"-601006":"cloudID expired",WX_CLOUDID_EXPIRED:-601006,"-601007":"cloudID and calling user does not match",WX_CLOUDID_USER_NOT_MATCH:-601007,"-601008":"server-side request timedout",WX_SERVER_REQUEST_TIMEOUT:-601008,"-601009":"missing mobile phone",WX_MISSING_MOBILE_PHONE:-601009,"-601010":"no write permission",WX_NO_WRITE_PERMISSION:-601010,"-601011":"no privilege permission",WX_NO_PRIVILEGE_PERMISSION:-601011,"-601012":"unauthorized env",WX_UNAUTHORIZED_ENV:-601012,"-601013":"no multiend permission",WX_NO_MULTIEND_PERMISSION:-601013,"-601015":"access denied (cloudfunction cloudbase_auth returns empty errCode)",WX_CLOUDBASE_AUTH_RETURN_EMPTY_ERRCODE:-601015,"-601016":"missing env auth info",WX_MISSING_ENV_AUTH_INFO:-601016,"-601017":"access denied (cloudbase_auth returns non-zero errCode)",WX_CLOUDBASE_AUTH_RETURN_NON_ZERO_ERRCODE:-601017,"-602018":"unauthorized API",WX_UNAUTHORIZED_API:-601018,"-602001":"database query result size exceed limit (1MB)",WX_DATABASE_QUERY_SIZE_EXCEED_LIMIT:-602001,"-604001":"cloudfunction result size exceed limit (1MB)",WX_CLOUDFUNCTION_RESULT_SIZE_EXCEED_LIMIT:-604001,"-501001":"resource system error",TCB_RESOURCE_SYSTEM_ERROR:-501001,"-501002":"resource server timeout",TCB_RESOURCE_SERVER_TIMEOUT:-501002,"-501003":"exceed request limit",TCB_EXCEED_REQUEST_LIMIT:-501003,"-501004":"exceed concurrent request limit",TCB_EXCEED_CONCURRENT_REQUEST_LIMIT:-501004,"-501005":"invalid env",TCB_INVALID_ENV:-501005,"-501006":"invalid common parameters",TCB_INVALID_COMMON_PARAM:-501006,"-501007":"invalid parameters",TCB_INVALID_PARAM:-501007,"-501008":"invalid request source",TCB_INVALID_REQUEST_SOURCE:-501008,"-501009":"resource not initialized",TCB_RESOURCE_NOT_INITIALIZED:-501009,"-501010":"tencentcloud key signature verification fail",TCB_KEY_SIGNATURE_VERIFICATION_FAIL:-501010,"-501011":"invalid env status",TCB_INVALID_ENV_STATUS:-501011,"-501012":"invalid api name",TCB_INVALID_API_NAME:-501012,"-501013":"request data size exceeds limit (5M)",TCB_REQ_DATA_EXCEED_LIMIT_5M:-501013,"-501014":"upload file size exceeds limit (5M)",TCB_UPLOAD_FILE_SIZE_EXCEED_LIMIT_5M:-501014,"-501023":"permission denied",TCB_PERMISSION_DENIED:-501023,"-502001":"database request fail",TCB_DB_REQUEST_FAIL:-502001,"-502002":"database invalid command",TCB_DB_INVALID_COMMAND:-502002,"-502003":"database permission denied",TCB_DB_PERMISSION_DENIED:-502003,"-502004":"database exceed collection limit",TCB_DB_EXCEED_COLLECTION_LIMIT:-502004,"-502005":"database collection not exists",TCB_DB_COLLECTION_NOT_EXISTS:-502005,"-503001":"storage request fail",TCB_STORAGE_REQUEST_FAIL:-503001,"-503002":"storage permission denied",TCB_STORAGE_PERMISSION_DENIED:-503002,"-503003":"storage file not exists",TCB_STORAGE_FILE_NOT_EXISTS:-503003,"-503004":"storage invalid sign parameter",TCB_STORAGE_INVALID_SIGN_PARAM:-503004,"-504001":"functions request fail",TCB_FUNCTIONS_REQUEST_FAIL:-504001,"-504002":"functions execute fail",TCB_FUNCTIONS_EXEC_FAIL:-504002}},"./src/config/report.config.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorKey=t.ErrorID=void 0,t.ErrorID=1128,t.ErrorKey={REALTIME_DB_INIT_WS_SUCCESS:1,REALTIME_DB_INIT_WS_FAIL:2,REALTIME_DB_RECONNECT_WS_SUCCESS:3,REALTIME_DB_RECONNECT_WS_FAIL:4,REALTIME_DB_INIT_WATCH_SUCCESS:5,REALTIME_DB_INIT_WATCH_FAIL:6,REALTIME_DB_REBUILD_WATCH_SUCCESS:7,REALTIME_DB_REBUILD_WATCH_FAIL:8,REALTIME_DB_WS_ONERROR_BEFORE_OPEN:9,REALTIME_DB_WS_ONERROR_WHILE_ACTIVE:10,REALTIME_DB_WS_ONCLOSE:11,REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PING_FAIL:12,REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PONG_TIMEOUT:13,REALTIME_DB_WS_ONCLOSE_AB_NORMAL_CLOSURE:14,REALTIME_DB_WS_ONCLOSE_SERVER_CLOSE_NO_AUTH:15,REALTIME_DB_WS_ONCLOSE_UNKNOWN_ORIGIN:16,REALTIME_DB_WS_TOTAL_CONNECTION_TIMEOUT:17,REALTIME_DB_WS_ONCLOSE_SERVER_CLOSE_FOR_UPGRADE:18,REALTIME_DB_RECV_MSG_WITH_CLOSED_WATCHID:30,REALTIME_DB_RECV_MSG_WITH_UNKNOWN_WATCHID:31,REALTIME_DB_RECV_MSG_WITHOUT_WATCHID:32,REALTIME_DB_HANDLE_EVENT_ERROR:33,REALTIME_DB_RECV_DUPLICATE_EVENT:34,REALTIME_DB_RECV_DUPLICATE_EVENT_AND_EVENT_OUT_OF_ORDER:35,REALTIME_DB_UNEXPECTED_EVENT_DATATYPE_UPDATE_NO_ASSOCIATED_DOC:36,REALTIME_DB_UNEXPECTED_EVENT_REMOVE_NO_ASSOCIATED_DOC:37,REALTIME_DB_UNEXPECTED_EVENT_DEQUEUE_NO_ASSOCIATED_DOC:38,REALTIME_DB_UNEXPECTED_EVENT_QUEUETYPE_UPDATE_NO_ASSOCIATED_DOC:39,REALTIME_DB_EVENT_OUT_OF_ORDER:40,REALTIME_DB_INIT_WATCH_FAIL_SERVER_SIGN_ERROR:50,REALTIME_DB_REBUILD_WATCH_FAIL_SERVER_SIGN_ERROR:51,REALTIME_DB_INIT_WATCH_FAIL_SERVER_OTHER_ERROR:52,REALTIME_DB_REBUILD_WATCH_FAIL_SERVER_OTHER_ERROR:53,REALTIME_DB_INIT_WATCH_FAIL_TIMEOUT_ERROR_TOTAL_CONNECTION:54,REALTIME_DB_REBUILD_WATCH_FAIL_TIMEOUT_ERROR_TOTAL_CONNECTION:55,REALTIME_DB_REBUILD_WATCH_FAIL_TIMEOUT_ERROR_QUERY_EVENT_CACHE:56,REALTIME_DB_INIT_WATCH_FAIL_CANCELLED_ERROR:57,REALTIME_DB_REBUILD_WATCH_FAIL_CANCELLED_ERROR:58,REALTIME_DB_INIT_WATCH_FAIL_UNKNOWN_ERROR:59,REALTIME_DB_REBUILD_WATCH_FAIL_UNKNOWN_ERROR:60}},"./src/externals/globals/devtools.ts":function(e,t,r){var n=this;Object.defineProperty(t,"__esModule",{value:!0}),t.autoDevtoolsNetworkLog=t.devtoolsNetworkLog=void 0;var i=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),o=r("./src/externals/globals/wxconfig.ts"),s=r("./src/utils/type.ts"),a=function(e){return i.__assign(i.__assign({},e),{errMsg:void 0})};t.devtoolsNetworkLog=function(e){try{(0,o.isDevTools)()&&"undefined"!=typeof __global&&__global.networkLog&&__global.networkLog(i.__assign(i.__assign({},e),{domain:"cloud",method:"POST",realMethod:e.method,timestampMs:e.timestampMs||+new Date,callFramesIgnoreLength:e.hasOwnProperty("callFramesIgnoreLength")?e.callFramesIgnoreLength:1}))}catch(e){}};t.autoDevtoolsNetworkLog=function(e,r){try{if((0,o.isDevTools)()&&"undefined"!=typeof __global&&__global.networkLog){var u=r(),c="".concat(Math.random(),"-").concat(+new Date),l=u.console||!1,d=u.resultGetter||a;(0,t.devtoolsNetworkLog)({reqId:c,type:"requestWillBeSent",url:u.url,headers:u.headers||{},body:u.reqBody,console:l,callFramesIgnoreLength:2,timestampMs:u.timestampMs,method:u.method}),e.then(function(e){return i.__awaiter(n,void 0,void 0,function(){return i.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(e){return void 0===e&&(e=0),new Promise(function(t){return setTimeout(t,e)})}()];case 1:return r.sent(),(0,t.devtoolsNetworkLog)({reqId:c,type:"loadingFinished",body:JSON.stringify(d(e),null,2),console:l,callFramesIgnoreLength:2,timestampMs:Date.now()}),[3,3];case 2:return r.sent(),[3,3];case 3:return[2]}})})}).catch(function(e){try{(0,t.devtoolsNetworkLog)({reqId:c,type:"loadingFailed",errorCode:e&&e.errCode||-1,errorMsg:(0,s.isObject)(e)?e.errMsg||JSON.stringify(e):e.toString(),console:l,callFramesIgnoreLength:2,timestampMs:Date.now()})}catch(e){}})}}catch(e){}}},"./src/externals/globals/wxconfig.ts":function(e,t,r){(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isMac=t.isWindows=t.isMINA=t.isDevTools=void 0;var i,o=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js");try{__wxConfig.platform,i=o.__assign({},__wxConfig),__wxConfig.onReady(function(){i=Object.assign(i,__wxConfig)})}catch(t){i={platform:"ios",appLaunchInfo:{mode:""},onReady:function(e){setTimeout(function(){e()})}},e.env.TEST&&(n.__wxConfig=i)}t.default=i;t.isDevTools=function(){return"devtools"===i.platform};t.isMINA=function(){return"mina"===i.platform};t.isWindows=function(){return"windows"===i.platform};t.isMac=function(){return"mac"===i.platform}}).call(this,r("../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js"),r("../../node_modules/.pnpm/webpack@4.46.0_webpack-command@0.4.2/node_modules/webpack/buildin/global.js"))},"./src/externals/public-lib/appserviceSdk.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.setDefaultSDK=t.setSDK=t.getSDK=void 0;var r,n=new WeakMap;function i(){return r||("undefined"!=typeof wx?wx:void 0)}t.getSDK=function(e){if(!e)return i();var t=n.get(e);return t&&t||i()};t.setSDK=function(e,t){n.set(e,t)};t.setDefaultSDK=function(e){r=e}},"./src/externals/public-lib/reporter.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=r("./src/utils/fail-safe.ts"),o={fake:!0,surroundThirdByTryCatch:function(e,t){return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return(0,i.tryCatch)(function(){try{return e.apply(e,r)}catch(r){throw console.error(JSON.stringify(r)+"; ".concat(t,"\n")+r.stack),console.error(e.toString()),r}},t)}},reportIDKey:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},reportIDKeyDirectly:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},reportKeyValue:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}},s=!1,a=10;function u(){try{return s?Reporter:a<=0?n:(a--,Reporter.surroundThirdByTryCatch,n=Reporter,s=!0,n)}catch(e){return n=o}}t.default={surroundThirdByTryCatch:function(e,t){return u().surroundThirdByTryCatch(e,t)},reportIDKey:function(e){return u().reportIDKey(e)},reportIDKeyDirectly:function(e){return u().reportIDKeyDirectly(e)},reportKeyValue:function(e){return u().reportKeyValue(e)}}},"./src/hook/invoke.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.hasAPICallback=t.invokeFailCompleteCallbacks=t.invokeSuccessCompleteCallbacks=t.invokeCompleteCallback=t.invokeFailCallback=t.invokeSuccessCallback=void 0;var n=r("./src/utils/type.ts"),i=r("./src/utils/fail-safe.ts");function o(e,t,r){t.success&&(0,n.isFunction)(t.success)&&(0,i.wrapWithTryCatch)(t.success,"at api ".concat(e," success callback function;"))(r)}function s(e,t,r){t.fail&&(0,n.isFunction)(t.fail)&&(0,i.wrapWithTryCatch)(t.fail,"at api ".concat(e," fail callback function;"))(r)}function a(e,t,r){t.complete&&(0,n.isFunction)(t.complete)&&(0,i.wrapWithTryCatch)(t.complete,"at api ".concat(e," complete callback function;"))(r)}t.invokeSuccessCallback=o,t.invokeFailCallback=s,t.invokeCompleteCallback=a,t.invokeSuccessCompleteCallbacks=function(e,t,r){o(e,t,r),a(e,t,r)},t.invokeFailCompleteCallbacks=function(e,t,r){s(e,t,r),a(e,t,r)},t.hasAPICallback=function(e){return e&&(e.success||e.fail||e.complete)}},"./src/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js");n.__exportStar(r("./src/cloud/index.ts"),t),n.__exportStar(r("./src/servicemarket/index.ts"),t),n.__exportStar(r("./src/externals/public-lib/appserviceSdk.ts"),t)},"./src/network/tunnel.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.stdPrivateProtocol=t.getBoundTunnelRequest=t.constructTunnelReq=t.tunnel=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/error.ts"),o=r("./src/externals/public-lib/appserviceSdk.ts"),s=r("./src/utils/utils.ts"),a=r("./src/proto/stdpriv.js"),u=r("./src/utils/service-endpoint.ts"),c=s._wxConsole,l=new Set(["tcbapi_init","tcbapi_get_service_info"]),d=new(function(){function e(){this._running=0,this._onIdleCallbacks=[]}return Object.defineProperty(e.prototype,"running",{get:function(){return this._running},enumerable:!1,configurable:!0}),e.prototype.incrementRunning=function(e){void 0===e&&(e=1),this._running+=e,this._idleTriggerTimer&&clearTimeout(this._idleTriggerTimer)},e.prototype.decrementRunning=function(e){var t=this;void 0===e&&(e=1),this._running-=e,this._running<0&&(this._running=0),this._running<=0&&this._onIdleCallbacks.length&&(this._idleTriggerTimer=setTimeout(function(){if(t._idleTriggerTimer=null,t._onIdleCallbacks.length){var e=t._onIdleCallbacks.shift();e&&e()}},50))},e.prototype.onceIdle=function(e){this._running>0?this._onIdleCallbacks.push(e):e()},e}());function f(e,t){var r=this;if(void 0===t&&(t={}),t.fireOnIdle&&d.running>0)return new Promise(function(i,o){d.onceIdle(function(){return n.__awaiter(r,void 0,void 0,function(){var r,s;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,f(e,t)];case 1:return r=n.sent(),i(r),[3,3];case 2:return s=n.sent(),o(s),[3,3];case 3:return[2]}})})})});if(t.onFire)try{t.onFire()}catch(e){}return new Promise(function(r,s){var a,u,c,l,f;d.incrementRunning(),(0,o.getSDK)((e.cloud||t.cloud||{}).identifiers).operateWXData({appid:null===(u=null===(a=e.cloud)||void 0===a?void 0:a.instanceOptions)||void 0===u?void 0:u.resourceAppid,accessToken:null===(l=null===(c=e.cloud)||void 0===c?void 0:c.authStorage)||void 0===l?void 0:l.getItem("access_token"),webRequest:null===(f=e.cloud)||void 0===f?void 0:f.webRequest,apiName:e.apiName||"qbase_commapi",reqData:e.data,requestInQueue:!1,success:function(e){!e.data&&e.rawData&&(e.data=JSON.parse(e.rawData));var o=n.__assign(n.__assign({},e),{data:e.data});if(e.data)try{var a=e.data;if(a.baseresponse&&0!==a.baseresponse.errcode){var u=new i.CloudSDKError({errCode:a.baseresponse.errcode,errMsg:a.baseresponse.errmsg});return void s(u)}o=n.__assign(n.__assign({},e),{data:a})}catch(e){u=new i.CloudSDKError({errMsg:e&&e.toString()});return void s(u)}else if(t&&t.requireDataNotEmpty){u=new i.CloudSDKError({errCode:e.errCode,errMsg:"error empty internal server response, ".concat(e.errMsg)});return void s(u)}r(o)},fail:function(e){if(e&&e.errMsg)if(e.errMsg.includes("invalid scope")){var t="invalid scope ";(e=new Error(t)).errMsg=t,e.operateWXDataFail=!0}else{t=e.errMsg.replace(/^operateWXData:fail /,"");(e=new Error(t)).errMsg=t,e.operateWXDataFail=!0}s(e)},complete:function(){e.complete&&e.complete.apply(null,arguments),d.decrementRunning()}})})}function p(e,t){return n.__awaiter(this,void 0,void 0,function(){var i,l,d,f,p,_,h,E,m,g,v;return n.__generator(this,function(S){switch(S.label){case 0:return(l=e.serviceEndpoint.getEndpointSync("container"))?[3,2]:[4,e.serviceEndpoint.getEndpoint("container")];case 1:l=S.sent(),S.label=2;case 2:if(!(i=l).cloudServiceUrl)throw{errCode:-9998,errMsg:"cloudServiceUrl not found"};return null===c||void 0===c||c.info("cloud stdpriv begin",t),d=(0,o.getSDK)(e.identifiers),f={"X-WX-ENCRYPTION-VERSION":2,"X-WX-ENCRYPTION-TIMESTAMP":i.timestamp+"","X-WX-COMPRESSION":"snappy","X-WX-LIB-BUILD-TS":1685330827011,"X-WX-RESPONSE-CONTENT-ACCEPT-ENCODING":"JSON","Content-Type":"application/octet-stream"},p=a.QBaseApiData.encode(t).finish(),f["X-WX-REQUEST-CONTENT-ENCODING"]="PB",_=r("./src/vendor/snappy.js"),h=_.compress(p),E=r("./src/utils/asmcrypto.ts"),m=new Uint8Array(s.base64ToArrayBuffer(i.key)),g=E.AES_CBC.encrypt(h,m,void 0,m),v=(0,u.getCloudServiceURL)({rdm:e.getConfig().rdm}),[2,new Promise(function(e,t){d.request({url:v,method:"POST",header:f,data:g.buffer,dataType:"arraybuffer",responseType:"arraybuffer",enableHttp2:!0,success:function(r){try{for(var n in null===c||void 0===c||c.info("res",r),r.header)if("x-nws-log-uuid"===n.toLowerCase()&&(null===c||void 0===c||c.log("[cloud.callContainer] x-nws-log-uuid ".concat(r.header[n]))),"x-wx-system-error"===n.toLowerCase()){var i=Number(r.header[n]);return 85104===i&&u.ServiceEndpoint.invalidateService("container"),void t(new Error("wx system error. code: ".concat(i)))}if(200===r.statusCode){var o=r.data,a=E.AES_CBC.decrypt(new Uint8Array(o),m,void 0,m);for(var l in null===c||void 0===c||c.info("decrypt done"),r.header){if("x-wx-compression"===l.toLowerCase()&&"snappy"===r.header[l]&&(a=_.uncompress(a)),"x-wx-server-timing"===l.toLowerCase())(r.header[l]||"").split(",").length}var d=JSON.parse(s.arrayBufferToString(a));e({errCode:0,errMsg:"",data:d,profile:r.profile,channelType:1})}else t({errCode:-9999,errMsg:"system conn status not 200"})}catch(e){t(new Error("error while processing internal response ".concat(e)))}},fail:function(e){t(n.__assign(n.__assign({},e),{errCode:-9999,errMsg:e.errMsg}))}})})]}})})}t.tunnel=f,t.constructTunnelReq=function(e){var t=e.cloud;return{apiName:"qbase_commapi",data:{qbase_api_name:e.apiName,qbase_req:e.serializedReqData,qbase_options:{env:e.env},qbase_meta:t.getMetaData(),cli_req_id:"".concat(+new Date,"_").concat(Math.random())},cloud:t}},t.getBoundTunnelRequest=function(e){var t=e.cloud;return function(e){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(o){switch(o.label){case 0:return r=t.isInstance?n.__assign(n.__assign({},t.instanceOptions),{appid:t.instanceOptions.resourceAppid,env:t.instanceOptions.resourceEnv}):n.__assign(n.__assign({},e),{env:e.env}),i={qbase_api_name:e.apiName,qbase_req:e.serializedReqData,qbase_options:r,qbase_meta:t.getMetaData(),cli_req_id:"".concat(+new Date,"_").concat(Math.random())},!e.stdpriv||l.has(e.apiName)?[3,2]:[4,p(t,i).catch(function(e){if(e&&(-9999===e.errCode||-9998===e.errCode))return f({apiName:"qbase_commapi",data:i,cloud:t}).then(function(t){return n.__assign(n.__assign({},t),{channelType:-9998===e.errCode?0:2})});throw e})];case 1:return[2,o.sent()];case 2:return[2,f({apiName:"qbase_commapi",data:i,cloud:t})]}})})}},t.stdPrivateProtocol=p,t.default=f},"./src/proto/http.js":function(e,t,r){var n=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/minimal.js"),i=n.Reader,o=n.Writer,s=n.util,a=n.roots.default||(n.roots.default={});a.HTTPRequest=function(){function e(e){if(this.header=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.method="",e.prototype.header=s.emptyArray,e.prototype.body=s.newBuffer([]),e.prototype.callId="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=o.create()),null!=e.method&&Object.hasOwnProperty.call(e,"method")&&t.uint32(10).string(e.method),null!=e.header&&e.header.length)for(var r=0;r<e.header.length;++r)a.HTTPHeader.encode(e.header[r],t.uint32(18).fork()).ldelim();return null!=e.body&&Object.hasOwnProperty.call(e,"body")&&t.uint32(26).bytes(e.body),null!=e.callId&&Object.hasOwnProperty.call(e,"callId")&&t.uint32(34).string(e.callId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.HTTPRequest;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.method=e.string();break;case 2:n.header&&n.header.length||(n.header=[]),n.header.push(a.HTTPHeader.decode(e,e.uint32()));break;case 3:n.body=e.bytes();break;case 4:n.callId=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.method&&e.hasOwnProperty("method")&&!s.isString(e.method))return"method: string expected";if(null!=e.header&&e.hasOwnProperty("header")){if(!Array.isArray(e.header))return"header: array expected";for(var t=0;t<e.header.length;++t){var r=a.HTTPHeader.verify(e.header[t]);if(r)return"header."+r}}return null!=e.body&&e.hasOwnProperty("body")&&!(e.body&&"number"==typeof e.body.length||s.isString(e.body))?"body: buffer expected":null!=e.callId&&e.hasOwnProperty("callId")&&!s.isString(e.callId)?"callId: string expected":null},e.fromObject=function(e){if(e instanceof a.HTTPRequest)return e;var t=new a.HTTPRequest;if(null!=e.method&&(t.method=String(e.method)),e.header){if(!Array.isArray(e.header))throw TypeError(".HTTPRequest.header: array expected");t.header=[];for(var r=0;r<e.header.length;++r){if("object"!=typeof e.header[r])throw TypeError(".HTTPRequest.header: object expected");t.header[r]=a.HTTPHeader.fromObject(e.header[r])}}return null!=e.body&&("string"==typeof e.body?s.base64.decode(e.body,t.body=s.newBuffer(s.base64.length(e.body)),0):e.body.length&&(t.body=e.body)),null!=e.callId&&(t.callId=String(e.callId)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.header=[]),t.defaults&&(r.method="",t.bytes===String?r.body="":(r.body=[],t.bytes!==Array&&(r.body=s.newBuffer(r.body))),r.callId=""),null!=e.method&&e.hasOwnProperty("method")&&(r.method=e.method),e.header&&e.header.length){r.header=[];for(var n=0;n<e.header.length;++n)r.header[n]=a.HTTPHeader.toObject(e.header[n],t)}return null!=e.body&&e.hasOwnProperty("body")&&(r.body=t.bytes===String?s.base64.encode(e.body,0,e.body.length):t.bytes===Array?Array.prototype.slice.call(e.body):e.body),null!=e.callId&&e.hasOwnProperty("callId")&&(r.callId=e.callId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.HTTPResponse=function(){function e(e){if(this.header=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.statusCode=0,e.prototype.header=s.emptyArray,e.prototype.bodyBuffer=s.newBuffer([]),e.prototype.bodyString="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=o.create()),null!=e.statusCode&&Object.hasOwnProperty.call(e,"statusCode")&&t.uint32(8).uint32(e.statusCode),null!=e.header&&e.header.length)for(var r=0;r<e.header.length;++r)a.HTTPHeader.encode(e.header[r],t.uint32(18).fork()).ldelim();return null!=e.bodyBuffer&&Object.hasOwnProperty.call(e,"bodyBuffer")&&t.uint32(26).bytes(e.bodyBuffer),null!=e.bodyString&&Object.hasOwnProperty.call(e,"bodyString")&&t.uint32(34).string(e.bodyString),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.HTTPResponse;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.statusCode=e.uint32();break;case 2:n.header&&n.header.length||(n.header=[]),n.header.push(a.HTTPHeader.decode(e,e.uint32()));break;case 3:n.bodyBuffer=e.bytes();break;case 4:n.bodyString=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.statusCode&&e.hasOwnProperty("statusCode")&&!s.isInteger(e.statusCode))return"statusCode: integer expected";if(null!=e.header&&e.hasOwnProperty("header")){if(!Array.isArray(e.header))return"header: array expected";for(var t=0;t<e.header.length;++t){var r=a.HTTPHeader.verify(e.header[t]);if(r)return"header."+r}}return null!=e.bodyBuffer&&e.hasOwnProperty("bodyBuffer")&&!(e.bodyBuffer&&"number"==typeof e.bodyBuffer.length||s.isString(e.bodyBuffer))?"bodyBuffer: buffer expected":null!=e.bodyString&&e.hasOwnProperty("bodyString")&&!s.isString(e.bodyString)?"bodyString: string expected":null},e.fromObject=function(e){if(e instanceof a.HTTPResponse)return e;var t=new a.HTTPResponse;if(null!=e.statusCode&&(t.statusCode=e.statusCode>>>0),e.header){if(!Array.isArray(e.header))throw TypeError(".HTTPResponse.header: array expected");t.header=[];for(var r=0;r<e.header.length;++r){if("object"!=typeof e.header[r])throw TypeError(".HTTPResponse.header: object expected");t.header[r]=a.HTTPHeader.fromObject(e.header[r])}}return null!=e.bodyBuffer&&("string"==typeof e.bodyBuffer?s.base64.decode(e.bodyBuffer,t.bodyBuffer=s.newBuffer(s.base64.length(e.bodyBuffer)),0):e.bodyBuffer.length&&(t.bodyBuffer=e.bodyBuffer)),null!=e.bodyString&&(t.bodyString=String(e.bodyString)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.header=[]),t.defaults&&(r.statusCode=0,t.bytes===String?r.bodyBuffer="":(r.bodyBuffer=[],t.bytes!==Array&&(r.bodyBuffer=s.newBuffer(r.bodyBuffer))),r.bodyString=""),null!=e.statusCode&&e.hasOwnProperty("statusCode")&&(r.statusCode=e.statusCode),e.header&&e.header.length){r.header=[];for(var n=0;n<e.header.length;++n)r.header[n]=a.HTTPHeader.toObject(e.header[n],t)}return null!=e.bodyBuffer&&e.hasOwnProperty("bodyBuffer")&&(r.bodyBuffer=t.bytes===String?s.base64.encode(e.bodyBuffer,0,e.bodyBuffer.length):t.bytes===Array?Array.prototype.slice.call(e.bodyBuffer):e.bodyBuffer),null!=e.bodyString&&e.hasOwnProperty("bodyString")&&(r.bodyString=e.bodyString),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),a.HTTPHeader=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.key="",e.prototype.value="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=o.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.HTTPHeader;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.key&&e.hasOwnProperty("key")&&!s.isString(e.key)?"key: string expected":null!=e.value&&e.hasOwnProperty("value")&&!s.isString(e.value)?"value: string expected":null},e.fromObject=function(e){if(e instanceof a.HTTPHeader)return e;var t=new a.HTTPHeader;return null!=e.key&&(t.key=String(e.key)),null!=e.value&&(t.value=String(e.value)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.key="",r.value=""),null!=e.key&&e.hasOwnProperty("key")&&(r.key=e.key),null!=e.value&&e.hasOwnProperty("value")&&(r.value=e.value),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e.exports=a},"./src/proto/stdpriv.js":function(e,t,r){var n=r("../../node_modules/.pnpm/protobufjs@7.1.2/node_modules/protobufjs/minimal.js"),i=n.Reader,o=n.Writer,s=n.util,a=n.roots.default||(n.roots.default={});a.QBaseApiData=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.qbase_api_name="",e.prototype.qbase_meta=null,e.prototype.qbase_options=null,e.prototype.qbase_req="",e.prototype.cli_req_id="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=o.create()),null!=e.qbase_api_name&&Object.hasOwnProperty.call(e,"qbase_api_name")&&t.uint32(10).string(e.qbase_api_name),null!=e.qbase_meta&&Object.hasOwnProperty.call(e,"qbase_meta")&&a.QBaseApiData.QBaseMeta.encode(e.qbase_meta,t.uint32(18).fork()).ldelim(),null!=e.qbase_options&&Object.hasOwnProperty.call(e,"qbase_options")&&a.QBaseApiData.QBaseOptions.encode(e.qbase_options,t.uint32(26).fork()).ldelim(),null!=e.qbase_req&&Object.hasOwnProperty.call(e,"qbase_req")&&t.uint32(34).string(e.qbase_req),null!=e.cli_req_id&&Object.hasOwnProperty.call(e,"cli_req_id")&&t.uint32(42).string(e.cli_req_id),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.QBaseApiData;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.qbase_api_name=e.string();break;case 2:n.qbase_meta=a.QBaseApiData.QBaseMeta.decode(e,e.uint32());break;case 3:n.qbase_options=a.QBaseApiData.QBaseOptions.decode(e,e.uint32());break;case 4:n.qbase_req=e.string();break;case 5:n.cli_req_id=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.qbase_api_name&&e.hasOwnProperty("qbase_api_name")&&!s.isString(e.qbase_api_name))return"qbase_api_name: string expected";var t;if(null!=e.qbase_meta&&e.hasOwnProperty("qbase_meta")&&(t=a.QBaseApiData.QBaseMeta.verify(e.qbase_meta)))return"qbase_meta."+t;if(null!=e.qbase_options&&e.hasOwnProperty("qbase_options")&&(t=a.QBaseApiData.QBaseOptions.verify(e.qbase_options)))return"qbase_options."+t;return null!=e.qbase_req&&e.hasOwnProperty("qbase_req")&&!s.isString(e.qbase_req)?"qbase_req: string expected":null!=e.cli_req_id&&e.hasOwnProperty("cli_req_id")&&!s.isString(e.cli_req_id)?"cli_req_id: string expected":null},e.fromObject=function(e){if(e instanceof a.QBaseApiData)return e;var t=new a.QBaseApiData;if(null!=e.qbase_api_name&&(t.qbase_api_name=String(e.qbase_api_name)),null!=e.qbase_meta){if("object"!=typeof e.qbase_meta)throw TypeError(".QBaseApiData.qbase_meta: object expected");t.qbase_meta=a.QBaseApiData.QBaseMeta.fromObject(e.qbase_meta)}if(null!=e.qbase_options){if("object"!=typeof e.qbase_options)throw TypeError(".QBaseApiData.qbase_options: object expected");t.qbase_options=a.QBaseApiData.QBaseOptions.fromObject(e.qbase_options)}return null!=e.qbase_req&&(t.qbase_req=String(e.qbase_req)),null!=e.cli_req_id&&(t.cli_req_id=String(e.cli_req_id)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.qbase_api_name="",r.qbase_meta=null,r.qbase_options=null,r.qbase_req="",r.cli_req_id=""),null!=e.qbase_api_name&&e.hasOwnProperty("qbase_api_name")&&(r.qbase_api_name=e.qbase_api_name),null!=e.qbase_meta&&e.hasOwnProperty("qbase_meta")&&(r.qbase_meta=a.QBaseApiData.QBaseMeta.toObject(e.qbase_meta,t)),null!=e.qbase_options&&e.hasOwnProperty("qbase_options")&&(r.qbase_options=a.QBaseApiData.QBaseOptions.toObject(e.qbase_options,t)),null!=e.qbase_req&&e.hasOwnProperty("qbase_req")&&(r.qbase_req=e.qbase_req),null!=e.cli_req_id&&e.hasOwnProperty("cli_req_id")&&(r.cli_req_id=e.cli_req_id),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e.QBaseMeta=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.first_launch=!1,e.prototype.session_id="",e.prototype.sdk_version="",e.prototype.filter_user_info=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=o.create()),null!=e.first_launch&&Object.hasOwnProperty.call(e,"first_launch")&&t.uint32(8).bool(e.first_launch),null!=e.session_id&&Object.hasOwnProperty.call(e,"session_id")&&t.uint32(18).string(e.session_id),null!=e.sdk_version&&Object.hasOwnProperty.call(e,"sdk_version")&&t.uint32(26).string(e.sdk_version),null!=e.filter_user_info&&Object.hasOwnProperty.call(e,"filter_user_info")&&t.uint32(32).bool(e.filter_user_info),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.QBaseApiData.QBaseMeta;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.first_launch=e.bool();break;case 2:n.session_id=e.string();break;case 3:n.sdk_version=e.string();break;case 4:n.filter_user_info=e.bool();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.first_launch&&e.hasOwnProperty("first_launch")&&"boolean"!=typeof e.first_launch?"first_launch: boolean expected":null!=e.session_id&&e.hasOwnProperty("session_id")&&!s.isString(e.session_id)?"session_id: string expected":null!=e.sdk_version&&e.hasOwnProperty("sdk_version")&&!s.isString(e.sdk_version)?"sdk_version: string expected":null!=e.filter_user_info&&e.hasOwnProperty("filter_user_info")&&"boolean"!=typeof e.filter_user_info?"filter_user_info: boolean expected":null},e.fromObject=function(e){if(e instanceof a.QBaseApiData.QBaseMeta)return e;var t=new a.QBaseApiData.QBaseMeta;return null!=e.first_launch&&(t.first_launch=Boolean(e.first_launch)),null!=e.session_id&&(t.session_id=String(e.session_id)),null!=e.sdk_version&&(t.sdk_version=String(e.sdk_version)),null!=e.filter_user_info&&(t.filter_user_info=Boolean(e.filter_user_info)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.first_launch=!1,r.session_id="",r.sdk_version="",r.filter_user_info=!1),null!=e.first_launch&&e.hasOwnProperty("first_launch")&&(r.first_launch=e.first_launch),null!=e.session_id&&e.hasOwnProperty("session_id")&&(r.session_id=e.session_id),null!=e.sdk_version&&e.hasOwnProperty("sdk_version")&&(r.sdk_version=e.sdk_version),null!=e.filter_user_info&&e.hasOwnProperty("filter_user_info")&&(r.filter_user_info=e.filter_user_info),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e.QBaseOptions=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.env="",e.prototype.appid="",e.prototype.region="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=o.create()),null!=e.env&&Object.hasOwnProperty.call(e,"env")&&t.uint32(10).string(e.env),null!=e.appid&&Object.hasOwnProperty.call(e,"appid")&&t.uint32(18).string(e.appid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(26).string(e.region),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new a.QBaseApiData.QBaseOptions;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.env=e.string();break;case 2:n.appid=e.string();break;case 3:n.region=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.env&&e.hasOwnProperty("env")&&!s.isString(e.env)?"env: string expected":null!=e.appid&&e.hasOwnProperty("appid")&&!s.isString(e.appid)?"appid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!s.isString(e.region)?"region: string expected":null},e.fromObject=function(e){if(e instanceof a.QBaseApiData.QBaseOptions)return e;var t=new a.QBaseApiData.QBaseOptions;return null!=e.env&&(t.env=String(e.env)),null!=e.appid&&(t.appid=String(e.appid)),null!=e.region&&(t.region=String(e.region)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.env="",r.appid="",r.region=""),null!=e.env&&e.hasOwnProperty("env")&&(r.env=e.env),null!=e.appid&&e.hasOwnProperty("appid")&&(r.appid=e.appid),null!=e.region&&e.hasOwnProperty("region")&&(r.region=e.region),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e}(),e.exports=a},"./src/runtime/runtime.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getRuntimeInfo=void 0,r("@web");var n={env:"",platform:""};if(t.getRuntimeInfo=function(){return n},"undefined"!=typeof __wxConfig)n.env="miniprogram",n.platform=__wxConfig.platform;else if(n.env="web",window.__wxjs_environment&&"miniprogram"===window.__wxjs_environment)n.platform="miniprogram";else{var i=window.navigator.userAgent.toLowerCase();/MicroMessenger/i.test(i)&&(n.platform="wxweb")}},"./src/servicemarket/cdn.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.uploadToCommonCDN=t.CDN=t.CDNObjectSymbol=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/externals/public-lib/appserviceSdk.ts");t.CDNObjectSymbol=Symbol("CDN");var o=function(){return function(e){this.symbol=t.CDNObjectSymbol,this.options=e}}();t.CDN=o,t.uploadToCommonCDN=function(e,t){return new Promise(function(r,o){(t||(0,i.getSDK)()).uploadToCommonCDN(n.__assign(n.__assign({},e),{success:r,fail:o}))})}},"./src/servicemarket/config.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_MSG=t.ERR_CODE=void 0,t.ERR_CODE={SM_EXCEED_MAX_TIMEOUT_POLL_RETRY:100,SM_EMPTY_CALL_RESULT:101,SM_EXCEED_MAX_POLL_RETRY:102,SM_PROVIDER_EXECUTION_ERROR:103,SM_POLL_RESULT_EXPIRED:104,SM_EMPTY_POLL_RESULT_BASE_RESP:105,SM_POLL_RESULT_BASE_RESP_RET_ABNORMAL:106,SM_UNKNOWN_SCENE:107,SM_SYSTEM_ERROR:108},t.ERR_MSG={SM_EXCEED_MAX_TIMEOUT_POLL_RETRY:"exceed max timeout retry",SM_EMPTY_CALL_RESULT:"empty call result",SM_EXCEED_MAX_POLL_RETRY:"exceed max poll retry",SM_PROVIDER_EXECUTION_ERROR:"provider execution error",SM_POLL_RESULT_EXPIRED:"poll result expired",SM_EMPTY_POLL_RESULT_BASE_RESP:"empty poll result base resp",SM_POLL_RESULT_BASE_RESP_RET_ABNORMAL:"poll result base resp ret abnormal",SM_UNKNOWN_SCENE:"unknown scene",SM_SYSTEM_ERROR:"system error"}},"./src/servicemarket/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getServiceMarketAPI=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/hook/invoke.ts"),o=r("./src/externals/globals/wxconfig.ts"),s=r("./src/servicemarket/cdn.ts"),a=r("./src/servicemarket/invokeService/v1.ts"),u=r("./src/servicemarket/invokeService/v2.ts"),c=function(e){return(0,i.hasAPICallback)(e)?l(e):(0,o.isDevTools)()&&!e.async?a.invokeService(e):u.invokeService(e)},l=function(e){((0,o.isDevTools)()&&!e.async?a.invokeService(e):u.invokeService(e)).then(function(t){(0,i.invokeSuccessCompleteCallbacks)("invokeService",e,t)}).catch(function(t){(0,i.invokeFailCompleteCallbacks)("invokeService",e,t)})},d=function(e){return(0,i.hasAPICallback)(e)?f(e):u.getAsyncResult(e)},f=function(e){u.getAsyncResult(e).then(function(t){(0,i.invokeSuccessCompleteCallbacks)("getAsyncResult",e,t)}).catch(function(t){(0,i.invokeFailCompleteCallbacks)("getAsyncResult",e,t)})};t.getServiceMarketAPI=function(e){void 0===e&&(e={});var t=e.sdk;return{invokeService:function(e){return c(n.__assign(n.__assign({},e),{sdk:t}))},getAsyncResult:function(e){return d(n.__assign(n.__assign({},e),{sdk:t}))},CDN:s.CDN}}},"./src/servicemarket/invokeService/v1.ts":function(e,t,r){var n=this;Object.defineProperty(t,"__esModule",{value:!0}),t.invokeService=void 0;var i=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),o=r("./src/servicemarket/cdn.ts"),s=r("./src/servicemarket/operateWXData.ts");t.invokeService=function(e){return i.__awaiter(n,void 0,void 0,function(){var t,r,n,a,u,c,l,d,f,p,_,h;return i.__generator(this,function(i){switch(i.label){case 0:if(i.trys.push([0,3,,4]),!e.service||!e.api)throw new Error("field 'service' and 'api' must be provided");return t=new WeakMap,r=[],e.data&&JSON.stringify(e.data,function(n,i){return i&&i.symbol===o.CDNObjectSymbol?void r.push(new Promise(function(r,n){var s={appType:301,fileType:20303,fileKey:"file_".concat(Math.random())},a=i;switch(function(e){return Object.prototype.toString.call(e).slice(8,-1)}(a.options)){case"Object":if(!a.options.filePath)throw new Error("filePath must be provided");s.filePath=a.options.filePath;break;default:s.fileData=a.options}r((0,o.uploadToCommonCDN)(s,e.sdk).then(function(e){t.set(i,e.fileUrl)}))})):i}),[4,Promise.all(r)];case 1:return i.sent(),n=JSON.stringify(e.data,function(e,r){return r&&r.symbol===o.CDNObjectSymbol&&t.has(r)?t.get(r):r}),[4,(0,s.operateWXData)({apiName:"WxaServiceMarketJsapiComm",reqData:{service_id:e.service,api_name:e.api,data:n,consume_type:e.consumeType,consume_appid:e.consumeAppid,client_msg_id:"".concat(Math.random(),"_").concat(Date.now()),version:1}},e.sdk)];case 2:!(a=i.sent()).data&&a.rawData&&(a.data=JSON.parse(a.rawData)),u=a.data,wxConsole.info("[servicemarket] raw response",u),c=void 0,l=void 0,d=void 0;try{c=(f=u).request_id,0===f.errcode?l=JSON.parse(f.data):(_="invokeService:fail ".concat(f.errcode," ").concat(f.errmsg," (requestId: ").concat(c,")"),(d=new Error(_)).errCode=f.errcode,d.errMsg=_,d.requestId=c)}catch(e){_="invokeService:fail inner protocol parse failed (requestId: ".concat(c||"empty",")"),(d=new Error(_)).errCode=-1,d.errMsg=_,d.requestId=c}if(d)throw d;return[2,{errMsg:"invokeService:ok",data:l,requestId:c}];case 3:throw p=i.sent(),_="invokeService:fail ",p&&p.errMsg&&p.err_code?(_+=p.errMsg,(h=new Error(_+"(err_code ".concat(p.err_code,")"))).errCode=p.err_code,h):p&&p.errMsg&&p.errCode?p:new Error("invokeService:fail ".concat(p));case 4:return[2]}})})}},"./src/servicemarket/invokeService/v2.ts":function(e,t,r){var n=this;Object.defineProperty(t,"__esModule",{value:!0}),t.getAsyncResult=t.invokeService=void 0;var i,o=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),s=r("./src/servicemarket/types.ts"),a=r("./src/utils/utils.ts"),u=r("./src/utils/error.ts"),c=r("./src/externals/globals/wxconfig.ts"),l=r("./src/servicemarket/config.ts"),d=r("./src/servicemarket/cdn.ts"),f=r("./src/servicemarket/operateWXData.ts"),p="invokeService",_=50,h=2,E=2,m=60,g=2e4;!function(e){e[e.InvalidRequestId=14]="InvalidRequestId"}(i||(i={}));var v=function(e){var t=new Date;return"".concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds()," ").concat(e)},S=function(e){return e.join("->")};t.invokeService=function(e){return o.__awaiter(n,void 0,void 0,function(){function t(t,r,n){return o.__awaiter(this,void 0,void 0,function(){return o.__generator(this,function(i){return[2,new Promise(function(i,d){var y=[v("start")],T=function(e,t,r){var n=function(t){e.push(v("app ".concat(t)))};return(0,a.onAppVisibilityChange)(n),{resolve:function(e){(0,a.offAppVisibilityChange)(n),t(e)},reject:function(e){(0,a.offAppVisibilityChange)(n),r(e)}}}(y,i,d),A=T.resolve,b=T.reject;!function t(r){return o.__awaiter(this,void 0,void 0,function(){var n,i,d,_,h,E,y,T,A,b,C,O,I,R,w,N,D,L,M,P,U,x,B,k=this;return o.__generator(this,function(j){switch(j.label){case 0:n=r.param,i=r.data,d=r.callID,_=r.scene,h=r.retryReason,E=r.tryCount,y=r.trace,T=r.systemErrorRetry,A=r.timeoutErrorRetry,b=r.resolve,C=r.reject,O={service_id:n.service,api_name:n.api,data:_===s.Scene.CALL?i:void 0,consume_type:e.consumeType,consume_appid:e.consumeAppid,client_msg_id:"".concat(Math.random(),"_").concat(Date.now()),version:2,call_id:d,scene:_,retry_reason:h},I=!1,R=!1,w=function(){clearTimeout(D),R=!0},N=+new Date,D=setTimeout(function(){return o.__awaiter(k,void 0,void 0,function(){var e;return o.__generator(this,function(n){switch(n.label){case 0:return e=g,+new Date-N>e?[4,(0,a.sleep)()]:[3,2];case 1:if(n.sent(),R)return[2];n.label=2;case 2:return!(0,c.isDevTools)()&&+new Date-N>m?(y.push(v("timeout, exceed max retry gap")),[2,C((0,u.returnAsFinalCloudSDKError)({errCode:l.ERR_CODE.SM_POLL_RESULT_EXPIRED,errMsg:"timeout for retry, cannot retry fetching the result anymore (callId: ".concat(d,") (trace: ").concat(S(y),")")},p))]):(I=!0,r.timeoutErrorRetry>0?(y.push(v("timeout, retry")),t(o.__assign(o.__assign({},r),{scene:_,retryReason:s.RetryReason.Timeout,tryCount:E-1,timeoutErrorRetry:A-1}))):(y.push(v("timeout, abort")),C((0,u.returnAsFinalCloudSDKError)({errCode:l.ERR_CODE.SM_EXCEED_MAX_TIMEOUT_POLL_RETRY,errMsg:"".concat(l.ERR_MSG.SM_EXCEED_MAX_TIMEOUT_POLL_RETRY," (callId: ").concat(d,") (trace: ").concat(S(y),")")},p))),[2])}})})},g),j.label=1;case 1:return j.trys.push([1,3,,4]),[4,(0,f.operateWXData)({apiName:"WxaServiceMarketJsapiComm",reqData:O},e.sdk)];case 2:!(L=j.sent()).data&&L.rawData&&(L.data=JSON.parse(L.rawData));try{if(I)return[2];if(w(),!(M=L.data)&&L.rawData)try{M=JSON.parse(L.rawData)}catch(e){}if(!M)return y.push(v("empty resp")),[2,C((0,u.returnAsFinalCloudSDKError)({errCode:l.ERR_CODE.SM_EMPTY_CALL_RESULT,errMsg:l.ERR_MSG.SM_EMPTY_CALL_RESULT},p))];if(M.scene!==s.Scene.PreResp){if(M.scene===s.Scene.FinalResp){if(0!==M.errcode)return(P=(0,u.returnAsFinalCloudSDKError)({errCode:l.ERR_CODE.SM_PROVIDER_EXECUTION_ERROR,errMsg:"requestID ".concat(M.request_id,", error message ").concat(M.provider_errmsg||"unknown"," (callid ").concat(d,")")},p)).requestID=M.request_id,[2,C(P)];U=M.data;try{U=JSON.parse(U)}catch(e){}return[2,b({result:U,requestID:M.request_id})]}return y.push(v("unexpected scene")),[2,C((0,u.returnAsFinalCloudSDKError)({errCode:l.ERR_CODE.SM_UNKNOWN_SCENE,errMsg:"unknown scene ".concat(M.scene," (callId: ").concat(d,") (trace: ").concat(S(y),")")},p))]}if(!(E>=0))return y.push(v("too many polls, abort")),[2,C((0,u.returnAsFinalCloudSDKError)({errCode:l.ERR_CODE.SM_EXCEED_MAX_POLL_RETRY,errMsg:"".concat(l.ERR_MSG.SM_EXCEED_MAX_POLL_RETRY," (callId: ").concat(d,") (trace: ").concat(S(y),")")},p))];y.push(v("normal poll")),t(o.__assign(o.__assign({},r),{scene:s.Scene.POLL,retryReason:s.RetryReason.None,tryCount:E-1}))}catch(e){C((0,u.returnAsFinalCloudSDKError)({errCode:l.ERR_CODE.SM_POLL_ERROR,errMsg:"polling catch error: ".concat(e," (callId: ").concat(d,")")},p))}return[3,4];case 3:return x=j.sent(),I?[2]:(w(),B=x instanceof Error?x:JSON.stringify(x),x&&x.operateWXDataFail&&T>0?(y.push(v("system error (".concat(B,"), retry"))),t(o.__assign(o.__assign({},r),{scene:_,retryReason:s.RetryReason.SysErr,tryCount:E-1,systemErrorRetry:T-1}))):(y.push(v("system error (".concat(B,"), abort"))),C((0,u.returnAsFinalCloudSDKError)("".concat(B," (callId: ").concat(d,") (trace: ").concat(S(y),")"),p))),[3,4]);case 4:return[2]}})})}({param:t,data:r,callID:n,scene:s.Scene.CALL,retryReason:s.RetryReason.None,tryCount:_,systemErrorRetry:h,timeoutErrorRetry:E,trace:y,resolve:A,reject:b})})]})})}var r,n,i,y,T,A,b,C,O,I,R,w,N,D;return o.__generator(this,function(o){switch(o.label){case 0:if(o.trys.push([0,6,,7]),!e.service||!e.api)throw new Error("field 'service' and 'api' must be provided");return r=new WeakMap,n=[],e.data&&JSON.stringify(e.data,function(t,i){return i&&i.symbol===d.CDNObjectSymbol?void n.push(new Promise(function(t,n){var o={appType:301,fileType:20303,fileKey:"file_".concat(Math.random())},s=i;switch(function(e){return Object.prototype.toString.call(e).slice(8,-1)}(s.options)){case"Object":if(!s.options.filePath)throw new Error("filePath must be provided");o.filePath=s.options.filePath;break;default:o.fileData=s.options}t((0,d.uploadToCommonCDN)(o,e.sdk).then(function(e){r.set(i,e.fileUrl)}))})):i}),[4,Promise.all(n)];case 1:return o.sent(),i=JSON.stringify(e.data,function(e,t){return t&&t.symbol===d.CDNObjectSymbol&&r.has(t)?r.get(t):t}),y="".concat(Math.random(),"_").concat(Date.now()),e.async?[3,3]:[4,t(e,i,y)];case 2:return T=o.sent(),A=T.result,b=T.requestID,[2,{errMsg:"invokeService:ok",data:A,requestId:b}];case 3:return C={service_id:e.service,api_name:e.api,data:i,consume_type:e.consumeType,consume_appid:e.consumeAppid,client_msg_id:"".concat(Math.random(),"_").concat(Date.now()),version:2,call_id:y,scene:s.Scene.CALL,retry_reason:s.RetryReason.None,req_type:s.ReqType.LongAsync},[4,(0,f.operateWXData)({apiName:"WxaServiceMarketJsapiComm",reqData:C},e.sdk)];case 4:if(!(O=o.sent()).data&&O.rawData&&(O.data=JSON.parse(O.rawData)),wxConsole.log("longAsync result",O),(I=O.data).scene===s.Scene.FinalResp&&0===I.errcode)return[2,{errMsg:"invokeService:ok",requestId:I.request_id}];throw(R=(0,u.returnAsFinalCloudSDKError)({errCode:l.ERR_CODE.SM_SYSTEM_ERROR,errMsg:"requestID ".concat(I.request_id,", error message ").concat(I.errmsg||"unknown"," (callid ").concat(y,")")},p)).requestID=I.request_id,R;case 5:return[3,7];case 6:throw w=o.sent(),N="invokeService:fail ",w&&w.errMsg&&w.err_code?(N+=w.errMsg,(D=new Error(N+"(err_code ".concat(w.err_code,")"))).errCode=w.err_code,D):w&&w.errMsg&&w.errCode?w:new Error("invokeService:fail ".concat(w));case 7:return[2]}})})},t.getAsyncResult=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,r,n;return o.__generator(this,function(i){switch(i.label){case 0:return[4,(0,f.operateWXData)({apiName:"webapi_servicemarket_jsapi_retrieve",reqData:{request_id:e.requestId}},e.sdk)];case 1:if(!(t=i.sent()).data&&t.rawData&&(t.data=JSON.parse(t.rawData)),wxConsole.log("getAsyncResult resp",t),0===(r=t.data).errcode)return r.provider_errmsg?[2,{errCode:0,errMsg:"getAsyncResult:fail provider execution error",status:r.status,providerErrMsg:r.provider_errmsg,requestId:r.request_id}]:[2,{errCode:0,errMsg:"getAsyncResult:ok",data:JSON.parse(r.data),status:r.status,requestId:r.request_id}];throw(n=new Error("getAsyncResult:fail requestID ".concat(r.request_id,", error message ").concat(r.errmsg||"unknown"))).errCode=r.errcode,n.errMsg=r.errmsg,n}})})}},"./src/servicemarket/operateWXData.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.operateWXData=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/externals/public-lib/appserviceSdk.ts");t.operateWXData=function(e,t){return new Promise(function(r,o){(t||(0,i.getSDK)()).operateWXData(n.__assign(n.__assign({},e),{success:r,fail:o}))})}},"./src/servicemarket/types.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ReqType=t.RetryReason=t.Scene=void 0,function(e){e[e.CALL=1]="CALL",e[e.POLL=2]="POLL",e[e.PreResp=3]="PreResp",e[e.FinalResp=4]="FinalResp"}(t.Scene||(t.Scene={})),function(e){e[e.None=0]="None",e[e.SysErr=1]="SysErr",e[e.Timeout=2]="Timeout"}(t.RetryReason||(t.RetryReason={})),function(e){e[e.Sync=0]="Sync",e[e.LongAsync=2]="LongAsync"}(t.ReqType||(t.ReqType={}))},"./src/services/container/api/api.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r("./src/services/container/api/callContainer.ts"),i=r("./src/services/container/api/connectContainer.ts");t.getAPIs=function(e){return{callContainer:(0,n.default)(e),connectContainer:(0,i.default)(e)}}},"./src/services/container/api/callContainer.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.API_NAME=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/hook/invoke.ts"),o=r("./src/utils/assert.ts"),s=r("./src/utils/error.ts"),a=r("./src/utils/fail-safe.ts"),u=r("./src/utils/fn/clone.ts"),c=r("./src/utils/report.ts"),l=r("./src/utils/serializer.ts"),d=r("./src/utils/cdn.ts"),f=r("./src/externals/globals/devtools.ts"),p=r("./src/externals/public-lib/appserviceSdk.ts"),_=r("./src/services/container/api/callContainer/v1.ts"),h=r("./src/services/container/api/callContainer/v2.ts"),E=r("./src/services/container/api/callContainer/direct.ts"),m=r("./src/utils/type.ts"),g=r("./src/utils/utils.ts"),v=r("./src/utils/userAgent.ts");function S(e){var t=!1;return function(r){t||(t=!0,e(r))}}t.API_NAME="cloud.callContainer";var y={OFF:0,ON:1,UNKNOWN:2},T=!0,A=6,b=new WeakMap;t.default=function(e){var r,C,O;function I(){return C||(C=(0,h.default)(e)),C}return function(e){var r=+new Date;(0,o.assertType)(e,"object");var n=(0,u.shallowClone)(e);return n.data||(n.data={}),n.dataType||(n.dataType="json"),n.context={tunnelTimeNoCSNetCost:0},n.context.apiStartTime=r,n.stats={apiStartTime:r},(0,i.hasAPICallback)(n)?function(e){(0,a.wrapParamCallbacksWithTryCatch)({apiName:t.API_NAME,param:e});var r=S(function(r){return(0,i.invokeSuccessCompleteCallbacks)(t.API_NAME,e,r)});e.context.onFinalized=r,R(e).then(r).catch(function(r){(0,i.invokeFailCompleteCallbacks)(t.API_NAME,e,r)})}(n):R(n)};function R(r){return n.__awaiter(this,void 0,void 0,function(){var i,a,_,h,E,C,O,I,R,D,L,M,P,U,x,B,k;return n.__generator(this,function(j){switch(j.label){case 0:i=!1,j.label=1;case 1:for(E in j.trys.push([1,6,,7]),function(t){var r;if(t.service,e.isInstance){if(!e.env)throw new Error("envId must be provided")}else if(null===(r=t.config)||void 0===r?void 0:r.env)(0,o.assertType)(t.config.env,"string");else if(!e.env)throw new Error("envId must be provided")}(r),r.path||(r.path=""),r.method||(r.method="GET"),r.header||(r.header={}),r.dataType||(r.dataType="json"),r.responseType||(r.responseType="text"),a="",r.header)"content-type"===E.toLowerCase()&&r.header&&(a=r.header[E]);if(a||(a="application/json",r.header["content-type"]="application/json"),r.header["User-Agent"]=(0,v.getUA)()||"",/get/i.test(r.method||"")&&r.data&&(0,m.isObject)(r.data)){for(E in h="",r.data)h+="".concat(h.length?"&":"").concat((0,g.encodeWithDecode)(E),"=").concat((0,g.encodeWithDecode)(r.data[E]));r.path.includes("?")?r.path+="".concat(r.path.endsWith("&")?"":h?"&":"").concat(h):r.path+="".concat(r.path.endsWith("?")?"":h?"?":"").concat(h),r.data=void 0}else if(/post|put|patch|delete/i.test(r.method||"")&&r.data)if(a.includes("application/json"))_=(0,m.getType)(r.data),r.shouldSerialize="string"!==_;else if(a.includes("application/x-www-form-urlencoded")&&(0,m.isObject)(r.data)){for(E in h="",r.data)h+="".concat(h.length?"&":"").concat(encodeURIComponent(E),"=").concat(encodeURIComponent(r.data[E]));r.data=h}return r.cdnMapPromise=r.shouldSerialize?d.collect(r.data):void 0,C=Date.now(),T?(T=!1,[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(n){switch(n.label){case 0:return Boolean(e.serviceEndpoint.getEndpointSync("container"))?[3,2]:(r=new Promise(function(e){return setTimeout(e,50)}),i=e.serviceEndpoint.getEndpoint("container"),[4,Promise.race([r,i])]);case 1:n.sent(),n.label=2;case 2:return[2,w(t)]}})})}(r)]):[3,3];case 2:return O=j.sent(),[3,4];case 3:O=w(r),j.label=4;case 4:return i=O,r.stats.tsBeforeCallContainerImpl=Date.now(),I=(0,u.shallowClone)(r),R=r.data,D=N(r,i),M=r.service||r.header["X-WX-SERVICE"],L=M?"wx.cloud.callContainer.".concat(M).concat(r.path):"wx.cloud.callContainer".concat(r.path),(0,f.autoDevtoolsNetworkLog)(D,function(){var t;return{url:L,method:r.method,headers:n.__assign({Env:e.isInstance?e.env:(null===(t=r.config)||void 0===t?void 0:t.env)||e.env},r.header),reqBody:(0,l.serialize)(R),timestampMs:C,console:e.debug}}),P=function(r,i){var o;return null===(o=r.followRedirect)||void 0===o||o?function r(o,s){return new Promise(function(a,c){s.then(function(s){var l;if(302===s.statusCode){var d=null!==(l=b.get(i))&&void 0!==l?l:0;if(d>=A)c("reach the max redirect count");else{b.set(i,d+1);var f="";for(var _ in s.header)"location"===_.toLowerCase()&&(f=s.header[_]);if(f)if(f.startsWith("/")){var h=(0,u.shallowClone)(o);o.path=f;var E=N(o);r(h,E).then(a).catch(c)}else{var m=(0,p.getSDK)(e.identifiers);m.request({url:f,method:o.method,header:o.header,data:o.data,dataType:o.dataType,responseType:o.responseType,timeout:o.timeout,success:function(e){a(n.__assign(n.__assign({},e),{errMsg:"".concat(t.API_NAME,":ok")}))},fail:function(e){c(e.errMsg.replace(/^request/,t.API_NAME))}})}else a(s)}}else a(s)}).catch(c)})}(r,i):i}(I,D),U=function(t,r){var n,i=(0,p.getSDK)(e.identifiers);if(!i.isUsedCache())return r;var o=function(e){var t={abort:function(){},promise:Promise.resolve()},r=new Promise(function(e,r){t.abort=r});return t.promise=Promise.race([e,r]),t}(r),s=i.reportCallContainer,a=i.privateCacheManager,u=i.cacheManager,c=Date.now(),l=t.data,d=t.method,f=(null===(n=t.config)||void 0===n?void 0:n.env)||e.env,_="https://wx.cloud.callContainer/".concat(f),h=t.service;if(!h)for(var E in t.header)"X-WX-SERVICE"===E.toUpperCase()&&(h=t.header[E]);_+=h?"/".concat(h).concat(t.path):t.path;var m=function(e,t,n){var i=a.emit("request",{url:_,data:l,method:d,request:function(){return new Promise(function(e,t){r.then(e).catch(t)})}});if(i.length){var s=i.find(function(e){return e&&"function"==typeof e.then});s&&s.then(e).catch(t).finally(function(){o.abort()})}else n&&t(n)};return new Promise(function(e,t){var n=function(t){s({isSuccess:!0,costTime:Date.now()-c,extra1:_}),e(t)},i=function(e){s({isSuccess:!1,costTime:Date.now()-c,extra1:_}),t(e)},o=function(e){a.checkNeedStore(_,l,d,e),n(e)};u.state===y.UNKNOWN?r.then(function(e){o(e)}).catch(function(e){m(n,i,e)}):u.state===y.ON?m(n,i):u.state===y.OFF&&r.then(function(e){o(e)}).catch(function(e){i(e)})})}(r,P),x=S(function(){return function(e,r){e.stats.apiEndTime=Date.now(),(0,c.reportAPISpeed)(n.__assign(n.__assign({},e.context),{apiEndTime:e.stats.apiEndTime,apiName:t.API_NAME}));var i=Boolean(e.stats.profile),o=e.stats.profile||{},s=e.stats.serverEndTs-e.stats.serverStartTs,a=e.stats.httpRequest?e.stats.httpRequest<=6e4?e.stats.httpRequest:6e4:void 0,u=e.stats.apiEndTime,l=u-e.context.apiStartTime;if(l>9e4&&(l=9e4),!(r&&l<=0||a<=0)){var d=e.path||"";d=d.split("?")[0].replace(/\/\d+\//g,"/*/").replace(/\/\d+$/g,"/*"),(0,c.reportMMData)(22601,9,[e.stats.callid,e.context.apiStartTime,u,e.stats.serverStartTs,e.stats.serverEndTs,e.stats.requestBodyBytes,e.stats.responseBodyBytes,e.stats.getServiceEndpoint,e.stats.queryDNS,e.stats.compress,e.stats.loadAsmcrypto,e.stats.encrypt,a,e.stats.decrypt,e.stats.uncompress,e.stats.decodePb,e.stats.decodeBody,e.stats.ip,o.redirectStart,i?o.redirectEnd-o.redirectStart:void 0,o.fetchStart,o.domainLookupStart||o.domainLookUpStart,i?(o.domainLookupEnd||o.domainLookUpEnd)-(o.domainLookupStart||o.domainLookUpStart):void 0,o.connectStart,i?o.connectEnd-o.connectStart:void 0,o.SSLconnectionStart,i?o.SSLconnectionEnd-o.SSLconnectionStart:void 0,o.requestStart,i?o.requestEnd-o.requestStart:void 0,o.responseStart,i?o.responseEnd-o.responseStart:void 0,o.rtt,o.estimate_nettype,o.httpRttEstimate,o.transportRttEstimate,o.downstreamThroughputKbpsEstimate,o.throughputKbps,o.peerIP,o.port,i?o.socketReused?1:0:void 0,o.sendBytesCount,o.receivedBytedCount,r||1e3===e.mode?o.protocol:"im",(0,g.getSystemInfo)().system,l,s>0?s:0,a?l-a:void 0,d,(0,g.getSystemInfo)().platform,e.stats.requestStartTs,1685330827011,e.stats.ecdnId,e.stats.ecdnEdgeTiming,e.stats.domain,e.stats.stringToBuffer,e.stats.encodePb,e.stats.tsBeforeCallContainerImpl,e.stats.tsCallContainerImplStart,e.stats.decodeJson,"WACloud.js",i?o.requestStart-e.stats.requestStartTs:void 0,i?e.stats.requestSuccessTs-o.requestEnd:void 0,u-e.stats.responseProcessEndTs].join(","))}}(r,i)}),r.context.onRequestDone=x,[4,U];case 5:return B=j.sent(),x(B),[2,B];case 6:throw k=j.sent(),(0,s.returnAsFinalCloudSDKError)(k,t.API_NAME);case 7:return[2]}})})}function w(t){return"windows"!==(0,g.getSystemInfo)().platform&&(1===t.apiVersion||2!==t.apiVersion&&Boolean(e.serviceEndpoint.getEndpointSync("container")))}function N(t,i){var o;if(i=null!==i&&void 0!==i?i:w(t),1e3===t.mode)o=(O||(O=(0,E.default)(e)),O)(t);else if(i){var s=n.__assign(n.__assign({},t),{stats:n.__assign({},t.stats)});o=(r||(r=(0,_.default)(e)),r)(t).catch(function(e){if(-9999===(null===e||void 0===e?void 0:e.errCode))return I()(s);throw e})}else o=I()(t);return o}}},"./src/services/container/api/callContainer/asmCrypto.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AES_CBC=void 0;var n=r("./src/vendor/asmcrypto.aes_cbc.js");Object.defineProperty(t,"AES_CBC",{enumerable:!0,get:function(){return n.AES_CBC}})},"./src/services/container/api/callContainer/direct.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.API_NAME=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/externals/public-lib/appserviceSdk.ts");t.API_NAME="cloud.callContainer",t.default=function(e){return function(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){return[2,function(t){return new Promise(function(r,o){var s,a=(0,i.getSDK)(e.identifiers),u="".concat(Math.random().toPrecision(11),"_").concat(Date.now(),"_1000"),c=n.__assign(n.__assign({},t.header),{"X-WX-ENV":e.isInstance?e.env:(null===(s=t.config)||void 0===s?void 0:s.env)||e.env,"X-WX-CALL-ID":u}),l=function(e){void 0!==c[e]&&(c["X-WX-".concat(e)]=c[e],delete c[e])};l("host"),l("HOST"),l("User-Agent"),e.appid&&(c["X-WX-RESOURCE-APPID"]=e.appid),t.service&&(c["X-WX-SERVICE"]=t.service);var d=t.stats;d.callid=u;var f=Date.now(),p="https://t.wxcloudrun.com".concat(t.path);t.verbose&&console.log("[cloud.callContainer] url ".concat(p)),d.requestStartTs=Date.now(),a.request({url:p,method:t.method,header:c,data:t.data,dataType:t.dataType,responseType:t.responseType,timeout:t.timeout,enableHttp2:!0,enableQuic:!0,success:function(e){d.httpRequest=Date.now()-f,d.profile=e.profile;var t=n.__assign(n.__assign({callID:u},e),{errMsg:"cloud.callContainer:ok",stats:d});r(t)},fail:function(e){o(e)}})})}(t)]})})}}},"./src/services/container/api/callContainer/v1.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.API_NAME=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/serializer.ts"),o=r("./src/externals/public-lib/appserviceSdk.ts"),s=r("./src/proto/http.js"),a=r("./src/utils/utils.ts"),u=r("./src/utils/type.ts"),c=r("./src/utils/service-endpoint.ts");new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);t.API_NAME="cloud.callContainer",t.default=function(e){return function(l){return n.__awaiter(this,void 0,void 0,function(){var d,f,p,_;return n.__generator(this,function(h){switch(h.label){case 0:return d=e.serviceEndpoint.getEndpointSync("container"),f=new WeakMap,!l.cdnMapPromise&&d?[3,2]:[4,Promise.all([l.cdnMapPromise,function(e,t,r){var n=Date.now();return e.then(function(){return t[r]=Date.now()-n}).catch(function(){return t[r]=Date.now()-n}),e}(e.serviceEndpoint.getEndpoint("container"),l.stats,"getServiceEndpoint")])];case 1:return(p=h.sent())[0]&&(f=p[0]),d=p[1],[3,3];case 2:l.stats.getServiceEndpoint=0,h.label=3;case 3:return l.shouldSerialize&&(l.data=(0,i.serialize)(l.data,f)),d.http?((_=function(i,l){return new Promise(function(d,f){var p,_;l.stats.tsCallContainerImplStart=Date.now();var h=(0,o.getSDK)(e.identifiers),E={"X-WX-ENCRYPTION-VERSION":2,"X-WX-ENCRYPTION-TIMESTAMP":i.timestamp+"","X-WX-COMPRESSION":"snappy","X-WX-USER-TIMEOUT":l.timeout||"","X-WX-LIB-BUILD-TS":1685330827011,"X-WX-RESPONSE-CONTENT-ACCEPT-ENCODING":"PB, JSON","Content-Type":"application/octet-stream"},m="".concat(Math.random(),"_").concat(Date.now()),g=n.__assign(n.__assign({},l.header),{"X-WX-ENV":e.isInstance?e.env:(null===(p=l.config)||void 0===p?void 0:p.env)||e.env,"X-WX-CALL-ID":m});e.appid&&(g["X-WX-RESOURCE-APPID"]=e.appid),l.service&&(g["X-WX-SERVICE"]=l.service);var v=l.stats;v.callid=m;var S,y=Date.now(),T=!1;if(l.data||(S=void 0),"GET"===(null===(_=l.method)||void 0===_?void 0:_.toUpperCase())&&l.data&&(0,u.isObject)(l.data)){var A=[];for(var b in l.data)A.push("".concat(b,"=").concat(l.data[b]));l.path+="".concat(l.path.includes("?")?l.path.endsWith("&")?"":"&":"?").concat(A.join("&")),l.data=void 0}else{var C=(0,u.getType)(l.data);"object"===C?S=JSON.stringify(l.data):"arraybuffer"!==C?S=l.data+"":(S=l.data,T=!0)}g["X-WX-CONTAINER-PATH"]=l.path;var O,I=[];for(var R in g)void 0!==g[R]&&null!==g[R]&&I.push({key:R.toLowerCase(),value:g[R]+""});y=Date.now(),T?(O=s.HTTPRequest.encode({method:l.method||"GET",header:I,body:new Uint8Array(S),callId:m}).finish(),v.encodePb=Date.now()-y,E["X-WX-REQUEST-CONTENT-ENCODING"]="PB"):(O=new Uint8Array(a.stringToArrayBuffer(JSON.stringify({method:l.method||"GET",header:I,body:S,call_id:m}))),v.stringToBuffer=Date.now()-y,E["X-WX-REQUEST-CONTENT-ENCODING"]="JSON"),y=Date.now();var w=r("./src/vendor/snappy.js"),N=w.compress(O);v.compress=Date.now()-y,y=Date.now();var D=r("./src/services/container/api/callContainer/asmCrypto.ts");v.loadAsmcrypto=Date.now()-y,y=Date.now();var L=new Uint8Array(a.base64ToArrayBuffer(i.key)),M=D.AES_CBC.encrypt(N,L,void 0,L);v.encrypt=Date.now()-y,y=Date.now();var P=i.url;l.rdm?P="https://wxardm.weixin.qq.com/wxa-qbase/container_service?token=".concat(i.token):l.ecdn&&(P="https://cloudbase.servicewechat.com/wxa-qbase/container_service?token=".concat(i.token)),l.verbose&&console.log("[cloud.callContainer] url ".concat(P)),i.domain&&(l.stats.domain=i.domain),v.requestBodyBytes=M.byteLength,v.requestStartTs=Date.now(),l._fallback?f({errCode:-9999,errMsg:"".concat(t.API_NAME,":fail emulated fallback")}):h.request({url:P,method:"POST",header:E,data:M.buffer,dataType:"arraybuffer",responseType:"arraybuffer",timeout:l.timeout,enableHttp2:!0,success:function(e){var r,n,i,o;v.requestSuccessTs=Date.now();try{for(var u in e.header)if("x-nws-log-uuid"===u.toLowerCase()&&(l.verbose&&console.log("[cloud.callContainer] x-nws-log-uuid ".concat(e.header[u])),l.stats.ecdnId=e.header[u]),"x-edge-timing"===u.toLowerCase()&&(l.stats.ecdnEdgeTiming=e.header[u]),"x-wx-system-error"===u.toLowerCase()){var p=Number(e.header[u]);return 85104===p&&c.ServiceEndpoint.invalidateService("container"),void f({errCode:p,errMsg:"".concat(t.API_NAME,":fail system error. code: ").concat(p)})}if(l.verbose&&console.warn("res",e),v.profile=e.profile,v.httpRequest=Date.now()-y,200===e.statusCode){var _=e.data;v.responseBodyBytes=_.byteLength,y=Date.now();var h=D.AES_CBC.decrypt(new Uint8Array(_),L,void 0,L);v.decrypt=Date.now()-y,l.verbose&&console.warn("decrypt done");var E="pb";for(var g in e.header)if("x-wx-compression"===g.toLowerCase()&&"snappy"===e.header[g]&&(y=Date.now(),h=w.uncompress(h),v.uncompress=Date.now()-y),"x-wx-response-content-encoding"===g.toLowerCase()&&"json"===e.header[g].toLowerCase()&&(E="json"),"x-wx-server-timing"===g.toLowerCase()){var S=e.header[g]||"",T=S.split(",");T.length>=2&&(v.serverStartTs=Number(T[0]),v.serverEndTs=Number(T[1]))}y=Date.now();var A=void 0;if("json"===E){var b=JSON.parse(a.arrayBufferToString(h));A={statusCode:b.status_code,header:b.header,bodyBuffer:b.body_buffer,bodyString:b.body_string},v.decodeJson=Date.now()-y}else A=s.HTTPResponse.decode(h),v.decodePb=Date.now()-y;y=Date.now();var C=void 0;if(302!==A.statusCode)if("json"===l.dataType){var O=A.bodyString||(A.bodyBuffer?a.arrayBufferToString(A.bodyBuffer):"{}");try{C=JSON.parse(O)}catch(e){return void f({errCode:-1,errMsg:"".concat(t.API_NAME,":fail [call_id ").concat(m,"] parse response body as JSON failed: ").concat(e,". input: ").concat(O)})}}else C="text"===l.responseType?A.bodyString||(A.bodyBuffer?a.arrayBufferToString(A.bodyBuffer):""):"arraybuffer"===l.responseType&&A.bodyString?a.stringToArrayBuffer(A.bodyString):A.bodyString||A.bodyBuffer;v.decodeBody=Date.now()-y;var I={statusCode:A.statusCode,header:A.header.reduce(function(e,t){var r=e[t.key+""];return e[t.key+""]=r?r+","+t.value:t.value+"",e},{}),data:C,stats:v,callID:m,errMsg:"".concat(t.API_NAME,":ok")};v.responseProcessEndTs=Date.now(),null===(n=(r=l.context).onRequestDone)||void 0===n||n.call(r,I),302!==A.statusCode&&(null===(o=(i=l.context).onFinalized)||void 0===o||o.call(i,I)),d(I)}else f({errCode:-9999,errMsg:"".concat(t.API_NAME,":fail [call_id ").concat(m,"] system conn status not 200")})}catch(e){f({errCode:-1,errMsg:"".concat(t.API_NAME,":fail [call_id ").concat(m,"] error while processing internal response ").concat(e)})}},fail:function(e){f(n.__assign(n.__assign({},e),{errCode:-9999,errMsg:e.errMsg.replace(/^request/,t.API_NAME)}))}})})}(d,l)).then(c.keepAlive).catch(c.keepAlive),[2,_]):[2,function(r,i){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(s){return[2,new Promise(function(s,a){var u,c=(0,o.getSDK)(e.identifiers),l=n.__assign(n.__assign({},i.header),{"X-WX-ENV":e.isInstance?e.env:(null===(u=i.config)||void 0===u?void 0:u.env)||e.env,"X-WX-SERVICE":i.service,"X-WX-CONTAINER-PATH":i.path,"X-WX-CALL-ID":"".concat(Math.random(),"_").concat(Date.now()),"X-WX-USER-TIMEOUT":i.timeout});e.appid&&(l["X-WX-RESOURCE-APPID"]=e.appid),c.request({url:r,method:i.method,header:l,data:i.data,dataType:i.dataType,responseType:i.responseType,timeout:i.timeout,success:function(e){s(n.__assign(n.__assign({},e),{errMsg:"".concat(t.API_NAME,":ok")}))},fail:function(e){a(n.__assign(n.__assign({},e),{errMsg:e.errMsg.replace(/^request/,t.API_NAME)}))}})})]})})}(d.url,l)]}})})}}},"./src/services/container/api/callContainer/v2.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.API_NAME=t.ResultStatus=t.DataType=t.RetryType=t.Action=void 0;var n,i,o,s=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),a=r("./src/utils/error.ts"),u=r("./src/utils/serializer.ts"),c=r("./src/externals/globals/wxconfig.ts"),l=r("./src/externals/public-lib/appserviceSdk.ts"),d=r("./src/utils/type.ts"),f=(r("./src/utils/cdn.ts"),r("./src/utils/utils.ts")),p=r("./src/utils/msg.ts"),_=r("./src/utils/utils.ts"),h=r("./src/config/error.config.ts");!function(e){e[e.CALL=1]="CALL",e[e.POLL=2]="POLL"}(n=t.Action||(t.Action={})),function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Timeout=2]="Timeout"}(i=t.RetryType||(t.RetryType={})),function(e){e[e.RAW=0]="RAW",e[e.BASE64=1]="BASE64",e[e.CDN_URL=2]="CDN_URL"}(o=t.DataType||(t.DataType={})),function(e){e[e.PENDING=0]="PENDING",e[e.DONE=1]="DONE",e[e.TIMEOUT=2]="TIMEOUT"}(t.ResultStatus||(t.ResultStatus={}));var E=function(e){var t=new Date;return"".concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds()," ").concat(e)},m=function(e){return e.join("->")},g=20,v=2,S=2,y=2e4,T=1e5;t.API_NAME="cloud.callContainer",t.default=function(e){return function(r){var A,b;return s.__awaiter(this,void 0,void 0,function(){function C(t,r,o,a){return s.__awaiter(this,void 0,void 0,function(){var u,c,l;return s.__generator(this,function(s){return u=!1,t.hasOwnProperty("timeout")&&(c=new Promise(function(e,r){setTimeout(function(){u=!0,r("timeout (options.timeout == ".concat(t.timeout,")"))},t.timeout)})),l=new Promise(function(s,l){var d=[E("start")],p=function(e,t,r){var n=function(t){e.push(E("app ".concat(t)))};return(0,f.onAppVisibilityChange)(n),{resolve:function(e){(0,f.offAppVisibilityChange)(n),t(e)},reject:function(e){(0,f.offAppVisibilityChange)(n),r(e)}}}(d,s,l),_=p.resolve,h=p.reject;O({param:t,data:r,dataType:o,callID:a,action:n.CALL,retryType:i.None,tryCount:e.appConfig.maxPollRetry||g,systemErrorRetry:v,timeoutErrorRetry:S,userTimeout:{get reached(){return!!c&&u}},trace:d,resolve:_,reject:h})}),[2,c?Promise.race([l,c]):l]})})}function O(d){return s.__awaiter(this,void 0,void 0,function(){function p(u){return s.__awaiter(this,void 0,void 0,function(){var c,p,_,g,S,y;return s.__generator(this,function(T){switch(T.label){case 0:return T.trys.push([0,13,,14]),U||R.reached?[2]:(B(),G(u),(c=u.data)?c.baseresponse&&0===c.baseresponse.errcode?0!==c.status?[3,1]:A>=0?(b.push(E("normal poll")),O(s.__assign(s.__assign({},d),{action:n.POLL,retryType:i.None,tryCount:A-1})),[3,10]):(b.push(E("too many polls, abort")),[2,N((0,a.toSDKError)({errCode:h.ERR_CODE.SDK_CONTAINER_EXCEED_MAX_POLL_RETRY,errMsg:"(callId: ".concat(v,") (trace: ").concat(m(b),")")},t.API_NAME))]):[3,11]:(b.push(E("empty resp")),[2,N((0,a.toSDKError)({errCode:h.ERR_CODE.SDK_CONTAINER_EMPTY_CALL_RESULT},t.API_NAME))]));case 1:return 1!==c.status?[3,9]:(p=void 0,c.data_type!==o.BASE64?[3,2]:(p=(0,f.base64ToArrayBuffer)(c.data),"json"===r.dataType?p=(0,f.tryJSONParse)((0,f.arrayBufferToString)(p)):"arraybuffer"!==r.responseType&&(p=(0,f.arrayBufferToString)(p)),[3,8]));case 2:if(c.data_type!==o.CDN_URL)return[3,7];T.label=3;case 3:return T.trys.push([3,5,,6]),_=(0,l.getSDK)(e.identifiers),[4,new Promise(function(e,t){_.request({url:c.data,dataType:r.dataType,responseType:r.responseType,success:function(r){200!==r.statusCode?t("download response status code ".concat(r.statusCode)):e(r)},fail:function(e){t(e)}})})];case 4:return g=T.sent(),p=g.data,[3,6];case 5:return S=T.sent(),[2,N((0,a.toSDKError)({errCode:h.ERR_CODE.SDK_CONTAINER_DOWNLOAD_RESULT_FROM_CDN_FAIL,errMsg:"error: ".concat(S," \n (callId: ").concat(v,") (trace: ").concat(m(b),")")},t.API_NAME))];case 6:return[3,8];case 7:p=c.data,"arraybuffer"===r.responseType?p=(0,f.stringToArrayBuffer)(p):"json"===r.dataType&&(p=(0,f.tryJSONParse)(p)),T.label=8;case 8:return[2,w({result:{data:p,statusCode:c.http_code,header:c.headers.reduce(function(e,t){var r=e[t.k+""];return e[t.k+""]=r?r+","+t.v:t.v+"",e},{})}})];case 9:return b.push(E("poll result expired")),[2,N((0,a.toSDKError)({errCode:h.ERR_CODE.SDK_CONTAINER_POLL_RESULT_EXPIRED,errMsg:"timeout for result fetching, result cannot be fetched anymore (callId: ".concat(v,") (trace: ").concat(m(b),")")},t.API_NAME))];case 10:return[3,12];case 11:return c.baseresponse?0!==c.baseresponse.errcode?[2,N((0,a.toSDKError)({errCode:h.ERR_CODE.SDK_CONTAINER_POLL_RESULT_BASE_RESP_RET_ABNORMAL,errMsg:"polling base_resp.errcode ".concat(c.baseresponse.errcode," errmsg ").concat(c.baseresponse.errmsg," (callId: ").concat(v,")")},t.API_NAME))]:[2,N((0,a.toSDKError)({errCode:h.ERR_CODE.SDK_CONTAINER_EMPTY_POLL_RESULT_BASE_RESP,errMsg:"polling base_resp ".concat(JSON.stringify(c.baseresponse)," (callId: ").concat(v,")")},t.API_NAME))]:[2,N((0,a.toSDKError)({errCode:h.ERR_CODE.SDK_CONTAINER_EMPTY_POLL_RESULT_BASE_RESP},t.API_NAME))];case 12:return[3,14];case 13:return y=T.sent(),N((0,a.toSDKError)({errCode:h.ERR_CODE.SDK_CONTAINER_POLL_ERROR,errMsg:"polling catch error: ".concat(y," (callId: ").concat(v,")")},t.API_NAME)),[3,14];case 14:return[2]}})})}var _,g,v,S,T,A,b,C,I,R,w,N,D,L,M,P,U,x,B,k,j,G,q=this;return s.__generator(this,function(o){for(L in _=d.data,g=d.dataType,v=d.callID,S=d.action,T=d.retryType,A=d.tryCount,b=d.trace,C=d.systemErrorRetry,I=d.timeoutErrorRetry,R=d.userTimeout,w=d.resolve,N=d.reject,D=[],r.header)D.push({k:L,v:r.header[L]});return M=S===n.CALL?{method:r.method||"GET",headers:D,data:S===n.CALL?_:void 0,data_type:g,action:S,retryType:T,call_id:v,user_timeout:r.timeout}:{call_id:v,action:S,retryType:T},P=(0,u.serialize)(M),U=!1,x=!1,B=function(){clearTimeout(j),x=!0},k=+new Date,j=setTimeout(function(){return s.__awaiter(q,void 0,void 0,function(){var r;return s.__generator(this,function(n){switch(n.label){case 0:return r=e.appConfig.clientPollTimeout||y,+new Date-k>r?[4,(0,f.sleep)()]:[3,2];case 1:if(n.sent(),x)return[2];n.label=2;case 2:return R.reached?[2]:!(0,c.isDevTools)()&&+new Date-k>e.appConfig.maxStartRetryGap?(b.push(E("timeout, exceed max retry gap")),[2,N((0,a.toSDKError)({errCode:h.ERR_CODE.SDK_CONTAINER_POLL_RESULT_EXPIRED,errMsg:"timeout for retry, cannot retry fetching the result anymore (callId: ".concat(v,") (trace: ").concat(m(b),")")},t.API_NAME))]):(U=!0,d.timeoutErrorRetry>0?(b.push(E("timeout, retry")),O(s.__assign(s.__assign({},d),{retryType:i.Timeout,tryCount:A-1,timeoutErrorRetry:I-1}))):(b.push(E("timeout, abort")),N((0,a.toSDKError)({errCode:h.ERR_CODE.SDK_CONTAINER_EXCEED_MAX_TIMEOUT_POLL_RETRY,errMsg:"(callId: ".concat(v,") (trace: ").concat(m(b),")")},t.API_NAME))),[2])}})})},e.appConfig.clientPollTimeout||y),G=function(e){var t=e.data;t&&t.baseresponse&&t.baseresponse.stat&&t.baseresponse.stat.qbase_cost_time&&(r.context.tunnelTimeNoCSNetCost+=t.baseresponse.stat.qbase_cost_time)},R.reached?[2]:(e.request(s.__assign(s.__assign({},r.config),{apiName:"tcbapi_call_container",serviceName:e.name,serializedReqData:P,env:r.config&&r.config.env||e.env})).then(p).catch(function(e){U||R.reached||(B(),e&&e.operateWXDataFail&&C>0?(b.push(E("system error (".concat(e,"), retry"))),O(s.__assign(s.__assign({},d),{retryType:i.Error,tryCount:A-1,systemErrorRetry:C-1}))):(b.push(E("system error (".concat(e,"), abort"))),N((0,a.toSDKError)("".concat(e," (callId: ").concat(v,") (trace: ").concat(m(b),")"),t.API_NAME))))}),[2])})})}var I,R,w,N,D,L,M,P,U,x,B;return s.__generator(this,function(n){switch(n.label){case 0:return r.shouldSerialize?[4,r.cdnMapPromise]:[3,2];case 1:I=n.sent(),r.data=(0,u.serialize)(r.data,I),n.label=2;case 2:return R=o.RAW,w=(null===(A=r.method)||void 0===A?void 0:A.toUpperCase())||"GET",r.data&&/^(POST|PUT|PATCH|DELETE)$/.test(w)?"object"!==(N=(0,d.getType)(r.data))?[3,3]:(r.data=JSON.stringify(r.data),[3,7]):[3,8];case 3:if("arraybuffer"!==N&&"string"!==N)return[3,6];if(D=!1,"string"===N?D=r.data.length>T:r.data.byteLength>T?D=!0:(L=(0,_.arrayBufferToBase64)(r.data)).length>T?D=!0:(r.data=L,R=o.BASE64),!D)return[3,5];throw new Error("input data size too large (> 100KB)");case 4:M=n.sent(),r.data=M.fileUrl,R=o.CDN_URL,n.label=5;case 5:return[3,7];case 6:throw new Error("input data type is not supported: ".concat(N));case 7:return[3,9];case 8:if("GET"===w&&r.data&&(0,d.isObject)(r.data)){for(x in P=[],r.data)P.push("".concat(x,"=").concat(r.data[x]));r.path+="".concat(r.path.includes("?")?r.path.endsWith("&")?"":"&":"?").concat(P.join("&")),r.data=void 0}else r.data=void 0;n.label=9;case 9:for(x in U="".concat(+new Date,"-").concat(Math.random()),r.header=s.__assign(s.__assign({},r.header),{"X-WX-ENV":e.isInstance?e.env:(null===(b=r.config)||void 0===b?void 0:b.env)||e.env,"X-WX-CONTAINER-PATH":r.path}),r.service&&(r.header["X-WX-SERVICE"]=r.service),r.header)null!==r.header[x]&&void 0!==r.header[x]&&(r.header[x]+="");return r.context.tunnelStartTime=+new Date,[4,C(r,r.data,R,U)];case 10:return B=n.sent().result,r.context.tunnelEndTime=+new Date,[2,s.__assign(s.__assign({},B),{errMsg:(0,p.apiSuccessMsg)(t.API_NAME),callID:U})]}})})}}},"./src/services/container/api/connectContainer.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/externals/public-lib/appserviceSdk.ts"),o=r("./src/utils/assert.ts"),s=r("./src/hook/invoke.ts"),a=r("./src/utils/msg.ts"),u=r("./src/utils/fn/clone.ts"),c=r("./src/utils/report.ts"),l="cloud.connectContainer";t.default=function(e){return function(e){var r=(0,u.shallowClone)(e);return r.timing={apiStartTime:+new Date},(0,s.hasAPICallback)(r)?function(e){t(e).then(function(t){(0,s.invokeSuccessCompleteCallbacks)(l,e,t)}).catch(function(t){(0,s.invokeFailCompleteCallbacks)(l,e,t)})}(r):t(r)};function t(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,3,4]),function(e){e.config&&e.config.env&&(0,o.assertType)(e.config.env,"string")}(t),[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,o,s,u,c,d;return n.__generator(this,function(f){switch(f.label){case 0:return r={service_name:t.service},o=JSON.stringify(r),t.timing.tunnelStartTime=+new Date,[4,e.request({apiName:"tcbapi_get_websocket_info",serviceName:e.name,serializedReqData:o,env:t.config&&t.config.env||e.env})];case 1:return s=f.sent(),t.timing.tunnelEndTime=+new Date,u=s.data,t.success,t.complete,c=n.__rest(t,["success","complete"]),d=(0,i.getSDK)(e.identifiers).connectSocket(n.__assign(n.__assign({},c),{url:"wss://".concat(u.host).concat(t.path||""),header:n.__assign(n.__assign({},c.header),{"content-type":"application/json","x-wx-token":u.token}),perMessageDeflate:!0})),[2,{errMsg:(0,a.apiSuccessMsg)(l),socketTask:d}]}})})}(t)];case 1:return[2,r.sent()];case 2:throw r.sent();case 3:return(0,c.reportAPISpeed)(n.__assign(n.__assign({},t.timing),{apiEndTime:+new Date,apiName:l})),[7];case 4:return[2]}})})}}},"./src/services/container/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerService=t.CONTAINER_SERVICE_NAME=void 0;var n=r("./src/services/container/api/api.ts");t.CONTAINER_SERVICE_NAME="container",t.registerService=function(e){e.registerService(function(e){var r={name:t.CONTAINER_SERVICE_NAME,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,serviceEndpoint:e.serviceEndpoint,get debug(){return e.debug},get appid(){return e.isInstance?e.instanceOptions.resourceAppid:void 0},get env(){return e.getEnvForService(t.CONTAINER_SERVICE_NAME)},appConfig:{get maxPollRetry(){return e.appConfig.call_container_poll_max_retry},get clientPollTimeout(){return e.appConfig.call_container_client_poll_timeout},get maxStartRetryGap(){return e.appConfig.call_container_valid_start_retry_gap}}};return{name:t.CONTAINER_SERVICE_NAME,context:r,getAPIs:n.getAPIs.bind(null,r)}}(e))}},"./src/services/database/api/api.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r("./src/services/database/api/database.ts");t.getAPIs=function(e){return{database:n.default.bind(null,e)}}},"./src/services/database/api/database.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getDatabase=void 0;var n=r("./src/services/database/api/database/command.ts"),i=r("./src/services/database/api/database/collection.ts"),o=r("./src/services/database/api/database/geo.ts"),s=r("./src/services/database/api/database/date.ts"),a=r("./src/services/database/api/database/regexp.ts"),u=r("./src/services/database/internal/grammar/engine.ts"),c=r("./src/utils/assert.ts");function l(e,t){return new(f(e.identifiers||{}))({context:e,config:t})}function d(e){return e.debug}t.getDatabase=l,t.default=l;var f=function(e){var t,r;return function(){function l(l){var f=l.config,p=l.context;this.identifiers=e,this.config=f||{},t={database:this,serviceContext:p,engine:(0,u.getEngine)()},r=(0,i.getCollectionReferenceClass)(t),f&&f.env&&(0,c.assertType)(f.env,"string"),this.command=n.commands,this.Geo=o,this.serverDate=s.serverDate,this.RegExp=a.regExp,f&&f.hasOwnProperty("debug")&&Object.defineProperties(this,{debug:{value:!0},QuerySerializer:{enumerable:!1,configurable:!1,get:function(){return function(e){return d(e.database)?e.engine.QuerySerializer:void 0}(t)},set:function(){}},UpdateSerializer:{enumerable:!1,configurable:!1,get:function(){return function(e){return d(e.database)?e.engine.UpdateSerializer:void 0}(t)},set:function(){}},ProjectionSerializer:{enumerable:!1,configurable:!1,get:function(){return function(e){return d(e.database)?e.engine.ProjectionSerializer:void 0}(t)},set:function(){}},AggregateSerializer:{enumerable:!1,configurable:!1,get:function(){return function(e){return d(e.database)?e.engine.AggregateSerializer:void 0}(t)},set:function(){}},Decoder:{enumerable:!1,configurable:!1,get:function(){return function(e){return d(e.database)?e.engine.Decoder:void 0}(t)},set:function(){}}})}return l.prototype.collection=function(e){return new r(e)},l.prototype.toJSON=function(){},l}()}},"./src/services/database/api/database/aggregate.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isPipelineStage=t.isPipeline=t.isAggregate=t.Pipeline=t.getAggregateClass=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/services/database/api/database/helper/symbol.ts"),o=r("./src/hook/invoke.ts"),s=r("./src/utils/msg.ts"),a=r("./src/utils/error.ts"),u=r("./src/utils/report.ts"),c=r("./src/services/database/internal/backend-api/backend-api.ts"),l=r("./src/externals/globals/wxconfig.ts");t.getAggregateClass=function(e){return function(t){function r(e,r){var n=t.call(this,r)||this;return n._internalType=i.SYMBOL_AGGREGATE,n.collection=e,n}return n.__extends(r,t),r.prototype.pushStage=function(e,t){return new r(this.collection,n.__spreadArray(n.__spreadArray([],n.__read(this._stages),!1),[new d(e,t)],!1))},r.prototype.end=function(t){var r=this;void 0===t&&(t={});var i="collection.aggregate",d={apiStartTime:+new Date},f=(0,o.hasAPICallback)(t),p=new Promise(function(o,f){return n.__awaiter(r,void 0,void 0,function(){var p,_;return n.__generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,3,4]),[4,(0,c.runAggregate)({env:e.database.config.env,collectionName:r.collection.collectionName,stages:e.engine.AggregateSerializer.encodeStages(r._stages),instanceContext:e,timing:d,explain:t.explain})];case 1:return p=h.sent(),t.explain&&(0,l.isDevTools)()?[2,o(p)]:(o({list:p.list,errMsg:(0,s.apiSuccessMsg)(i)}),[3,4]);case 2:return _=h.sent(),f((0,a.returnAsFinalCloudSDKError)(_,i)),[3,4];case 3:return(0,u.reportAPISpeed)(n.__assign(n.__assign({},d),{apiEndTime:+new Date,apiName:"cloud.db.".concat(i)})),[7];case 4:return[2]}})})});if(!f)return p;p.then(function(e){(0,o.invokeSuccessCompleteCallbacks)(i,t,e)}).catch(function(e){(0,o.invokeFailCompleteCallbacks)(i,t,e)})},r}(f)};var d=function(){return function(e,t){this._internalType=i.SYMBOL_AGGREGATE_PIPELINE_STAGE,this.stage=e,this.val=t}}(),f=function(){function e(e){this._internalType=i.SYMBOL_AGGREGATE_PIPELINE,this._stages=e}return e.prototype.pushStage=function(t,r){return new e(n.__spreadArray(n.__spreadArray([],n.__read(this._stages),!1),[new d(t,r)],!1))},e.prototype.addFields=function(e){return this.pushStage("addFields",e)},e.prototype.bucket=function(e){return this.pushStage("bucket",e)},e.prototype.bucketAuto=function(e){return this.pushStage("bucketAuto",e)},e.prototype.collStats=function(e){return this.pushStage("collStats",e)},e.prototype.count=function(e){return this.pushStage("count",e)},e.prototype.facet=function(e){return this.pushStage("facet",e)},e.prototype.geoNear=function(e){return this.pushStage("geoNear",e)},e.prototype.graphLookup=function(e){return this.pushStage("graphLookup",e)},e.prototype.group=function(e){return this.pushStage("group",e)},e.prototype.indexStats=function(){return this.pushStage("indexStats",{})},e.prototype.limit=function(e){return this.pushStage("limit",e)},e.prototype.lookup=function(e){return this.pushStage("lookup",e)},e.prototype.match=function(e){return this.pushStage("match",e)},e.prototype.out=function(e){return this.pushStage("out",e)},e.prototype.project=function(e){return this.pushStage("project",e)},e.prototype.redact=function(e){return this.pushStage("redact",e)},e.prototype.replaceRoot=function(e){return this.pushStage("replaceRoot",e)},e.prototype.sample=function(e){return this.pushStage("sample",e)},e.prototype.skip=function(e){return this.pushStage("skip",e)},e.prototype.sort=function(e){return this.pushStage("sort",e)},e.prototype.sortByCount=function(e){return this.pushStage("sortByCount",e)},e.prototype.unwind=function(e){return this.pushStage("unwind",e)},e.prototype.end=function(){},e}(),p=function(e){function t(t,r){void 0===r&&(r=!1);var n=e.call(this,t)||this;return n._sealed=r,n}return n.__extends(t,e),t.prototype.pushStage=function(e,r){if(this._sealed)throw new Error("pushing new stage is not allowed after calling 'done()'");return new t(n.__spreadArray(n.__spreadArray([],n.__read(this._stages),!1),[new d(e,r)],!1))},t.prototype.done=function(){return new t(this._stages,!0)},t}(f);t.Pipeline=p;t.isAggregate=function(e){return e&&e._internalType===i.SYMBOL_AGGREGATE};t.isPipeline=function(e){return e&&e._internalType===i.SYMBOL_AGGREGATE_PIPELINE};t.isPipelineStage=function(e){return e&&e._internalType===i.SYMBOL_AGGREGATE_PIPELINE_STAGE}},"./src/services/database/api/database/collection.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getCollectionReferenceClass=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/services/database/api/database/query.ts"),o=r("./src/services/database/api/database/document.ts"),s=r("./src/services/database/api/database/aggregate.ts"),a=r("./src/hook/invoke.ts"),u=r("./src/services/database/internal/backend-api/backend-api.ts"),c=r("./src/utils/msg.ts"),l=r("./src/utils/error.ts"),d=r("./src/utils/assert.ts"),f=r("./src/utils/report.ts");t.getCollectionReferenceClass=function(e){var t=(0,i.getQueryClass)(e),r=(0,o.getDocumentReferenceClass)(e),p=(0,s.getAggregateClass)(e);return function(t){function i(e){var r=t.call(this,e)||this;return r.collectionName=e,r}return n.__extends(i,t),i.prototype.doc=function(e){if(null===e||void 0===e)throw(0,l.returnAsFinalCloudSDKError)({errCode:-1,errMsg:"docId must not be empty"},"collection.doc");return new r(this,e)},i.prototype.add=function(t){var r=this,i="collection.add",o={apiStartTime:+new Date},s=(0,a.hasAPICallback)(t),p=new Promise(function(s,a){return n.__awaiter(r,void 0,void 0,function(){var p,_;return n.__generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,3,4]),(0,d.assertType)(t,{data:"object"}),[4,(0,u.addDocument)({env:e.database.config.env,collectionName:r.collectionName,data:e.engine.encodeInternalDataType(t.data),instanceContext:e,timing:o})];case 1:return p=h.sent(),s({_id:p._id,errMsg:(0,c.apiSuccessMsg)(i)}),[3,4];case 2:return _=h.sent(),a((0,l.returnAsFinalCloudSDKError)(_,i)),[3,4];case 3:return(0,f.reportAPISpeed)(n.__assign(n.__assign({},o),{apiEndTime:+new Date,apiName:"cloud.db.".concat(i)})),[7];case 4:return[2]}})})});if(!s)return p;p.then(function(e){(0,a.invokeSuccessCompleteCallbacks)(i,t,e)}).catch(function(e){(0,a.invokeFailCompleteCallbacks)(i,t,e)})},i.prototype.aggregate=function(){return new p(this,[])},i}(t)}},"./src/services/database/api/database/command.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.commands=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/services/database/api/database/commands/query.ts"),o=r("./src/services/database/api/database/commands/logic.ts"),s=r("./src/services/database/api/database/commands/update.ts"),a=r("./src/services/database/api/database/commands/aggregate.ts"),u=r("./src/services/database/api/database/commands/projection.ts"),c=r("./src/services/database/api/database/aggregate.ts"),l=r("./src/utils/type.ts"),d=new Set(["each","position","slice","sort"]);t.commands={eq:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.EQ,[e])},neq:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.NEQ,[e])},lt:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.LT,[e])},lte:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.LTE,[e])},gt:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.GT,[e])},gte:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.GTE,[e])},in:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.IN,e)},nin:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.NIN,e)},geoNear:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.GEO_NEAR,[e])},geoWithin:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.GEO_WITHIN,[e])},geoIntersects:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS,[e])},and:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,l.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.AND,r)},or:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,l.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.OR,r)},nor:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,l.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.NOR,r)},not:function(e){return new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.NOT,[e])},exists:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.EXISTS,[e])},mod:function(e,t){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.MOD,[e,t])},all:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.ALL,e)},elemMatch:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.ELEM_MATCH,[e])},size:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.SIZE,[e])},expr:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.EXPR,[e])},set:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.SET,[e])},remove:function(){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.REMOVE,[])},inc:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.INC,[e])},mul:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.MUL,[e])},min:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.MIN,[e])},max:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.MAX,[e])},rename:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.RENAME,[e])},bit:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.BIT,[e])},push:function(e){var t,r,i={};if((0,l.isArray)(e))i.each=e;else if((0,l.isObject)(e)&&(0,l.isArray)(e.each)){var o=Object.keys(e);if(1===o.length)i=e;else{var a=!1;try{for(var u=n.__values(o),c=u.next();!c.done;c=u.next()){var f=c.value;if(!d.has(f)){a=!0;break}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}i=a?[e]:e}}else i.each=[e];return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.PUSH,[i])},pop:function(){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.POP,[])},shift:function(){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.SHIFT,[])},unshift:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,l.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.UNSHIFT,r)},addToSet:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.ADD_TO_SET,[e])},pull:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.PULL,[e])},pullAll:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.PULL_ALL,[e])},project:{slice:function(e){return new u.ProjectionCommmand(u.PROJECTION_COMMANDS_LITERAL.SLICE,[e])}},aggregate:{pipeline:function(){return new c.Pipeline([])},abs:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ABS,[e])},add:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ADD,[e])},addToSet:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ADDTOSET,[e])},allElementsTrue:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ALLELEMENTSTRUE,[e])},and:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.AND,[e])},anyElementTrue:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ANYELEMENTTRUE,[e])},arrayElemAt:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ARRAYELEMAT,[e])},arrayToObject:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ARRAYTOOBJECT,[e])},avg:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.AVG,[e])},ceil:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.CEIL,[e])},cmp:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.CMP,[e])},concat:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.CONCAT,[e])},concatArrays:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.CONCATARRAYS,[e])},cond:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.COND,[e])},convert:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.CONVERT,[e])},dateFromParts:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.DATEFROMPARTS,[e])},dateToParts:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.DATETOPARTS,[e])},dateFromString:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.DATEFROMSTRING,[e])},dateToString:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.DATETOSTRING,[e])},dayOfMonth:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.DAYOFMONTH,[e])},dayOfWeek:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.DAYOFWEEK,[e])},dayOfYear:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.DAYOFYEAR,[e])},divide:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.DIVIDE,[e])},eq:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.EQ,[e])},exp:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.EXP,[e])},filter:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.FILTER,[e])},first:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.FIRST,[e])},floor:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.FLOOR,[e])},gt:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.GT,[e])},gte:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.GTE,[e])},hour:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.HOUR,[e])},ifNull:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.IFNULL,[e])},in:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.IN,[e])},indexOfArray:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.INDEXOFARRAY,[e])},indexOfBytes:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.INDEXOFBYTES,[e])},indexOfCP:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.INDEXOFCP,[e])},isArray:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ISARRAY,[e])},isoDayOfWeek:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ISODAYOFWEEK,[e])},isoWeek:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ISOWEEK,[e])},isoWeekYear:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ISOWEEKYEAR,[e])},last:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.LAST,[e])},let:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.LET,[e])},literal:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.LITERAL,[e])},ln:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.LN,[e])},log:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.LOG,[e])},log10:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.LOG10,[e])},lt:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.LT,[e])},lte:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.LTE,[e])},ltrim:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.LTRIM,[e])},map:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.MAP,[e])},max:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.MAX,[e])},mergeObjects:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.MERGEOBJECTS,[e])},meta:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.META,[e])},min:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.MIN,[e])},millisecond:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.MILLISECOND,[e])},minute:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.MINUTE,[e])},mod:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.MOD,[e])},month:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.MONTH,[e])},multiply:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.MULTIPLY,[e])},neq:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.NEQ,[e])},not:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.NOT,[e])},objectToArray:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.OBJECTTOARRAY,[e])},or:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.OR,[e])},pow:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.POW,[e])},push:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.PUSH,[e])},range:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.RANGE,[e])},reduce:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.REDUCE,[e])},reverseArray:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.REVERSEARRAY,[e])},rtrim:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.RTRIM,[e])},second:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SECOND,[e])},setDifference:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SETDIFFERENCE,[e])},setEquals:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SETEQUALS,[e])},setIntersection:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SETINTERSECTION,[e])},setIsSubset:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SETISSUBSET,[e])},setUnion:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SETUNION,[e])},size:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SIZE,[e])},slice:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SLICE,[e])},split:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SPLIT,[e])},sqrt:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SQRT,[e])},stdDevPop:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.STDDEVPOP,[e])},stdDevSamp:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.STDDEVSAMP,[e])},strcasecmp:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.STRCASECMP,[e])},strLenBytes:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.STRLENBYTES,[e])},strLenCP:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.STRLENCP,[e])},substr:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SUBSTR,[e])},substrBytes:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SUBSTRBYTES,[e])},substrCP:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SUBSTRCP,[e])},subtract:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SUBTRACT,[e])},sum:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SUM,[e])},switch:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.SWITCH,[e])},toBool:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TOBOOL,[e])},toDate:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TODATE,[e])},toDecimal:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TODECIMAL,[e])},toDouble:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TODOUBLE,[e])},toInt:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TOINT,[e])},toLong:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TOLONG,[e])},toObjectId:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TOOBJECTID,[e])},toString:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TOSTRING,[e])},toLower:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TOLOWER,[e])},toUpper:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TOUPPER,[e])},trim:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TRIM,[e])},trunc:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TRUNC,[e])},type:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.TYPE,[e])},week:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.WEEK,[e])},year:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.YEAR,[e])},zip:function(e){return new a.AggregateCommand(a.AGGREGATE_COMMANDS_LITERAL.ZIP,[e])}}},t.default=t.commands},"./src/services/database/api/database/commands/aggregate.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.LTRIM=t.LTE=t.LT=t.LOG10=t.LOG=t.LN=t.LITERAL=t.LET=t.LAST=t.ISOWEEKYEAR=t.ISOWEEK=t.ISODAYOFWEEK=t.ISARRAY=t.INDEXOFCP=t.INDEXOFBYTES=t.INDEXOFARRAY=t.IN=t.IFNULL=t.HOUR=t.GTE=t.GT=t.FLOOR=t.FIRST=t.FILTER=t.EXP=t.EQ=t.DIVIDE=t.DAYOFYEAR=t.DAYOFWEEK=t.DAYOFMONTH=t.DATETOSTRING=t.DATEFROMSTRING=t.DATETOPARTS=t.DATEFROMPARTS=t.CONVERT=t.COND=t.CONCATARRAYS=t.CONCAT=t.CMP=t.CEIL=t.AVG=t.ARRAYTOOBJECT=t.ARRAYELEMAT=t.ANYELEMENTTRUE=t.AND=t.ALLELEMENTSTRUE=t.ADDTOSET=t.ADD=t.ABS=t.AGGREGATE_COMMANDS_LITERAL=void 0,t.TOLOWER=t.TOSTRING=t.TOOBJECTID=t.TOLONG=t.TOINT=t.TODOUBLE=t.TODECIMAL=t.TODATE=t.TOBOOL=t.SWITCH=t.SUM=t.SUBTRACT=t.SUBSTRCP=t.SUBSTRBYTES=t.SUBSTR=t.STRLENCP=t.STRLENBYTES=t.STRCASECMP=t.STDDEVSAMP=t.STDDEVPOP=t.SQRT=t.SPLIT=t.SLICE=t.SIZE=t.SETUNION=t.SETISSUBSET=t.SETINTERSECTION=t.SETEQUALS=t.SETDIFFERENCE=t.SECOND=t.RTRIM=t.REVERSEARRAY=t.REDUCE=t.RANGE=t.PUSH=t.POW=t.OR=t.OBJECTTOARRAY=t.NOT=t.NEQ=t.MULTIPLY=t.MONTH=t.MOD=t.MINUTE=t.MILLISECOND=t.MIN=t.META=t.MERGEOBJECTS=t.MAX=t.MAP=void 0,t.isKnownAggregateCommand=t.isAggregateCommand=t.AggregateCommand=t.ZIP=t.YEAR=t.WEEK=t.TYPE=t.TRUNC=t.TRIM=t.TOUPPER=void 0;var n,i=r("./src/services/database/api/database/helper/symbol.ts");!function(e){e.ABS="abs",e.ADD="add",e.ADDTOSET="addToSet",e.ALLELEMENTSTRUE="allElementsTrue",e.AND="and",e.ANYELEMENTTRUE="anyElementTrue",e.ARRAYELEMAT="arrayElemAt",e.ARRAYTOOBJECT="arrayToObject",e.AVG="avg",e.CEIL="ceil",e.CMP="cmp",e.CONCAT="concat",e.CONCATARRAYS="concatArrays",e.COND="cond",e.CONVERT="convert",e.DATEFROMPARTS="dateFromParts",e.DATETOPARTS="dateToParts",e.DATEFROMSTRING="dateFromString",e.DATETOSTRING="dateToString",e.DAYOFMONTH="dayOfMonth",e.DAYOFWEEK="dayOfWeek",e.DAYOFYEAR="dayOfYear",e.DIVIDE="divide",e.EQ="eq",e.EXP="exp",e.FILTER="filter",e.FIRST="first",e.FLOOR="floor",e.GT="gt",e.GTE="gte",e.HOUR="hour",e.IFNULL="ifNull",e.IN="in",e.INDEXOFARRAY="indexOfArray",e.INDEXOFBYTES="indexOfBytes",e.INDEXOFCP="indexOfCP",e.ISARRAY="isArray",e.ISODAYOFWEEK="isoDayOfWeek",e.ISOWEEK="isoWeek",e.ISOWEEKYEAR="isoWeekYear",e.LAST="last",e.LET="let",e.LITERAL="literal",e.LN="ln",e.LOG="log",e.LOG10="log10",e.LT="lt",e.LTE="lte",e.LTRIM="ltrim",e.MAP="map",e.MAX="max",e.MERGEOBJECTS="mergeObjects",e.META="meta",e.MIN="min",e.MILLISECOND="millisecond",e.MINUTE="minute",e.MOD="mod",e.MONTH="month",e.MULTIPLY="multiply",e.NEQ="ne",e.NOT="not",e.OBJECTTOARRAY="objectToArray",e.OR="or",e.POW="pow",e.PUSH="push",e.RANGE="range",e.REDUCE="reduce",e.REVERSEARRAY="reverseArray",e.RTRIM="rtrim",e.SECOND="second",e.SETDIFFERENCE="setDifference",e.SETEQUALS="setEquals",e.SETINTERSECTION="setIntersection",e.SETISSUBSET="setIsSubset",e.SETUNION="setUnion",e.SIZE="size",e.SLICE="slice",e.SPLIT="split",e.SQRT="sqrt",e.STDDEVPOP="stdDevPop",e.STDDEVSAMP="stdDevSamp",e.STRCASECMP="strcasecmp",e.STRLENBYTES="strLenBytes",e.STRLENCP="strLenCP",e.SUBSTR="substr",e.SUBSTRBYTES="substrBytes",e.SUBSTRCP="substrCP",e.SUBTRACT="subtract",e.SUM="sum",e.SWITCH="switch",e.TOBOOL="toBool",e.TODATE="toDate",e.TODECIMAL="toDecimal",e.TODOUBLE="toDouble",e.TOINT="toInt",e.TOLONG="toLong",e.TOOBJECTID="toObjectId",e.TOSTRING="toString",e.TOLOWER="toLower",e.TOUPPER="toUpper",e.TRIM="trim",e.TRUNC="trunc",e.TYPE="type",e.WEEK="week",e.YEAR="year",e.ZIP="zip"}(n=t.AGGREGATE_COMMANDS_LITERAL||(t.AGGREGATE_COMMANDS_LITERAL={})),t.ABS=n.ABS,t.ADD=n.ADD,t.ADDTOSET=n.ADDTOSET,t.ALLELEMENTSTRUE=n.ALLELEMENTSTRUE,t.AND=n.AND,t.ANYELEMENTTRUE=n.ANYELEMENTTRUE,t.ARRAYELEMAT=n.ARRAYELEMAT,t.ARRAYTOOBJECT=n.ARRAYTOOBJECT,t.AVG=n.AVG,t.CEIL=n.CEIL,t.CMP=n.CMP,t.CONCAT=n.CONCAT,t.CONCATARRAYS=n.CONCATARRAYS,t.COND=n.COND,t.CONVERT=n.CONVERT,t.DATEFROMPARTS=n.DATEFROMPARTS,t.DATETOPARTS=n.DATETOPARTS,t.DATEFROMSTRING=n.DATEFROMSTRING,t.DATETOSTRING=n.DATETOSTRING,t.DAYOFMONTH=n.DAYOFMONTH,t.DAYOFWEEK=n.DAYOFWEEK,t.DAYOFYEAR=n.DAYOFYEAR,t.DIVIDE=n.DIVIDE,t.EQ=n.EQ,t.EXP=n.EXP,t.FILTER=n.FILTER,t.FIRST=n.FIRST,t.FLOOR=n.FLOOR,t.GT=n.GT,t.GTE=n.GTE,t.HOUR=n.HOUR,t.IFNULL=n.IFNULL,t.IN=n.IN,t.INDEXOFARRAY=n.INDEXOFARRAY,t.INDEXOFBYTES=n.INDEXOFBYTES,t.INDEXOFCP=n.INDEXOFCP,t.ISARRAY=n.ISARRAY,t.ISODAYOFWEEK=n.ISODAYOFWEEK,t.ISOWEEK=n.ISOWEEK,t.ISOWEEKYEAR=n.ISOWEEKYEAR,t.LAST=n.LAST,t.LET=n.LET,t.LITERAL=n.LITERAL,t.LN=n.LN,t.LOG=n.LOG,t.LOG10=n.LOG10,t.LT=n.LT,t.LTE=n.LTE,t.LTRIM=n.LTRIM,t.MAP=n.MAP,t.MAX=n.MAX,t.MERGEOBJECTS=n.MERGEOBJECTS,t.META=n.META,t.MIN=n.MIN,t.MILLISECOND=n.MILLISECOND,t.MINUTE=n.MINUTE,t.MOD=n.MOD,t.MONTH=n.MONTH,t.MULTIPLY=n.MULTIPLY,t.NEQ=n.NEQ,t.NOT=n.NOT,t.OBJECTTOARRAY=n.OBJECTTOARRAY,t.OR=n.OR,t.POW=n.POW,t.PUSH=n.PUSH,t.RANGE=n.RANGE,t.REDUCE=n.REDUCE,t.REVERSEARRAY=n.REVERSEARRAY,t.RTRIM=n.RTRIM,t.SECOND=n.SECOND,t.SETDIFFERENCE=n.SETDIFFERENCE,t.SETEQUALS=n.SETEQUALS,t.SETINTERSECTION=n.SETINTERSECTION,t.SETISSUBSET=n.SETISSUBSET,t.SETUNION=n.SETUNION,t.SIZE=n.SIZE,t.SLICE=n.SLICE,t.SPLIT=n.SPLIT,t.SQRT=n.SQRT,t.STDDEVPOP=n.STDDEVPOP,t.STDDEVSAMP=n.STDDEVSAMP,t.STRCASECMP=n.STRCASECMP,t.STRLENBYTES=n.STRLENBYTES,t.STRLENCP=n.STRLENCP,t.SUBSTR=n.SUBSTR,t.SUBSTRBYTES=n.SUBSTRBYTES,t.SUBSTRCP=n.SUBSTRCP,t.SUBTRACT=n.SUBTRACT,t.SUM=n.SUM,t.SWITCH=n.SWITCH,t.TOBOOL=n.TOBOOL,t.TODATE=n.TODATE,t.TODECIMAL=n.TODECIMAL,t.TODOUBLE=n.TODOUBLE,t.TOINT=n.TOINT,t.TOLONG=n.TOLONG,t.TOOBJECTID=n.TOOBJECTID,t.TOSTRING=n.TOSTRING,t.TOLOWER=n.TOLOWER,t.TOUPPER=n.TOUPPER,t.TRIM=n.TRIM,t.TRUNC=n.TRUNC,t.TYPE=n.TYPE,t.WEEK=n.WEEK,t.YEAR=n.YEAR,t.ZIP=n.ZIP;var o=function(){function e(e,t,r){this._internalType=i.SYMBOL_AGGREGATE_COMMAND,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=r||i.SYMBOL_UNSET_FIELD_NAME}return e.prototype._setFieldName=function(t){return new e(this.operator,this.operands,t)},e}();function s(e){return e&&e instanceof o&&e._internalType===i.SYMBOL_AGGREGATE_COMMAND}t.AggregateCommand=o,t.isAggregateCommand=s,t.isKnownAggregateCommand=function(e){return s(e)&&e.operator.toUpperCase()in n},t.default=o},"./src/services/database/api/database/commands/logic.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isKnownLogicCommand=t.isLogicCommand=t.LogicCommmand=t.logicCommandsSet=t.LOGIC_COMMANDS_LITERAL=void 0;var n,i=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),o=r("./src/services/database/api/database/helper/symbol.ts"),s=r("./src/utils/assert.ts"),a=r("./src/utils/type.ts");!function(e){e.AND="and",e.OR="or",e.NOT="not",e.NOR="nor"}(n=t.LOGIC_COMMANDS_LITERAL||(t.LOGIC_COMMANDS_LITERAL={}));var u=[n.AND,n.OR,n.NOT,n.NOR];t.logicCommandsSet=new Set(u);var c=function(){function e(e,t,r){this._internalType=o.SYMBOL_LOGIC_COMMAND,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=r||o.SYMBOL_UNSET_FIELD_NAME}return e.prototype._setFieldName=function(t){var r=this.operands.map(function(e){return e===n.AND||e===n.OR?e._setFieldName(t):e});return new e(this.operator,r,t)},e.prototype.and=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(0,s.assertRequiredParam)(arguments[0],"expressions","and");var o=(0,a.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new e(n.AND,i.__spreadArray([this],i.__read(o),!1),this.fieldName)},e.prototype.or=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(0,s.assertRequiredParam)(arguments[0],"expressions","or");var o=(0,a.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new e(n.OR,i.__spreadArray([this],i.__read(o),!1),this.fieldName)},e.prototype.nor=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(0,s.assertRequiredParam)(arguments[0],"expressions","nor");var o=(0,a.isArray)(arguments[0])?arguments[0]:Array.from(arguments);return new e(n.NOR,i.__spreadArray([this],i.__read(o),!1),this.fieldName)},e.prototype.not=function(t){return(0,s.assertRequiredParam)(t,"expression","not"),new e(n.NOT,[t],this.fieldName)},e.prototype.toJSON=function(){},e}();function l(e){return e&&e instanceof c&&e._internalType===o.SYMBOL_LOGIC_COMMAND}t.LogicCommmand=c,t.isLogicCommand=l,t.isKnownLogicCommand=function(e){return l(e)&&t.logicCommandsSet.has(e.operator)},t.default=c},"./src/services/database/api/database/commands/projection.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isProjectionCommand=t.ProjectionCommmand=t.projectionCommandsSet=t.PROJECTION_COMMANDS_LITERAL=t.SLICE=void 0;var n,i=r("./src/services/database/api/database/helper/symbol.ts");t.SLICE="slice",function(e){e.SLICE="slice"}(n=t.PROJECTION_COMMANDS_LITERAL||(t.PROJECTION_COMMANDS_LITERAL={})),t.projectionCommandsSet=new Set([n.SLICE]);var o=function(){function e(e,t,r){this._internalType=i.SYMBOL_PROJECT_COMMAND,this.operator=e,this.operands=t,this.fieldName=r||i.SYMBOL_UNSET_FIELD_NAME}return e.prototype._setFieldName=function(t){return new e(this.operator,this.operands,t)},e}();t.ProjectionCommmand=o,t.isProjectionCommand=function(e){return e&&e instanceof o&&e._internalType===i.SYMBOL_PROJECT_COMMAND},t.default=o},"./src/services/database/api/database/commands/query.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isComparisonCommand=t.isKnownQueryCommand=t.isQueryCommand=t.QueryCommmand=t.queryCommandsSet=t.QUERY_COMMANDS_LITERAL=void 0;var n,i=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),o=r("./src/services/database/api/database/commands/logic.ts"),s=r("./src/services/database/api/database/helper/symbol.ts"),a=r("./src/utils/assert.ts");!function(e){e.EQ="eq",e.NEQ="neq",e.GT="gt",e.GTE="gte",e.LT="lt",e.LTE="lte",e.IN="in",e.NIN="nin",e.GEO_NEAR="geoNear",e.GEO_WITHIN="geoWithin",e.GEO_INTERSECTS="geoIntersects",e.EXISTS="exists",e.MOD="mod",e.ALL="all",e.ELEM_MATCH="elemMatch",e.SIZE="size",e.EXPR="expr"}(n=t.QUERY_COMMANDS_LITERAL||(t.QUERY_COMMANDS_LITERAL={}));var u=[n.EQ,n.NEQ,n.GT,n.GTE,n.LT,n.LTE,n.IN,n.NIN,n.GEO_NEAR,n.GEO_WITHIN,n.GEO_INTERSECTS,n.EXISTS,n.MOD,n.ALL,n.ELEM_MATCH,n.SIZE];t.queryCommandsSet=new Set(u);new Set(i.__spreadArray(i.__spreadArray([],i.__read(t.queryCommandsSet),!1),i.__read(o.logicCommandsSet),!1));var c=function(e){function t(t,r,n){var i=e.call(this,t,r,n)||this;return i.operator=t,i._internalType=s.SYMBOL_QUERY_COMMAND,i}return i.__extends(t,e),t.prototype._setFieldName=function(e){return new t(this.operator,this.operands,e)},t.prototype.eq=function(e){var r=new t(n.EQ,[e],this.fieldName);return this.and(r)},t.prototype.neq=function(e){var r=new t(n.NEQ,[e],this.fieldName);return this.and(r)},t.prototype.gt=function(e){var r=new t(n.GT,[e],this.fieldName);return this.and(r)},t.prototype.gte=function(e){var r=new t(n.GTE,[e],this.fieldName);return this.and(r)},t.prototype.lt=function(e){var r=new t(n.LT,[e],this.fieldName);return this.and(r)},t.prototype.lte=function(e){var r=new t(n.LTE,[e],this.fieldName);return this.and(r)},t.prototype.in=function(e){(0,a.assertType)(e,"array");var r=new t(n.IN,e,this.fieldName);return this.and(r)},t.prototype.nin=function(e){(0,a.assertType)(e,"array");var r=new t(n.NIN,e,this.fieldName);return this.and(r)},t.prototype.geoNear=function(e){var r=new t(n.GEO_NEAR,[e],this.fieldName);return this.and(r)},t.prototype.geoWithin=function(e){var r=new t(n.GEO_WITHIN,[e],this.fieldName);return this.and(r)},t.prototype.geoIntersects=function(e){var r=new t(n.GEO_INTERSECTS,[e],this.fieldName);return this.and(r)},t.prototype.exists=function(e){var r=new t(n.EXISTS,[e],this.fieldName);return this.and(r)},t.prototype.mod=function(e,r){var i=new t(n.MOD,[e,r],this.fieldName);return this.and(i)},t.prototype.all=function(e){var r=new t(n.ALL,e,this.fieldName);return this.and(r)},t.prototype.elemMatch=function(e){var r=new t(n.ELEM_MATCH,[e],this.fieldName);return this.and(r)},t.prototype.size=function(e){var r=new t(n.SIZE,[e],this.fieldName);return this.and(r)},t}(o.LogicCommmand);function l(e){return e&&e instanceof c&&e._internalType===s.SYMBOL_QUERY_COMMAND}t.QueryCommmand=c,t.isQueryCommand=l,t.isKnownQueryCommand=function(e){return l(e)&&t.queryCommandsSet.has(e.operator)},t.isComparisonCommand=function(e){return l(e)},t.default=c},"./src/services/database/api/database/commands/update.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isKnownUpdateCommand=t.isUpdateCommand=t.UpdateCommand=t.updateCommandsSet=t.UPDATE_COMMANDS_LITERAL=void 0;var n,i=r("./src/services/database/api/database/helper/symbol.ts");!function(e){e.SET="set",e.REMOVE="remove",e.INC="inc",e.MUL="mul",e.MIN="min",e.MAX="max",e.RENAME="rename",e.BIT="bit",e.PUSH="push",e.POP="pop",e.SHIFT="shift",e.UNSHIFT="unshift",e.ADD_TO_SET="addToSet",e.PULL="pull",e.PULL_ALL="pullAll"}(n=t.UPDATE_COMMANDS_LITERAL||(t.UPDATE_COMMANDS_LITERAL={})),t.updateCommandsSet=new Set([n.SET,n.REMOVE,n.INC,n.MUL,n.MIN,n.MAX,n.RENAME,n.BIT,n.PUSH,n.POP,n.SHIFT,n.UNSHIFT,n.ADD_TO_SET,n.PULL,n.PULL_ALL]);var o=function(){function e(e,t,r){this._internalType=i.SYMBOL_UPDATE_COMMAND,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=r||i.SYMBOL_UNSET_FIELD_NAME}return e.prototype._setFieldName=function(t){return new e(this.operator,this.operands,t)},e.prototype.toJSON=function(){},e}();function s(e){return e&&e instanceof o&&e._internalType===i.SYMBOL_UPDATE_COMMAND}t.UpdateCommand=o,t.isUpdateCommand=s,t.isKnownUpdateCommand=function(e){return s(e)&&t.updateCommandsSet.has(e.operator)},t.default=o},"./src/services/database/api/database/date.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js").__exportStar(r("./src/services/database/api/database/date/serverDate.ts"),t)},"./src/services/database/api/database/date/serverDate.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.ServerDate=t.serverDate=void 0;var n=r("./src/services/database/api/database/helper/symbol.ts"),i=r("./src/utils/assert.ts");t.serverDate=function(e){return new o(e)};var o=function(){function e(e){void 0===e&&(e={offset:0}),(0,i.assertType)(e,"object","serverDate.options"),this.options=e}return Object.defineProperty(e.prototype,"_internalType",{get:function(){return n.SYMBOL_SERVER_DATE},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{$date:this.options}},e}();t.ServerDate=o},"./src/services/database/api/database/document.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getDocumentReferenceClass=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/hook/invoke.ts"),o=r("./src/services/database/internal/backend-api/backend-api.ts"),s=r("./src/utils/msg.ts"),a=r("./src/utils/error.ts"),u=r("./src/utils/assert.ts"),c=r("./src/utils/report.ts"),l=r("./src/config/error.config.ts"),d=r("./src/services/database/api/database/realtime/websocket-client.ts");t.getDocumentReferenceClass=function(e){return function(){function t(t,r){var i=this;if(this.watch=function(t){return(0,u.assertType)(t,{onChange:"function",onError:"function"}),e.serviceContext.ws||(e.serviceContext.ws=new d.RealtimeWebSocketClient({serviceContext:e.serviceContext})),e.serviceContext.ws.watch(n.__assign(n.__assign({},t),{envId:e.database.config.env||e.serviceContext.env,collectionName:i.collection.collectionName,query:JSON.stringify({_id:i._id}),queryType:o.QUERY_TYPE.DOC,reportAPIName:"cloud.db.document.watch"}))},this.collection=t,this._id=r,null===r||void 0===r)throw new a.CloudSDKError({errCode:l.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR,errMsg:"docId must not be null or undefined"});Object.defineProperties(this,{_field:{enumerable:!1,configurable:!1,writable:!0}}),this._field={}}return t.prototype.field=function(e){return(0,u.assertRequiredParam)(e,"object","field"),(0,u.assertType)(e,"object","field"),this._field=e,this},t.prototype.get=function(t){var r=this,u={apiStartTime:+new Date},l=(0,i.hasAPICallback)(t),d=new Promise(function(t,i){return n.__awaiter(r,void 0,void 0,function(){var l,d,f;return n.__generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,3,4]),l=this._id,[4,(0,o.queryDocument)({env:e.database.config.env,collectionName:r.collection.collectionName,query:e.engine.QuerySerializer.encode({_id:r._id}),options:{projection:e.engine.ProjectionSerializer.encode(r._field)},queryType:o.QUERY_TYPE.DOC,instanceContext:e,timing:u})];case 1:if(!(d=p.sent()).list||!d.list.length)throw new Error("cannot find document with _id ".concat(l,", ")+"please make sure that the document exists and you have the corresponding access permission");return t({data:d.list[0],errMsg:(0,s.apiSuccessMsg)("document.get")}),[3,4];case 2:return f=p.sent(),i((0,a.returnAsFinalCloudSDKError)(f,"document.get")),[3,4];case 3:return(0,c.reportAPISpeed)(n.__assign(n.__assign({},u),{apiEndTime:+new Date,apiName:"cloud.db.".concat("document.get")})),[7];case 4:return[2]}})})});if(!l)return d;d.then(function(e){(0,i.invokeSuccessCompleteCallbacks)("document.get",t,e)}).catch(function(e){(0,i.invokeFailCompleteCallbacks)("document.get",t,e)})},t.prototype.set=function(t){var r=this,l={apiStartTime:+new Date},d=(0,i.hasAPICallback)(t),f=new Promise(function(i,d){return n.__awaiter(r,void 0,void 0,function(){var f,p;return n.__generator(this,function(_){switch(_.label){case 0:return _.trys.push([0,2,3,4]),(0,u.assertType)(t,{data:"object"}),(0,u.assertObjectNotEmpty)({name:"options.data",target:t.data}),[4,(0,o.setDocument)({env:e.database.config.env,collectionName:r.collection.collectionName,_id:r._id,data:e.engine.encodeInternalDataType(t.data),options:{},instanceContext:e,timing:l})];case 1:return f=_.sent(),i({_id:f._id,errMsg:(0,s.apiSuccessMsg)("document.set"),stats:{updated:f.updated,created:f.created}}),[3,4];case 2:return p=_.sent(),d((0,a.returnAsFinalCloudSDKError)(p,"document.set")),[3,4];case 3:return(0,c.reportAPISpeed)(n.__assign(n.__assign({},l),{apiEndTime:+new Date,apiName:"cloud.db.".concat("document.set")})),[7];case 4:return[2]}})})});if(!d)return f;f.then(function(e){(0,i.invokeSuccessCompleteCallbacks)("document.set",t,e)}).catch(function(e){(0,i.invokeFailCompleteCallbacks)("document.set",t,e)})},t.prototype.update=function(t){var r=this,l={apiStartTime:+new Date},d=(0,i.hasAPICallback)(t),f=new Promise(function(i,d){return n.__awaiter(r,void 0,void 0,function(){var f,p;return n.__generator(this,function(_){switch(_.label){case 0:return _.trys.push([0,2,3,4]),(0,u.assertType)(t,{data:"object"}),(0,u.assertObjectNotEmpty)({name:"options.data",target:t.data}),[4,(0,o.updateDocument)({env:e.database.config.env,collectionName:r.collection.collectionName,query:e.engine.QuerySerializer.encode({_id:r._id}),data:e.engine.UpdateSerializer.encode(t.data),queryType:o.QUERY_TYPE.DOC,options:{multi:!1,merge:!1},instanceContext:e,timing:l})];case 1:return f=_.sent(),i({stats:{updated:f.updated},errMsg:(0,s.apiSuccessMsg)("document.update")}),[3,4];case 2:return p=_.sent(),d((0,a.returnAsFinalCloudSDKError)(p,"document.update")),[3,4];case 3:return(0,c.reportAPISpeed)(n.__assign(n.__assign({},l),{apiEndTime:+new Date,apiName:"cloud.db.".concat("document.update")})),[7];case 4:return[2]}})})});if(!d)return f;f.then(function(e){(0,i.invokeSuccessCompleteCallbacks)("document.update",t,e)}).catch(function(e){(0,i.invokeFailCompleteCallbacks)("document.update",t,e)})},t.prototype.remove=function(t){var r=this,u={apiStartTime:+new Date},l=(0,i.hasAPICallback)(t),d=new Promise(function(t,i){return n.__awaiter(r,void 0,void 0,function(){var l,d,f;return n.__generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,3,4]),l=this._id,[4,(0,o.removeDocument)({env:e.database.config.env,collectionName:r.collection.collectionName,query:e.engine.QuerySerializer.encode({_id:r._id}),queryType:o.QUERY_TYPE.DOC,options:{},instanceContext:e,timing:u})];case 1:if(0===(d=p.sent()).removed)throw new Error("cannot remove document with _id ".concat(l,", ")+"please make sure that the document exists and you have the corresponding Write permission");return t({stats:{removed:d.removed||0},errMsg:(0,s.apiSuccessMsg)("document.remove")}),[3,4];case 2:return f=p.sent(),i((0,a.returnAsFinalCloudSDKError)(f,"document.remove")),[3,4];case 3:return(0,c.reportAPISpeed)(n.__assign(n.__assign({},u),{apiEndTime:+new Date,apiName:"cloud.db.".concat("document.remove")})),[7];case 4:return[2]}})})});if(!l)return d;d.then(function(e){(0,i.invokeSuccessCompleteCallbacks)("document.remove",t,e)}).catch(function(e){(0,i.invokeFailCompleteCallbacks)("document.remove",t,e)})},t.prototype.toJSON=function(){},t}()}},"./src/services/database/api/database/geo.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.__safe_props__=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js");n.__exportStar(r("./src/services/database/api/database/geo/point.ts"),t),n.__exportStar(r("./src/services/database/api/database/geo/multipoint.ts"),t),n.__exportStar(r("./src/services/database/api/database/geo/linestring.ts"),t),n.__exportStar(r("./src/services/database/api/database/geo/multilinestring.ts"),t),n.__exportStar(r("./src/services/database/api/database/geo/polygon.ts"),t),n.__exportStar(r("./src/services/database/api/database/geo/multipolygon.ts"),t);t.__safe_props__=void 0},"./src/services/database/api/database/geo/linestring.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoLineString=t.LineString=void 0;var n=r("./src/services/database/api/database/helper/symbol.ts"),i=r("./src/services/database/api/database/helper/geojson.ts");t.LineString=function(e){return(0,i.isGeoJSONLineString)(e)?(0,i.toLineString)(e):new o(e)};var o=function(){function e(e){this._internalType=n.SYMBOL_GEO_LINESTRING,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.points=e}return e.prototype.toJSON=function(){return(0,i.toGeoJSONLineString)(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoLineString=o},"./src/services/database/api/database/geo/multilinestring.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoMultiLineString=t.MultiLineString=void 0;var n=r("./src/services/database/api/database/helper/symbol.ts"),i=r("./src/services/database/api/database/helper/geojson.ts");t.MultiLineString=function(e){return(0,i.isGeoJSONMultiLineString)(e)?(0,i.toMultiLineString)(e):new o(e)};var o=function(){function e(e){this._internalType=n.SYMBOL_GEO_MULTILINESTRING,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.lines=e}return e.prototype.toJSON=function(){return(0,i.toGeoJSONMultiLineString)(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoMultiLineString=o},"./src/services/database/api/database/geo/multipoint.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoMultiPoint=t.MultiPoint=void 0;var n=r("./src/services/database/api/database/helper/symbol.ts"),i=r("./src/services/database/api/database/helper/geojson.ts");t.MultiPoint=function(e){return(0,i.isGeoJSONMultiPoint)(e)?(0,i.toMultiPoint)(e):new o(e)};var o=function(){function e(e){this._internalType=n.SYMBOL_GEO_MULTIPOINT,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.points=e}return e.prototype.toJSON=function(){return(0,i.toGeoJSONMultiPoint)(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoMultiPoint=o},"./src/services/database/api/database/geo/multipolygon.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoMultiPolygon=t.MultiPolygon=void 0;var n=r("./src/services/database/api/database/helper/symbol.ts"),i=r("./src/services/database/api/database/helper/geojson.ts");t.MultiPolygon=function(e){return(0,i.isGeoJSONMultiPolygon)(e)?(0,i.toMultiPolygon)(e):new o(e)};var o=function(){function e(e){this._internalType=n.SYMBOL_GEO_MULTIPOLYGON,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.polygons=e}return e.prototype.toJSON=function(){return(0,i.toGeoJSONMultiPolygon)(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoMultiPolygon=o},"./src/services/database/api/database/geo/point.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoPoint=t.Point=void 0;var n=r("./src/services/database/api/database/helper/symbol.ts"),i=r("./src/utils/assert.ts"),o=r("./src/utils/error.ts"),s=r("./src/services/database/api/database/helper/geojson.ts");t.Point=function(e,t){return(0,s.isGeoJSONPoint)(e)?(0,s.toPoint)(e):new a(e,t)};var a=function(){function e(e,t){this._internalType=n.SYMBOL_GEO_POINT,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}});var r=e,s=t;Object.defineProperties(this,{longitude:{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){if((0,i.assertType)(e,"number","longitude"),e>180||e<-180)throw new o.CloudSDKError({errMsg:"longitude should be a number ranges from -180 to 180"})}},latitude:{enumerable:!0,configurable:!1,get:function(){return s},set:function(e){if((0,i.assertType)(e,"number","latitude"),e>90||e<-90)throw new o.CloudSDKError({errMsg:"latitude should be a number ranges from -90 to 90"})}}}),this.longitude=r,this.latitude=s}return e.prototype.toJSON=function(){return(0,s.toGeoJSONPoint)(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoPoint=a},"./src/services/database/api/database/geo/polygon.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoPolygon=t.Polygon=void 0;var n=r("./src/services/database/api/database/helper/symbol.ts"),i=r("./src/services/database/api/database/helper/geojson.ts");t.Polygon=function(e){return(0,i.isGeoJSONPolygon)(e)?(0,i.toPolygon)(e):new o(e)};var o=function(){function e(e){this._internalType=n.SYMBOL_GEO_POLYGON,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.lines=e}return e.prototype.toJSON=function(){return(0,i.toGeoJSONPolygon)(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoPolygon=o},"./src/services/database/api/database/helper/geojson.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isMultiPolygonCoordinates=t.isPolygonCoordinates=t.isMultiLineStringCoordinates=t.isLineStringCoordinates=t.isMultiPointCoordinates=t.isPointCoordinates=t.isGeoJSONMultiPolygon=t.isGeoJSONPolygon=t.isGeoJSONMultiLineString=t.isGeoJSONLineString=t.isGeoJSONMultiPoint=t.isGeoJSONPoint=t.toGeoJSONMultiPolygon=t.toGeoJSONPolygon=t.toGeoJSONMultiLineString=t.toGeoJSONLineString=t.toGeoJSONMultiPoint=t.toGeoJSONPoint=t.toMultiPolygon=t.toPolygon=t.toMultiLineString=t.toLineString=t.toMultiPoint=t.toPoint=t.fromGeoJSON=void 0;var n=r("./src/services/database/api/database/geo.ts"),i=r("./src/utils/type.ts"),o=r("./src/utils/error.ts");function s(e){return(0,n.Point)(e.coordinates[0],e.coordinates[1])}function a(e){return(0,n.MultiPoint)(e.coordinates.map(function(e){return(0,n.Point)(e[0],e[1])}))}function u(e){return(0,n.LineString)(e.coordinates.map(function(e){return(0,n.Point)(e[0],e[1])}))}function c(e){return(0,n.MultiLineString)(e.coordinates.map(function(e){return(0,n.LineString)(e.map(function(e){return(0,n.Point)(e[0],e[1])}))}))}function l(e){return(0,n.Polygon)(e.coordinates.map(function(e){return(0,n.LineString)(e.map(function(e){return(0,n.Point)(e[0],e[1])}))}))}function d(e){return(0,n.MultiPolygon)(e.coordinates.map(function(e){return(0,n.Polygon)(e.map(function(e){return(0,n.LineString)(e.map(function(e){return(0,n.Point)(e[0],e[1])}))}))}))}function f(e){return(0,i.isArray)(e)&&(0,i.isNumber)(e[0])&&(0,i.isNumber)(e[1])}function p(e){return(0,i.isArray)(e)&&e.every(f)}function _(e){return p(e)}function h(e){return(0,i.isArray)(e)&&e.every(_)}function E(e){return h(e)}function m(e){return(0,i.isArray)(e)&&e.every(E)}t.fromGeoJSON=function(e){switch(e.type){case"Point":return s(e);case"MultiPoint":return a(e);case"LineString":return u(e);case"MultiLineString":return c(e);case"Polygon":return l(e);case"MultiPolygon":return d(e);default:throw new o.CloudSDKError({errCode:-1,errMsg:"Invalid GeoJSON input"})}},t.toPoint=s,t.toMultiPoint=a,t.toLineString=u,t.toMultiLineString=c,t.toPolygon=l,t.toMultiPolygon=d,t.toGeoJSONPoint=function(e){return{type:"Point",coordinates:[e.longitude,e.latitude]}},t.toGeoJSONMultiPoint=function(e){return{type:"MultiPoint",coordinates:e.points.map(function(e){return[e.longitude,e.latitude]})}},t.toGeoJSONLineString=function(e){return{type:"LineString",coordinates:e.points.map(function(e){return[e.longitude,e.latitude]})}},t.toGeoJSONMultiLineString=function(e){return{type:"MultiLineString",coordinates:e.lines.map(function(e){return e.points.map(function(e){return[e.longitude,e.latitude]})})}},t.toGeoJSONPolygon=function(e){return{type:"Polygon",coordinates:e.lines.map(function(e){return e.points.map(function(e){return[e.longitude,e.latitude]})})}},t.toGeoJSONMultiPolygon=function(e){return{type:"MultiPolygon",coordinates:e.polygons.map(function(e){return e.lines.map(function(e){return e.points.map(function(e){return[e.longitude,e.latitude]})})})}},t.isGeoJSONPoint=function(e){return(0,i.isObject)(e)&&f(e.coordinates)},t.isGeoJSONMultiPoint=function(e){return(0,i.isObject)(e)&&p(e.coordinates)},t.isGeoJSONLineString=function(e){return(0,i.isObject)(e)&&_(e.coordinates)},t.isGeoJSONMultiLineString=function(e){return(0,i.isObject)(e)&&h(e.coordinates)},t.isGeoJSONPolygon=function(e){return(0,i.isObject)(e)&&E(e.coordinates)},t.isGeoJSONMultiPolygon=function(e){return(0,i.isObject)(e)&&m(e.coordinates)},t.isPointCoordinates=f,t.isMultiPointCoordinates=p,t.isLineStringCoordinates=_,t.isMultiLineStringCoordinates=h,t.isPolygonCoordinates=E,t.isMultiPolygonCoordinates=m},"./src/services/database/api/database/helper/symbol.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SYMBOL_REGEXP=t.SYMBOL_SERVER_DATE=t.SYMBOL_GEO_MULTIPOLYGON=t.SYMBOL_GEO_MULTILINESTRING=t.SYMBOL_GEO_MULTIPOINT=t.SYMBOL_GEO_POLYGON=t.SYMBOL_GEO_LINESTRING=t.SYMBOL_GEO_POINT=t.SYMBOL_PROJECT_COMMAND=t.SYMBOL_AGGREGATE_COMMAND=t.SYMBOL_LOGIC_COMMAND=t.SYMBOL_QUERY_COMMAND=t.SYMBOL_UPDATE_COMMAND=t.SYMBOL_AGGREGATE_PIPELINE_STAGE=t.SYMBOL_AGGREGATE_PIPELINE=t.SYMBOL_AGGREGATE=t.SYMBOL_UNSET_FIELD_NAME=void 0,t.SYMBOL_UNSET_FIELD_NAME=Symbol.for("UNSET_FIELD_NAME"),t.SYMBOL_AGGREGATE=Symbol.for("AGGREGATE"),t.SYMBOL_AGGREGATE_PIPELINE=Symbol.for("AGGREGATE_PIPELINE"),t.SYMBOL_AGGREGATE_PIPELINE_STAGE=Symbol.for("AGGREGATE_PIPELINE_STAGE"),t.SYMBOL_UPDATE_COMMAND=Symbol.for("UPDATE_COMMAND"),t.SYMBOL_QUERY_COMMAND=Symbol.for("QUERY_COMMAND"),t.SYMBOL_LOGIC_COMMAND=Symbol.for("LOGIC_COMMAND"),t.SYMBOL_AGGREGATE_COMMAND=Symbol.for("AGGREGATE_COMMAND"),t.SYMBOL_PROJECT_COMMAND=Symbol.for("PROJECT_COMMAND"),t.SYMBOL_GEO_POINT=Symbol.for("GEO_POINT"),t.SYMBOL_GEO_LINESTRING=Symbol.for("GEO_LINESTRING"),t.SYMBOL_GEO_POLYGON=Symbol.for("GEO_POLYGON"),t.SYMBOL_GEO_MULTIPOINT=Symbol.for("GEO_MULTIPOINT"),t.SYMBOL_GEO_MULTILINESTRING=Symbol.for("GEO_MULTILINESTRING"),t.SYMBOL_GEO_MULTIPOLYGON=Symbol.for("GEO_MULTIPOLYGON"),t.SYMBOL_SERVER_DATE=Symbol.for("SERVER_DATE"),t.SYMBOL_REGEXP=Symbol.for("REGEXP")},"./src/services/database/api/database/query.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getQueryClass=t.ORDER_DIRECTION=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/msg.ts"),o=r("./src/services/database/internal/grammar/default/extractor.ts"),s=r("./src/utils/assert.ts"),a=r("./src/services/database/internal/backend-api/backend-api.ts"),u=r("./src/hook/invoke.ts"),c=r("./src/utils/error.ts"),l=r("./src/utils/report.ts"),d=r("./src/services/database/api/database/command.ts"),f=r("./src/externals/globals/wxconfig.ts"),p=r("./src/services/database/api/database/realtime/websocket-client.ts"),_=r("./src/config/error.config.ts");!function(e){e.ASC="asc",e.DESC="desc"}(t.ORDER_DIRECTION||(t.ORDER_DIRECTION={}));t.getQueryClass=function(e){var t=function(){function t(t,i){var o=this;if(this.watch=function(t){return(0,s.assertType)(t,{onChange:"function",onError:"function"}),e.serviceContext.ws||(e.serviceContext.ws=new p.RealtimeWebSocketClient({serviceContext:e.serviceContext})),e.serviceContext.ws.watch(n.__assign(n.__assign({},t),{envId:e.database.config.env||e.serviceContext.env,collectionName:o.collectionName,query:JSON.stringify(e.engine.QuerySerializer.encode(o._query.where||{})),limit:o._query.limit,orderBy:o._query.order?o._query.order.reduce(function(e,t){return e[t.fieldPath]=t.order,e},{}):void 0,queryType:a.QUERY_TYPE.WHERE,reportAPIName:"cloud.db.collection.watch"}))},!t)throw new c.CloudSDKError({errCode:_.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR,errMsg:"collectionName must be provided"});this.collectionName=t,this._query=new r(i),Object.defineProperties(this,{_field:{enumerable:!1,configurable:!1,writable:!0}}),this._field=i&&i.field||{}}return t.prototype.field=function(e){return(0,s.assertRequiredParam)(e,"object","field"),new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{field:e}))},t.prototype.where=function(e){return(0,s.assertRequiredParam)(e,"condition","where"),this._query.where?new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{where:d.commands.and(this._query.where,e)})):new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{where:e}))},t.prototype.orderBy=function(e,r){return(0,s.assertRequiredParam)(e,"fieldPath","orderBy"),(0,s.assertRequiredParam)(r,"order","orderBy"),new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{order:n.__spreadArray(n.__spreadArray([],n.__read(this._query.order||[]),!1),[{fieldPath:e,order:r}],!1)}))},t.prototype.limit=function(e){return(0,s.assertRequiredParam)(e,"max","limit"),new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{limit:e}))},t.prototype.skip=function(e){return(0,s.assertRequiredParam)(e,"offset","skip"),new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{offset:e}))},t.prototype.get=function(t){var r=this,s="collection.get",d={apiStartTime:+new Date},p=(0,u.hasAPICallback)(t),_=new Promise(function(u,p){return n.__awaiter(r,void 0,void 0,function(){var _,h;return n.__generator(this,function(E){switch(E.label){case 0:return E.trys.push([0,2,3,4]),[4,(0,a.queryDocument)({env:e.database.config.env,collectionName:r.collectionName,query:e.engine.QuerySerializer.encode(r._query.where||{}),queryType:a.QUERY_TYPE.WHERE,options:(0,o.extractQueryOptions)(r,e),instanceContext:e,timing:d,explain:null===t||void 0===t?void 0:t.explain})];case 1:return _=E.sent(),(null===t||void 0===t?void 0:t.explain)&&(0,f.isDevTools)()?(u(_),[2]):(u({data:_.list,errMsg:(0,i.apiSuccessMsg)(s)}),[3,4]);case 2:return h=E.sent(),p((0,c.returnAsFinalCloudSDKError)(h,s)),[3,4];case 3:return(0,l.reportAPISpeed)(n.__assign(n.__assign({},d),{apiEndTime:+new Date,apiName:"cloud.db.".concat(s)})),[7];case 4:return[2]}})})});if(!p)return _;_.then(function(e){(0,u.invokeSuccessCompleteCallbacks)(s,t,e)}).catch(function(e){(0,u.invokeFailCompleteCallbacks)(s,t,e)})},t.prototype.update=function(t){var r=this,o="collection.update",d={apiStartTime:+new Date},p=(0,u.hasAPICallback)(t),_=new Promise(function(u,p){return n.__awaiter(r,void 0,void 0,function(){var _,h;return n.__generator(this,function(E){switch(E.label){case 0:return E.trys.push([0,2,3,4]),function(){if((0,s.assertRequiredParam)(t,"options","update"),(0,s.assertType)(t,{data:"object"}),!r._query.where)throw new c.CloudSDKError({errCode:-1,errMsg:"query condition must be provided"})}(),[4,(0,a.updateDocument)({env:e.database.config.env,collectionName:r.collectionName,query:e.engine.QuerySerializer.encode(r._query.where||{}),data:e.engine.UpdateSerializer.encode(t.data),queryType:a.QUERY_TYPE.WHERE,options:{multi:!1!==t.multi,merge:!0},instanceContext:e,timing:d,explain:t.explain})];case 1:return _=E.sent(),(null===t||void 0===t?void 0:t.explain)&&(0,f.isDevTools)()?[2,u(_)]:(u({stats:{updated:_.updated},errMsg:(0,i.apiSuccessMsg)(o)}),[3,4]);case 2:return h=E.sent(),p((0,c.returnAsFinalCloudSDKError)(h,o)),[3,4];case 3:return(0,l.reportAPISpeed)(n.__assign(n.__assign({},d),{apiEndTime:+new Date,apiName:"cloud.db.".concat(o)})),[7];case 4:return[2]}})})});if(!p)return _;_.then(function(e){(0,u.invokeSuccessCompleteCallbacks)(o,t,e)}).catch(function(e){(0,u.invokeFailCompleteCallbacks)(o,t,e)})},t.prototype.remove=function(t){var r=this,o="collection.remove",s={apiStartTime:+new Date},d=(0,u.hasAPICallback)(t),p=new Promise(function(u,d){return n.__awaiter(r,void 0,void 0,function(){var p,_;return n.__generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,3,4]),function(){if(!r._query.where||0===Object.keys(r._query.where).length)throw new c.CloudSDKError({errCode:-1,errMsg:"query condition must be provided and not be empty"})}(),[4,(0,a.removeDocument)({env:e.database.config.env,collectionName:r.collectionName,query:e.engine.QuerySerializer.encode(r._query.where||{}),queryType:a.QUERY_TYPE.WHERE,options:{multi:!0},instanceContext:e,timing:s,explain:null===t||void 0===t?void 0:t.explain})];case 1:return p=h.sent(),(null===t||void 0===t?void 0:t.explain)&&(0,f.isDevTools)()?[2,u(p)]:(u({stats:{removed:p.removed||0},errMsg:(0,i.apiSuccessMsg)(o)}),[3,4]);case 2:return _=h.sent(),d((0,c.returnAsFinalCloudSDKError)(_,o)),[3,4];case 3:return(0,l.reportAPISpeed)(n.__assign(n.__assign({},s),{apiEndTime:+new Date,apiName:"cloud.db.".concat(o)})),[7];case 4:return[2]}})})});if(!d)return p;p.then(function(e){(0,u.invokeSuccessCompleteCallbacks)(o,t,e)}).catch(function(e){(0,u.invokeFailCompleteCallbacks)(o,t,e)})},t.prototype.count=function(t){var r=this,o="collection.count",s={apiStartTime:+new Date},d=(0,u.hasAPICallback)(t),p=new Promise(function(u,d){return n.__awaiter(r,void 0,void 0,function(){var p,_;return n.__generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,3,4]),[4,(0,a.countDocument)({env:e.database.config.env,collectionName:r.collectionName,query:e.engine.QuerySerializer.encode(r._query.where||{}),queryType:a.QUERY_TYPE.WHERE,instanceContext:e,timing:s,explain:null===t||void 0===t?void 0:t.explain})];case 1:return p=h.sent(),(null===t||void 0===t?void 0:t.explain)&&(0,f.isDevTools)()?[2,u(p)]:(u({total:p.total,errMsg:(0,i.apiSuccessMsg)(o)}),[3,4]);case 2:return _=h.sent(),d((0,c.returnAsFinalCloudSDKError)(_,o)),[3,4];case 3:return(0,l.reportAPISpeed)(n.__assign(n.__assign({},s),{apiEndTime:+new Date,apiName:"cloud.db.".concat(o)})),[7];case 4:return[2]}})})});if(!d)return p;p.then(function(e){(0,u.invokeSuccessCompleteCallbacks)(o,t,e)}).catch(function(e){(0,u.invokeFailCompleteCallbacks)(o,t,e)})},t.prototype.toJSON=function(){},t}(),r=function(){function e(e){this.where=e&&e.where,this.offset=e&&e.offset,this.limit=e&&e.limit,this.order=e&&e.order,this.field=e&&e.field}return e.prototype.getProperties=function(){return{where:this.where,offset:this.offset,limit:this.limit,order:this.order,field:this.field}},e}();return t}},"./src/services/database/api/database/realtime/error.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isRealtimeErrorMessageError=t.RealtimeErrorMessageError=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=function(e){function t(t){var r=e.call(this,"Watch Error ".concat(JSON.stringify(t.msgData)," (requestid: ").concat(t.requestId,")"))||this;return r.isRealtimeErrorMessageError=!0,r.payload=t,r}return n.__extends(t,e),t}(Error);t.RealtimeErrorMessageError=i;t.isRealtimeErrorMessageError=function(e){return e&&e.isRealtimeErrorMessageError}},"./src/services/database/api/database/realtime/fsm/vws.ts":function(e,t){var r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.VWSStates=t.VWSEvent=t.VWSState=void 0,function(e){e.UNINIT="UNINIT",e.CLOSED="CLOSED",e.INIT_LOGGING_IN="INIT_LOGGING_IN",e.INIT_LOGGED_IN="INIT_LOGGED_IN",e.INIT_LOGIN_FAIL="INIT_LOGIN_FAIL",e.INIT_WATCH_PENDING="INIT_WATCH_PENDING",e.INIT_WATCH_FAIL="INIT_WATCH_FAIL",e.INIT_WATCH_SUCCESS="INIT_WATCH_SUCCESS",e.PAUSED="PAUSED",e.ABNORMAL_WATCH_STATUS="ABNORMAL_WATCH_STATUS",e.REBUILD_LOGGING_IN="REBUILD_LOGGING_IN",e.REBUILD_LOGGED_IN="REBUILD_LOGGED_IN",e.REBUILD_LOGIN_FAIL="REBUILD_LOGIN_FAIL",e.REBUILD_WATCH_PENDING="REBUILD_WATCH_PENDING",e.REBUILD_WATCH_FAIL="REBUILD_WATCH_FAIL",e.REBUILD_WATCH_SUCCESS="REBUILD_WATCH_SUCCESS"}(n=t.VWSState||(t.VWSState={})),function(e){e.CLOSE="close",e.LOGIN_START="loginStart",e.LOGIN_FAIL="loginFail",e.LOGIN_SUCCESS="loginSuccess",e.INIT_WATCH_START="initWatchStart",e.INIT_WATCH_FAIL="initWatchFail",e.INIT_WATCH_SUCCESS="initWatchSuccess",e.WS_DISCONNECTED="wsDisconnected",e.WS_CONNECTED="wsConnected",e.REBUILD_WATCH_START="rebuildWatchStart",e.REBUILD_WATCH_FAIL="rebuildWatchFail",e.REBUILD_WATCH_SUCCESS="rebuildWatchSuccess",e.NEED_REBUILD_WATCH="needRebuildWatch"}(i=t.VWSEvent||(t.VWSEvent={}));var o={accept:i.CLOSE,to:n.CLOSED},s={accept:i.WS_DISCONNECTED,to:n.CLOSED},a={accept:i.WS_DISCONNECTED,to:n.PAUSED};t.VWSStates=((r={})[n.UNINIT]={transitions:[{accept:i.LOGIN_START,to:n.INIT_LOGGING_IN},s,o]},r[n.CLOSED]={transitions:[o]},r[n.INIT_LOGGING_IN]={transitions:[{accept:i.LOGIN_FAIL,to:n.INIT_LOGIN_FAIL},{accept:i.LOGIN_SUCCESS,to:n.INIT_LOGGED_IN},s,o]},r[n.INIT_LOGIN_FAIL]={transitions:[{accept:i.LOGIN_START,to:n.INIT_LOGGING_IN},s,o]},r[n.INIT_LOGGED_IN]={transitions:[{accept:i.INIT_WATCH_START,to:n.INIT_WATCH_PENDING},s,o]},r[n.INIT_WATCH_PENDING]={transitions:[{accept:i.INIT_WATCH_FAIL,to:n.INIT_WATCH_FAIL},{accept:i.INIT_WATCH_SUCCESS,to:n.INIT_WATCH_SUCCESS},s,o]},r[n.INIT_WATCH_FAIL]={transitions:[{accept:i.LOGIN_START,to:n.INIT_LOGGING_IN},s,o]},r[n.INIT_WATCH_SUCCESS]={transitions:[{accept:i.WS_DISCONNECTED,to:n.PAUSED},{accept:i.NEED_REBUILD_WATCH,to:n.ABNORMAL_WATCH_STATUS},a,o]},r[n.PAUSED]={transitions:[{accept:i.LOGIN_START,to:n.REBUILD_LOGGING_IN},a,o]},r[n.ABNORMAL_WATCH_STATUS]={transitions:[{accept:i.LOGIN_START,to:n.REBUILD_LOGGING_IN},a,o]},r[n.REBUILD_LOGGING_IN]={transitions:[{accept:i.LOGIN_FAIL,to:n.REBUILD_LOGIN_FAIL},{accept:i.LOGIN_SUCCESS,to:n.REBUILD_LOGGED_IN},a,o]},r[n.REBUILD_LOGIN_FAIL]={transitions:[{accept:i.LOGIN_START,to:n.REBUILD_LOGGING_IN},a,o]},r[n.REBUILD_LOGGED_IN]={transitions:[{accept:i.REBUILD_WATCH_START,to:n.REBUILD_WATCH_PENDING},a,o]},r[n.REBUILD_WATCH_PENDING]={transitions:[{accept:i.REBUILD_WATCH_FAIL,to:n.REBUILD_WATCH_FAIL},{accept:i.REBUILD_WATCH_SUCCESS,to:n.REBUILD_WATCH_SUCCESS},a,o]},r[n.REBUILD_WATCH_FAIL]={transitions:[{accept:i.LOGIN_START,to:n.REBUILD_LOGGING_IN},a,o]},r[n.REBUILD_WATCH_SUCCESS]={transitions:[{accept:i.NEED_REBUILD_WATCH,to:n.ABNORMAL_WATCH_STATUS},a,o]},r)},"./src/services/database/api/database/realtime/fsm/ws.ts":function(e,t){var r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.WSStates=t.WSEvent=t.WSState=void 0,function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED"}(n=t.WSState||(t.WSState={})),function(e){e.CONNECTION_START="connectionStart",e.CONNECTION_SUCCESS="connectionSuccess",e.CONNECTION_FAIL="connectionFail",e.DISCONNECT="disconnect"}(i=t.WSEvent||(t.WSEvent={})),t.WSStates=((r={})[n.DISCONNECTED]={transitions:[{accept:i.CONNECTION_START,to:n.CONNECTING}]},r[n.CONNECTING]={transitions:[{accept:i.CONNECTION_SUCCESS,to:n.CONNECTED},{accept:i.CONNECTION_FAIL,to:n.DISCONNECTED},{accept:i.DISCONNECT,to:n.DISCONNECTED}]},r[n.CONNECTED]={transitions:[{accept:i.DISCONNECT,to:n.DISCONNECTED},{accept:i.CONNECTION_FAIL,to:n.DISCONNECTED}]},r)},"./src/services/database/api/database/realtime/listener.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RealtimeListener=void 0;var r=function(){return function(e){this.close=e.close,this.onChange=e.onChange,this.onError=e.onError,e.debug&&Object.defineProperty(this,"virtualClient",{get:function(){return e.virtualClient}})}}();t.RealtimeListener=r},"./src/services/database/api/database/realtime/message.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isInitEventMessage=t.genRequestId=void 0,t.genRequestId=function(e){return void 0===e&&(e=""),"".concat(e?"".concat(e,"_"):"").concat(+new Date,"_").concat(Math.random())},t.isInitEventMessage=function(e){return"INIT_EVENT"===e.msgType}},"./src/services/database/api/database/realtime/snapshot.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Snapshot=void 0;var r=function(){return function(e){var t=e.id,r=e.docChanges,n=e.docs,i=e.type,o=(e.EJSON,e.requestId),s=e.watchId;Object.defineProperties(this,{id:{value:t,writable:!1,enumerable:!0},docChanges:{value:r,writable:!1,enumerable:!0},docs:{value:n,writable:!1,enumerable:!0},type:{value:i,writable:!1,enumerable:!0}}),this.requestId=o,this.watchId=s}}();t.Snapshot=r},"./src/services/database/api/database/realtime/virtual-websocket-client.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.VirtualWebSocketClient=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/set.ts"),o=r("./src/services/database/api/database/realtime/fsm/vws.ts"),s=r("./src/services/database/api/database/realtime/fsm/ws.ts"),a=r("./src/utils/fsm.ts"),u=r("./src/services/database/api/database/realtime/message.ts"),c=r("./src/utils/error.ts"),l=r("./src/config/error.config.ts"),d=r("./src/externals/public-lib/reporter.ts"),f=r("./src/utils/report.ts"),p=r("./src/config/report.config.ts"),_=r("./src/services/database/api/database/realtime/listener.ts"),h=r("./src/services/database/api/database/realtime/snapshot.ts"),E=r("./src/services/database/api/database/realtime/error.ts"),m=2,g=2,v=1e4,S=1e4,y=1e4,T=new Set([o.VWSState.REBUILD_LOGGING_IN,o.VWSState.INIT_LOGGING_IN]),A=function(e){0},b=function(){function e(e){var t=this;this.closeWatchInvoked=!1,this.userOnErrorInvoked=!1,this._loginInvalidated=!1,this._errors=[],this._snapshotHistory=[],this._login=function(e){return n.__awaiter(t,void 0,void 0,function(){var t,r;return n.__generator(this,function(n){switch(n.label){case 0:this._fsm.transition(o.VWSEvent.LOGIN_START),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.login(this.envId,e||this._loginInvalidated,this.timing)];case 2:return t=n.sent(),this.envId||(this.envId=t.envId),this._fsm.transition(o.VWSEvent.LOGIN_SUCCESS,T),this._loginInvalidated=!1,[3,4];case 3:r=n.sent(),this._errors.push(r),this._loginInvalidated=!0;try{this._fsm.transition(o.VWSEvent.LOGIN_FAIL,T)}catch(e){console.warn("[realtime]",e)}return[3,4];case 4:return[2]}})})},this.initWatch=function(){return n.__awaiter(t,void 0,void 0,function(){var e,t,r,i,s,a,c,l,_,E,g,v,y,T,A=this;return n.__generator(this,function(b){switch(b.label){case 0:e=Date.now(),t=(0,u.genRequestId)(),b.label=1;case 1:return b.trys.push([1,3,,4]),this._fsm.transition(o.VWSEvent.INIT_WATCH_START,o.VWSState.INIT_LOGGED_IN),r=this.envId,i={watchId:this.watchId,requestId:t,msgType:"INIT_WATCH",msgData:{envId:r,collName:this.collectionName,query:this.query,limit:this.limit,orderBy:this.orderBy,queryType:this.queryType}},[4,this.send({msg:i,waitResponse:!0,skipOnMessage:!0,timeout:S})];case 2:if(s=b.sent(),this.assertAsyncTaskStatus(),a=s.msgData,c=a.events,l=a.currEvent,this.sessionInfo={queryID:s.msgData.queryID,currentEventId:l-1,currentDocs:[],currentEventTS:Date.now()},c.length>0){try{for(_=n.__values(c),E=_.next();!E.done;E=_.next())E.value.ID=l}catch(e){y={error:e}}finally{try{E&&!E.done&&(T=_.return)&&T.call(_)}finally{if(y)throw y.error}}this.handleServerEvents(s)}else this.sessionInfo.currentEventId=l,g=new h.Snapshot({id:l,docChanges:[],docs:[],type:"init",EJSON:this.getEJSON(),requestId:s.requestId,watchId:this.watchId}),d.default.surroundThirdByTryCatch(function(){return A.listener.onChange(g)})(),this.scheduleSendACK(),this.debug&&this._snapshotHistory.push(g);return this.onWatchStart(this,this.sessionInfo.queryID),this._availableRetries.INIT_WATCH=m,this._wsDisconnectionTS=void 0,(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_INIT_WATCH_SUCCESS,!0),(0,f.reportAPISpeed)({apiName:"_realtime.initWatch(success)",apiStartTime:e,apiEndTime:Date.now()}),this._fsm.transition(o.VWSEvent.INIT_WATCH_SUCCESS),[3,4];case 3:return v=b.sent(),(0,f.reportAPISpeed)({apiName:"_realtime.initWatch(fail)",apiStartTime:e,apiEndTime:Date.now()}),this.handleWatchEstablishmentError(v,{operationName:"INIT_WATCH",requestId:t}),[3,4];case 4:return[2]}})})},this.rebuildWatch=function(){return n.__awaiter(t,void 0,void 0,function(){var e,t,r,i,s,a;return n.__generator(this,function(n){switch(n.label){case 0:e=Date.now(),t=(0,u.genRequestId)(),n.label=1;case 1:if(n.trys.push([1,4,,5]),this._fsm.transition(o.VWSEvent.REBUILD_WATCH_START,o.VWSState.REBUILD_LOGGED_IN),r=this.envId,!this.sessionInfo)throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");if(this._wsDisconnectionTS&&Date.now()-this._wsDisconnectionTS>.9*this.getServiceContext().appConfig.realtimeQueryEventCacheTimeout)throw new c.TimeoutError("query event cache timeout, ws has been disconnected for too long, PLEASE RECONNECT manually",{subtype:"queryEventCacheClientTimeout",retryable:!1});return i={watchId:this.watchId,requestId:t,msgType:"REBUILD_WATCH",msgData:{envId:r,collName:this.collectionName,queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:i,waitResponse:!0,skipOnMessage:!0,timeout:y})];case 2:return s=n.sent(),this.assertAsyncTaskStatus(),[4,this.handleServerEvents(s)];case 3:return n.sent(),this._availableRetries.REBUILD_WATCH=m,this._wsDisconnectionTS=void 0,(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_REBUILD_WATCH_SUCCESS,!0),(0,f.reportAPISpeed)({apiName:"_realtime.rebuildWatch(success)",apiStartTime:e,apiEndTime:Date.now()}),this._fsm.transition(o.VWSEvent.REBUILD_WATCH_SUCCESS),[3,5];case 4:return a=n.sent(),(0,f.reportAPISpeed)({apiName:"_realtime.rebuildWatch(fail)",apiStartTime:e,apiEndTime:Date.now()}),this.handleWatchEstablishmentError(a,{operationName:"REBUILD_WATCH",requestId:t}),[3,5];case 5:return[2]}})})},this.handleWatchEstablishmentError=function(e,r){return n.__awaiter(t,void 0,void 0,function(){var t,i,s=this;return n.__generator(this,function(n){return t="INIT_WATCH"===r.operationName,i=function(n){var i="".concat(n||e," (").concat(t?"initWatch":"rebuildWatch"," requestId ").concat(r.requestId,")");if(s.closeWithError(new c.CloudSDKError({errCode:t?l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:i})),(0,f.reportIDKey)(p.ErrorID,t?p.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL:p.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL,!0),!(0,E.isRealtimeErrorMessageError)(e)){if((0,c.isTimeoutError)(e)){switch(e.payload.subtype){case"totalConnectionTimeout":(0,f.reportIDKey)(p.ErrorID,t?p.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL_TIMEOUT_ERROR_TOTAL_CONNECTION:p.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_TIMEOUT_ERROR_TOTAL_CONNECTION,!0);break;case"queryEventCacheClientTimeout":t||(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_TIMEOUT_ERROR_QUERY_EVENT_CACHE,!0)}return}return(0,c.isCancelledError)(e)?void(0,f.reportIDKey)(p.ErrorID,t?p.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL_CANCELLED_ERROR:p.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_CANCELLED_ERROR,!0):void(0,f.reportIDKey)(p.ErrorID,t?p.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL_UNKNOWN_ERROR:p.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_UNKNOWN_ERROR,!0)}switch(e.payload.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":(0,f.reportIDKey)(p.ErrorID,t?p.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL_SERVER_SIGN_ERROR:p.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_SERVER_SIGN_ERROR,!0);break;default:(0,f.reportIDKey)(p.ErrorID,t?p.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL_SERVER_OTHER_ERROR:p.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_SERVER_OTHER_ERROR,!0)}},this._errors.push(e),this.handleCommonError(e,{onSignError:function(){s._loginInvalidated=!0,s._fsm.transition(s.initialized?o.VWSEvent.REBUILD_WATCH_FAIL:o.VWSEvent.INIT_WATCH_FAIL)},onTimeoutError:function(e){e.payload&&!e.payload.retryable?i(e):s._fsm.transition(s.initialized?o.VWSEvent.REBUILD_WATCH_FAIL:o.VWSEvent.INIT_WATCH_FAIL)},onNotRetryableError:i,onCancelledError:function(e){s._fsm.transition(s.initialized?o.VWSEvent.REBUILD_WATCH_FAIL:o.VWSEvent.INIT_WATCH_FAIL)},onUnknownError:function(){s._fsm.transition(s.initialized?o.VWSEvent.REBUILD_WATCH_FAIL:o.VWSEvent.INIT_WATCH_FAIL)}}),[2]})})},this.closeWatch=function(){return n.__awaiter(t,void 0,void 0,function(){var e,t;return n.__generator(this,function(r){switch(r.label){case 0:if(this.closeWatchInvoked=!0,e=this.sessionInfo?this.sessionInfo.queryID:"",this._fsm.currentState===o.VWSState.CLOSED)return[2];r.label=1;case 1:return r.trys.push([1,3,4,5]),this._fsm.transition(o.VWSEvent.CLOSE),[4,this.sendCloseWatch()];case 2:return r.sent(),[3,5];case 3:return t=r.sent(),console.warn("[realtime] non-fatal error while closing watch: ".concat(t)),[3,5];case 4:return this.sessionInfo=void 0,this.onWatchClose(this,e),this._cleanup(),[7];case 5:return[2]}})})},this.sendCloseWatch=function(){return n.__awaiter(t,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:return e={watchId:this.watchId,requestId:(0,u.genRequestId)(),msgType:"CLOSE_WATCH",msgData:null},[4,this.send({msg:e})];case 1:return t.sent(),[2]}})})},this.scheduleSendACK=function(){t.clearACKSchedule(),t._ackTimeoutId=setTimeout(function(){t._waitExpectedTimeoutId?t.scheduleSendACK():t.sendACK()},v)},this.clearACKSchedule=function(){t._ackTimeoutId&&clearTimeout(t._ackTimeoutId)},this.sendACK=function(){return n.__awaiter(t,void 0,void 0,function(){var e,t,r;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this._fsm.currentState!==o.VWSState.INIT_WATCH_SUCCESS&&this._fsm.currentState!==o.VWSState.REBUILD_WATCH_SUCCESS?(this.scheduleSendACK(),[2]):this.sessionInfo?(e={watchId:this.watchId,requestId:(0,u.genRequestId)(),msgType:"CHECK_LAST",msgData:{queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:e})]):(console.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)"),[2]);case 1:return n.sent(),this.scheduleSendACK(),[3,3];case 2:if(t=n.sent(),(0,E.isRealtimeErrorMessageError)(t))switch((r=t.payload).msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return this._loginInvalidated=!0,this._fsm.currentState!==o.VWSState.INIT_WATCH_SUCCESS&&this._fsm.currentState!==o.VWSState.REBUILD_WATCH_SUCCESS||this._fsm.transition(o.VWSEvent.NEED_REBUILD_WATCH),[2];case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return this.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:r.msgData.code})),[2]}return this._availableRetries.CHECK_LAST&&this._availableRetries.CHECK_LAST>0?(this._availableRetries.CHECK_LAST--,this.scheduleSendACK()):this.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:t})),[3,3];case 3:return[2]}})})},this.handleCommonError=function(e,t){if((0,E.isRealtimeErrorMessageError)(e)){switch(e.payload.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return void t.onSignError(e);case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":default:return void t.onNotRetryableError(e)}}else{if((0,c.isTimeoutError)(e))return void t.onTimeoutError(e);if((0,c.isCancelledError)(e))return void t.onCancelledError(e)}t.onUnknownError(e)},this.watchId="watchid_".concat(+new Date,"_").concat(Math.random()),this._parentFSM=e.parentFSM,this.envId=e.envId,this.collectionName=e.collectionName,this.query=e.query,this.limit=e.limit,this.orderBy=e.orderBy,this.queryType=e.queryType,this.send=e.send,this.login=e.login,this.isWSConnected=e.isWSConnected,this.getWaitExpectedTimeoutLength=e.getWaitExpectedTimeoutLength,this.getEJSON=e.getEJSON,this.getServiceContext=e.getServiceContext,this.onWatchStart=e.onWatchStart,this.onWatchClose=e.onWatchClose,this.timing=e.timing,this.debug=e.debug,this._availableRetries={INIT_WATCH:m,REBUILD_WATCH:m,CHECK_LAST:g},this._fsm=new a.FSM({initialState:o.VWSState.UNINIT,states:o.VWSStates,history:!0}),this._subscribeParentFSMEvents(),this._subscribeFSMEvents(),this.listener=new _.RealtimeListener({close:this.closeWatch,onChange:e.onChange,onError:e.onError,debug:this.debug,virtualClient:this}),this._parentFSM.currentState===s.WSState.CONNECTED&&this._login(),e.debug&&(this.wsclient=e.wsclient)}return Object.defineProperty(e.prototype,"initialized",{get:function(){return Boolean(this.sessionInfo)},enumerable:!1,configurable:!0}),e.prototype._cleanup=function(){this._parentFSM.unsubscribe(this._parentFSMListener)},e.prototype._subscribeParentFSMEvents=function(){var e=this;this._parentFSMListener=function(t){var r=t.event;t.from,t.to;if(e._fsm.currentState!==o.VWSState.CLOSED)if(r.type===s.WSEvent.DISCONNECT||r.type===s.WSEvent.CONNECTION_FAIL)switch(e._fsm.currentState){case o.VWSState.UNINIT:case o.VWSState.INIT_LOGGING_IN:case o.VWSState.INIT_LOGIN_FAIL:case o.VWSState.INIT_LOGGED_IN:case o.VWSState.INIT_WATCH_PENDING:case o.VWSState.INIT_WATCH_FAIL:e.closeWithError(r.error||new Error("websocket connection fail"),!1);break;default:r.type===s.WSEvent.DISCONNECT?(e._wsDisconnectionTS||(e._wsDisconnectionTS=Date.now()),e._fsm.transition(o.VWSEvent.WS_DISCONNECTED)):e.closeWithError(r.error||new Error("websocket connection fail"),!1)}else if(r.type===s.WSEvent.CONNECTION_SUCCESS)switch(e._fsm.currentState){case o.VWSState.UNINIT:case o.VWSState.PAUSED:e._login();break;case o.VWSState.CLOSED:break;default:console.warn("[realtime] current state should not be ".concat(e._fsm.currentState," (parent event ").concat(r,")"))}},this._parentFSM.subscribe(this._parentFSMListener)},e.prototype._subscribeFSMEvents=function(){var e=this;this._FSMListener=function(t){var r=t.event,n=t.from;t.to;switch(r.type){case o.VWSEvent.WS_CONNECTED:e._login().catch(A);break;case o.VWSEvent.LOGIN_SUCCESS:n===o.VWSState.INIT_LOGGING_IN?e.initWatch().catch(A):n===o.VWSState.REBUILD_LOGGING_IN?e.rebuildWatch().catch(A):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:"unexpected state: event ".concat(r.type," from ").concat(n)}));break;case o.VWSEvent.LOGIN_FAIL:n===o.VWSState.INIT_LOGGING_IN?e.useRetryTicket("INIT_WATCH")?e._login().catch(A):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL,errMsg:"login fail ".concat(e._errors[e._errors.length-1])})):n===o.VWSState.REBUILD_LOGGING_IN?e.useRetryTicket("REBUILD_WATCH")?e._login().catch(A):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:"login fail ".concat(e._errors[e._errors.length-1])})):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:"unexpected state: event ".concat(r.type," from ").concat(n)}));break;case o.VWSEvent.INIT_WATCH_SUCCESS:e._availableRetries.INIT_WATCH=m,e._errors=[];break;case o.VWSEvent.INIT_WATCH_FAIL:e.useRetryTicket("INIT_WATCH")?e._login().catch(A):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL,errMsg:"init watch fail ".concat(e._errors[e._errors.length-1])}));break;case o.VWSEvent.REBUILD_WATCH_SUCCESS:e._availableRetries.REBUILD_WATCH=m,e._errors=[];break;case o.VWSEvent.REBUILD_WATCH_FAIL:e.useRetryTicket("REBUILD_WATCH")?e._login().catch(A):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:"init watch fail ".concat(e._errors[e._errors.length-1])}));break;case o.VWSEvent.NEED_REBUILD_WATCH:e._login().catch(A)}},this._fsm.subscribe(this._FSMListener)},e.prototype.useRetryTicket=function(e){return!!(this._availableRetries[e]&&this._availableRetries[e]>0)&&(this._availableRetries[e]--,!0)},e.prototype.assertAsyncTaskStatus=function(){if(this.closeWatchInvoked)throw new c.CancelledError("closeWatch",{subtype:"closeWatch"});switch(this._fsm.currentState){case o.VWSState.PAUSED:throw new c.CancelledError("pause",{subtype:"pause"});case o.VWSState.CLOSED:throw new c.CancelledError("close",{subtype:"close"})}},e.prototype.handleServerEvents=function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.scheduleSendACK(),[4,this._handleServerEvents(e)];case 1:return r.sent(),this._postHandleServerEventsValidityCheck(e),[3,3];case 2:throw t=r.sent(),(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_HANDLE_EVENT_ERROR,!0),t;case 3:return[2]}})})},e.prototype._handleServerEvents=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,s,a,u,_,E,m,g,v,S=this;return n.__generator(this,function(y){if(t=e.requestId,!(r=e.msgData.events).length||!this.sessionInfo)return[2];s=this.sessionInfo;try{a=r.map(C)}catch(e){return this.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,errMsg:e})),[2]}for(u=n.__spreadArray([],n.__read(s.currentDocs),!1),_=!1,E=function(r,E){var g,v,y=a[r];if(s.currentEventId>=y.id)return!a[r-1]||y.id>a[r-1].id?(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_RECV_DUPLICATE_EVENT,!0):(console.error("[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId ".concat(t,")")),(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_RECV_DUPLICATE_EVENT_AND_EVENT_OUT_OF_ORDER,!0)),"continue";if(s.currentEventId===y.id-1){switch(y.dataType){case"update":if(!y.doc)switch(y.queueType){case"update":case"dequeue":if(I=u.find(function(e){return e._id===y.docId})){var T=JSON.parse(JSON.stringify(I));if(y.updatedFields)for(var A in y.updatedFields)(0,i.set)(T,A,y.updatedFields[A]);if(y.removedFields)try{for(var b=(g=void 0,n.__values(y.removedFields)),C=b.next();!C.done;C=b.next()){A=C.value;(0,i.unset)(T,A)}}catch(e){g={error:e}}finally{try{C&&!C.done&&(v=b.return)&&v.call(b)}finally{if(g)throw g.error}}y.doc=T}else console.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated."),(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_DATATYPE_UPDATE_NO_ASSOCIATED_DOC,!0);break;case"enqueue":var O=new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId '.concat(e.requestId,")")});throw m.closeWithError(O),O}break;case"limit":if(!y.doc)switch(y.queueType){case"dequeue":var I;(I=u.find(function(e){return e._id===y.docId}))?y.doc=I:console.error("[realtime listener] internal non-fatal server error: unexpected limit dataType dequeue queueType event where no doc is associated.")}break;case"replace":if(!y.doc){O=new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="replace" (requestId '.concat(e.requestId,")")});throw m.closeWithError(O),O}break;case"remove":(T=u.find(function(e){return e._id===y.docId}))?y.doc=T:(console.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated."),(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_REMOVE_NO_ASSOCIATED_DOC,!0))}switch(y.queueType){case"init":_?u.push(y.doc):(_=!0,u=[y.doc]);break;case"enqueue":u.push(y.doc);break;case"dequeue":(R=u.findIndex(function(e){return e._id===y.docId}))>-1?u.splice(R,1):(console.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated."),(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_DEQUEUE_NO_ASSOCIATED_DOC,!0));break;case"update":var R;(R=u.findIndex(function(e){return e._id===y.docId}))>-1?u[R]=y.doc:(console.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated."),(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_QUEUETYPE_UPDATE_NO_ASSOCIATED_DOC,!0))}if(r===E-1||a[r+1]&&a[r+1].id!==y.id){var w=n.__spreadArray([],n.__read(u),!1),N=a.slice(0,r+1).filter(function(e){return e.id===y.id});m.sessionInfo.currentEventId=y.id,m.sessionInfo.currentDocs=u,m.sessionInfo.currentEventTS=Date.now();var D=new h.Snapshot({id:y.id,type:"init"===N[0].queueType?"init":void 0,docChanges:m.getEJSON().deserialize(N),docs:m.getEJSON().deserialize(w),EJSON:m.getEJSON(),requestId:t,watchId:m.watchId});d.default.surroundThirdByTryCatch(function(){return S.listener.onChange(D)})(),m.debug&&m._snapshotHistory.push(D)}}else(0,f.reportIDKey)(p.ErrorID,p.ErrorKey.REALTIME_DB_EVENT_OUT_OF_ORDER,!0),m._fsm.transition(o.VWSEvent.NEED_REBUILD_WATCH)},m=this,g=0,v=a.length;g<v;g++)E(g,v);return[2]})})},e.prototype._postHandleServerEventsValidityCheck=function(e){this.sessionInfo?(this.sessionInfo.expectEventId&&this.sessionInfo.currentEventId>=this.sessionInfo.expectEventId&&this.clearWaitExpectedEvent(),this.sessionInfo.currentEventId<e.msgData.currEvent&&console.warn("[realtime listener] internal non-fatal error: client eventId ".concat(this.sessionInfo.currentEventId," does not match with server event id after server event handling ").concat(e.msgData.currEvent," (requestId ").concat(e.requestId,")"))):console.error("[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur. (requestId ".concat(e.requestId,")"))},e.prototype.clearWaitExpectedEvent=function(){this._waitExpectedTimeoutId&&(clearTimeout(this._waitExpectedTimeoutId),this._waitExpectedTimeoutId=void 0)},e.prototype.onMessage=function(e){var t=this;switch(this._fsm.currentState){case o.VWSState.INIT_WATCH_SUCCESS:case o.VWSState.REBUILD_WATCH_SUCCESS:break;case o.VWSState.PAUSED:if("ERROR"!==e.msgType)return;break;default:return void console.warn("[realtime listener] internal non-fatal error: unexpected message received while state is ".concat(this._fsm.currentState))}if(this.sessionInfo)switch(this.scheduleSendACK(),e.msgType){case"NEXT_EVENT":0,this.handleServerEvents(e);break;case"CHECK_EVENT":this.sessionInfo.currentEventId<e.msgData.currEvent&&(this.sessionInfo.expectEventId=e.msgData.currEvent,this.clearWaitExpectedEvent(),this._waitExpectedTimeoutId=setTimeout(function(){t._fsm.transition(o.VWSEvent.NEED_REBUILD_WATCH)},this.getWaitExpectedTimeoutLength()));break;case"ERROR":this.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,errMsg:"".concat(e.msgData.code," - ").concat(e.msgData.message)}));break;default:0}else console.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.")},e.prototype.closeWithError=function(e,t){var r=this;if(void 0===t&&(t=!0),this._fsm.currentState!==o.VWSState.CLOSED&&this._fsm.transition(o.VWSEvent.CLOSE),!this.userOnErrorInvoked){var n=this._fsm.getHistoryRepresentation({limit:20});(0,c.isSDKError)(e)?(e.errMsg+="\nhistory ".concat(n),e.history=n):e&&((e=new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:"".concat(e," \nhistory ").concat(n)})).history=n),this.clearACKSchedule(),d.default.surroundThirdByTryCatch(function(){return r.listener.onError(e)})(),this.userOnErrorInvoked=!0,this.onWatchClose(this,this.sessionInfo&&this.sessionInfo.queryID||""),t&&this.sendCloseWatch().catch(A),this.sessionInfo=void 0}},e}();function C(e){var t={id:e.ID,dataType:e.DataType,queueType:e.QueueType,docId:e.DocID,doc:e.Doc&&"{}"!==e.Doc?JSON.parse(e.Doc):void 0};return"update"===e.DataType&&(e.UpdatedFields&&(t.updatedFields=JSON.parse(e.UpdatedFields)),(e.removedFields||e.RemovedFields)&&(t.removedFields=e.removedFields?JSON.parse(e.removedFields):JSON.parse(e.RemovedFields))),t}t.VirtualWebSocketClient=b},"./src/services/database/api/database/realtime/websocket-client.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RealtimeWebSocketClient=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/externals/public-lib/appserviceSdk.ts"),o=r("./src/services/database/api/database/realtime/fsm/ws.ts"),s=r("./src/services/database/api/database/realtime/virtual-websocket-client.ts"),a=r("./src/utils/fsm.ts"),u=r("./src/utils/utils.ts"),c=r("./src/services/database/internal/backend-api/backend-api.ts"),l=r("./src/services/database/api/database/realtime/message.ts"),d=r("./src/services/database/api/database/realtime/ws-event.ts"),f=r("./src/utils/error.ts"),p=r("./src/services/database/api/database/realtime/error.ts"),_=r("./src/config/error.config.ts"),h=r("./src/externals/globals/wxconfig.ts"),E=r("./src/utils/report.ts"),m=r("./src/config/report.config.ts"),g=r("./src/utils/report.ts"),v=r("./src/externals/public-lib/reporter.ts"),S={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},y=3,T=5e3,A=1e4,b=5e3,C=100,O=function(){function e(e){var t=this;this._virtualWSClient=new Set,this._queryIdClientMap=new Map,this._watchIdClientMap=new Map,this._pingFailed=0,this._pongMissed=0,this._logins=new Map,this._signatures=new Map,this._wsResponseWait=new Map,this._rttObserved=[],this._closedWatches=new Set,this.initWebSocketConnection=function(e,s){return void 0===s&&(s=t._maxReconnect),n.__awaiter(t,void 0,void 0,function(){var t,s,a,c,l,d,p,v,S,y=this;return n.__generator(this,function(T){switch(T.label){case 0:if(this._EJSON||(t=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t;return n.__generator(this,function(n){return e=Date.now(),t=r("./src/vendor/bson.bundle.js"),(0,g.reportAPISpeed)({apiName:"_realtime.importBSON",apiStartTime:e,apiEndTime:Date.now()}),[2,t.EJSON]})})}().then(function(e){return y._EJSON=e})),this._fsm.currentState!==o.WSState.DISCONNECTED)return[2];this._fsm.transition(o.WSEvent.CONNECTION_START),this._logins=new Map,this._wsResponseWait=new Map,s=!1,a=[],c=!1,!this._totalConnectionTimeoutId&&this._totalConnectionTimeout&&this._totalConnectionTimeout!==1/0&&(l=this._totalConnectionTimeout,this._totalConnectionTimeoutId=setTimeout(function(){c=!0,y._totalConnectionTimeoutId=void 0;var e=new f.TimeoutError("reconnect timeout (reach totalConnectionTimeout ".concat(l,"s)"),{subtype:"totalConnectionTimeout",retryable:!1});(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_WS_TOTAL_CONNECTION_TIMEOUT,!0),y._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:e})},1e3*l)),d=function(r){var l,d,f,E;return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,11,,17]),[4,(0,u.getNetworkStatus)()];case 1:return r.sent().isConnected?[3,5]:e?[3,2]:(p._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:new Error("network offline")}),[2,{value:void 0}]);case 2:return[4,(0,u.onceNetworkOnline)()];case 3:return r.sent(),0===p._virtualWSClient.size?(p.clearTotalReconnectTimeout(),[2,{value:void 0}]):(0,h.isDevTools)()?[4,(0,u.sleep)(C)]:[3,5];case 4:r.sent(),r.label=5;case 5:return c?[2,{value:void 0}]:[4,p.getSignature(p._connectionEnvId)];case 6:return l=r.sent(),c?[2,{value:void 0}]:(d=Date.now(),[4,new Promise(function(e,t){y._ws=(0,i.getSDK)(y._context.identifiers).connectSocket({url:l.wsUrl,header:{"content-type":"application/json"},perMessageDeflate:!0,success:e,fail:t})})]);case 7:return r.sent(),c?[2,{value:void 0}]:((0,g.reportAPISpeed)({apiName:"_realtime.connectSocket",apiStartTime:d,apiEndTime:Date.now()}),[4,p.initWebSocketEvent()]);case 8:return r.sent(),c?[2,{value:void 0}]:t?[4,t]:[3,10];case 9:if(r.sent(),c)return[2,{value:void 0}];r.label=10;case 10:return s=!0,[2,"break"];case 11:return f=r.sent(),a.unshift(f),f.errCode===_.ERR_CODE.TCB_PERMISSION_DENIED?[2,"break"]:[4,(0,u.getNetworkStatus)()];case 12:return E=r.sent().isConnected,c?[2,{value:void 0}]:E?[4,(0,u.sleep)(p._reconnectInterval)]:[3,14];case 13:if(r.sent(),c)return[2,{value:void 0}];r.label=14;case 14:return(0,h.isDevTools)()?[4,(0,u.sleep)(0)]:[3,16];case 15:if(r.sent(),c)return[2,{value:void 0}];r.label=16;case 16:return[3,17];case 17:return[2]}})},p=this,v=this._maxReconnect,T.label=1;case 1:return v>=0?[5,d(v)]:[3,4];case 2:if("object"==typeof(S=T.sent()))return[2,S.value];if("break"===S)return[3,4];T.label=3;case 3:return v--,[3,1];case 4:return s?(this.clearTotalReconnectTimeout(),(0,E.reportIDKey)(m.ErrorID,e?m.ErrorKey.REALTIME_DB_RECONNECT_WS_SUCCESS:m.ErrorKey.REALTIME_DB_INIT_WS_SUCCESS,!0),this._fsm.transition(o.WSEvent.CONNECTION_SUCCESS),[2]):(this.clearTotalReconnectTimeout(),(0,E.reportIDKey)(m.ErrorID,e?m.ErrorKey.REALTIME_DB_RECONNECT_WS_FAIL:m.ErrorKey.REALTIME_DB_INIT_WS_FAIL,!0),e?this._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:new f.CloudSDKError({errCode:_.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WS_FAIL,errMsg:"errors of each retry (latest to oldest): ".concat(JSON.stringify(a.map(function(e){return e+""})))})}):this._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:new f.CloudSDKError({errCode:_.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WS_FAIL,errMsg:"errors of each retry (latest to oldest): ".concat(JSON.stringify(a.map(function(e){return e+""})))})}),[2])}})})},this.initWebSocketEvent=function(){return new Promise(function(e,r){if(!t._ws)throw new Error("can not initWebSocketEvent, ws not exists");var n=!1;t._ws.onOpen(function(r){t._context.debug&&console.warn("[realtime] ws event: open",r),n=!0,e()});var i=null;t._ws.onError(function(e){i=e,t._logins=new Map,n?(t._context.debug&&console.error("[realtime] ws event: error",e),t.clearHeartbeat(),(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_WS_ONERROR_WHILE_ACTIVE,!0)):(t._context.debug&&console.error("[realtime] ws open failed with ws event: error",e),r(e),(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_WS_ONERROR_BEFORE_OPEN,!0))}),t._ws.onClose(function(e){t._logins=new Map,t.clearHeartbeat();var r=i||(0,d.getWSCloseError)(e.code);switch(e.code){case d.CLOSE_EVENT_CODE.ReconnectOnServerUpgrade:case d.CLOSE_EVENT_CODE.ReconnectWebSocket:case d.CLOSE_EVENT_CODE.NoRealtimeListeners:t._fsm.transition({type:o.WSEvent.DISCONNECT,error:r});break;case d.CLOSE_EVENT_CODE.HeartbeatPingError:case d.CLOSE_EVENT_CODE.HeartbeatPongTimeoutError:case d.CLOSE_EVENT_CODE.NormalClosure:case d.CLOSE_EVENT_CODE.AbnormalClosure:t._maxReconnect>0?(t._fsm.transition({type:o.WSEvent.DISCONNECT,error:r}),t.initWebSocketConnection(!0)):t._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:r}),e.code===d.CLOSE_EVENT_CODE.HeartbeatPingError?(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PING_FAIL,!0):e.code===d.CLOSE_EVENT_CODE.HeartbeatPongTimeoutError?(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PONG_TIMEOUT,!0):(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_WS_ONCLOSE_AB_NORMAL_CLOSURE,!0);break;case d.CLOSE_EVENT_CODE.UnauthenticatedIdleConnection:t._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:(0,d.getWSCloseError)(e.code,e.reason)}),(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_WS_ONCLOSE_SERVER_CLOSE_NO_AUTH,!0);break;case d.CLOSE_EVENT_CODE.ServerUpgrade:t._fsm.transition({type:o.WSEvent.DISCONNECT,error:r}),t.initWebSocketConnection(!0),(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_WS_ONCLOSE_SERVER_CLOSE_FOR_UPGRADE,!0);break;default:t._maxReconnect>0?(t._fsm.transition({type:o.WSEvent.DISCONNECT,error:r}),t.initWebSocketConnection(!0)):t._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:(0,d.getWSCloseError)(e.code,e.reason)}),(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_WS_ONCLOSE_UNKNOWN_ORIGIN,!0)}(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_WS_ONCLOSE,!0)});var s={timing:{},startKey:"apiStartTime",endKey:"apiEndTime",samplePicker:E.socketOnMessageSamplePicker,autoReport:"_realtime.onSocketMessage"};t._ws.onMessage((0,E.wrapTiming)(t.onSocketMessage,s)),t.heartbeat()})},this.isWSConnected=function(){return Boolean(t._ws&&t._ws.readyState===S.OPEN)},this.onSocketMessage=function(e){var r,n=e.data;t.heartbeat();try{r=JSON.parse(n)}catch(e){throw new Error("[realtime] onMessage parse res.data error: ".concat(e))}t._context.debug&&console.log("[realtime] onMessage ".concat(r.msgType," (").concat((new Date).toLocaleString(),")"),r);var i=t._wsResponseWait.get(r.requestId);if(i){try{"ERROR"===r.msgType?i.reject(new p.RealtimeErrorMessageError(r)):i.resolve(r)}catch(e){t._context.debug&&console.error("ws onMessage responseWaitSpec.resolve(msg) errored:",e)}finally{t._wsResponseWait.delete(r.requestId)}if(i.skipOnMessage)return}if("PONG"!==r.msgType){var o=r.watchId&&t._watchIdClientMap.get(r.watchId);if(o)o.onMessage(r);else switch(r.watchId?t._closedWatches.has(r.watchId)?(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_RECV_MSG_WITH_CLOSED_WATCHID,!0):(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_RECV_MSG_WITH_UNKNOWN_WATCHID,!0):(0,E.reportIDKey)(m.ErrorID,m.ErrorKey.REALTIME_DB_RECV_MSG_WITHOUT_WATCHID,!0),r.msgType){case"INIT_EVENT":case"NEXT_EVENT":case"CHECK_EVENT":(o=t._queryIdClientMap.get(r.msgData.queryID))&&o.onMessage(r)}}else if(t._lastPingSendTS){var s=Date.now()-t._lastPingSendTS;if(s>A)return void(t._context.debug&&console.warn("[realtime] untrusted rtt observed: ".concat(s)));t._rttObserved.length>=y&&t._rttObserved.splice(0,t._rttObserved.length-y+1),t._rttObserved.push(s)}},this.login=function(e,r,i){return n.__awaiter(t,void 0,void 0,function(){var t,o,s,a,c,d,f,p,_=this;return n.__generator(this,function(h){switch(h.label){case 0:if(e=e||this._context.env||this._defaultEnvId,!r)if(e){if(t=this._logins.get(e)){if(t.loggedIn&&t.loginResult)return[2,t.loginResult];if(t.loggingInPromise)return[2,t.loggingInPromise]}}else if((o=this._logins.get(""))&&o.loggingInPromise)return[2,o.loggingInPromise];0,s=new Promise(function(t,o){return n.__awaiter(_,void 0,void 0,function(){var s,a,c,d,f;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,i?(0,E.wrapTiming)(this.getSignature(e,r),{timing:i,startKey:"tunnelStartTime",endKey:"tunnelEndTime",condition:{emptyKey:!0}}):this.getSignature(e,r)];case 1:return s=n.sent(),a=(0,u.getWXVersion)(),c={watchId:void 0,requestId:(0,l.genRequestId)(),msgType:"LOGIN",msgData:{envId:s.envId,signStr:s.signStr,secretVersion:s.secretVersion,referrer:"mp",sdkVersion:a.version,dataVersion:a.updateDateInDashes}},[4,this.send({msg:c,waitResponse:!0,skipOnMessage:!0,timeout:b})];case 2:return(d=n.sent()).msgData.code?o(new Error("".concat(d.msgData.code," ").concat(d.msgData.message))):t({envId:s.envId}),[3,4];case 3:return f=n.sent(),o(f),[3,4];case 4:return[2]}})})}),a=e&&this._logins.get(e),c=Date.now(),a?(a.loggedIn=!1,a.loggingInPromise=s,a.loginStartTS=c):(a={loggedIn:!1,loggingInPromise:s,loginStartTS:c},this._logins.set(e||"",a)),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,s];case 2:if(d=h.sent(),(f=this._logins.get(e||""))&&f===a&&f.loginStartTS===c)return a.loggedIn=!0,a.loggingInPromise=void 0,a.loginStartTS=void 0,a.loginResult=d,[2,d];if(f){if(f.loggedIn&&f.loginResult)return[2,f.loginResult];if(f.loggingInPromise)return[2,f.loggingInPromise];throw new Error("ws unexpected login info")}throw new Error("ws login info reset");case 3:throw p=h.sent(),a.loggedIn=!1,a.loggingInPromise=void 0,a.loginStartTS=void 0,a.loginResult=void 0,p;case 4:return[2]}})})},this.getSignature=function(e,r){return n.__awaiter(t,void 0,void 0,function(){var t,i,o,s;return n.__generator(this,function(a){switch(a.label){case 0:if(e=e||this._context.env||this._defaultEnvId,!r&&e&&this._signatures.has(e)){if(t=this._signatures.get(e),Date.now()<t.expireTS)return[2,t]}else 0;return i=Date.now()+6e4,[4,(0,c.getRealtimeConnectionSignature)(this._context,e)];case 1:return o=a.sent(),Date.now()-i>6e4?[2,this.getSignature(e,r)]:(s=n.__assign(n.__assign({},o),{expireTS:i}),this._signatures.set(s.envId,s),e||(this._defaultEnvId=s.envId),[2,s])}})})},this.getWaitExpectedTimeoutLength=function(){return t._rttObserved.length?t._rttObserved.reduce(function(e,t){return e+t})/t._rttObserved.length*1.5:T},this.ping=function(){return n.__awaiter(t,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:return e={watchId:void 0,requestId:(0,l.genRequestId)(),msgType:"PING",msgData:null},[4,this.send({msg:e})];case 1:return t.sent(),this._context.debug&&console.log("ping sent"),[2]}})})},this.send=function(e){return new Promise(function(r,i){return n.__awaiter(t,void 0,void 0,function(){var t,s,a,c,l,d=this;return n.__generator(this,function(p){if(this._fsm.currentState!==o.WSState.CONNECTED)return[2,i(new Error("websocket not connected"))];s=!1,a=!1,c=function(e){s=!0,t&&clearTimeout(t),r(e)},l=function(e){a=!0,t&&clearTimeout(t),i(e)},e.timeout&&(t=setTimeout(function(){return n.__awaiter(d,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return s&&a?[3,2]:[4,(0,u.sleep)(0)];case 1:e.sent(),s&&a||l(new f.TimeoutError("wsclient.send timedout")),e.label=2;case 2:return[2]}})})},e.timeout));try{if(this._context.debug&&console.log("[realtime] ws send ".concat(e.msg.msgType," (").concat((new Date).toLocaleString(),"): "),e),!this._ws)return l(new Error("invalid state: ws connection not exists, can not send message")),[2];if(this._ws.readyState!==S.OPEN)return l(new Error("ws readyState invalid: ".concat(this._ws.readyState,", can not send message"))),[2];e.waitResponse&&this._wsResponseWait.set(e.msg.requestId,{resolve:c,reject:l,skipOnMessage:e.skipOnMessage}),this._ws.send({data:JSON.stringify(e.msg),success:function(t){e.waitResponse||c(t)},fail:function(t){l(t),e.waitResponse&&d._wsResponseWait.delete(e.msg.requestId)}})}catch(e){l(e)}return[2]})})})},this.onWatchStart=function(e,r){t._queryIdClientMap.set(r,e)},this.onWatchClose=function(e,r){r&&t._queryIdClientMap.delete(r),t._watchIdClientMap.delete(e.watchId),t._virtualWSClient.delete(e),t._closedWatches.add(e.watchId),t._virtualWSClient.size||t.close(d.CLOSE_EVENT_CODE.NoRealtimeListeners)},this.getEJSON=function(){return t._EJSON},this._fsm=new a.FSM({initialState:o.WSState.DISCONNECTED,states:o.WSStates}),this._serviceContext=e.serviceContext}return Object.defineProperty(e.prototype,"_context",{get:function(){return this._serviceContext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_maxReconnect",{get:function(){return this._context.appConfig.realtimeMaxReconnect},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_reconnectInterval",{get:function(){return this._context.appConfig.realtimeReconnectInterval},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_totalConnectionTimeout",{get:function(){return this._context.appConfig.realtimeTotalConnectionTimeout},enumerable:!1,configurable:!0}),e.prototype.heartbeat=function(e){var t=this;this.clearHeartbeat(),this._pingTimeoutId=setTimeout(function(){return n.__awaiter(t,void 0,void 0,function(){var e=this;return n.__generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this._ws&&this._ws.readyState===S.OPEN?(this._lastPingSendTS=Date.now(),[4,this.ping()]):[2];case 1:return t.sent(),this._pingFailed=0,this._pongTimeoutId=setTimeout(function(){e._context.debug&&console.error("pong timed out"),e._pongMissed<2?(e._pongMissed++,e.heartbeat(!0)):e.close(d.CLOSE_EVENT_CODE.HeartbeatPongTimeoutError)},this._context.appConfig.realtimePongWaitTimeout),[3,3];case 2:return t.sent(),this._pingFailed<2?(this._pingFailed++,this.heartbeat()):this.close(d.CLOSE_EVENT_CODE.HeartbeatPingError),[3,3];case 3:return[2]}})})},e?0:this._context.appConfig.realtimePingInterval)},e.prototype.clearHeartbeat=function(){this._pingTimeoutId&&clearTimeout(this._pingTimeoutId),this._pongTimeoutId&&clearTimeout(this._pongTimeoutId)},e.prototype.clearTotalReconnectTimeout=function(){this._totalConnectionTimeoutId&&clearTimeout(this._totalConnectionTimeoutId)},e.prototype.close=function(e){this.clearHeartbeat(),this._ws&&(this._ws.close({code:e,reason:d.CLOSE_EVENT_CODE_INFO[e].name}),this._ws=void 0)},e.prototype.watch=function(e){var t=this,r={apiStartTime:Date.now()},i=!1,a=function(){(0,g.reportAPISpeed)(n.__assign(n.__assign({},r),{apiName:e.reportAPIName}))},u=e.onChange,c=e.onError;this._fsm.currentState===o.WSState.DISCONNECTED&&(this._connectionEnvId=e.envId,this.initWebSocketConnection(!1));var l=new s.VirtualWebSocketClient(n.__assign(n.__assign({},e),{parentFSM:this._fsm,send:this.send,login:this.login,isWSConnected:this.isWSConnected,getWaitExpectedTimeoutLength:this.getWaitExpectedTimeoutLength,getEJSON:this.getEJSON,getServiceContext:function(){return t._context},onWatchStart:this.onWatchStart,onWatchClose:this.onWatchClose,timing:r,debug:this._context.debug,wsclient:this,onChange:f,onError:p}));this._virtualWSClient.add(l),this._watchIdClientMap.set(l.watchId,l);var d=l.listener;return d;function f(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i||(i=!0,r.apiEndTime=Date.now(),a()),_(),v.default.surroundThirdByTryCatch(function(){return d.onChange.apply(e,t)})()}function p(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i||(i=!0,r.apiEndTime=Date.now(),a()),_(),v.default.surroundThirdByTryCatch(function(){return d.onError.apply(e,t)})()}function _(){d.onChange===f&&(d.onChange=u),d.onError===p&&(d.onError=c)}},e}();t.RealtimeWebSocketClient=O},"./src/services/database/api/database/realtime/ws-event.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getWSCloseError=t.CLOSE_EVENT_CODE=t.CLOSE_EVENT_CODE_INFO=void 0;var n=r("./src/utils/error.ts"),i=r("./src/config/error.config.ts");t.CLOSE_EVENT_CODE_INFO={1000:{code:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},1001:{code:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{code:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},1003:{code:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},1005:{code:1005,name:"No Status Received",description:"Indicates that no status code was provided even though one was expected."},1006:{code:1006,name:"Abnormal Closure",description:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{code:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{code:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{code:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{code:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{code:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{code:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},1013:{code:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{code:1014,name:"Bad Gateway",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{code:1015,name:"TLS Handshake",description:"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},3000:{code:3e3,name:"Reconnect WebSocket",description:"The client is terminating the connection because it wants to reconnect"},3001:{code:3001,name:"No Realtime Listeners",description:"The client is terminating the connection because no more realtime listeners exist"},3002:{code:3002,name:"Heartbeat Ping Error",description:"The client is terminating the connection due to its failure in sending heartbeat messages"},3003:{code:3003,name:"Heartbeat Pong Timeout Error",description:"The client is terminating the connection because no heartbeat response is received from the server"},3004:{code:3004,name:"Client Reconnect on Server Upgrade",description:"The client is terminating the connection in response to server upgrade"},3050:{code:3050,name:"Server Close Unauthenticated Idle Connection",description:"The server is terminating the connection because the connection is idle and not authenticated"},3051:{code:3051,name:"Server Upgrade",description:"The server is terminating the connection because it is upgrading"},3052:{code:3052,name:"Server Requires Authentication",description:"The server is terminating the connection because it has not received authentication message as the connection's first message"}},function(e){e[e.NormalClosure=1e3]="NormalClosure",e[e.GoingAway=1001]="GoingAway",e[e.ProtocolError=1002]="ProtocolError",e[e.UnsupportedData=1003]="UnsupportedData",e[e.NoStatusReceived=1005]="NoStatusReceived",e[e.AbnormalClosure=1006]="AbnormalClosure",e[e.InvalidFramePayloadData=1007]="InvalidFramePayloadData",e[e.PolicyViolation=1008]="PolicyViolation",e[e.MessageTooBig=1009]="MessageTooBig",e[e.MissingExtension=1010]="MissingExtension",e[e.InternalError=1011]="InternalError",e[e.ServiceRestart=1012]="ServiceRestart",e[e.TryAgainLater=1013]="TryAgainLater",e[e.BadGateway=1014]="BadGateway",e[e.TLSHandshake=1015]="TLSHandshake",e[e.ReconnectWebSocket=3e3]="ReconnectWebSocket",e[e.NoRealtimeListeners=3001]="NoRealtimeListeners",e[e.HeartbeatPingError=3002]="HeartbeatPingError",e[e.HeartbeatPongTimeoutError=3003]="HeartbeatPongTimeoutError",e[e.ReconnectOnServerUpgrade=3004]="ReconnectOnServerUpgrade",e[e.UnauthenticatedIdleConnection=3050]="UnauthenticatedIdleConnection",e[e.ServerUpgrade=3051]="ServerUpgrade",e[e.AuthenticationRequired=3052]="AuthenticationRequired"}(t.CLOSE_EVENT_CODE||(t.CLOSE_EVENT_CODE={}));t.getWSCloseError=function(e,r){var o=t.CLOSE_EVENT_CODE_INFO[e],s=o?"".concat(o.name,", code ").concat(e,", reason ").concat(r||o.description):"code ".concat(e);return new n.CloudSDKError({errCode:i.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,errMsg:s})}},"./src/services/database/api/database/regexp.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RegExp=t.regExp=void 0;var n=r("./src/services/database/api/database/helper/symbol.ts"),i=r("./src/utils/assert.ts");t.regExp=function(e){return new o(e)};var o=function(){function e(e){(0,i.assertType)(e,{regexp:"string"},"RegExp options"),e.options&&(0,i.assertType)(e.options,"string"),this.regexp=e.regexp,this.options=e.options||""}return Object.defineProperty(e.prototype,"_internalType",{get:function(){return n.SYMBOL_REGEXP},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{$regex:this.regexp,$options:this.options}},e}();t.RegExp=o},"./src/services/database/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerService=void 0;var n=r("./src/services/database/api/api.ts"),i="database";t.registerService=function(e){e.registerService(function(e){var t={name:i,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get debug(){return e.debug},get env(){return e.getEnvForService(i)},appConfig:{get docSizeLimit(){return e.appConfig.db_doc_size_limit},get realtimePingInterval(){return e.appConfig.db_realtime_ping_interval},get realtimePongWaitTimeout(){return e.appConfig.db_realtime_pong_wait_timeout},get realtimeMaxReconnect(){return e.config.database.realtime.maxReconnect},get realtimeReconnectInterval(){return e.config.database.realtime.reconnectInterval},get realtimeTotalConnectionTimeout(){return e.config.database.realtime.totalConnectionTimeout},get realtimeQueryEventCacheTimeout(){return e.appConfig.db_realtime_query_event_cache_timeout}}};return{name:i,context:t,getAPIs:n.getAPIs.bind(null,t)}}(e))}},"./src/services/database/internal/backend-api/backend-api.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getRealtimeConnectionSignature=t.runAggregate=t.countDocument=t.setDocument=t.updateDocument=t.queryDocument=t.removeDocument=t.addDocument=t.ORDER_DIRECTION=t._ID_TYPE=t.QUERY_TYPE=void 0;var n,i,o=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),s=r("./src/utils/assert.ts"),a=r("./src/utils/type.ts"),u=r("./src/externals/globals/wxconfig.ts");!function(e){e[e.WHERE=0]="WHERE",e[e.DOC=1]="DOC"}(n=t.QUERY_TYPE||(t.QUERY_TYPE={})),function(e){e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"}(i=t._ID_TYPE||(t._ID_TYPE={})),function(e){e[e.ASC=0]="ASC",e[e.DESC=1]="DESC"}(t.ORDER_DIRECTION||(t.ORDER_DIRECTION={})),t.addDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,r,n,a,u,c,l,d,f,p;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,r=e.collectionName,n=e.data,a=e.instanceContext,u=e.timing,c=JSON.stringify(n),(0,s.assertStringLength)({input:c,max:a.serviceContext.appConfig.docSizeLimit,name:"record",maxWording:"".concat((a.serviceContext.appConfig.docSizeLimit/1024).toFixed(0)," KB")}),l={collection_name:r,data:c},d=JSON.stringify(l),u.tunnelStartTime=+new Date,[4,a.serviceContext.request({apiName:"tcbapi_db_adddocument",serviceName:a.serviceContext.name,serializedReqData:d,requireDataNotEmpty:!0,env:t||a.serviceContext.env})];case 1:return f=o.sent(),u.tunnelEndTime=+new Date,p=f.data,u.tunnelTimeNoCSNetCost=p.baseresponse.stat.qbase_cost_time,[2,{_id:p._id_type===i.NUMBER?p._id_number:p._id}]}})})},t.removeDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,i,s,a,c,l,d,f,p,_,h;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.collectionName,i=e.query,s=e.options,a=e.instanceContext,c=e.timing,l=e.env,d=(0,u.isDevTools)()?e.explain:void 0,f=s&&s.multi,p=JSON.stringify({collection_name:t,query:JSON.stringify(i),multi:f,query_type:f?n.WHERE:n.DOC,explain:d}),c.tunnelStartTime=+new Date,[4,a.serviceContext.request({apiName:"tcbapi_db_deletedocument",serviceName:a.serviceContext.name,serializedReqData:p,requireDataNotEmpty:!0,env:l||a.serviceContext.env})];case 1:return _=o.sent(),c.tunnelEndTime=+new Date,d?[2,r("./src/vendor/bson.bundle.js").EJSON.deserialize(_.data)]:(h=_.data,c.tunnelTimeNoCSNetCost=h.baseresponse.stat.qbase_cost_time,[2,{removed:h.deleted}])}})})},t.queryDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,n,i,s,a,c,l,d,f,p,_,h,E,m;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,n=e.collectionName,i=e.query,s=e.options,a=void 0===s?{}:s,c=e.instanceContext,l=e.timing,d=e.queryType,f=(0,u.isDevTools)()?e.explain:void 0,p={collection_name:n,query:JSON.stringify(i),query_type:d,explain:f},a.offset&&(p.offset=a.offset),a.limit&&(p.limit=a.limit),a.order&&(p.order=a.order),a.projection&&(p.projection=JSON.stringify(a.projection)),_=JSON.stringify(p),l.tunnelStartTime=+new Date,[4,c.serviceContext.request({apiName:"tcbapi_db_querydocument",serviceName:c.serviceContext.name,serializedReqData:_,requireDataNotEmpty:!0,env:t||c.serviceContext.env})];case 1:return h=o.sent(),l.tunnelEndTime=+new Date,f?[2,r("./src/vendor/bson.bundle.js").EJSON.deserialize(h.data)]:(E=h.data,l.tunnelTimeNoCSNetCost=E.baseresponse.stat.qbase_cost_time,m=E.data_list?JSON.parse(E.data_list):[],[2,{list:m=c.engine.Decoder.decode(m),offset:E.offset,limit:E.limit,total:E.total}])}})})},t.updateDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,n,i,a,c,l,d,f,p,_,h,E,m,g,v;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,n=e.collectionName,i=e.query,a=e.data,c=e.options,l=void 0===c?{}:c,d=e.instanceContext,f=e.timing,p=e.queryType,_=(0,u.isDevTools)()?e.explain:void 0,h=JSON.stringify(a),(0,s.assertStringLength)({input:h,max:d.serviceContext.appConfig.docSizeLimit,name:"update expression",maxWording:"".concat((d.serviceContext.appConfig.docSizeLimit/1024).toFixed(0)," KB")}),(E={collection_name:n,query:JSON.stringify(i),data:h,query_type:p,explain:_}).multi=!1!==l.multi,E.merge=!1!==l.merge,l.upsert&&(E.upsert=l.upsert),m=JSON.stringify(E),f.tunnelStartTime=+new Date,[4,d.serviceContext.request({apiName:"tcbapi_db_updatedocument",serviceName:d.serviceContext.name,serializedReqData:m,requireDataNotEmpty:!0,env:t||d.serviceContext.env})];case 1:return g=o.sent(),f.tunnelEndTime=+new Date,_?[2,r("./src/vendor/bson.bundle.js").EJSON.deserialize(g.data)]:(v=g.data,f.tunnelTimeNoCSNetCost=v.baseresponse.stat.qbase_cost_time,[2,{updated:v.updated}])}})})},t.setDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,r,n,u,c,l,d,f,p,_,h,E;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,r=e.collectionName,n=e._id,u=e.data,e.options,c=e.instanceContext,l=e.timing,d=JSON.stringify(u),(0,s.assertStringLength)({input:d,max:c.serviceContext.appConfig.docSizeLimit,name:"record",maxWording:"".concat((c.serviceContext.appConfig.docSizeLimit/1024).toFixed(0)," KB")}),f=(0,a.isNumber)(n),p={collection_name:r,_id_type:f?i.NUMBER:i.STRING,data:d},f?p._id_number=n:p._id=n,_=JSON.stringify(p),l.tunnelStartTime=+new Date,[4,c.serviceContext.request({apiName:"tcbapi_db_setdocument",serviceName:c.serviceContext.name,serializedReqData:_,requireDataNotEmpty:!0,env:t||c.serviceContext.env})];case 1:return h=o.sent(),l.tunnelEndTime=+new Date,E=h.data,l.tunnelTimeNoCSNetCost=E.baseresponse.stat.qbase_cost_time,[2,{_id:E._id_type===i.NUMBER?E._id_number:E._id,updated:E._id?0:1,created:E._id?1:0}]}})})},t.countDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,i,s,a,c,l,d,f,p,_;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,i=e.collectionName,s=e.query,a=e.instanceContext,c=e.timing,l=(0,u.isDevTools)()?e.explain:void 0,d={collection_name:i,query:JSON.stringify(s),query_type:n.WHERE,explain:l},f=JSON.stringify(d),c.tunnelStartTime=+new Date,[4,a.serviceContext.request({apiName:"tcbapi_db_countdocument",serviceName:a.serviceContext.name,serializedReqData:f,requireDataNotEmpty:!0,env:t||a.serviceContext.env})];case 1:return p=o.sent(),c.tunnelEndTime=+new Date,l?[2,r("./src/vendor/bson.bundle.js").EJSON.deserialize(p.data)]:(_=p.data,c.tunnelTimeNoCSNetCost=_.baseresponse.stat.qbase_cost_time,[2,{total:_.total}])}})})},t.runAggregate=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,n,i,s,a,c,l,d,f,p,_;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,n=e.collectionName,i=e.stages,s=e.instanceContext,a=e.timing,c=(0,u.isDevTools)()?e.explain:void 0,l={collection_name:n,stages:i.map(function(e){for(var t in e)return{stage_key:t,stage_value:JSON.stringify(e[t])};throw new Error("empty encoded stage (".concat(JSON.stringify(e),")"))}),explain:c},d=JSON.stringify(l),a.tunnelStartTime=+new Date,[4,s.serviceContext.request({apiName:"tcbapi_db_aggregate",serviceName:s.serviceContext.name,serializedReqData:d,requireDataNotEmpty:!0,env:t||s.serviceContext.env})];case 1:return f=o.sent(),a.tunnelEndTime=+new Date,c?[2,r("./src/vendor/bson.bundle.js").EJSON.deserialize(f.data)]:(p=f.data,a.tunnelTimeNoCSNetCost=p.baseresponse.stat.qbase_cost_time,_=r("./src/vendor/bson.bundle.js").EJSON,[2,{list:JSON.parse(p.list).map(function(e){return _.parse(e)})}])}})})},t.getRealtimeConnectionSignature=function(e,t){return o.__awaiter(this,void 0,void 0,function(){var r,n;return o.__generator(this,function(i){switch(i.label){case 0:return[4,e.request({apiName:"tcbapi_db_get_realtime_connection",env:t||e.env,serviceName:e.name,serializedReqData:JSON.stringify({}),requireDataNotEmpty:!0})];case 1:return r=i.sent(),[2,{envId:(n=r.data).env_id,secretVersion:n.secret_version,signStr:n.sign_str,wsUrl:n.ws_url}]}})})}},"./src/services/database/internal/grammar/default/extractor.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getProjectionDefinition=t.extractQueryOptions=void 0;var n=r("./src/services/database/api/database/query.ts"),i=r("./src/services/database/internal/backend-api/backend-api.ts"),o=r("./src/services/database/internal/grammar/default/serializer/common.ts");t.extractQueryOptions=function(e,t){return{limit:e._query.limit,offset:e._query.offset,order:function(e){return e.map(function(e){return{field:e.fieldPath,direction:e.order===n.ORDER_DIRECTION.DESC?i.ORDER_DIRECTION.DESC:i.ORDER_DIRECTION.ASC}})}(e._query.order||[]),projection:t.engine.ProjectionSerializer.encode(e._field)}},t.getProjectionDefinition=function(e){var t=(0,o.flattenObject)(e);for(var r in t)!0===t[r]||1===t[r]?t[r]=1:!1===t[r]||0===t[r]?t[r]=0:delete t[r];return t}},"./src/services/database/internal/grammar/default/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js");n.__exportStar(r("./src/services/database/internal/grammar/default/extractor.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/operator-map.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/serializer.ts"),t)},"./src/services/database/internal/grammar/default/operator-map.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateOperatorToString=t.operatorToString=t.AggregateOperatorMap=t.OperatorMap=void 0;var n=r("./src/services/database/api/database/commands/query.ts"),i=r("./src/services/database/api/database/commands/logic.ts"),o=r("./src/services/database/api/database/commands/update.ts"),s=r("./src/services/database/api/database/commands/aggregate.ts");for(var a in t.OperatorMap={},t.AggregateOperatorMap={},n.QUERY_COMMANDS_LITERAL)t.OperatorMap[n.QUERY_COMMANDS_LITERAL[a]]="$".concat(n.QUERY_COMMANDS_LITERAL[a]);for(var a in i.LOGIC_COMMANDS_LITERAL)t.OperatorMap[i.LOGIC_COMMANDS_LITERAL[a]]="$".concat(i.LOGIC_COMMANDS_LITERAL[a]);for(var a in o.UPDATE_COMMANDS_LITERAL)t.OperatorMap[o.UPDATE_COMMANDS_LITERAL[a]]="$".concat(o.UPDATE_COMMANDS_LITERAL[a]);for(var a in s.AGGREGATE_COMMANDS_LITERAL)t.AggregateOperatorMap[s.AGGREGATE_COMMANDS_LITERAL[a]]="$".concat(s.AGGREGATE_COMMANDS_LITERAL[a]);t.OperatorMap[n.QUERY_COMMANDS_LITERAL.NEQ]="$ne",t.OperatorMap[o.UPDATE_COMMANDS_LITERAL.REMOVE]="$unset",t.OperatorMap[o.UPDATE_COMMANDS_LITERAL.SHIFT]="$pop",t.OperatorMap[o.UPDATE_COMMANDS_LITERAL.UNSHIFT]="$push",t.OperatorMap[n.QUERY_COMMANDS_LITERAL.GEO_NEAR]="$nearSphere",t.OperatorMap[n.QUERY_COMMANDS_LITERAL.GEO_WITHIN]="$geoWithin",t.OperatorMap[n.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS]="$geoIntersects",t.operatorToString=function(e){return t.OperatorMap[e]||"$".concat(e.toLowerCase())},t.aggregateOperatorToString=function(e){return t.AggregateOperatorMap[e]||"$".concat(e.toLowerCase())}},"./src/services/database/internal/grammar/default/serializer.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js");n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/query.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/update.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/projection.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/decoder.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/aggregate.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/common.ts"),t)},"./src/services/database/internal/grammar/default/serializer/aggregate.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AggregateSerializer=void 0;var n=r("./src/services/database/internal/grammar/default/serializer/common.ts"),i=r("./src/services/database/api/database/aggregate.ts"),o=r("./src/services/database/api/database/commands/aggregate.ts"),s=r("./src/utils/type.ts"),a=r("./src/services/database/internal/grammar/default/operator-map.ts"),u=r("./src/services/database/internal/grammar/default/serializer/query.ts"),c=function(){function e(){}return e.encodeStages=function(e){return(new l).encodeStages(e)},e.encode=function(e){return(new l).encodeAny(e)},e}();t.AggregateSerializer=c;var l=function(){function e(){}return e.prototype.encodeStages=function(e){var t=this;return e.map(function(e){return t.encodePipelineStage(e)})},e.prototype.encodeAny=function(e){var t=this;return(0,n.isConversionRequired)(e)?(0,i.isPipeline)(e)?this.encodePipeline(e):(0,i.isPipelineStage)(e)?this.encodePipelineStage(e):(0,o.isAggregateCommand)(e)?this.encodeAggregateCommand(e):(0,n.encodeInternalDataType)(e):(0,s.isObject)(e)?this.encodeObject(e):(0,s.isArray)(e)?e.map(function(e){return t.encodeAny(e)}):e},e.prototype.encodeObject=function(e){var t={};for(var r in e)t[r]=this.encodeAny(e[r]);return t},e.prototype.encodePipeline=function(e){var t=this;return e._stages.map(function(e){return t.encodeAny(e)})},e.prototype.encodePipelineStage=function(e){var t,r,n="$".concat(e.stage);switch(e.stage){case"match":return(t={})[n]=u.QuerySerializer.encode(e.val),t;default:return(r={})[n]=this.encodeAny(e.val),r}},e.prototype.encodeAggregateCommand=function(e){var t;return(t={})[(0,a.aggregateOperatorToString)(e.operator)]=this.encodeAny(e.operands[0]),t},e}()},"./src/services/database/internal/grammar/default/serializer/common.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.decodeInternalDataType=t.encodeInternalDataType=t.isConversionRequired=t.mergeConditionAfterEncode=t.flattenObject=t.flattenQueryObject=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/error.ts"),o=r("./src/config/error.config.ts"),s=r("./src/utils/type.ts"),a=r("./src/services/database/internal/grammar/default/serializer/datatype.ts");function u(e,t,r,a){var c=n.__assign({},e);for(var l in e)if(!/^\$/.test(l)){var d=e[l];if(d&&(0,s.isObject)(d)&&!t(d)){if(a.indexOf(d)>-1)throw new i.CloudSDKError({errCode:o.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});var f=u(d,t,n.__spreadArray(n.__spreadArray([],n.__read(r),!1),[l],!1),n.__spreadArray(n.__spreadArray([],n.__read(a),!1),[d],!1));c[l]=f;var p=!1;for(var _ in f)/^\$/.test(_)?p=!0:(c["".concat(l,".").concat(_)]=f[_],delete c[l][_]);p||delete c[l]}}return c}function c(e){return(0,s.isInternalObject)(e)||(0,s.isDate)(e)||(0,s.isRegExp)(e)}t.flattenQueryObject=function(e){return u(e,c,[],[e])},t.flattenObject=function(e){return u(e,function(e){return!1},[],[e])},t.mergeConditionAfterEncode=function(e,t,r){for(var n in t[r]||delete e[r],t)e[n]?(0,s.isArray)(e[n])?e[n].push(t[n]):(0,s.isObject)(e[n])?(0,s.isObject)(t[n])?Object.assign(e[n],t[n]):(console.warn("unmergable condition, query is object but condition is ".concat((0,s.getType)(t),", can only overwrite"),t,r),e[n]=t[n]):(console.warn("to-merge query is of type ".concat((0,s.getType)(e),", can only overwrite"),e,t,r),e[n]=t[n]):e[n]=t[n]},t.isConversionRequired=c,t.encodeInternalDataType=function(e){return(0,a.serialize)(e)},t.decodeInternalDataType=function(e){return(0,a.deserialize)(e)}},"./src/services/database/internal/grammar/default/serializer/datatype.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.deserialize=t.serialize=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/services/database/api/database/helper/symbol.ts"),o=r("./src/utils/type.ts"),s=r("./src/services/database/api/database/date.ts"),a=r("./src/utils/error.ts"),u=r("./src/config/error.config.ts"),c=r("./src/services/database/api/database/helper/geojson.ts");t.serialize=function(e){return function e(t,r){if(!(0,o.isInternalObject)(t)){if((0,o.isDate)(t))return{$date:+t};if((0,o.isRegExp)(t))return{$regex:t.source,$options:t.flags};if((0,o.isArray)(t))return t.map(function(t){if(r.indexOf(t)>-1)throw new a.CloudSDKError({errCode:u.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});return e(t,n.__spreadArray(n.__spreadArray([],n.__read(r),!1),[t],!1))});if((0,o.isObject)(t)){var s=n.__assign({},t);for(var c in s){if(r.indexOf(s[c])>-1)throw new a.CloudSDKError({errCode:u.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});s[c]=e(s[c],n.__spreadArray(n.__spreadArray([],n.__read(r),!1),[s[c]],!1))}return s}return t}switch(t._internalType){case i.SYMBOL_GEO_POINT:case i.SYMBOL_GEO_MULTIPOINT:case i.SYMBOL_GEO_LINESTRING:case i.SYMBOL_GEO_MULTILINESTRING:case i.SYMBOL_GEO_POLYGON:case i.SYMBOL_GEO_MULTIPOLYGON:return t.toJSON();case i.SYMBOL_SERVER_DATE:return{$date:t.options};case i.SYMBOL_REGEXP:return{$regex:t.regexp,$options:t.options};default:return t.toJSON?t.toJSON():t}}(e,[e])},t.deserialize=function(e){var t=n.__assign({},e);for(var r in t)switch(r){case"$date":switch((0,o.getType)(t[r])){case"number":return new Date(t[r]);case"object":return(0,s.serverDate)(t[r])}break;case"type":switch(t.coordinates,t.type){case"Point":if((0,c.isGeoJSONPoint)(t))return(0,c.toPoint)(t);break;case"MultiPoint":if((0,c.isGeoJSONMultiPoint)(t))return(0,c.toMultiPoint)(t);break;case"LineString":if((0,c.isGeoJSONLineString)(t))return(0,c.toLineString)(t);break;case"MultiLineString":if((0,c.isGeoJSONMultiLineString)(t))return(0,c.toMultiLineString)(t);break;case"Polygon":if((0,c.isGeoJSONPolygon)(t))return(0,c.toPolygon)(t);break;case"MultiPolygon":if((0,c.isGeoJSONMultiPolygon)(t))return(0,c.toMultiPolygon)(t)}}return e}},"./src/services/database/internal/grammar/default/serializer/decoder.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Decoder=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/type.ts"),o=r("./src/services/database/internal/grammar/default/serializer/common.ts"),s=function(){function e(){}return e.decode=function(t){return(new e).decodeData(t)},e.prototype.decodeData=function(e){var t=this;switch((0,i.getType)(e)){case"object":return this.decodeObject(e);case"array":return e.map(function(e){if((0,i.isObject)(e)){var r=(0,o.decodeInternalDataType)(e);return r!==e?r:t.decodeObject(e)}return e});default:return e}},e.prototype.decodeObject=function(e){var t=n.__assign({},e);for(var r in t){var s=t[r];switch((0,i.getType)(s)){case"object":var a=(0,o.decodeInternalDataType)(s);t[r]=a!==s?a:this.decodeObject(t[r]);break;case"array":(a=this.decodeData(s))!==s&&(t[r]=a);break;default:continue}}return t},e}();t.Decoder=s},"./src/services/database/internal/grammar/default/serializer/projection.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectionSerializer=void 0;var n=r("./src/services/database/api/database/commands/projection.ts"),i=r("./src/utils/type.ts"),o=r("./src/services/database/internal/grammar/default/operator-map.ts"),s=r("./src/services/database/internal/grammar/default/serializer/common.ts"),a=function(){function e(){}return e.encode=function(t){return(new e).encodeProjection(t)},e.prototype.encodeProjection=function(e){return(0,n.isProjectionCommand)(e)?this.encodeProjectionCommand(e):"object"===(0,i.getType)(e)?this.encodeProjectionObject(e):e},e.prototype.encodeProjectionCommand=function(e){var t,r=(0,o.operatorToString)(e.operator);switch(e.operator){case n.PROJECTION_COMMANDS_LITERAL.SLICE:default:return(t={})[r]=e.operands[0],t}},e.prototype.encodeProjectionObject=function(e){var t=(0,s.flattenQueryObject)(e);for(var r in t)!0===t[r]||1===t[r]?t[r]=1:!1===t[r]||0===t[r]?t[r]=0:(0,n.isProjectionCommand)(t[r])?t[r]=this.encodeProjectionCommand(t[r]):delete t[r];return t},e}();t.ProjectionSerializer=a},"./src/services/database/internal/grammar/default/serializer/query.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.QuerySerializer=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/type.ts"),o=r("./src/services/database/api/database/commands/logic.ts"),s=r("./src/services/database/api/database/commands/query.ts"),a=r("./src/services/database/internal/grammar/default/operator-map.ts"),u=r("./src/services/database/internal/grammar/default/serializer/common.ts"),c=r("./src/services/database/internal/grammar/default/serializer/aggregate.ts"),l=r("./src/services/database/api/database/aggregate.ts"),d=r("./src/services/database/api/database/commands/aggregate.ts"),f=function(){function e(){}return e.encode=function(e){return(0,t.encode)(e)},e}();t.QuerySerializer=f;t.encode=function(e){return(0,o.isLogicCommand)(e)?_(e):(0,s.isQueryCommand)(e)?h(e):(0,l.isPipeline)(e)||(0,d.isAggregateCommand)(e)||(0,l.isPipelineStage)(e)?c.AggregateSerializer.encode(e):(0,i.isObject)(e)?p(e):(0,u.encodeInternalDataType)(e)};var p=function(e){var r,n=(0,u.flattenQueryObject)(e),i=[],c=((r={})[o.LOGIC_COMMANDS_LITERAL.OR]=0,r[o.LOGIC_COMMANDS_LITERAL.NOR]=0,r[o.LOGIC_COMMANDS_LITERAL.AND]=0,r[o.LOGIC_COMMANDS_LITERAL.NOT]=0,r),l=function(e){var r,l,d,f,p,E=n[e];if((0,o.isLogicCommand)(E))switch(E.operator){case o.LOGIC_COMMANDS_LITERAL.OR:case o.LOGIC_COMMANDS_LITERAL.NOR:case o.LOGIC_COMMANDS_LITERAL.AND:c[E.operator]++,i.push(((r={})[(0,a.operatorToString)(E.operator)]=E.operands.map(function(r){var n;return(0,t.encode)(((n={})[e]=r,n))}),r));break;case o.LOGIC_COMMANDS_LITERAL.NOT:var m=E.operands[0];if((0,o.isLogicCommand)(m))switch(m.operator){case o.LOGIC_COMMANDS_LITERAL.AND:c[o.LOGIC_COMMANDS_LITERAL.OR]++,i.push(_(new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.OR,m.operands.map(function(t){var r;return(r={})[e]=new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.NOT,[t]),r}))));break;case o.LOGIC_COMMANDS_LITERAL.OR:c[o.LOGIC_COMMANDS_LITERAL.NOR]++,i.push(_(new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.NOR,m.operands.map(function(t){var r;return(r={})[e]=t,r}))));break;case o.LOGIC_COMMANDS_LITERAL.NOR:c[o.LOGIC_COMMANDS_LITERAL.OR]++,i.push(_(new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.OR,m.operands.map(function(t){var r;return(r={})[e]=t,r}))));break;case o.LOGIC_COMMANDS_LITERAL.NOT:i.push((0,t.encode)(((l={})[e]=m.operands[0],l)))}else i.push(((d={})[e]=_(E),d))}else(0,s.isQueryCommand)(E)?i.push(((f={})[e]=h(E),f)):i.push(((p={})[e]=(0,u.encodeInternalDataType)(E),p))};for(var d in n)l(d);return E(i)},_=function(e){var r,i,u,c,l,d;switch(e.operator){case o.LOGIC_COMMANDS_LITERAL.AND:if(e.operands.every(function(e){return(0,s.isQueryCommand)(e)})){var f={};try{for(var p=n.__values(e.operands),_=p.next();!_.done;_=p.next()){var E=_.value;Object.assign(f,h(E))}}catch(e){r={error:e}}finally{try{_&&!_.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}return f}var m=(0,a.operatorToString)(e.operator),g=e.operands.map(t.encode);return(u={})[m]=g,u;case o.LOGIC_COMMANDS_LITERAL.OR:case o.LOGIC_COMMANDS_LITERAL.NOR:m=(0,a.operatorToString)(e.operator),g=e.operands.map(t.encode);return(c={})[m]=g,c;case o.LOGIC_COMMANDS_LITERAL.NOT:m=(0,a.operatorToString)(e.operator),E=e.operands[0];return(l={})[m]=(0,t.encode)(E),l;default:m=(0,a.operatorToString)(e.operator),g=e.operands.map(t.encode);return(d={})[m]=g,d}},h=function(e){var r,n,i,o,c,l,d,f,p=(0,a.operatorToString)(e.operator);switch(e.operator){case s.QUERY_COMMANDS_LITERAL.EQ:case s.QUERY_COMMANDS_LITERAL.NEQ:case s.QUERY_COMMANDS_LITERAL.LT:case s.QUERY_COMMANDS_LITERAL.LTE:case s.QUERY_COMMANDS_LITERAL.GT:case s.QUERY_COMMANDS_LITERAL.GTE:case s.QUERY_COMMANDS_LITERAL.EXISTS:case s.QUERY_COMMANDS_LITERAL.SIZE:return(r={})[p]=(0,u.encodeInternalDataType)(e.operands[0]),r;case s.QUERY_COMMANDS_LITERAL.IN:case s.QUERY_COMMANDS_LITERAL.NIN:case s.QUERY_COMMANDS_LITERAL.MOD:return(n={})[p]=(0,u.encodeInternalDataType)(e.operands),n;case s.QUERY_COMMANDS_LITERAL.ALL:return(i={})[p]=e.operands.map(t.encode),i;case s.QUERY_COMMANDS_LITERAL.ELEM_MATCH:case s.QUERY_COMMANDS_LITERAL.EXPR:return(o={})[p]=(0,t.encode)(e.operands[0]),o;case s.QUERY_COMMANDS_LITERAL.GEO_NEAR:return(c={})[p]={$geometry:(0,u.encodeInternalDataType)(e.operands[0].geometry),$maxDistance:e.operands[0].maxDistance,$minDistance:e.operands[0].minDistance},c;case s.QUERY_COMMANDS_LITERAL.GEO_WITHIN:var _={};return e.operands[0].geometry&&(_.$geometry=(0,u.encodeInternalDataType)(e.operands[0].geometry)),e.operands[0].centerSphere&&(_.$centerSphere=(0,u.encodeInternalDataType)(e.operands[0].centerSphere)),(l={})[p]=_,l;case s.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS:return(d={})[p]={$geometry:(0,u.encodeInternalDataType)(e.operands[0].geometry)},d;default:return(f={})[p]=e.operands.length>1?e.operands.map(t.encode):(0,t.encode)(e.operands[0]),f}},E=function(e){var t,r,i,o,s={$and:0,$or:0,$nor:0};try{for(var a=n.__values(e),u=a.next();!u.done;u=a.next()){(_=u.value).$and&&s.$and++,_.$or&&s.$or++,_.$nor&&s.$nor++}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}var c=s.$and>1||s.$or>1||s.$nor>1,l=!1,d={};try{for(var f=n.__values(e),p=f.next();!p.done;p=f.next()){var _=p.value;for(var h in _){var E=_[h];c?l?d.$and.push(_):"$and"===h||"$or"===h||"$nor"===h?(l=!0,d.$and=[_]):d[h]=E:d[h]=E}}}catch(e){i={error:e}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}return d}},"./src/services/database/internal/grammar/default/serializer/update.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateSerializer=void 0;var n=r("./src/utils/type.ts"),i=r("./src/services/database/api/database/commands/update.ts"),o=r("./src/services/database/internal/grammar/default/operator-map.ts"),s=r("./src/services/database/internal/grammar/default/serializer/common.ts"),a=r("./src/services/database/internal/grammar/default/serializer/query.ts"),u=function(){function e(){}return e.encode=function(e){return c(e)},e}();t.UpdateSerializer=u;var c=function(e){return l(e)},l=function(e){var t=(0,s.flattenQueryObject)(e),r={};for(var u in t){var c=t[u];if((0,i.isUpdateCommand)(c)){var l=(0,o.operatorToString)(c.operator);switch(r[l]||(r[l]={}),c.operator){case i.UPDATE_COMMANDS_LITERAL.SET:case i.UPDATE_COMMANDS_LITERAL.INC:case i.UPDATE_COMMANDS_LITERAL.MUL:case i.UPDATE_COMMANDS_LITERAL.MIN:case i.UPDATE_COMMANDS_LITERAL.MAX:case i.UPDATE_COMMANDS_LITERAL.RENAME:case i.UPDATE_COMMANDS_LITERAL.BIT:r[l][u]=(0,s.encodeInternalDataType)(c.operands[0]);break;case i.UPDATE_COMMANDS_LITERAL.REMOVE:r[l][u]="";break;case i.UPDATE_COMMANDS_LITERAL.PUSH:var d=void 0;d=1===c.operands.length&&(0,n.isObject)(c.operands[0])?{$each:c.operands[0].each.map(s.encodeInternalDataType),$position:c.operands[0].position,$slice:c.operands[0].slice,$sort:c.operands[0].sort}:{$each:c.operands.map(s.encodeInternalDataType)},r[l][u]=d;break;case i.UPDATE_COMMANDS_LITERAL.UNSHIFT:d={$each:c.operands.map(s.encodeInternalDataType),$position:0};r[l][u]=d;break;case i.UPDATE_COMMANDS_LITERAL.POP:r[l][u]=1;break;case i.UPDATE_COMMANDS_LITERAL.SHIFT:r[l][u]=-1;break;case i.UPDATE_COMMANDS_LITERAL.ADD_TO_SET:r[l][u]=(0,n.isObject)(c.operands[0])&&c.operands[0].each?{$each:c.operands[0].each}:c.operands[0];break;case i.UPDATE_COMMANDS_LITERAL.PULL:r[l][u]=a.QuerySerializer.encode(c.operands[0]);break;case i.UPDATE_COMMANDS_LITERAL.PULL_ALL:default:r[l][u]=(0,s.encodeInternalDataType)(c.operands[0])}}else r.$set||(r.$set={}),r.$set[u]=(0,s.encodeInternalDataType)(c)}return r}},"./src/services/database/internal/grammar/engine.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getEngine=t.ENGINES=void 0;var n,i=r("./src/services/database/internal/grammar/default/index.ts");!function(e){e[e.DEFAULT=0]="DEFAULT"}(n=t.ENGINES||(t.ENGINES={})),t.getEngine=function(e){return void 0===e&&(e=n.DEFAULT),i}},"./src/services/functions/api/api.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r("./src/services/functions/api/callFunction.ts");t.getAPIs=function(e){return{callFunction:(0,n.default)(e)}}},"./src/services/functions/api/callFunction.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.API_NAME_V2=t.API_NAME=t.ResultStatus=t.SlowCallScene=t.SlowCallAction=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/hook/invoke.ts"),o=r("./src/utils/assert.ts"),s=r("./src/utils/error.ts"),a=r("./src/utils/fail-safe.ts"),u=r("./src/utils/fn/clone.ts"),c=r("./src/utils/report.ts"),l=r("./src/services/functions/api/callFunction/sync.ts"),d=r("./src/services/functions/api/callFunction/slow.ts"),f=r("./src/services/functions/api/callFunction/slow.v2.ts"),p=r("./src/utils/serializer.ts"),_=r("./src/utils/cdn.ts"),h=r("./src/externals/globals/devtools.ts"),E=r("./src/externals/globals/wxconfig.ts");!function(e){e[e.CALL=1]="CALL",e[e.POLL=2]="POLL"}(t.SlowCallAction||(t.SlowCallAction={})),function(e){e[e.INITIATE_CALL=1]="INITIATE_CALL",e[e.NORMAL_POLL_RETRY=2]="NORMAL_POLL_RETRY",e[e.SYSTEM_ERROR_RETRY=3]="SYSTEM_ERROR_RETRY",e[e.TIMEOUT_RETRY=4]="TIMEOUT_RETRY"}(t.SlowCallScene||(t.SlowCallScene={})),function(e){e[e.PENDING=0]="PENDING",e[e.DONE=1]="DONE",e[e.TIMEOUT=2]="TIMEOUT"}(t.ResultStatus||(t.ResultStatus={})),t.API_NAME="cloud.callFunction",t.API_NAME_V2="cloud.callFunction_real_v2",t.default=function(e){var r,m,g;return function(e){var r=+new Date;(0,o.assertType)(e,"object");var n=(0,u.shallowClone)(e);return n.data||(n.data={}),n.context={tunnelTimeNoCSNetCost:0,funcName:e.name},n.context.apiStartTime=r,(0,i.hasAPICallback)(n)?function(e){(0,a.wrapParamCallbacksWithTryCatch)({apiName:t.API_NAME,param:e}),v(e).then(function(r){(0,i.invokeSuccessCompleteCallbacks)(t.API_NAME,e,r)}).catch(function(r){(0,i.invokeFailCompleteCallbacks)(t.API_NAME,e,r)})}(n):v(n)};function v(i){return n.__awaiter(this,void 0,void 0,function(){function a(){return 1===i.version}var u,v,S;return n.__generator(this,function(y){switch(y.label){case 0:return y.trys.push([0,5,6,7]),function(e){(0,o.assertType)(e,{name:"string"}),e.data&&(0,o.assertType)(e.data,"object"),e.config&&e.config.env&&(0,o.assertType)(e.config.env,"string")}(i),i.cdnMapPromise=_.collect(i.data),u=void 0,u=a()?(r||(r=(0,d.default)(e)),r)(i):(m||(m=(0,f.default)(e)),m)(i),(0,E.isDevTools)()&&(v=Date.now(),(0,h.autoDevtoolsNetworkLog)(u,function(){var t;return{url:"wx.cloud.callFunction.".concat(i.name),headers:{Env:e.isInstance?e.env:(null===(t=i.config)||void 0===t?void 0:t.env)||e.env},reqBody:(0,p.serialize)(i.data),timestampMs:v,console:e.debug}})),[4,u];case 1:return[2,y.sent()];case 2:return[4,(g||(g=(0,l.default)(e)),g)(i)];case 3:return[2,y.sent()];case 4:return[3,7];case 5:throw S=y.sent(),(0,s.returnAsFinalCloudSDKError)(S,t.API_NAME);case 6:return(0,c.reportAPISpeed)(n.__assign(n.__assign({},i.context),{apiEndTime:+new Date,apiName:a()?t.API_NAME:t.API_NAME_V2})),[7];case 7:return[2]}})})}}},"./src/services/functions/api/callFunction/slow.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/config/error.config.ts"),o=r("./src/externals/public-lib/appserviceSdk.ts"),s=r("./src/utils/assert.ts"),a=r("./src/utils/error.ts"),u=r("./src/utils/msg.ts"),c=r("./src/utils/serializer.ts"),l=r("./src/services/functions/utils/extract.ts"),d=r("./src/services/functions/api/callFunction.ts");t.default=function(e){return function(t){return n.__awaiter(this,void 0,void 0,function(){function r(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){return[2,new Promise(function(r,s){!function t(r,s,u,l){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return(0,o.getSDK)(e.identifiers).request({url:r,success:function(e){try{if(200!==e.statusCode)return l((0,a.returnAsFinalCloudSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_STATUS_CODE_ERROR,errMsg:"polling status code ".concat(e.statusCode)},d.API_NAME));var n=e.data;if(!n)return l((0,a.returnAsFinalCloudSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON,errMsg:i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON]},d.API_NAME));if(n.base_resp&&0===n.base_resp.ret){if(0!==n.status){if(1===n.status){if(0!==n.service_errcode){var o=(0,a.returnAsFinalCloudSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR,errMsg:"requestID ".concat(n.func_req_id,", cloud function service error code ").concat(n.service_errcode||"unknown",", error message ").concat(n.service_errmsg||"unknown")},d.API_NAME);return o.requestID=n.func_req_id,l(o)}var f=n.content;try{f=(0,c.deserialize)(f)}catch(e){try{f=JSON.parse(f)}catch(e){}}return u({result:f,requestID:n.func_req_id})}return l((0,a.returnAsFinalCloudSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_EXPIRED,errMsg:"timeout for result fetching"},d.API_NAME))}if(!(s>=0))return l((0,a.returnAsFinalCloudSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY,errMsg:i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY]},d.API_NAME));t(r,s-1,u,l)}else{if(!n.base_resp)return l((0,a.returnAsFinalCloudSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP,errMsg:i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP]},d.API_NAME));if(0!==n.base_resp.ret)return l((0,a.returnAsFinalCloudSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL,errMsg:"polling base_resp.ret ".concat(n.base_resp.ret)},d.API_NAME))}}catch(e){l((0,a.returnAsFinalCloudSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_ERROR,errMsg:"polling catch error: ".concat(e)},d.API_NAME))}},fail:function(e){l((0,a.returnAsFinalCloudSDKError)(e,d.API_NAME))}}),[2]})})}(t,e.appConfig.maxPollRetry||50,r,s)})]})})}var f,p,_,h,E,m,g,v,S,y,T,A,b,C,O,I;return n.__generator(this,function(o){switch(o.label){case 0:if(f=n.__assign({},t.data),(p=(0,l.extractCloudID)(f).map(function(e){return{key_name:e.key,cloud_id:e.cloudID}})).length)try{for(_=n.__values(p),h=_.next();!h.done;h=_.next())E=h.value,delete f[E.key_name]}catch(e){O={error:e}}finally{try{h&&!h.done&&(I=_.return)&&I.call(_)}finally{if(O)throw O.error}}return[4,t.cdnMapPromise];case 1:return m=o.sent(),g=(0,c.serialize)(f,m),(0,s.assertStringLength)({input:g,max:e.appConfig.maxReqDataSize,name:"callFunction data",maxWording:"".concat(e.appConfig.maxReqDataSize/1024," KB")}),v={function_name:t.name,data:g,cloudid_list:p},S=(0,c.serialize)(v),t.context.tunnelStartTime=+new Date,[4,e.request(n.__assign(n.__assign({},t.config),{apiName:"tcbapi_slowcallfunction",serviceName:e.name,serializedReqData:S,env:t.config&&t.config.env||e.env}))];case 2:if(y=o.sent(),t.context.tunnelEndTime=+new Date,!(T=y.data))throw(0,a.returnAsFinalCloudSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT,errMsg:i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT]},d.API_NAME);if(T.event_id,!T.poll_url)throw(0,a.returnAsFinalCloudSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_URL,errMsg:i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_URL]},d.API_NAME);return T.poll_url.indexOf("?")>-1?T.poll_url+="&devtools_ignore=true&skip_domain_check=true":T.poll_url+="?devtools_ignore=true&skip_domain_check=true",t.context.pollStartTime=+new Date,[4,r(T.poll_url)];case 3:return A=o.sent(),b=A.result,C=A.requestID,t.context.pollEndTime=+new Date,[2,{errMsg:(0,u.apiSuccessMsg)(d.API_NAME),result:b,requestID:C}]}})})}}},"./src/services/functions/api/callFunction/slow.v2.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/config/error.config.ts"),o=r("./src/utils/assert.ts"),s=r("./src/utils/error.ts"),a=r("./src/utils/msg.ts"),u=r("./src/utils/serializer.ts"),c=r("./src/services/functions/utils/extract.ts"),l=r("./src/utils/utils.ts"),d=r("./src/externals/globals/wxconfig.ts"),f=r("./src/services/functions/api/callFunction.ts"),p=20,_=2,h=2,E=2e4,m=function(e){var t=new Date;return"".concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds()," ").concat(e)},g=function(e){return e.join("->")};t.default=function(e){return function(t){return n.__awaiter(this,void 0,void 0,function(){function r(t,r,i,o){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return[2,new Promise(function(n,s){var a=[m("start")],u=function(e,t,r){var n=function(t){e.push(m("app ".concat(t)))};return(0,l.onAppVisibilityChange)(n),{resolve:function(e){(0,l.offAppVisibilityChange)(n),t(e)},reject:function(e){(0,l.offAppVisibilityChange)(n),r(e)}}}(a,n,s),c=u.resolve,d=u.reject;v({param:t,functionName:t.name,data:r,cloudIDList:i,callID:o,action:f.SlowCallAction.CALL,scene:f.SlowCallScene.INITIATE_CALL,tryCount:e.appConfig.maxPollRetry||p,systemErrorRetry:_,timeoutErrorRetry:h,trace:a,resolve:c,reject:d})})]})})}function v(r){return n.__awaiter(this,void 0,void 0,function(){function o(e){try{if(N)return;L(),U(e);var t=e.data;if(!t)return T.push(m("empty resp")),O((0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT},f.API_NAME));if(!t.baseresponse||0!==t.baseresponse.errcode)return t.baseresponse?0!==t.baseresponse.errcode?O((0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL,errMsg:"polling base_resp.errcode ".concat(t.baseresponse.errcode," errmsg ").concat(t.baseresponse.errmsg," (callId: ").concat(p,")")},f.API_NAME)):O((0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP,errMsg:"polling base_resp ".concat(JSON.stringify(t.baseresponse)," (callId: ").concat(p,")")},f.API_NAME)):O((0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP},f.API_NAME));if(0!==t.status){if(1===t.status){if(0!==t.service_errcode){if(t.service_errcode===i.ERR_CODE.TCB_FUNCTIONS_EXEC_FAIL){var o=t.service_errmsg||"";try{for(var a=o.split("\n"),c=[],l=0;l<a.length;l++)a[l].startsWith("Error: ")&&c.push([a[l],l]);if(c.length%2==1){var d=c[Math.floor(c.length/2)][1];o=a.slice(d).join("\n")}}catch(e){}return(_=(0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR,errMsg:"\n(error stack)(".concat(t.func_request_id?"requestId ".concat(t.func_request_id,", "):"","callid ").concat(p,"):\n").concat(o)},f.API_NAME)).stack="Error: ".concat(_.message),_.requestID=t.func_request_id,O(_)}var _;return(_=(0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR,errMsg:"\n(".concat(t.func_request_id?"requestId ".concat(t.func_request_id,", "):"","callid ").concat(p,"):\n").concat(t.service_errcode," ").concat(t.service_errmsg)},f.API_NAME)).stack="Error: ".concat(_.message),_.requestID=t.func_request_id,O(_)}var h=t.data;try{h=(0,u.deserialize)(h)}catch(e){try{h=JSON.parse(h)}catch(e){}}return C({result:h,requestID:t.func_request_id})}return T.push(m("poll result expired")),O((0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_EXPIRED,errMsg:"timeout for result fetching, result cannot be fetched anymore (callId: ".concat(p,") (trace: ").concat(g(T),")")},f.API_NAME))}if(!(S>=0))return T.push(m("too many polls, abort")),O((0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY,errMsg:"(callId: ".concat(p,") (trace: ").concat(g(T),")")},f.API_NAME));T.push(m("normal poll")),v(n.__assign(n.__assign({},r),{action:f.SlowCallAction.POLL,scene:f.SlowCallScene.NORMAL_POLL_RETRY,tryCount:S-1}))}catch(e){O((0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_ERROR,errMsg:"polling catch error: ".concat(e," (callId: ").concat(p,")")},f.API_NAME))}}var a,c,p,_,h,S,T,A,b,C,O,I,R,w,N,D,L,M,P,U,x=this;return n.__generator(this,function(B){return a=r.functionName,c=r.data,p=r.callID,_=r.action,h=r.scene,S=r.tryCount,T=r.trace,A=r.systemErrorRetry,b=r.timeoutErrorRetry,C=r.resolve,O=r.reject,I=_===f.SlowCallAction.CALL&&(0,d.isDevTools)()?t.localDebugNoTimeout:void 0,R={function_name:a,data:_===f.SlowCallAction.CALL?c:void 0,action:_,scene:h,call_id:p,cloudid_list:_===f.SlowCallAction.CALL?y:[],local_debug_no_timeout:I},w=(0,u.serialize)(R),N=!1,D=!1,L=function(){clearTimeout(P),D=!0},M=+new Date,P=I?void 0:setTimeout(function(){return n.__awaiter(x,void 0,void 0,function(){var t;return n.__generator(this,function(o){switch(o.label){case 0:return t=e.appConfig.clientPollTimeout||E,+new Date-M>t?[4,(0,l.sleep)()]:[3,2];case 1:if(o.sent(),D)return[2];o.label=2;case 2:return!(0,d.isDevTools)()&&+new Date-M>e.appConfig.maxStartRetryGap?(T.push(m("timeout, exceed max retry gap")),[2,O((0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_EXPIRED,errMsg:"timeout for retry, cannot retry fetching the result anymore (callId: ".concat(p,") (trace: ").concat(g(T),")")},f.API_NAME))]):(N=!0,r.timeoutErrorRetry>0?(T.push(m("timeout, retry")),v(n.__assign(n.__assign({},r),{scene:f.SlowCallScene.TIMEOUT_RETRY,tryCount:S-1,timeoutErrorRetry:b-1}))):(T.push(m("timeout, abort")),O((0,s.toSDKError)({errCode:i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_TIMEOUT_POLL_RETRY,errMsg:"(callId: ".concat(p,") (trace: ").concat(g(T),")")},f.API_NAME))),[2])}})})},e.appConfig.clientPollTimeout||E),U=function(e){var r,n=e.data;n&&n.baseresponse&&n.baseresponse.stat&&(n.baseresponse.stat.qbase_cost_time&&(t.context.tunnelTimeNoCSNetCost+=n.baseresponse.stat.qbase_cost_time),n.baseresponse.stat.func_exec_cost_time&&(t.context.funcExecTime=n.baseresponse.stat.func_exec_cost_time)),t.context.channelType=null!==(r=e.channelType)&&void 0!==r?r:0,e.profile&&(null===l._wxConsole||void 0===l._wxConsole||l._wxConsole.log("callFunction profile",e.profile))},e.request(n.__assign(n.__assign({},t.config),{apiName:"tcbapi_slowcallfunction_v2",serviceName:e.name,serializedReqData:w,env:t.config&&t.config.env||e.env,stdpriv:!0})).then(o).catch(function(e){N||(L(),e&&e.operateWXDataFail&&A>0?(T.push(m("system error (".concat(e,"), retry"))),v(n.__assign(n.__assign({},r),{scene:f.SlowCallScene.SYSTEM_ERROR_RETRY,tryCount:S-1,systemErrorRetry:A-1}))):(T.push(m("system error (".concat(e,"), abort"))),O((0,s.toSDKError)("".concat(e," (callId: ").concat(p,") (trace: ").concat(g(T),")"),f.API_NAME))))}),[2]})})}var S,y,T,A,b,C,O,I,R,w,N,D,L;return n.__generator(this,function(i){switch(i.label){case 0:if(S=n.__assign({},t.data),(y=(0,c.extractCloudID)(S).map(function(e){return{key_name:e.key,cloud_id:e.cloudID}})).length)try{for(T=n.__values(y),A=T.next();!A.done;A=T.next())b=A.value,delete S[b.key_name]}catch(e){D={error:e}}finally{try{A&&!A.done&&(L=T.return)&&L.call(T)}finally{if(D)throw D.error}}return[4,t.cdnMapPromise];case 1:return C=i.sent(),O=(0,u.serialize)(S,C),(0,o.assertStringLength)({input:O,max:e.appConfig.maxReqDataSize,name:"callFunction data",maxWording:"".concat(e.appConfig.maxReqDataSize/1024," KB")}),I="".concat(+new Date,"-").concat(Math.random()),t.context.tunnelStartTime=+new Date,[4,r(t,O,y,I)];case 2:return R=i.sent(),w=R.result,N=R.requestID,t.context.tunnelEndTime=+new Date,[2,{errMsg:(0,a.apiSuccessMsg)(f.API_NAME),result:w,requestID:N}]}})})}}},"./src/services/functions/api/callFunction/sync.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/msg.ts"),o=r("./src/utils/serializer.ts"),s=r("./src/services/functions/api/callFunction.ts");t.default=function(e){return function(t){return n.__awaiter(this,void 0,void 0,function(){var r,a,u,c,l;return n.__generator(this,function(n){switch(n.label){case 0:return r={function_name:t.name,data:(0,o.serialize)(t.data),cloudid_list:[]},a=(0,o.serialize)(r),[4,e.request({apiName:"tcbapi_callfunction",serviceName:e.name,serializedReqData:a,env:t.config&&t.config.env||e.env})];case 1:if(u=n.sent(),c=u.data,l=c&&c.data)try{l=JSON.parse(l)}catch(e){}return[2,{errMsg:(0,i.apiSuccessMsg)(s.API_NAME),result:l}]}})})}}},"./src/services/functions/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerService=t.FUNCTIONS_SERVICE_NAME=void 0;var n=r("./src/services/functions/api/api.ts");t.FUNCTIONS_SERVICE_NAME="functions",t.registerService=function(e){e.registerService(function(e){var r={name:t.FUNCTIONS_SERVICE_NAME,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get debug(){return e.debug},get env(){return e.getEnvForService(t.FUNCTIONS_SERVICE_NAME)},appConfig:{get maxReqDataSize(){return e.appConfig.call_function_max_req_data_size},get maxPollRetry(){return e.appConfig.call_function_poll_max_retry},get maxStartRetryGap(){return e.appConfig.call_function_valid_start_retry_gap},get clientPollTimeout(){return e.appConfig.call_function_client_poll_timeout}}};return{name:t.FUNCTIONS_SERVICE_NAME,context:r,getAPIs:n.getAPIs.bind(null,r)}}(e))}},"./src/services/functions/utils/extract.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.extractCloudID=void 0;var n=r("./src/utils/symbol.ts"),i=r("./src/utils/type.ts");t.extractCloudID=function(e){var t=[];for(var r in e)(0,i.isObject)(e[r])&&e[r]._internalType===n.SYMBOL_CLOUD_ID&&t.push({key:r,cloudID:e[r].cloudID});return t}},"./src/services/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerServices=void 0;var n=r("./src/services/functions/index.ts"),i=r("./src/services/container/index.ts"),o=r("./src/services/storage/index.ts"),s=r("./src/services/database/index.ts"),a=r("./src/services/utils/index.ts");t.registerServices=function(e){(0,n.registerService)(e),(0,o.registerService)(e),(0,s.registerService)(e),(0,a.registerService)(e),(0,i.registerService)(e)}},"./src/services/storage/api/api.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r("./src/services/storage/api/uploadFile.ts"),i=r("./src/services/storage/api/downloadFile.ts"),o=r("./src/services/storage/api/getTempFileURL.ts"),s=r("./src/services/storage/api/deleteFile.ts");t.getAPIs=function(e){return{uploadFile:(0,n.default)(e),downloadFile:(0,i.default)(e),getTempFileURL:(0,o.default)(e),deleteFile:(0,s.default)(e)}}},"./src/services/storage/api/deleteFile.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/assert.ts"),o=r("./src/utils/error.ts"),s=r("./src/hook/invoke.ts"),a=r("./src/utils/msg.ts"),u=r("./src/utils/fn/clone.ts"),c=r("./src/utils/report.ts"),l=r("./src/config/error.config.ts"),d="cloud.deleteFile";t.default=function(e){return function(e){var r=(0,u.shallowClone)(e);return r.timing={apiStartTime:+new Date},(0,s.hasAPICallback)(r)?function(e){t(e).then(function(t){(0,s.invokeSuccessCompleteCallbacks)(d,e,t)}).catch(function(t){(0,s.invokeFailCompleteCallbacks)(d,e,t)})}(r):t(r)};function t(t){return n.__awaiter(this,void 0,void 0,function(){var r;return n.__generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,3,4]),function(t){(0,i.assertType)(t,{fileList:"array"}),t.config&&t.config.env&&(0,i.assertType)(t.config.env,"string");for(var r=0,n=t.fileList.length;r<n;r++)(0,i.assertType)(t.fileList[r],"string","parameter.fileList[".concat(r,"]"));if(e.appConfig.getTempFileURLMaxReq&&t.fileList.length>e.appConfig.getTempFileURLMaxReq)throw new o.CloudSDKError({errCode:l.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"parameter.fileList exceed max length ".concat(e.appConfig.getTempFileURLMaxReq)})}(t),t.fileList.length?[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s;return n.__generator(this,function(n){switch(n.label){case 0:return r={fileid_list:t.fileList},i=JSON.stringify(r),t.timing.tunnelStartTime=+new Date,[4,e.request({apiName:"tcbapi_deletefile",serviceName:e.name,serializedReqData:i,env:t.config&&t.config.env||e.env})];case 1:return o=n.sent(),t.timing.tunnelEndTime=+new Date,s=o.data,t.timing.tunnelTimeNoCSNetCost=s.baseresponse.stat.qbase_cost_time,[2,{errMsg:(0,a.apiSuccessMsg)(d),fileList:s.delete_list.map(function(e){return{fileID:e.fileid,status:e.status,errMsg:e.errmsg}})}]}})})}(t)]:[2,{errMsg:(0,a.apiSuccessMsg)(d),fileList:[]}];case 1:return[2,s.sent()];case 2:throw r=s.sent(),(0,o.returnAsFinalCloudSDKError)(r,d);case 3:return(0,c.reportAPISpeed)(n.__assign(n.__assign({},t.timing),{apiEndTime:+new Date,apiName:d})),[7];case 4:return[2]}})})}}},"./src/services/storage/api/downloadFile.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/assert.ts"),o=r("./src/utils/type.ts"),s=r("./src/utils/fn/clone.ts"),a=r("./src/utils/error.ts"),u=r("./src/hook/invoke.ts"),c=r("./src/externals/public-lib/appserviceSdk.ts"),l=r("./src/utils/report.ts"),d=r("./src/config/error.config.ts"),f="cloud.downloadFile";t.default=function(e){return function(e){if(e=(0,s.shallowClone)(e),(0,u.hasAPICallback)(e))return function(e){var r={aborted:!1},i=function(e){return{onProgressUpdate:function(t){e.onProgressUpdateUserHandler=t},abort:function(){e.abort&&e.abort(),e.aborted=!0}}}(r),o={apiStartTime:+new Date};return t(n.__assign(n.__assign({},e),{context:r,timing:o,downloadTaskAgent:i})).then(function(t){(0,u.invokeSuccessCompleteCallbacks)(f,e,t)}).catch(function(t){(0,u.invokeFailCompleteCallbacks)(f,e,t)}),i}(e);var r={apiStartTime:+new Date};return t(n.__assign(n.__assign({},e),{timing:r}))};function t(t){return n.__awaiter(this,void 0,void 0,function(){var r=this;return n.__generator(this,function(s){return[2,new Promise(function(s,u){return n.__awaiter(r,void 0,void 0,function(){var r,p;return n.__generator(this,function(_){switch(_.label){case 0:return _.trys.push([0,2,3,4]),function(e){(0,i.assertType)(e,{fileID:"string"}),e.config&&e.config.env&&(0,i.assertType)(e.config.env,"string")}(t),t.context&&(t.context.abort=function(){u((0,a.returnAsFinalCloudSDKError)({errMsg:"abort"},f))},t.context.aborted)?[2,u((0,a.returnAsFinalCloudSDKError)({errMsg:"abort"},f))]:[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(s){switch(s.label){case 0:return r=(0,c.getSDK)(e.identifiers),[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s;return n.__generator(this,function(n){switch(n.label){case 0:return r=JSON.stringify({fileid:t.fileID}),i=+new Date,[4,e.request({apiName:"tcbapi_downloadfile",serviceName:e.name,serializedReqData:r,env:t.config&&t.config.env||e.env})];case 1:if(o=n.sent(),s=o.data,t.timing&&(t.timing.tunnelStartTime=i,t.timing.tunnelEndTime=+new Date,t.timing.tunnelTimeNoCSNetCost=s.baseresponse.stat.qbase_cost_time),!s.download_url)throw new a.CloudSDKError({errCode:d.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL,errMsg:d.ERR_CODE[d.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL]});return s.download_url.indexOf("?")>-1?s.download_url+="&skip_domain_check=true":s.download_url+="?skip_domain_check=true",[2,s.download_url]}})})}(t)];case 1:return i=s.sent(),[2,new Promise(function(e,n){if(t.context&&t.context.aborted)return n((0,a.returnAsFinalCloudSDKError)({errMsg:"abort"},f));var s=r.downloadFile({url:i,success:function(t){e(t)},fail:function(e){n(e)}});s&&(s.onProgressUpdate(function(){t.downloadTaskAgent&&t.context&&t.context.onProgressUpdateUserHandler&&(0,o.isFunction)(t.context.onProgressUpdateUserHandler)&&t.context.onProgressUpdateUserHandler.apply(r.downloadFile,arguments)}),t.context&&(t.context.abort=s.abort.bind(s)))})]}})})}(t)];case 1:return r=_.sent(),s(r),[3,4];case 2:return p=_.sent(),u((0,a.returnAsFinalCloudSDKError)(p,f)),[3,4];case 3:return(0,l.reportAPISpeed)(n.__assign(n.__assign({},t.timing),{apiEndTime:+new Date,apiName:f})),[7];case 4:return[2]}})})})]})})}}},"./src/services/storage/api/getTempFileURL.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/assert.ts"),o=r("./src/utils/error.ts"),s=r("./src/hook/invoke.ts"),a=r("./src/utils/msg.ts"),u=r("./src/utils/fn/clone.ts"),c=r("./src/utils/type.ts"),l=r("./src/utils/report.ts"),d=r("./src/config/error.config.ts"),f="cloud.getTempFileURL";t.default=function(e){return function(e){var r=(0,u.shallowClone)(e);return r.timing={apiStartTime:+new Date},(0,s.hasAPICallback)(r)?function(e){t(e).then(function(t){(0,s.invokeSuccessCompleteCallbacks)(f,e,t)}).catch(function(t){(0,s.invokeFailCompleteCallbacks)(f,e,t)})}(r):t(r)};function t(t){return n.__awaiter(this,void 0,void 0,function(){var r;return n.__generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,3,4]),function(t){if((0,i.assertType)(t,{fileList:"array"}),t.config&&t.config.env&&(0,i.assertType)(t.config.env,"string"),e.appConfig.getTempFileURLMaxReq&&t.fileList.length>e.appConfig.getTempFileURLMaxReq)throw new o.CloudSDKError({errCode:d.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"parameter.fileList exceed max length ".concat(e.appConfig.getTempFileURLMaxReq)})}(t),t.fileList.length?[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,s;return n.__generator(this,function(n){switch(n.label){case 0:return r={file_list:t.fileList.map(function(e){return(0,c.isString)(e)?{fileid:e}:{fileid:e.fileID,max_age:e.maxAge}})},i=JSON.stringify(r),t.timing.tunnelStartTime=+new Date,[4,e.request({apiName:"tcbapi_gettempfileurl",serviceName:e.name,serializedReqData:i,env:t.config&&t.config.env||e.env})];case 1:return o=n.sent(),t.timing.tunnelEndTime=+new Date,s=o.data,t.timing.tunnelTimeNoCSNetCost=s.baseresponse.stat.qbase_cost_time,[2,{errMsg:(0,a.apiSuccessMsg)(f),fileList:s.download_list.map(function(e){return{fileID:e.fileid,tempFileURL:e.download_url,maxAge:e.max_age,status:e.status,errMsg:e.errmsg}})}]}})})}(t)]:[2,{errMsg:(0,a.apiSuccessMsg)(f),fileList:[]}];case 1:return[2,s.sent()];case 2:throw r=s.sent(),(0,o.returnAsFinalCloudSDKError)(r,f);case 3:return(0,l.reportAPISpeed)(n.__assign(n.__assign({},t.timing),{apiEndTime:+new Date,apiName:f})),[7];case 4:return[2]}})})}}},"./src/services/storage/api/uploadFile.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/assert.ts"),o=r("./src/utils/error.ts"),s=r("./src/utils/type.ts"),a=r("./src/utils/fn/clone.ts"),u=r("./src/hook/invoke.ts"),c=r("./src/utils/msg.ts"),l=r("./src/externals/public-lib/appserviceSdk.ts"),d=r("./src/utils/report.ts"),f=r("./src/config/error.config.ts"),p=r("./src/runtime/runtime.ts"),_="cloud.uploadFile",h="cloud.uploadFile_v2";t.default=function(e){return function(e){if(e=(0,a.shallowClone)(e),(0,u.hasAPICallback)(e))return function(e){var r={aborted:!1},i=function(e){return{onProgressUpdate:function(t){e.onProgressUpdateUserHandler=t},abort:function(){e.abort&&e.abort(),e.aborted=!0}}}(r),o={apiStartTime:+new Date};return t(n.__assign(n.__assign({},e),{context:r,timing:o,uploadTaskAgent:i})).then(function(t){(0,u.invokeSuccessCompleteCallbacks)(_,e,t)}).catch(function(t){(0,u.invokeFailCompleteCallbacks)(_,e,t)}),i}(e);var r={apiStartTime:+new Date};return t(n.__assign(n.__assign({},e),{timing:r}))};function t(t){var r=this;return new Promise(function(a,u){return n.__awaiter(r,void 0,void 0,function(){var r,E;return n.__generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,2,3,4]),function(e){(0,i.assertType)(e,{cloudPath:"string"}),"miniprogram"===(0,p.getRuntimeInfo)().env?(0,i.assertType)(e,{filePath:"string"}):(0,i.assertRequiredParam)(e,"file","uploadFile")}(t),t.context&&(t.context.abort=function(){u((0,o.returnAsFinalCloudSDKError)({errMsg:"abort"},_))},t.context.aborted)?[2,u((0,o.returnAsFinalCloudSDKError)({errMsg:"abort"},_))]:[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(a){switch(a.label){case 0:return r=(0,l.getSDK)(e.identifiers),[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i,s,a;return n.__generator(this,function(n){switch(n.label){case 0:return r=JSON.stringify({path:t.cloudPath}),i=+new Date,[4,e.request({apiName:"tcbapi_cos_uploadfile",serviceName:e.name,serializedReqData:r,env:t.config&&t.config.env||e.env})];case 1:if(s=n.sent(),a=s.data,t.timing&&(t.timing.tunnelStartTime=i,t.timing.tunnelEndTime=+new Date,t.timing.tunnelTimeNoCSNetCost=a.baseresponse.stat.qbase_cost_time),!a.url)throw new o.CloudSDKError({errCode:f.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL,errMsg:f.ERR_CODE[f.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL]});return[2,a]}})})}(t)];case 1:return i=a.sent(),[2,new Promise(function(e,a){if(t.context&&t.context.aborted)return a((0,o.returnAsFinalCloudSDKError)({errMsg:"abort"},_));var u,l,d=(0,p.getRuntimeInfo)();if("web"===d.env){var f=new FormData;f.append("key",t.cloudPath),f.append("signature",i.authorization),f.append("x-cos-security-token",i.token),f.append("x-cos-meta-fileid",i.cos_file_id),f.append("file",t.file),u={url:i.url,timeout:t.timeout,filePath:"",header:t.header,name:"",formData:f}}else u={url:i.url,timeout:t.timeout,filePath:t.filePath,header:t.header,name:"file",formData:{key:t.cloudPath,signature:i.authorization,"x-cos-security-token":i.token,"x-cos-meta-fileid":i.cos_file_id}};(l=r.uploadFile(n.__assign(n.__assign({},u),{success:function(t){try{if(t.statusCode>=200&&t.statusCode<300)e({errMsg:(0,c.apiSuccessMsg)(_),fileID:i.file_id,statusCode:t.statusCode});else{var r=new o.CloudSDKError({errMsg:"status ".concat(t.statusCode,", error: ").concat(t.data,";")});a(r)}}catch(r){var n=new o.CloudSDKError({errMsg:"Error : ".concat(t.data,";")});a(n)}},fail:function(e){a(e)}})))&&(l.onProgressUpdate(function(){t.uploadTaskAgent&&t.context&&t.context.onProgressUpdateUserHandler&&(0,s.isFunction)(t.context.onProgressUpdateUserHandler)&&t.context.onProgressUpdateUserHandler.apply(r.uploadFile,arguments)}),t.context&&(t.context.abort=l.abort.bind(l)))})]}})})}(t)];case 1:return r=m.sent(),a(r),[3,4];case 2:return E=m.sent(),u((0,o.returnAsFinalCloudSDKError)(E,_)),[3,4];case 3:return(0,d.reportAPISpeed)(n.__assign(n.__assign({},t.timing),{apiEndTime:+new Date,apiName:h})),[7];case 4:return[2]}})})})}}},"./src/services/storage/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerService=t.STORAGE_SERVICE_NAME=void 0;var n=r("./src/services/storage/api/api.ts");t.STORAGE_SERVICE_NAME="storage",t.registerService=function(e){e.registerService(function(e){var r={name:t.STORAGE_SERVICE_NAME,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get env(){return e.getEnvForService(t.STORAGE_SERVICE_NAME)},get debug(){return e.debug},appConfig:{get uploadMaxFileSize(){return e.appConfig.upload_max_file_size},get getTempFileURLMaxReq(){return e.appConfig.get_temp_file_url_max_requests}}};return{name:t.STORAGE_SERVICE_NAME,context:r,getAPIs:n.getAPIs.bind(null,r)}}(e))}},"./src/services/utils/api/CDN.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/symbol.ts");t.default=function(e){var t=function(){function e(e){this._internalType=n.SYMBOL_CDN,this.target=e,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}})}return e.prototype.toString=function(){return JSON.stringify({target:this.target})},e}();return function(e){return new t(e)}}},"./src/services/utils/api/CloudID.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/symbol.ts");t.default=function(e){var t=function(){function e(e){this._internalType=n.SYMBOL_CLOUD_ID,this.cloudID=e,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}})}return e.prototype.toJSON=function(){return this.cloudID},e.prototype.toString=function(){return this.cloudID},e}();return function(e){return new t(e)}}},"./src/services/utils/api/api.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r("./src/services/utils/api/CloudID.ts"),i=r("./src/services/utils/api/CDN.ts");t.getAPIs=function(e){return{CloudID:(0,n.default)(e),CDN:(0,i.default)(e)}}},"./src/services/utils/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerService=t.UTILS_SERVICE_NAME=void 0;var n=r("./src/services/utils/api/api.ts");t.UTILS_SERVICE_NAME="utils",t.registerService=function(e){e.registerService(function(e){var r={name:t.UTILS_SERVICE_NAME,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get debug(){return e.debug}};return{name:t.UTILS_SERVICE_NAME,context:r,getAPIs:n.getAPIs.bind(null,r)}}(e))}},"./src/utils/asmcrypto.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AES_CBC=void 0;var n=r("./src/vendor/asmcrypto.aes_cbc.js");Object.defineProperty(t,"AES_CBC",{enumerable:!0,get:function(){return n.AES_CBC}})},"./src/utils/assert.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.assertObjectNotEmpty=t.assertStringLength=t.assertRequiredParam=t.assertType=t.validType=void 0;var n=r("./src/utils/type.ts"),i=r("./src/utils/error.ts"),o=r("./src/config/error.config.ts");function s(e,t,r){void 0===r&&(r="parameter");var i=function e(t,r,i){var o=(0,n.getType)(t),s=(0,n.getType)(r);if("string"===s)return o!==r?"".concat(i," should be ").concat(r," instead of ").concat(o,";"):"";if(o!==s)return"".concat(i," should be ").concat(s," instead of ").concat(o,"; ");var a="";switch(o){case"object":for(var u in r)a+=e(t[u],r[u],"".concat(i,".").concat(u));break;case"array":for(var c=0;c<r.length;c++)a+=e(t[c],r[c],"".concat(i,"[").concat(c,"]"))}return a}(e,t,r);return{passed:!i,reason:i}}t.validType=s,t.assertType=function(e,t,r,n){void 0===r&&(r="parameter"),void 0===n&&(n=i.CloudSDKError);var a=s(e,t,r);if(!a.passed)throw new n({errCode:o.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR,errMsg:a.reason})},t.assertRequiredParam=function(e,t,r,n){if(void 0===n&&(n=i.CloudSDKError),void 0===e||null===e)throw new n({errCode:o.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"parameter ".concat(t," of function ").concat(r," must be provided")})},t.assertStringLength=function(e){var t=e.name,r=e.input,n=e.max,s=e.maxWording,a=void 0===s?"":s,u=e.ErrorClass,c=void 0===u?i.CloudSDKError:u;if(r.length>n)throw new c({errCode:o.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"".concat(t," size must be less than ").concat(a||n)})},t.assertObjectNotEmpty=function(e){var t=e.target,r=e.name,n=e.ErrorClass,s=void 0===n?i.CloudSDKError:n;if(0===Object.keys(t).length)throw new s({errCode:o.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"".concat(r," must not be empty")})}},"./src/utils/cdn.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.uploadToCommonCDN=t.populateAndSerialize=t.collect=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/symbol.ts"),o=r("./src/utils/type.ts"),s=r("./src/externals/public-lib/appserviceSdk.ts");function a(e){var t=new WeakMap,r=[];if(e&&(JSON.stringify(e,function(e,n){return n&&n._internalType===i.SYMBOL_CDN?void r.push(new Promise(function(e,r){var i={appType:301,fileType:20303,fileKey:"file_".concat(Math.random())},s=n;switch((0,o.getType)(s.target)){case"object":if(!s.target.filePath)throw new Error("filePath must be provided");i.filePath=s.target.filePath;break;default:i.fileData=s.target}e(u(i).then(function(e){t.set(n,e.fileUrl)}))})):n}),r.length))return Promise.all(r).then(function(){return t})}function u(e){return new Promise(function(t,r){var i=n.__assign(n.__assign({},e),{appType:e.appType||301,fileType:e.fileType||20303,fileKey:e.fileKey||"file_".concat(Math.random())});(0,s.getSDK)().uploadToCommonCDN(n.__assign(n.__assign({},i),{success:t,fail:r}))})}t.collect=a,t.populateAndSerialize=function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return e?[4,a(e)]:[3,2];case 1:return t=r.sent(),[2,JSON.stringify(e,function(e,r){return r&&r.symbol===i.SYMBOL_CDN&&(null===t||void 0===t?void 0:t.has(r))?t.get(r):r})];case 2:return[2,JSON.stringify(e)]}})})},t.uploadToCommonCDN=u},"./src/utils/error.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isCancelledError=t.CancelledError=t.isTimeoutError=t.TimeoutError=t.isGenericError=t.toSDKError=t.returnAsFinalCloudSDKError=t.returnAsCloudSDKError=t.isSDKError=t.CloudSDKError=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/type.ts"),o=r("./src/config/error.config.ts"),s=function(e){function t(t){var r=e.call(this,t.errMsg)||this;return r.errCode=-1,Object.defineProperties(r,{message:{get:function(){return"errCode: ".concat(this.errCode," ").concat(o.ERR_CODE[this.errCode]||""," | errMsg: ")+this.errMsg},set:function(e){this.errMsg=e}}}),r.errCode=t.errCode||-1,r.errMsg=t.errMsg,r}return n.__extends(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return"errCode: ".concat(this.errCode," | errMsg: ")+this.errMsg},set:function(e){this.errMsg=e},enumerable:!1,configurable:!0}),t}(Error);function a(e){return e&&e instanceof Error&&(0,i.isString)(e.errMsg)}function u(e,t){if(e){if(a(e))return e;var r,n="".concat(t,":fail ");if(e instanceof Error)e.message="".concat(n).concat(e.message),e.stack=e.stack?e.stack.slice(0,7)+n+e.stack.slice(7):e.stack,(r=e).errCode=-1;else if("string"==typeof e)(r=new Error("".concat(n).concat(e))).errCode=-1;else{var i=e.errMsg||"";(r=new Error("".concat(t,":fail ").concat(e.errCode," ").concat(o.ERR_CODE[e.errCode]||"",". ").concat(i))).errCode=e.errCode||-1}return r.errMsg=r.message+"",r}var s=new Error("".concat(t,":fail"));return s.errCode=-1,s.errMsg=s.message+"",s}t.CloudSDKError=s,t.isSDKError=a,t.returnAsCloudSDKError=function(e,t){if(void 0===t&&(t=""),e){if(a(e))return t&&(e.errMsg+="; "+t),e;var r=e?e.errCode:void 0,n=(e&&e.errMsg||e.toString()||"unknown error")+"; "+t;return new s({errCode:r,errMsg:n})}return new s({errMsg:t})},t.returnAsFinalCloudSDKError=function(e,t){return u(e,t)},t.toSDKError=u;t.isGenericError=function(e){return e.generic};var c=function(e){function t(t,r){var n=e.call(this,t)||this;return n.type="timeout",n.generic=!0,n.payload=r,n}return n.__extends(t,e),t}(Error);t.TimeoutError=c;t.isTimeoutError=function(e){return"timeout"===e.type};var l=function(e){function t(t,r){var n=e.call(this,t)||this;return n.type="cancelled",n.generic=!0,n.payload=r,n}return n.__extends(t,e),t}(Error);t.CancelledError=l;t.isCancelledError=function(e){return"cancelled"===e.type}},"./src/utils/expire.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getPessimisticExpireTs=void 0,t.getPessimisticExpireTs=function(e){if(void 0===e||!e.timestamp||!e.expires_in)return 0;var t=Date.now()-e.timestamp,r=.8*e.expires_in,n=Math.min(e.timestamp,Date.now())+1e3*r;return t>1e3*r?Date.now()+1e3*r:n}},"./src/utils/fail-safe.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.wrapParamCallbacksWithTryCatch=t.wrapWithTryCatch=t.tryCatch=void 0;var n=r("./src/utils/error.ts"),i=r("./src/utils/type.ts"),o=r("./src/externals/public-lib/reporter.ts");function s(e,t){void 0===t&&(t="");try{return e()}catch(e){if((0,n.isSDKError)(e))return e.errMsg+=t,e;var r=(e?e.toString():"")+t;return new n.CloudSDKError({errMsg:r})}}t.tryCatch=s,t.wrapWithTryCatch=function(e,t){return void 0===t&&(t=""),function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return s(function(){return e.apply(e,r)},t)}},t.wrapParamCallbacksWithTryCatch=function(e){var t=e.param;t&&(t.success&&(0,i.isFunction)(t.success)&&(t.success=o.default.surroundThirdByTryCatch(t.success,"at api ".concat(e.apiName," success callback function"))),t.fail&&(0,i.isFunction)(t.fail)&&(t.fail=o.default.surroundThirdByTryCatch(t.fail,"at api ".concat(e.apiName," fail callback function"))),t.complete&&(0,i.isFunction)(t.complete)&&(t.complete=o.default.surroundThirdByTryCatch(t.complete,"at api ".concat(e.apiName," complete callback function"))))}},"./src/utils/fn/clone.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.shallowClone=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/type.ts");t.shallowClone=function(e,t){if(void 0===t&&(t=!1),t)return function(e){switch((0,i.getType)(e)){case"object":return n.__assign({},e);case"array":return e.slice();case"number":return e instanceof Number?new Number(e):e;case"string":return e instanceof String?new String(e):e;case"boolean":return e instanceof Boolean?new Boolean(e):e;case"date":return new e.constructor(+e);case"map":return new Map(e);case"set":return new Set(e);default:return e}}(e);if((0,i.isPlainObject)(e))return n.__assign({},e);switch((0,i.getType)(e)){case"object":return e;case"array":return e.slice();default:return e}}},"./src/utils/fsm.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isFSMTransitionError=t.FSMTransitionError=t.FSM=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=function(){function e(e){for(var t in this.listeners=new Set,this.currentState=e.initialState,this.states=new Map,e.states)this.states.set(t,{name:t,transitions:new Map(e.states[t].transitions.map(function(e){return[e.accept,e.to]}))});this.history={options:{enable:!1,limit:100},transitions:[]},e.history&&("boolean"==typeof e.history?e.history&&(this.history.options.enable=!0):Boolean(e.history.enable)&&(void 0===e.history.limit||null===e.history.limit?this.history.options={enable:!0,limit:100}:e.history.limit>0&&(this.history.options={enable:!0,limit:e.history.limit}))),this.history.options.enable&&this.history.transitions.push({state:this.currentState})}return e.prototype.transition=function(e,t){var r=this;if(t&&(t instanceof Set?!t.has(this.currentState):t!==this.currentState))throw new o("current state (".concat(this.currentState,") != expected from state (").concat(t instanceof Set?JSON.stringify(n.__spreadArray([],n.__read(t),!1)):t,")"),"unexpectedFromState");var i="string"==typeof e?{type:e}:e,s=this.states.get(this.currentState),a=s.transitions.get(i.type);if(!a)throw new o("current state (".concat(this.currentState,') does not accept "').concat(i.type,'"'),"unexpectedInput");this.currentState=a,this.history.options.enable&&(this.history.transitions.push({event:i.type,state:this.currentState}),this.history.transitions.length>this.history.options.limit&&(this.history.transitions.length===this.history.options.limit+1?this.history.transitions.shift():this.history.transitions.splice(0,this.history.transitions.length-this.history.options.limit))),this.listeners.forEach(function(e){try{e({event:i,from:s.name,to:r.currentState})}catch(e){console.error("FSM listener exec error: ",e)}})},e.prototype.canAccept=function(e){return this.states.get(this.currentState).transitions.has(e)},e.prototype.subscribe=function(e){this.listeners.add(e)},e.prototype.unsubscribe=function(e){this.listeners.delete(e)},e.prototype.getHistoryRepresentation=function(e){if(!this.history.options.enable)return"";var t=e.limit?this.history.transitions.slice(-e.limit):this.history.transitions;return"states: ".concat(t.map(function(e){var t=e.state,r=e.event;return"".concat(r?"-(".concat(r,")->"):"").concat(t)}).join(""))},e}();t.FSM=i;var o=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.type="transition",i.generic=!0,i.subtype=r,i.payload=n,i}return n.__extends(t,e),t}(Error);t.FSMTransitionError=o;t.isFSMTransitionError=function(e){return"transition"===e.type}},"./src/utils/merge.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js");function i(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}t.default=function e(t,r){var o,s;if(t===r)return t;try{for(var a=n.__values(Object.keys(r)),u=a.next();!u.done;u=a.next()){var c=u.value,l=i(r,c),d=i(t,c),f=void 0;"object"==typeof l?e(f=d||{},l):f=l,t[c]=f}}catch(e){o={error:e}}finally{try{u&&!u.done&&(s=a.return)&&s.call(a)}finally{if(o)throw o.error}}return t}},"./src/utils/msg.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.apiFailMsg=t.apiCancelMsg=t.apiSuccessMsg=void 0,t.apiSuccessMsg=function(e){return"".concat(e,":ok")},t.apiCancelMsg=function(e,t){return"".concat(e,":cancel ").concat(t)},t.apiFailMsg=function(e,t){return"".concat(e,":fail ").concat(t)}},"./src/utils/report.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.socketOnMessageSamplePicker=t.wrapTiming=t.reportMMData=t.setReportToken=t.reportIDKey=t.reportAPISpeed=t.init=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/externals/public-lib/reporter.ts"),o=r("./src/externals/public-lib/appserviceSdk.ts"),s=r("./src/utils/throttle.ts"),a=r("./src/utils/service-endpoint.ts"),u=r("./src/externals/globals/wxconfig.ts"),c=r("./src/utils/type.ts"),l=!1,d=[],f=Date.now(),p=Date.now(),_="unknown";u.default.onReady(function(){f=Date.now(),p=Date.now()});t.init=function(){if(!l)try{var e=(0,o.getSDK)();e.wx.onAppShow&&e.wx.onAppShow(function(){p=Date.now()}),e.wx.getNetworkType({success:function(e){_=e.networkType},complete:function(){l=!0,h()}}),e.wx.onNetworkStatusChange(function(e){l||(l=!0,h()),_=e.networkType})}catch(e){}};var h=function(){var e,t;try{for(var r=n.__values(d),i=r.next();!i.done;i=r.next()){var o=i.value;try{o()}catch(e){0}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}d=[]};t.reportAPISpeed=function(e){setTimeout(function(){var r;try{if(!function(e){return!(e.tunnelStartTime&&e.tunnelEndTime&&e.tunnelEndTime<e.tunnelStartTime||!(e.apiStartTime&&e.apiEndTime&&e.apiEndTime>e.apiStartTime))}(e))return;if(!l&&d.length<100)return void d.push(t.reportAPISpeed.bind(null,e));var n=Date.now(),o=e.apiEndTime-e.apiStartTime,s=e.tunnelEndTime?e.tunnelEndTime-e.tunnelStartTime:0,a=[0,e.apiName,o,s,(e.pollStartTime&&e.pollEndTime&&e.pollEndTime>e.pollStartTime?e.pollEndTime-e.pollStartTime:0)||0,_,e.tunnelTimeNoCSNetCost?o-e.tunnelTimeNoCSNetCost:0,e.tunnelTimeNoCSNetCost?s-e.tunnelTimeNoCSNetCost:0,e.funcExecTime?e.funcExecTime:0,null!==(r=e.channelType)&&void 0!==r?r:0,e.funcName||"",n-f,n-p];i.default.fake?(0,t.reportMMData)(16588,6,a.join(",")):i.default.reportKeyValue({key:"CloudReport",value:a.join(","),force:!0})}catch(e){}})};var E;t.reportIDKey=function(e,t,r,n){i.default.reportIDKeyDirectly({id:e,key:t,force:r,immediately:n})};t.setReportToken=function(e){return E=e};var m=[];t.reportMMData=function(e,t,r){m.push({log_id:e,version:t,user_log_list:r}),E&&g()};var g=(0,s.default)(function(){(0,o.getSDK)().request({url:"https://servicewechat.com/wxa-qbase/report?token=".concat(E),method:"POST",header:{},enableHttp2:!0,dataType:"json",data:JSON.stringify({report_info_list:m}),success:function(e){for(var t in e.header)"x-wx-system-error"===t.toLocaleLowerCase()&&"85104"===e.header[t]&&a.ServiceEndpoint.invalidateService("container")}}),m=[],(0,a.keepAlive)()},3e4);t.wrapTiming=function(e,r){var i=(0,c.isFunction)(e);function o(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(r.samplePicker&&!r.samplePicker.next())return i?e.apply(this,t):e;var o=Date.now(),a=!0;try{if(r.condition&&r.condition.emptyKey&&r.timing[r.startKey])return i?e.apply(this,t):e;var u=void 0;if(i){var l=e.apply(this,t);if(!(0,c.isPromise)(l))return a=!1,l;u=l}else u=e;return u.then(function(){return s(o)}).catch(function(){return s(o)}),u}catch(e){throw a=!1,e}finally{a||s(o)}}function s(e){r.timing[r.startKey]=e,r.timing[r.endKey]=Date.now(),r.autoReport&&(0,t.reportAPISpeed)(n.__assign(n.__assign({},r.timing),{apiName:r.autoReport}))}return i?o:o()};t.socketOnMessageSamplePicker=function(e,t){return function(){var r,i;return n.__generator(this,function(n){switch(n.label){case 0:r=function(){return parseInt(Math.round(2*Math.random()*e),10)},i=t?0:r(),n.label=1;case 1:return i>0?(i--,[4,!1]):[3,3];case 2:return n.sent(),[3,5];case 3:return i=r(),[4,!0];case 4:n.sent(),n.label=5;case 5:return[3,1];case 6:return[2]}})}}(10,!0)()},"./src/utils/serializer.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.deserialize=t.toJSONSerializable=t.stringifyReplacer=t.serialize=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/utils/error.ts"),o=r("./src/config/error.config.ts"),s=r("./src/utils/type.ts");function a(e){switch((0,s.getType)(e)){case"object":return function e(t){var r=t;var n=u(r);if(r!==n)return n;for(var i in r){var o=r[i],c=(0,s.getType)(o);switch(c){case"object":var l=u(o);r[i]=l!==o?l:e(r[i]);break;case"array":var l=a(o);l!==o&&(r[i]=l);break;default:continue}}return r}(e);case"array":return e.map(a);default:return e}}function u(e){for(var t in e)switch(t){case"type":switch(e.type){case"Buffer":if((0,s.isArray)(e.data)&&(0,s.isNumber)(e.data[0]))try{return new Uint8Array(e.data).buffer}catch(t){return e}}}return e}t.serialize=function(e,t){return JSON.stringify(e,function(e,r){if(t&&t.has(r))return t.get(r);switch((0,s.getType)(r)){case"arraybuffer":var i=new Uint8Array(r);return{type:"Buffer",data:n.__spreadArray([],n.__read(i),!1)}}return r})},t.stringifyReplacer=function(e,t){switch((0,s.getType)(t)){case"arraybuffer":var r=new Uint8Array(t);return{type:"Buffer",data:n.__spreadArray([],n.__read(r),!1)}}return t},t.toJSONSerializable=function e(t,r){if(void 0===r&&(r="data"),null!==t&&void 0!==t){if(!0===t||!1===t)return t;switch((0,s.getType)(t)){case"number":if(isFinite(t))return t;break;case"string":return t;case"array":return t.map(function(t,n){return e(t,"".concat(r,"[").concat(n,"]"))});case"object":var a={};for(var u in t)t.hasOwnProperty(u)&&(a[u]=e(t[u],"".concat(r,".").concat(u)));return a;case"arraybuffer":var c=new Uint8Array(t);return{type:"Buffer",data:n.__spreadArray([],n.__read(c),!1)}}if("function"==typeof t)return t;!function(e){throw new i.CloudSDKError({errCode:o.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR,errMsg:"".concat(e," is not JSON-serializable")})}(r)}},t.deserialize=function(e){return a(JSON.parse(e))}},"./src/utils/service-endpoint.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.keepAlive=t.getCloudServiceURL=t.ServiceEndpoint=void 0;var n=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),i=r("./src/network/tunnel.ts"),o=r("../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/debounce.js"),s=r("./src/externals/public-lib/appserviceSdk.ts"),a=r("./src/utils/report.ts"),u=r("./src/utils/report.ts"),c=r("./src/utils/utils.ts"),l=r("./src/utils/expire.ts"),d=/https:\/\/servicewechat\.com/,f={},p={},_={},h="".concat(Math.random(),"_").concat(Date.now()),E="servicewechat.com",m=!1,g=function(){function e(e){this.identifiers=e}return e.prototype.setMetaData=function(e){this._meta=e},e.prototype.setTunnelRequest=function(e){this._tunnelRequest=e},e.prototype.getEndpointSync=function(e){var t=f[e];if("container"===e){if((null===t||void 0===t?void 0:t.url)&&(null===t||void 0===t?void 0:t.expiresTs)&&Date.now()<t.expiresTs)return t;this.getEndpoint(e)}},e.prototype.getEndpoint=function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){return t=f[e],"container"===e?(null===t||void 0===t?void 0:t.url)&&(null===t||void 0===t?void 0:t.expiresTs)&&Date.now()<t.expiresTs?[2,t]:[2,this.refreshContainerServiceEndpoint()]:[2,null]})})},e.prototype.refreshContainerServiceEndpoint=function(){return n.__awaiter(this,void 0,void 0,function(){var r=this;return n.__generator(this,function(o){return p.container?[2,p.container]:(f.container&&e.invalidateService("container"),clearTimeout(_.container),p.container=new Promise(function(e,o){return n.__awaiter(r,void 0,void 0,function(){var r,u,d,g,y,A,b,C,O,I,R,w,N,D,L=this;return n.__generator(this,function(M){switch(M.label){case 0:return!(0,s.getSDK)().private_getBackgroundFetchData||m?[3,2]:(m=!0,[4,(0,c.privateGetBackgroundFetchData)(500,this.identifiers)]);case 1:if((r=M.sent())&&r.expiresTs>Date.now()&&r.url_info)return f.container={url:(null===(R=r.url_info)||void 0===R?void 0:R.cloudrun_url)?"".concat(r.url_info.cloudrun_url,"?token=").concat(r.token):"https://".concat(r.domain,"/wxa-qbase/container_service?token=").concat(r.token),cloudServiceUrl:(null===(w=r.url_info)||void 0===w?void 0:w.cloudbase_url)?"".concat(r.url_info.cloudbase_url,"?token=").concat(r.token):void 0,domain:r.domain||"servicewechat.com",token:r.token,http:!0,key:r.key,timestamp:r.timestamp,expiresTs:r.expiresTs},e(f.container),delete p.container,[2];M.label=2;case 2:u=[],d=0,M.label=3;case 3:if(!(d<3))return[3,11];M.label=4;case 4:return M.trys.push([4,9,,10]),g=Date.now(),y=(0,c.getSystemInfo)(),this._tunnelRequest?[4,this._tunnelRequest({apiName:"tcbapi_get_service_info",serializedReqData:JSON.stringify({client_random:h,system:y.system,wx_app_version:y.version})})]:[3,6];case 5:return A=M.sent(),[3,8];case 6:return[4,(0,i.default)({apiName:"qbase_commapi",data:{qbase_api_name:"tcbapi_get_service_info",qbase_req:JSON.stringify({client_random:h,system:y.system,wx_app_version:y.version}),qbase_options:{},qbase_meta:this._meta,cli_req_id:"".concat(+new Date,"_").concat(Math.random())}})];case 7:A=M.sent(),M.label=8;case 8:return b=A.data,Date.now()-g>1e3*b.expires_in?(u.push("result already expired (startTs ".concat(g," resultTs ").concat(Date.now(),")")),[3,10]):(C=(0,l.getPessimisticExpireTs)(b),O=b.domain||"servicewechat.com",f.container={url:(null===(N=b.url_info)||void 0===N?void 0:N.cloudrun_url)?"".concat(b.url_info.cloudrun_url,"?token=").concat(b.token):"https://".concat(O,"/wxa-qbase/container_service?token=").concat(b.token),cloudServiceUrl:(null===(D=b.url_info)||void 0===D?void 0:D.cloudbase_url)?"".concat(b.url_info.cloudbase_url,"?token=").concat(b.token):void 0,domain:O,token:b.token,http:b.http,key:b.key,timestamp:b.timestamp,ip:b.ip,vip:b.vip,expiresTs:C},e(f.container),delete p.container,(0,a.setReportToken)(b.token),E=f.container.domain||"servicewechat.com",function(){var e;n.__awaiter(this,void 0,void 0,function(){var r,i,o=this;return n.__generator(this,function(a){return v?[2]:(v=!0,(r=function(){v&&setTimeout(function(){return n.__awaiter(o,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return[4,(0,t.keepAlive)()];case 1:return e.sent(),r(),[2]}})})},2e4)})(),S||(S=!0,i=(0,s.getSDK)(),(null===(e=i.wx)||void 0===e?void 0:e.onAppHide)&&i.wx.onAppHide(function(){v=!1})),T(),[2,(0,t.keepAlive)()])})})}(),clearTimeout(_.container),_.container=setTimeout(function(){L.refreshContainerServiceEndpoint()},C-Date.now()),[2]);case 9:return I=M.sent(),u.push(I+""),[3,10];case 10:return d++,[3,3];case 11:return o("get container service endpoints errors: ".concat(u.join("\n"))),delete p.container,[2]}})})}),[2,p.container])})})},e.invalidateService=function(e){delete f[e]},e}();t.ServiceEndpoint=g,t.getCloudServiceURL=function(e){var t=f.container;if(t&&t.cloudServiceUrl)return e.rdm?t.cloudServiceUrl.replace(d,"https://wxardm.weixin.qq.com"):t.cloudServiceUrl};var v=!1,S=!1,y=0;var T=function(){return new Promise(function(e){var t=Date.now(),r=!/^\d+/.test(E);(0,s.getSDK)().request({url:"".concat(r?"https":"http","://").concat(E,"/wxa-qbase/keepalive"),header:r?{}:{host:"servicewechat.com"},method:"GET",dataType:"text",enableHttp2:r,success:function(){e(),y++%4==0&&(0,u.reportMMData)(22990,1,["privateHttpKeepAlive",E,t,Date.now(),Date.now()-t].join(","))},fail:function(){e()}})})};t.keepAlive=(0,o.default)(T,2e4)},"./src/utils/set.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unset=t.set=void 0;var r=function(e){var t=new Map;return function(r){return t.has(r)||t.set(r,e(r)),t.get(r)}}(function(e){return e.replace(/\[(\d+)\]/g,".[$1]").split(".").map(function(e){return/^\[(\d+)\]$/.test(e)?parseInt(e.substring(1,e.length-1)):e})});t.set=function(e,t,n){if(e){if(!Object.prototype.hasOwnProperty.call(e,t)){for(var i=r(t),o=e,s=0;s<i.length-1;++s){var a=i[s];o[a]||(o[a]="string"==typeof i[s+1]?{}:[]),o=o[a]}return o[i[i.length-1]]=n,e}e[t]=n}},t.unset=function(e,t){if(e){if(!Object.prototype.hasOwnProperty.call(e,t)){for(var n=r(t),i=e,o=0;o<n.length-1;++o){var s=n[o];if(!i[s])return;i=i[s]}return delete i[n[n.length-1]],e}delete e[t]}}},"./src/utils/symbol.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SYMBOL_CDN=t.SYMBOL_CLOUD_ID=void 0,t.SYMBOL_CLOUD_ID=Symbol.for("CLOUD_ID"),t.SYMBOL_CDN=Symbol("CDN")},"./src/utils/throttle.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t){var r=null,n=!1,i=function(){r?n=!0:(e(),r=setTimeout(function(){clearTimeout(r),r=null,n&&(n=!1,i())},t))};return i}},"./src/utils/type.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isPlainObject=t.isInternalObject=t.isRegExp=t.isDate=t.isArray=t.isFunction=t.isPromise=t.isNumber=t.isString=t.isObject=t.getType=void 0;t.getType=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()};t.isObject=function(e){return"object"===(0,t.getType)(e)};t.isString=function(e){return"string"===(0,t.getType)(e)};t.isNumber=function(e){return"number"===(0,t.getType)(e)};t.isPromise=function(e){return"promise"===(0,t.getType)(e)};t.isFunction=function(e){return"function"==typeof e};t.isArray=function(e){return Array.isArray(e)};t.isDate=function(e){return"date"===(0,t.getType)(e)};t.isRegExp=function(e){return"regexp"===(0,t.getType)(e)};t.isInternalObject=function(e){return e&&"symbol"===(0,t.getType)(e._internalType)};t.isPlainObject=function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}},"./src/utils/userAgent.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getUA=void 0;var n,i=r("./src/externals/public-lib/appserviceSdk.ts");t.getUA=function(){return n||(0,i.getSDK)().private_getUserAgent(function(e){n=e}),n}},"./src/utils/utils.ts":function(e,t,r){(function(e){var n=this;Object.defineProperty(t,"__esModule",{value:!0}),t.stringToUtf8Array=t.stringToArrayBuffer=t.arrayBufferToString=t.base64ToArrayBuffer=t.arrayBufferToBase64=t.encodeWithDecode=t.tryDecodeURIComponent=t.tryJSONParse=t.privateGetBackgroundFetchData=t.getSystemInfo=t.offAppVisibilityChange=t.onAppVisibilityChange=t.onceNetworkOnline=t.throwErrorIfNetworkOffline=t.getNetworkStatus=t.getWXVersion=t.autoCount=t.nextLoop=t.sleep=t._wxConsole=void 0;var i=r("../../node_modules/.pnpm/tslib@2.4.1/node_modules/tslib/tslib.es6.js"),o=r("./src/externals/public-lib/appserviceSdk.ts"),s=r("./src/utils/report.ts"),a=r("./src/utils/expire.ts");t._wxConsole="undefined"!=typeof wxConsole?wxConsole:void 0;t.sleep=function(e){return void 0===e&&(e=0),new Promise(function(t){return setTimeout(t,e)})};t.nextLoop=function(){return new Promise(function(t){return e(t)})};var u={};t.autoCount=function(e){return void 0===e&&(e="any"),u[e]||(u[e]=0),u[e]++};var c;t.getWXVersion=function(){var e,t,r=(0,o.getSDK)().wx;if(r&&r.version){e=r.version.version,t=r.version.updateTime;var n=r.version.updateTime.match(/^(\d+)\.(\d+)\.(\d+)/);return{version:e,updateTime:t,updateDateInDashes:n?"".concat(n[1],"-").concat(n[2],"-").concat(n[3]):"unknown"}}return{version:"unknown",updateTime:"unknown",updateDateInDashes:"unknown"}};var l=!1,d=[];t.getNetworkStatus=function(){return new Promise(function(e,t){if(c)e(c);else try{(0,o.getSDK)().wx.getNetworkType({success:function(t){c={networkType:t.networkType,isConnected:"none"!==t.networkType},e(c),l||((0,o.getSDK)().wx.onNetworkStatusChange(function(e){if(c.networkType=e.networkType,c.isConnected=e.isConnected,e.isConnected&&d.length)for(;d.length;)try{d.shift()()}catch(e){}}),l=!0)},fail:t})}catch(e){t(e)}})};t.throwErrorIfNetworkOffline=function(){return new Promise(function(e,r){return i.__awaiter(n,void 0,void 0,function(){return i.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,(0,t.getNetworkStatus)()];case 1:return n.sent().isConnected?e():r("network offline"),[3,3];case 2:return n.sent(),e(),[3,3];case 3:return[2]}})})})};t.onceNetworkOnline=function(){return new Promise(function(e){c&&c.isConnected?e():d.push(e)})};var f,p=!1,_=new Set;t.onAppVisibilityChange=function(e){(0,o.getSDK)().wx.onAppShow&&(p||(function(){var e=(0,o.getSDK)().wx;e.onAppShow&&e.onAppHide&&(e.onAppShow(function(){var e,t;"visible";try{for(var r=i.__values(_),n=r.next();!n.done;n=r.next()){var o=n.value;try{o("show")}catch(e){}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}),e.onAppHide(function(){var e,t;"hidden";try{for(var r=i.__values(_),n=r.next();!n.done;n=r.next()){var o=n.value;try{o("hide")}catch(e){}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}))}(),p=!0),_.size>50&&_.clear(),_.add(e))},t.offAppVisibilityChange=function(e){_.delete(e)},t.getSystemInfo=function(){if(f)return f;var e=(0,o.getSDK)().wx;return f=e.getSystemInfoSync()};var h,E=!1,m=void 0;function g(e){try{return decodeURIComponent(e)}catch(t){return e}}t.privateGetBackgroundFetchData=function(e,r){return void 0===e&&(e=500),void 0===r&&(r={}),i.__awaiter(this,void 0,void 0,function(){var n,u;return i.__generator(this,function(i){switch(i.label){case 0:return(0,o.getSDK)().private_getBackgroundFetchData?r.pluginId?[2]:m?[2,m]:h?[2,h.then(function(){return m})]:E?[2]:(E=!0,n=Date.now(),[4,h=Promise.race([(0,t.sleep)(e).then(function(){return{error:"bg fetch timeout"}}),new Promise(function(e,t){(0,o.getSDK)().private_getBackgroundFetchData({fetchType:0,success:function(t){try{(m=JSON.parse(t.fetchedData)).expiresTs=(0,a.getPessimisticExpireTs)(m),e(m),(0,s.reportAPISpeed)({apiName:"private_getBackgroundFetchData",apiStartTime:n,apiEndTime:Date.now()})}catch(t){e({error:t})}},fail:function(t){e({error:t})}})})])]):[2];case 1:return u=i.sent(),h=void 0,null===t._wxConsole||void 0===t._wxConsole||t._wxConsole.log("wrap_private_getBackgroundFetchData",JSON.stringify(u)),u.error?[2,void 0]:[2,u]}})})},t.tryJSONParse=function(e){try{return JSON.parse(e)}catch(t){return e}},t.tryDecodeURIComponent=g,t.encodeWithDecode=function(e){return encodeURIComponent(g(e))};var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function S(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?t.push(192|n>>6,128|63&n):n<55296||n>=57344?t.push(224|n>>12,128|n>>6&63,128|63&n):(r++,n=65536+((1023&n)<<10|1023&e.charCodeAt(r)),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return new Uint8Array(t)}t.arrayBufferToBase64=function(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return function(e){for(var t=String(e),r="",n=void 0,i=void 0,o=0,s=v;t.charAt(0|o)||(s="=",o%1);r+=s.charAt(63&n>>8-o%1*8)){if((i=t.charCodeAt(o+=.75))>255)throw new Error('"btoa" failed');n=n<<8|i}return r}(t)},t.base64ToArrayBuffer=function(e){for(var t=function(e){var t=String(e).replace(/=+$/,""),r="";if(t.length%4==1)throw new Error('"atob" failed');for(var n=0,i=void 0,o=void 0,s=0;o=t.charAt(s++);~o&&(i=n%4?64*i+o:o,n++%4)?r+=String.fromCharCode(255&i>>(-2*n&6)):0)o=v.indexOf(o);return r}(e),r=t.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=t.charCodeAt(i);return n.buffer},t.arrayBufferToString=function(e){return y(new Uint8Array(e))},t.stringToArrayBuffer=function(e){return S(e).buffer},t.stringToUtf8Array=S;var y=function(){var e=new Array(128),t=String.fromCodePoint||String.fromCharCode,r=[];return function(n){var i,o,s=n.length;r.length=0;for(var a=0;a<s;)(o=n[a++])<=127?i=o:o<=223?i=(31&o)<<6|63&n[a++]:o<=239?i=(15&o)<<12|(63&n[a++])<<6|63&n[a++]:String.fromCodePoint?i=(7&o)<<18|(63&n[a++])<<12|(63&n[a++])<<6|63&n[a++]:(i=63,a+=3),r.push(e[i]||(e[i]=t(i)));return r.join("")}}()}).call(this,r("../../node_modules/.pnpm/timers-browserify@2.0.12/node_modules/timers-browserify/main.js").setImmediate)},"./src/vendor/asmcrypto.aes_cbc.js":function(e,t,r){function n(e){return e instanceof Uint8Array}function i(e,t,r,n,i){var o=e.length-t,s=o<i?o:i;return e.set(r.subarray(n,n+s),t),s}r.r(t),r.d(t,"AES_CBC",function(){return d});var o=(()=>{function e(){var e=Error.apply(this,arguments);this.message=e.message,this.stack=e.stack}return e.prototype=Object.create(Error.prototype,{name:{value:"IllegalArgumentError"}}),e})(),s=(()=>{function e(){var e=Error.apply(this,arguments);this.message=e.message,this.stack=e.stack}return e.prototype=Object.create(Error.prototype,{name:{value:"SecurityError"}}),e})(),a=(()=>{var e,t,r,n,i,o,s=!1;function a(r,n){var i=e[(t[r]+t[n])%255];return 0!==r&&0!==n||(i=0),i}function u(){function u(r){var n,i,o;for(i=o=function(r){var n=e[255-t[r]];return 0===r&&(n=0),n}(r),n=0;n<4;n++)o^=i=255&(i<<1|i>>>7);return o^=99}s||function(){e=[],t=[];var r,n,i=1;for(r=0;r<255;r++)e[r]=i,n=128&i,i<<=1,i&=255,128===n&&(i^=27),i^=e[r],t[e[r]]=r;e[255]=e[0],t[0]=0,s=!0}(),r=[],n=[],i=[[],[],[],[]],o=[[],[],[],[]];for(var c=0;c<256;c++){var l=u(c);r[c]=l,n[l]=c,i[0][c]=a(2,l)<<24|l<<16|l<<8|a(3,l),o[0][l]=a(14,c)<<24|a(9,c)<<16|a(13,c)<<8|a(11,c);for(var d=1;d<4;d++)i[d][c]=i[d-1][c]>>>8|i[d-1][c]<<24,o[d][l]=o[d-1][l]>>>8|o[d-1][l]<<24}}var c=function(e,t){u();var s=new Uint32Array(t);s.set(r,512),s.set(n,768);for(var a=0;a<4;a++)s.set(i[a],4096+1024*a>>2),s.set(o[a],8192+1024*a>>2);var c=function(e,t,r){"use asm";var n=0,i=0,o=0,s=0,a=0,u=0,c=0,l=0,d=0,f=0,p=0,_=0,h=0,E=0,m=0,g=0,v=0,S=0,y=0,T=0,A=0;var b=new e.Uint32Array(r),C=new e.Uint8Array(r);function O(e,t,r,a,u,c,l,d){e=e|0;t=t|0;r=r|0;a=a|0;u=u|0;c=c|0;l=l|0;d=d|0;var f=0,p=0,_=0,h=0,E=0,m=0,g=0,v=0;f=r|0x400,p=r|0x800,_=r|0xc00;u=u^b[(e|0)>>2],c=c^b[(e|4)>>2],l=l^b[(e|8)>>2],d=d^b[(e|12)>>2];for(v=16;(v|0)<=a<<4;v=v+16|0){h=b[(r|u>>22&1020)>>2]^b[(f|c>>14&1020)>>2]^b[(p|l>>6&1020)>>2]^b[(_|d<<2&1020)>>2]^b[(e|v|0)>>2],E=b[(r|c>>22&1020)>>2]^b[(f|l>>14&1020)>>2]^b[(p|d>>6&1020)>>2]^b[(_|u<<2&1020)>>2]^b[(e|v|4)>>2],m=b[(r|l>>22&1020)>>2]^b[(f|d>>14&1020)>>2]^b[(p|u>>6&1020)>>2]^b[(_|c<<2&1020)>>2]^b[(e|v|8)>>2],g=b[(r|d>>22&1020)>>2]^b[(f|u>>14&1020)>>2]^b[(p|c>>6&1020)>>2]^b[(_|l<<2&1020)>>2]^b[(e|v|12)>>2];u=h,c=E,l=m,d=g}n=b[(t|u>>22&1020)>>2]<<24^b[(t|c>>14&1020)>>2]<<16^b[(t|l>>6&1020)>>2]<<8^b[(t|d<<2&1020)>>2]^b[(e|v|0)>>2],i=b[(t|c>>22&1020)>>2]<<24^b[(t|l>>14&1020)>>2]<<16^b[(t|d>>6&1020)>>2]<<8^b[(t|u<<2&1020)>>2]^b[(e|v|4)>>2],o=b[(t|l>>22&1020)>>2]<<24^b[(t|d>>14&1020)>>2]<<16^b[(t|u>>6&1020)>>2]<<8^b[(t|c<<2&1020)>>2]^b[(e|v|8)>>2],s=b[(t|d>>22&1020)>>2]<<24^b[(t|u>>14&1020)>>2]<<16^b[(t|c>>6&1020)>>2]<<8^b[(t|l<<2&1020)>>2]^b[(e|v|12)>>2]}function I(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;O(0x0000,0x0800,0x1000,A,e,t,r,n)}function R(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var o=0;O(0x0400,0x0c00,0x2000,A,e,n,r,t);o=i,i=s,s=o}function w(e,t,r,d){e=e|0;t=t|0;r=r|0;d=d|0;O(0x0000,0x0800,0x1000,A,a^e,u^t,c^r,l^d);a=n,u=i,c=o,l=s}function N(e,t,r,d){e=e|0;t=t|0;r=r|0;d=d|0;var f=0;O(0x0400,0x0c00,0x2000,A,e,d,r,t);f=i,i=s,s=f;n=n^a,i=i^u,o=o^c,s=s^l;a=e,u=t,c=r,l=d}function D(e,t,r,d){e=e|0;t=t|0;r=r|0;d=d|0;O(0x0000,0x0800,0x1000,A,a,u,c,l);a=n=n^e,u=i=i^t,c=o=o^r,l=s=s^d}function L(e,t,r,d){e=e|0;t=t|0;r=r|0;d=d|0;O(0x0000,0x0800,0x1000,A,a,u,c,l);n=n^e,i=i^t,o=o^r,s=s^d;a=e,u=t,c=r,l=d}function M(e,t,r,d){e=e|0;t=t|0;r=r|0;d=d|0;O(0x0000,0x0800,0x1000,A,a,u,c,l);a=n,u=i,c=o,l=s;n=n^e,i=i^t,o=o^r,s=s^d}function P(e,t,r,a){e=e|0;t=t|0;r=r|0;a=a|0;O(0x0000,0x0800,0x1000,A,d,f,p,_);_=~g&_|g&_+1;p=~m&p|m&p+((_|0)==0);f=~E&f|E&f+((p|0)==0);d=~h&d|h&d+((f|0)==0);n=n^e;i=i^t;o=o^r;s=s^a}function U(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,o=0,s=0,d=0,f=0,p=0,_=0,h=0,E=0,m=0;e=e^a,t=t^u,r=r^c,n=n^l;i=v|0,o=S|0,s=y|0,d=T|0;for(;(E|0)<128;E=E+1|0){if(i>>>31){f=f^e,p=p^t,_=_^r,h=h^n}i=i<<1|o>>>31,o=o<<1|s>>>31,s=s<<1|d>>>31,d=d<<1;m=n&1;n=n>>>1|r<<31,r=r>>>1|t<<31,t=t>>>1|e<<31,e=e>>>1;if(m)e=e^0xe1000000}a=f,u=p,c=_,l=h}function x(e){e=e|0;A=e}function B(e,t,r,a){e=e|0;t=t|0;r=r|0;a=a|0;n=e,i=t,o=r,s=a}function k(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;a=e,u=t,c=r,l=n}function j(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;d=e,f=t,p=r,_=n}function G(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;h=e,E=t,m=r,g=n}function q(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;_=~g&_|g&n,p=~m&p|m&r,f=~E&f|E&t,d=~h&d|h&e}function W(e){e=e|0;if(e&15)return-1;C[e|0]=n>>>24,C[e|1]=n>>>16&255,C[e|2]=n>>>8&255,C[e|3]=n&255,C[e|4]=i>>>24,C[e|5]=i>>>16&255,C[e|6]=i>>>8&255,C[e|7]=i&255,C[e|8]=o>>>24,C[e|9]=o>>>16&255,C[e|10]=o>>>8&255,C[e|11]=o&255,C[e|12]=s>>>24,C[e|13]=s>>>16&255,C[e|14]=s>>>8&255,C[e|15]=s&255;return 16}function F(e){e=e|0;if(e&15)return-1;C[e|0]=a>>>24,C[e|1]=a>>>16&255,C[e|2]=a>>>8&255,C[e|3]=a&255,C[e|4]=u>>>24,C[e|5]=u>>>16&255,C[e|6]=u>>>8&255,C[e|7]=u&255,C[e|8]=c>>>24,C[e|9]=c>>>16&255,C[e|10]=c>>>8&255,C[e|11]=c&255,C[e|12]=l>>>24,C[e|13]=l>>>16&255,C[e|14]=l>>>8&255,C[e|15]=l&255;return 16}function Y(){I(0,0,0,0);v=n,S=i,y=o,T=s}function K(e,t,r){e=e|0;t=t|0;r=r|0;var a=0;if(t&15)return-1;while((r|0)>=16){V[e&7](C[t|0]<<24|C[t|1]<<16|C[t|2]<<8|C[t|3],C[t|4]<<24|C[t|5]<<16|C[t|6]<<8|C[t|7],C[t|8]<<24|C[t|9]<<16|C[t|10]<<8|C[t|11],C[t|12]<<24|C[t|13]<<16|C[t|14]<<8|C[t|15]);C[t|0]=n>>>24,C[t|1]=n>>>16&255,C[t|2]=n>>>8&255,C[t|3]=n&255,C[t|4]=i>>>24,C[t|5]=i>>>16&255,C[t|6]=i>>>8&255,C[t|7]=i&255,C[t|8]=o>>>24,C[t|9]=o>>>16&255,C[t|10]=o>>>8&255,C[t|11]=o&255,C[t|12]=s>>>24,C[t|13]=s>>>16&255,C[t|14]=s>>>8&255,C[t|15]=s&255;a=a+16|0,t=t+16|0,r=r-16|0}return a|0}function H(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(t&15)return-1;while((r|0)>=16){J[e&1](C[t|0]<<24|C[t|1]<<16|C[t|2]<<8|C[t|3],C[t|4]<<24|C[t|5]<<16|C[t|6]<<8|C[t|7],C[t|8]<<24|C[t|9]<<16|C[t|10]<<8|C[t|11],C[t|12]<<24|C[t|13]<<16|C[t|14]<<8|C[t|15]);n=n+16|0,t=t+16|0,r=r-16|0}return n|0}var V=[I,R,w,N,D,L,M,P];var J=[w,U];return{set_rounds:x,set_state:B,set_iv:k,set_nonce:j,set_mask:G,set_counter:q,get_state:W,get_iv:F,gcm_init:Y,cipher:K,mac:H}}({Uint8Array:Uint8Array,Uint32Array:Uint32Array},e,t);return c.set_key=function(e,t,n,i,a,u,l,d,f){var p=s.subarray(0,60),_=s.subarray(256,316);p.set([t,n,i,a,u,l,d,f]);for(var h=e,E=1;h<4*e+28;h++){var m=p[h-1];(h%e==0||8===e&&h%e==4)&&(m=r[m>>>24]<<24^r[m>>>16&255]<<16^r[m>>>8&255]<<8^r[255&m]),h%e==0&&(m=m<<8^m>>>24^E<<24,E=E<<1^(128&E?27:0)),p[h]=p[h-e]^m}for(var g=0;g<h;g+=4)for(var v=0;v<4;v++)m=p[h-(4+g)+(4-v)%4],_[g+v]=g<4||g>=h-4?m:o[0][r[m>>>24]]^o[1][r[m>>>16&255]]^o[2][r[m>>>8&255]]^o[3][r[255&m]];c.set_rounds(e+5)},c};return c.ENC={ECB:0,CBC:2,CFB:4,OFB:6,CTR:7},c.DEC={ECB:1,CBC:3,CFB:5,OFB:6,CTR:7},c.MAC={CBC:0,GCM:1},c.HEAP_DATA=16384,c})(),u=new Uint8Array(1048576),c=(()=>a(null,u.buffer))();class l{constructor(e,t,r,n,i){this.nonce=null,this.counter=0,this.counterSize=0,this.heap=function(e,t,r){var n=t?t.byteLength:r||65536;if(4095&n||n<=0)throw new Error("heap size must be a positive integer and a multiple of 4096");return t=t||new e(new ArrayBuffer(n))}(Uint8Array,n).subarray(a.HEAP_DATA),this.asm=i||a(null,this.heap.buffer),this.mode=null,this.key=null,this.AES_reset(e,t,r)}AES_set_key(e){if(void 0!==e){if(!n(e))throw new TypeError("unexpected key type");var t=e.length;if(16!==t&&24!==t&&32!==t)throw new o("illegal key size");var r=new DataView(e.buffer,e.byteOffset,e.byteLength);this.asm.set_key(t>>2,r.getUint32(0),r.getUint32(4),r.getUint32(8),r.getUint32(12),t>16?r.getUint32(16):0,t>16?r.getUint32(20):0,t>24?r.getUint32(24):0,t>24?r.getUint32(28):0),this.key=e}else if(!this.key)throw new Error("key is required")}AES_CTR_set_options(e,t,r){if(void 0!==r){if(r<8||r>48)throw new o("illegal counter size");this.counterSize=r;var i=Math.pow(2,r)-1;this.asm.set_mask(0,0,i/4294967296|0,0|i)}else this.counterSize=r=48,this.asm.set_mask(0,0,65535,4294967295);if(void 0===e)throw new Error("nonce is required");if(!n(e))throw new TypeError("unexpected nonce type");var s=e.length;if(!s||s>16)throw new o("illegal nonce size");this.nonce=e;var a=new DataView(new ArrayBuffer(16));if(new Uint8Array(a.buffer).set(e),this.asm.set_nonce(a.getUint32(0),a.getUint32(4),a.getUint32(8),a.getUint32(12)),void 0!==t){if(!function(e){return"number"==typeof e}(t))throw new TypeError("unexpected counter type");if(t<0||t>=Math.pow(2,r))throw new o("illegal counter value");this.counter=t,this.asm.set_counter(0,0,t/4294967296|0,0|t)}else this.counter=0}AES_set_iv(e){if(void 0!==e){if(!n(e))throw new TypeError("unexpected iv type");if(16!==e.length)throw new o("illegal iv size");var t=new DataView(e.buffer,e.byteOffset,e.byteLength);this.iv=e,this.asm.set_iv(t.getUint32(0),t.getUint32(4),t.getUint32(8),t.getUint32(12))}else this.iv=null,this.asm.set_iv(0,0,0,0)}AES_set_padding(e){this.padding=void 0===e||!!e}AES_reset(e,t,r){return this.result=null,this.pos=0,this.len=0,this.AES_set_key(e),this.AES_set_iv(t),this.AES_set_padding(r),this}AES_Encrypt_process(e){if(!n(e))throw new TypeError("data isn't of expected type");for(var t=this.asm,r=this.heap,o=a.ENC[this.mode],s=a.HEAP_DATA,u=this.pos,c=this.len,l=0,d=e.length||0,f=0,p=0,_=new Uint8Array(c+d&-16);d>0;)c+=p=i(r,u+c,e,l,d),l+=p,d-=p,(p=t.cipher(o,s+u,c))&&_.set(r.subarray(u,u+p),f),f+=p,p<c?(u+=p,c-=p):(u=0,c=0);return this.result=_,this.pos=u,this.len=c,this}AES_Encrypt_finish(e){var t=null,r=0;void 0!==e&&(r=(t=this.AES_Encrypt_process(e).result).length);var n=this.asm,i=this.heap,s=a.ENC[this.mode],u=a.HEAP_DATA,c=this.pos,l=this.len,d=16-l%16,f=l;if(this.hasOwnProperty("padding")){if(this.padding){for(var p=0;p<d;++p)i[c+l+p]=d;f=l+=d}else if(l%16)throw new o("data length must be a multiple of the block size")}else l+=d;var _=new Uint8Array(r+f);return r&&_.set(t),l&&n.cipher(s,u+c,l),f&&_.set(i.subarray(c,c+f),r),this.result=_,this.pos=0,this.len=0,this}AES_Decrypt_process(e){if(!n(e))throw new TypeError("data isn't of expected type");var t=this.asm,r=this.heap,o=a.DEC[this.mode],s=a.HEAP_DATA,u=this.pos,c=this.len,l=0,d=e.length||0,f=0,p=c+d&-16,_=0,h=0;this.padding&&(p-=_=c+d-p||16);for(var E=new Uint8Array(p);d>0;)c+=h=i(r,u+c,e,l,d),l+=h,d-=h,(h=t.cipher(o,s+u,c-(d?0:_)))&&E.set(r.subarray(u,u+h),f),f+=h,h<c?(u+=h,c-=h):(u=0,c=0);return this.result=E,this.pos=u,this.len=c,this}AES_Decrypt_finish(e){var t=null,r=0;void 0!==e&&(r=(t=this.AES_Decrypt_process(e).result).length);var n=this.asm,i=this.heap,u=a.DEC[this.mode],c=a.HEAP_DATA,l=this.pos,d=this.len,f=d;if(d>0){if(d%16){if(this.hasOwnProperty("padding"))throw new o("data length must be a multiple of the block size");d+=16-d%16}if(n.cipher(u,c+l,d),this.hasOwnProperty("padding")&&this.padding){var p=i[l+f-1];if(p<1||p>16||p>f)throw new s("bad padding");for(var _=0,h=p;h>1;h--)_|=p^i[l+f-h];if(_)throw new s("bad padding");f-=p}}var E=new Uint8Array(r+f);return r>0&&E.set(t),f>0&&E.set(i.subarray(l,l+f),r),this.result=E,this.pos=0,this.len=0,this}}var d=(()=>{class e extends l{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!(arguments.length>2&&void 0!==arguments[2])||arguments[2],arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0),this.mode="CBC",this.BLOCK_SIZE=16}encrypt(e){return this.AES_Encrypt_finish(e)}decrypt(e){return this.AES_Decrypt_finish(e)}}return e.encrypt=f,e.decrypt=p,e})();function f(e,t,r,n){if(void 0===e)throw new SyntaxError("data required");if(void 0===t)throw new SyntaxError("key required");return new d(t,n,r,u,c).encrypt(e).result}function p(e,t,r,n){if(void 0===e)throw new SyntaxError("data required");if(void 0===t)throw new SyntaxError("key required");return new d(t,n,r,u,c).decrypt(e).result}var _="undefined"!=typeof crypto?crypto:"undefined"!=typeof msCrypto?msCrypto:void 0;void 0!==_&&_.getRandomValues},"./src/vendor/bson.bundle.js":function(e,t,r){(function(e,r){var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s=!1;function a(){s=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)n[t]=e[t],i[e.charCodeAt(t)]=t;i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63}function u(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function c(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16)+(e[o+1]<<8)+e[o+2],i.push(u(n));return i.join("")}function l(e){var t;s||a();for(var r=e.length,i=r%3,o="",u=[],l=0,d=r-i;l<d;l+=16383)u.push(c(e,l,l+16383>d?d:l+16383));return 1===i?(t=e[r-1],o+=n[t>>2],o+=n[t<<4&63],o+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],o+=n[t>>10],o+=n[t>>4&63],o+=n[t<<2&63],o+="="),u.push(o),u.join("")}function d(e,t,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,d=r?i-1:0,f=r?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+d],d+=f,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+d],d+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)}function f(e,t,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,_=n?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+d>=1?f/u:f*Math.pow(2,1-d))*u>=2&&(s++,u/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*u-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=_,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[r+p]=255&s,p+=_,s/=256,c-=8);e[r+p-_]|=128*h}var p={}.toString,_=Array.isArray||function(e){return"[object Array]"==p.call(e)};g.TYPED_ARRAY_SUPPORT=void 0===e.TYPED_ARRAY_SUPPORT||e.TYPED_ARRAY_SUPPORT;var h=E();function E(){return g.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function m(e,t){if(E()<t)throw new RangeError("Invalid typed array length");return g.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=g.prototype:(null===e&&(e=new g(t)),e.length=t),e}function g(e,t,r){if(!(g.TYPED_ARRAY_SUPPORT||this instanceof g))return new g(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return y(this,e)}return v(this,e,t,r)}function v(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);g.TYPED_ARRAY_SUPPORT?(e=t).__proto__=g.prototype:e=T(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!g.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|C(t,r),i=(e=m(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(b(t)){var r=0|A(t.length);return 0===(e=m(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?m(e,0):T(e,t);if("Buffer"===t.type&&_(t.data))return T(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function S(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function y(e,t){if(S(t),e=m(e,t<0?0:0|A(t)),!g.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function T(e,t){var r=t.length<0?0:0|A(t.length);e=m(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function A(e){if(e>=E())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+E().toString(16)+" bytes");return 0|e}function b(e){return!(null==e||!e._isBuffer)}function C(e,t){if(b(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return $(e).length;default:if(n)return Q(e).length;t=(""+t).toLowerCase(),n=!0}}function O(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function I(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=g.from(t,n)),b(t))return 0===t.length?-1:R(e,t,r,n,i);if("number"==typeof t)return t&=255,g.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):R(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function R(e,t,r,n,i){var o,s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=r;o<a;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var d=!0,f=0;f<u;f++)if(c(e,o+f)!==c(t,f)){d=!1;break}if(d)return o}return-1}function w(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function N(e,t,r,n){return Z(Q(t,e.length-r),e,r,n)}function D(e,t,r,n){return Z(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function L(e,t,r,n){return D(e,t,r,n)}function M(e,t,r,n){return Z($(t),e,r,n)}function P(e,t,r,n){return Z(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function U(e,t,r){return 0===t&&r===e.length?l(e):l(e.slice(t,r))}function x(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,u,c=e[i],l=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=r)switch(d){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,d=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=d}return function(e){var t=e.length;if(t<=B)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=B));return r}(n)}g.poolSize=8192,g._augment=function(e){return e.__proto__=g.prototype,e},g.from=function(e,t,r){return v(null,e,t,r)},g.TYPED_ARRAY_SUPPORT&&(g.prototype.__proto__=Uint8Array.prototype,g.__proto__=Uint8Array),g.alloc=function(e,t,r){return function(e,t,r,n){return S(t),t<=0?m(e,t):void 0!==r?"string"==typeof n?m(e,t).fill(r,n):m(e,t).fill(r):m(e,t)}(null,e,t,r)},g.allocUnsafe=function(e){return y(null,e)},g.allocUnsafeSlow=function(e){return y(null,e)},g.isBuffer=ee,g.compare=function(e,t){if(!b(e)||!b(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},g.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},g.concat=function(e,t){if(!_(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return g.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=g.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!b(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},g.byteLength=C,g.prototype._isBuffer=!0,g.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)O(this,t,t+1);return this},g.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)O(this,t,t+3),O(this,t+1,t+2);return this},g.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)O(this,t,t+7),O(this,t+1,t+6),O(this,t+2,t+5),O(this,t+3,t+4);return this},g.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?x(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return G(this,t,r);case"utf8":case"utf-8":return x(this,t,r);case"ascii":return k(this,t,r);case"latin1":case"binary":return j(this,t,r);case"base64":return U(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},g.prototype.equals=function(e){if(!b(e))throw new TypeError("Argument must be a Buffer");return this===e||0===g.compare(this,e)},g.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},g.prototype.compare=function(e,t,r,n,i){if(!b(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var o=i-n,s=r-t,a=Math.min(o,s),u=this.slice(n,i),c=e.slice(t,r),l=0;l<a;++l)if(u[l]!==c[l]){o=u[l],s=c[l];break}return o<s?-1:s<o?1:0},g.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},g.prototype.indexOf=function(e,t,r){return I(this,e,t,r,!0)},g.prototype.lastIndexOf=function(e,t,r){return I(this,e,t,r,!1)},g.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return w(this,e,t,r);case"utf8":case"utf-8":return N(this,e,t,r);case"ascii":return D(this,e,t,r);case"latin1":case"binary":return L(this,e,t,r);case"base64":return M(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},g.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var B=4096;function k(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function j(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function G(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=z(e[o]);return i}function q(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function W(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function F(e,t,r,n,i,o){if(!b(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function Y(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function K(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function H(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function V(e,t,r,n,i){return i||H(e,0,r,4),f(e,t,r,n,23,4),r+4}function J(e,t,r,n,i){return i||H(e,0,r,8),f(e,t,r,n,52,8),r+8}g.prototype.slice=function(e,t){var r,n=this.length;if(e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),g.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=g.prototype;else{var i=t-e;r=new g(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},g.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||W(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},g.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||W(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},g.prototype.readUInt8=function(e,t){return t||W(e,1,this.length),this[e]},g.prototype.readUInt16LE=function(e,t){return t||W(e,2,this.length),this[e]|this[e+1]<<8},g.prototype.readUInt16BE=function(e,t){return t||W(e,2,this.length),this[e]<<8|this[e+1]},g.prototype.readUInt32LE=function(e,t){return t||W(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},g.prototype.readUInt32BE=function(e,t){return t||W(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},g.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||W(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},g.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||W(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},g.prototype.readInt8=function(e,t){return t||W(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},g.prototype.readInt16LE=function(e,t){t||W(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},g.prototype.readInt16BE=function(e,t){t||W(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},g.prototype.readInt32LE=function(e,t){return t||W(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},g.prototype.readInt32BE=function(e,t){return t||W(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},g.prototype.readFloatLE=function(e,t){return t||W(e,4,this.length),d(this,e,!0,23,4)},g.prototype.readFloatBE=function(e,t){return t||W(e,4,this.length),d(this,e,!1,23,4)},g.prototype.readDoubleLE=function(e,t){return t||W(e,8,this.length),d(this,e,!0,52,8)},g.prototype.readDoubleBE=function(e,t){return t||W(e,8,this.length),d(this,e,!1,52,8)},g.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||F(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},g.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||F(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},g.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,1,255,0),g.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},g.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Y(this,e,t,!0),t+2},g.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Y(this,e,t,!1),t+2},g.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):K(this,e,t,!0),t+4},g.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):K(this,e,t,!1),t+4},g.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);F(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},g.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);F(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},g.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,1,127,-128),g.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},g.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Y(this,e,t,!0),t+2},g.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Y(this,e,t,!1),t+2},g.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,4,2147483647,-2147483648),g.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):K(this,e,t,!0),t+4},g.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||F(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),g.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):K(this,e,t,!1),t+4},g.prototype.writeFloatLE=function(e,t,r){return V(this,e,t,!0,r)},g.prototype.writeFloatBE=function(e,t,r){return V(this,e,t,!1,r)},g.prototype.writeDoubleLE=function(e,t,r){return J(this,e,t,!0,r)},g.prototype.writeDoubleBE=function(e,t,r){return J(this,e,t,!1,r)},g.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!g.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},g.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!g.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=b(e)?e:Q(new g(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var X=/[^+\/0-9A-Za-z-_]/g;function z(e){return e<16?"0"+e.toString(16):e.toString(16)}function Q(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function $(e){return function(e){var t,r,n,u,c,l;s||a();var d=e.length;if(d%4>0)throw new Error("Invalid string. Length must be a multiple of 4");c="="===e[d-2]?2:"="===e[d-1]?1:0,l=new o(3*d/4-c),n=c>0?d-4:d;var f=0;for(t=0,r=0;t<n;t+=4,r+=3)u=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],l[f++]=u>>16&255,l[f++]=u>>8&255,l[f++]=255&u;return 2===c?(u=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,l[f++]=255&u):1===c&&(u=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,l[f++]=u>>8&255,l[f++]=255&u),l}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(X,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Z(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function ee(e){return null!=e&&(!!e._isBuffer||te(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&te(e.slice(0,0))}(e))}function te(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var re=Object.freeze({INSPECT_MAX_BYTES:50,kMaxLength:h,Buffer:g,SlowBuffer:function(e){return+e!=e&&(e=0),g.alloc(+e)},isBuffer:ee});Map;var ne=function(){function e(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0}),e.isLong=t;var r={},n={};function i(e,t){var i,o,a;return t?(a=0<=(e>>>=0)&&e<256)&&(o=n[e])?o:(i=s(e,(0|e)<0?-1:0,!0),a&&(n[e]=i),i):(a=-128<=(e|=0)&&e<128)&&(o=r[e])?o:(i=s(e,e<0?-1:0,!1),a&&(r[e]=i),i)}function o(e,t){if(isNaN(e))return t?h:_;if(t){if(e<0)return h;if(e>=d)return S}else{if(e<=-f)return y;if(e+1>=f)return v}return e<0?o(-e,t).neg():s(e%l|0,e/l|0,t)}function s(t,r,n){return new e(t,r,n)}e.fromInt=i,e.fromNumber=o,e.fromBits=s;var a=Math.pow;function u(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return _;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return u(e.substring(1),t,r).neg();for(var i=o(a(r,8)),s=_,c=0;c<e.length;c+=8){var l=Math.min(8,e.length-c),d=parseInt(e.substring(c,c+l),r);if(l<8){var f=o(a(r,l));s=s.mul(f).add(o(d))}else s=(s=s.mul(i)).add(o(d))}return s.unsigned=t,s}function c(e,t){return"number"==typeof e?o(e,t):"string"==typeof e?u(e,t):s(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}e.fromString=u,e.fromValue=c;var l=4294967296,d=l*l,f=d/2,p=i(1<<24),_=i(0);e.ZERO=_;var h=i(0,!0);e.UZERO=h;var E=i(1);e.ONE=E;var m=i(1,!0);e.UONE=m;var g=i(-1);e.NEG_ONE=g;var v=s(-1,2147483647,!1);e.MAX_VALUE=v;var S=s(-1,-1,!0);e.MAX_UNSIGNED_VALUE=S;var y=s(0,-2147483648,!1);e.MIN_VALUE=y;var T=e.prototype;return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(y)){var t=o(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=o(a(e,6),this.unsigned),s=this,u="";;){var c=s.div(i),l=(s.sub(c.mul(i)).toInt()>>>0).toString(e);if((s=c).isZero())return l+u;for(;l.length<6;)l="0"+l;u=""+l+u}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return t(e)||(e=c(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(e){if(t(e)||(e=c(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(E)},T.neg=T.negate,T.add=function(e){t(e)||(e=c(e));var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,a=e.high>>>16,u=65535&e.high,l=e.low>>>16,d=0,f=0,p=0,_=0;return p+=(_+=o+(65535&e.low))>>>16,f+=(p+=i+l)>>>16,d+=(f+=n+u)>>>16,d+=r+a,s((p&=65535)<<16|(_&=65535),(d&=65535)<<16|(f&=65535),this.unsigned)},T.subtract=function(e){return t(e)||(e=c(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){if(this.isZero())return _;if(t(e)||(e=c(e)),e.isZero())return _;if(this.eq(y))return e.isOdd()?y:_;if(e.eq(y))return this.isOdd()?y:_;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(p)&&e.lt(p))return o(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,a=65535&this.low,u=e.high>>>16,l=65535&e.high,d=e.low>>>16,f=65535&e.low,h=0,E=0,m=0,g=0;return m+=(g+=a*f)>>>16,E+=(m+=i*f)>>>16,m&=65535,E+=(m+=a*d)>>>16,h+=(E+=n*f)>>>16,E&=65535,h+=(E+=i*d)>>>16,E&=65535,h+=(E+=a*l)>>>16,h+=r*f+n*d+i*l+a*u,s((m&=65535)<<16|(g&=65535),(h&=65535)<<16|(E&=65535),this.unsigned)},T.mul=T.multiply,T.divide=function(e){if(t(e)||(e=c(e)),e.isZero())throw Error("division by zero");var r,n,i;if(this.isZero())return this.unsigned?h:_;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return h;if(e.gt(this.shru(1)))return m;i=h}else{if(this.eq(y))return e.eq(E)||e.eq(g)?y:e.eq(y)?E:(r=this.shr(1).div(e).shl(1)).eq(_)?e.isNegative()?E:g:(n=this.sub(e.mul(r)),i=r.add(n.div(e)));else if(e.eq(y))return this.unsigned?h:_;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=_}for(n=this;n.gte(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:a(2,s-48),l=o(r),d=l.mul(e);d.isNegative()||d.gt(n);)d=(l=o(r-=u,this.unsigned)).mul(e);l.isZero()&&(l=E),i=i.add(l),n=n.sub(d)}return i},T.div=T.divide,T.modulo=function(e){return t(e)||(e=c(e)),this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return s(~this.low,~this.high,this.unsigned)},T.and=function(e){return t(e)||(e=c(e)),s(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return t(e)||(e=c(e)),s(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return t(e)||(e=c(e)),s(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?s(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):s(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?s(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):s(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0===(e&=63))return this;var r=this.high;return e<32?s(this.low>>>e|r<<32-e,r>>>e,this.unsigned):s(32===e?r:r>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?s(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:s(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},e.fromBytes=function(t,r,n){return n?e.fromBytesLE(t,r):e.fromBytesBE(t,r)},e.fromBytesLE=function(t,r){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)},e.fromBytesBE=function(t,r){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)},e.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},e.fromExtendedJSON=function(t,r){var n=e.fromString(t.$numberLong);return r&&r.relaxed?n.toNumber():n},Object.defineProperty(e.prototype,"_bsontype",{value:"Long"}),e}();function ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function se(e,t,r){return t&&oe(e.prototype,t),r&&oe(e,r),e}var ae=function(){function e(t){ie(this,e),t instanceof Number&&(t=t.valueOf()),this.value=t}return se(e,[{key:"valueOf",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:{$numberDouble:this.value.toString()}}}],[{key:"fromExtendedJSON",value:function(t,r){return r&&r.relaxed?parseFloat(t.$numberDouble):new e(parseFloat(t.$numberDouble))}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Double"}),e}();function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){return!t||"object"!==ue(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function le(e){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fe=function(e){function t(e,r){return ie(this,t),ce(ne.isLong(e)?ce(this,le(t).call(this,e.low,e.high,!0)):ce(this,le(t).call(this,e,r,!0)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(t,ne),se(t,[{key:"toJSON",value:function(){return{$timestamp:this.toString()}}},{key:"toExtendedJSON",value:function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}}}],[{key:"fromInt",value:function(e){return new t(ne.fromInt(e,!0))}},{key:"fromNumber",value:function(e){return new t(ne.fromNumber(e,!0))}},{key:"fromBits",value:function(e,r){return new t(e,r)}},{key:"fromString",value:function(e,r){return new t(ne.fromString(e,r,!0))}},{key:"fromExtendedJSON",value:function(e){return new t(e.$timestamp.i,e.$timestamp.t)}}]),Object.defineProperty(t.prototype,"_bsontype",{value:"Timestamp"}),t.MAX_VALUE=t.MAX_UNSIGNED_VALUE,t}(),pe={};function _e(e){for(var t=new Uint8Array(e),r=0;r<e;++r)t[r]=Math.floor(256*Math.random());return t}var he={normalizedFunctionString:function(e){return e.toString().replace("function(","function (")},randomBytes:function(){var e=_e;if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues)e=function(e){return window.crypto.getRandomValues(new Uint8Array(e))};else{try{e=pe.randomBytes}catch(e){}null==e&&(e=_e)}return e}()};new Date;var Ee=function(){function e(e,t){var r={seen:[],stylize:ge};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),Ae(t)?r.showHidden=t:t&&Pe(r,t),Ie(r.showHidden)&&(r.showHidden=!1),Ie(r.depth)&&(r.depth=2),Ie(r.colors)&&(r.colors=!1),Ie(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=me),ve(r,e,r.depth)}return e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e}();function me(e,t){var r=Ee.styles[t];return r?"["+Ee.colors[r][0]+"m"+e+"["+Ee.colors[r][1]+"m":e}function ge(e,t){return e}function ve(e,t,r){if(e.customInspect&&t&&Le(t.inspect)&&t.inspect!==Ee&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return Oe(n)||(n=ve(e,n,r)),n}var i=function(e,t){if(Ie(t))return e.stylize("undefined","undefined");if(Oe(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(Ce(t))return e.stylize(""+t,"number");if(Ae(t))return e.stylize(""+t,"boolean");if(be(t))return e.stylize("null","null")}(e,t);if(i)return i;var o=Object.keys(t),s=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),De(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return Se(t);if(0===o.length){if(Le(t)){var a=t.name?": "+t.name:"";return e.stylize("[Function"+a+"]","special")}if(Re(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Ne(t))return e.stylize(Date.prototype.toString.call(t),"date");if(De(t))return Se(t)}var u,c="",l=!1,d=["{","}"];(Te(t)&&(l=!0,d=["[","]"]),Le(t))&&(c=" [Function"+(t.name?": "+t.name:"")+"]");return Re(t)&&(c=" "+RegExp.prototype.toString.call(t)),Ne(t)&&(c=" "+Date.prototype.toUTCString.call(t)),De(t)&&(c=" "+Se(t)),0!==o.length||l&&0!=t.length?r<0?Re(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=l?function(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)Ue(t,String(s))?o.push(ye(e,t,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(ye(e,t,r,n,i,!0))}),o}(e,t,r,s,o):o.map(function(n){return ye(e,t,r,s,n,l)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,c,d)):d[0]+c+d[1]}function Se(e){return"["+Error.prototype.toString.call(e)+"]"}function ye(e,t,r,n,i,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),Ue(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=be(r)?ve(e,u.value,null):ve(e,u.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),Ie(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function Te(e){return Array.isArray(e)}function Ae(e){return"boolean"==typeof e}function be(e){return null===e}function Ce(e){return"number"==typeof e}function Oe(e){return"string"==typeof e}function Ie(e){return void 0===e}function Re(e){return we(e)&&"[object RegExp]"===Me(e)}function we(e){return"object"===ue(e)&&null!==e}function Ne(e){return we(e)&&"[object Date]"===Me(e)}function De(e){return we(e)&&("[object Error]"===Me(e)||e instanceof Error)}function Le(e){return"function"==typeof e}function Me(e){return Object.prototype.toString.call(e)}function Pe(e,t){if(!t||!we(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function Ue(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var xe=Ee,Be=function t(r,n){if(Ie(e.process))return function(){return t(r,n).apply(this,arguments)};var i=!1;return function(){return i||(console.error(n),i=!0),r.apply(this,arguments)}},ke=(()=>re.Buffer)(),je=Be,Ge=(0,he.randomBytes)(5),qe=new RegExp("^[0-9a-fA-F]{24}$"),We=function(){var e=!1;try{ke&&ke.from&&(e=!0)}catch(t){e=!1}return e}(),Fe=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<=15?"0":"")+t.toString(16);return e}(),Ye=function(){for(var e=[],t=0;t<10;)e[48+t]=t++;for(;t<16;)e[55+t]=e[87+t]=t++;return e}(),Ke=ke;function He(e,t){var r=e[t];return new TypeError('ObjectId string "'.concat(e,'" contains invalid character "').concat(r,'" with character code (').concat(e.charCodeAt(t),"). All character codes for a non-hex string must be less than 256."))}var Ve=function(){function e(t){if(ie(this,e),t instanceof e)return t;if(null==t||"number"==typeof t)return this.id=e.generate(t),void(e.cacheHexString&&(this.__id=this.toString("hex")));var r=e.isValid(t);if(!r&&null!=t)throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(r&&"string"==typeof t&&24===t.length&&We)return new e(ke.from(t,"hex"));if(r&&"string"==typeof t&&24===t.length)return e.createFromHexString(t);if(null==t||12!==t.length){if(null!=t&&t.toHexString)return e.createFromHexString(t.toHexString());throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=t,e.cacheHexString&&(this.__id=this.toString("hex"))}return se(e,[{key:"toHexString",value:function(){if(e.cacheHexString&&this.__id)return this.__id;var t="";if(!this.id||!this.id.length)throw new TypeError("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof Ke)return t=function(e){return e.toString("hex")}(this.id),e.cacheHexString&&(this.__id=t),t;for(var r=0;r<this.id.length;r++){var n=Fe[this.id.charCodeAt(r)];if("string"!=typeof n)throw He(this.id,r);t+=n}return e.cacheHexString&&(this.__id=t),t}},{key:"toString",value:function(e){return this.id&&this.id.copy?this.id.toString("string"==typeof e?e:"hex"):this.toHexString()}},{key:"toJSON",value:function(){return this.toHexString()}},{key:"equals",value:function(t){return t instanceof e?this.toString()===t.toString():"string"==typeof t&&e.isValid(t)&&12===t.length&&this.id instanceof Ke?t===this.id.toString("binary"):"string"==typeof t&&e.isValid(t)&&24===t.length?t.toLowerCase()===this.toHexString():"string"==typeof t&&e.isValid(t)&&12===t.length?t===this.id:!(null==t||!(t instanceof e||t.toHexString))&&t.toHexString()===this.toHexString()}},{key:"getTimestamp",value:function(){var e=new Date,t=this.id.readUInt32BE(0);return e.setTime(1e3*Math.floor(t)),e}},{key:"toExtendedJSON",value:function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}}],[{key:"getInc",value:function(){return e.index=(e.index+1)%16777215}},{key:"generate",value:function(t){"number"!=typeof t&&(t=~~(Date.now()/1e3));var r=e.getInc(),n=ke.alloc(12);return n[3]=255&t,n[2]=t>>8&255,n[1]=t>>16&255,n[0]=t>>24&255,n[4]=Ge[0],n[5]=Ge[1],n[6]=Ge[2],n[7]=Ge[3],n[8]=Ge[4],n[11]=255&r,n[10]=r>>8&255,n[9]=r>>16&255,n}},{key:"createPk",value:function(){return new e}},{key:"createFromTime",value:function(t){var r=ke.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r[3]=255&t,r[2]=t>>8&255,r[1]=t>>16&255,r[0]=t>>24&255,new e(r)}},{key:"createFromHexString",value:function(t){if(void 0===t||null!=t&&24!==t.length)throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(We)return new e(ke.from(t,"hex"));for(var r=new Ke(12),n=0,i=0;i<24;)r[n++]=Ye[t.charCodeAt(i++)]<<4|Ye[t.charCodeAt(i++)];return new e(r)}},{key:"isValid",value:function(t){return null!=t&&("number"==typeof t||("string"==typeof t?12===t.length||24===t.length&&qe.test(t):t instanceof e||(t instanceof Ke&&12===t.length||!!t.toHexString&&(12===t.id.length||24===t.id.length&&qe.test(t.id)))))}},{key:"fromExtendedJSON",value:function(t){return new e(t.$oid)}}]),e.get_inc=je(function(){return e.getInc()},"Please use the static `ObjectId.getInc()` instead"),e.prototype.get_inc=je(function(){return e.getInc()},"Please use the static `ObjectId.getInc()` instead"),e.prototype.getInc=je(function(){return e.getInc()},"Please use the static `ObjectId.getInc()` instead"),e.prototype.generate=je(function(t){return e.generate(t)},"Please use the static `ObjectId.generate(time)` instead"),Object.defineProperty(e.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=255&e,this.id[2]=e>>8&255,this.id[1]=e>>16&255,this.id[0]=e>>24&255}}),e.prototype[xe.custom||"inspect"]=e.prototype.toString,e.index=~~(16777215*Math.random()),Object.defineProperty(e.prototype,"_bsontype",{value:"ObjectID"}),e}();var Je=function(){function e(t,r){ie(this,e),this.pattern=t||"",this.options=r?function(e){return e.split("").sort().join("")}(r):"";for(var n=0;n<this.options.length;n++)if("i"!==this.options[n]&&"m"!==this.options[n]&&"x"!==this.options[n]&&"l"!==this.options[n]&&"s"!==this.options[n]&&"u"!==this.options[n])throw new Error("The regular expression option [".concat(this.options[n],"] is not supported"))}return se(e,[{key:"toExtendedJSON",value:function(e){return(e=e||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}}],[{key:"parseOptions",value:function(e){return e?e.split("").sort().join(""):""}},{key:"fromExtendedJSON",value:function(t){return t.$regex?"BSONRegExp"===t.$regex._bsontype?t:new e(t.$regex,e.parseOptions(t.$options)):new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options))}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"BSONRegExp"}),e}(),Xe=function(){function e(t){ie(this,e),this.value=t}return se(e,[{key:"valueOf",value:function(){return this.value}},{key:"toString",value:function(){return this.value}},{key:"inspect",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(){return{$symbol:this.value}}}],[{key:"fromExtendedJSON",value:function(t){return new e(t.$symbol)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Symbol"}),e}(),ze=function(){function e(t){ie(this,e),t instanceof Number&&(t=t.valueOf()),this.value=t}return se(e,[{key:"valueOf",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}}}],[{key:"fromExtendedJSON",value:function(t,r){return r&&r.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Int32"}),e}(),Qe=function(){function e(t,r){ie(this,e),this.code=t,this.scope=r}return se(e,[{key:"toJSON",value:function(){return{scope:this.scope,code:this.code}}},{key:"toExtendedJSON",value:function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}}],[{key:"fromExtendedJSON",value:function(t){return new e(t.$code,t.$scope)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Code"}),e}(),$e=(()=>re.Buffer)(),Ze=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,et=/^(\+|-)?(Infinity|inf)$/i,tt=/^(\+|-)?NaN$/i,rt=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),nt=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),it=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),ot=/^([-+])?(\d+)?$/;function st(e){return!isNaN(parseInt(e,10))}function at(e){var t=ne.fromNumber(1e9),r=ne.fromNumber(0);if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:r};for(var n=0;n<=3;n++)r=(r=r.shiftLeft(32)).add(new ne(e.parts[n],0)),e.parts[n]=r.div(t).low,r=r.modulo(t);return{quotient:e,rem:r}}function ut(e,t){throw new TypeError('"'.concat(e,'" is not a valid Decimal128 string - ').concat(t))}var ct=function(){function e(e){this.bytes=e}e.fromString=function(t){var r,n=!1,i=!1,o=!1,s=0,a=0,u=0,c=0,l=0,d=[0],f=0,p=0,_=0,h=0,E=0,m=0,g=[0,0],v=[0,0],S=0;if(t.length>=7e3)throw new TypeError(t+" not a valid Decimal128 string");var y=t.match(Ze),T=t.match(et),A=t.match(tt);if(!y&&!T&&!A||0===t.length)throw new TypeError(t+" not a valid Decimal128 string");if(y){var b=y[2],C=y[4],O=y[5],I=y[6];C&&void 0===I&&ut(t,"missing exponent power"),C&&void 0===b&&ut(t,"missing exponent base"),void 0===C&&(O||I)&&ut(t,"missing e before exponent")}if("+"!==t[S]&&"-"!==t[S]||(n="-"===t[S++]),!st(t[S])&&"."!==t[S]){if("i"===t[S]||"I"===t[S])return new e($e.from(n?nt:it));if("N"===t[S])return new e($e.from(rt))}for(;st(t[S])||"."===t[S];)"."!==t[S]?(f<34&&("0"!==t[S]||o)&&(o||(l=a),o=!0,d[p++]=parseInt(t[S],10),f+=1),o&&(u+=1),i&&(c+=1),a+=1,S+=1):(i&&ut(t,"contains multiple periods"),i=!0,S+=1);if(i&&!a)throw new TypeError(t+" not a valid Decimal128 string");if("e"===t[S]||"E"===t[S]){var R=t.substr(++S).match(ot);if(!R||!R[2])return new e($e.from(rt));E=parseInt(R[0],10),S+=R[0].length}if(t[S])return new e($e.from(rt));if(_=0,f){if(h=f-1,1!==(s=u))for(;"0"===t[l+s-1];)s-=1}else _=0,h=0,d[0]=0,u=1,f=1,s=0;for(E<=c&&c-E>16384?E=-6176:E-=c;E>6111;){if((h+=1)-_>34){if(d.join("").match(/^0+$/)){E=6111;break}ut(t,"overflow")}E-=1}for(;E<-6176||f<u;){if(0===h&&s<f){E=-6176,s=0;break}if(f<u?u-=1:h-=1,E<6111)E+=1;else{if(d.join("").match(/^0+$/)){E=6111;break}ut(t,"overflow")}}if(h-_+1<s){var w=a;i&&(l+=1,w+=1),n&&(l+=1,w+=1);var N=parseInt(t[l+h+1],10),D=0;if(N>=5&&(D=1,5===N))for(D=d[h]%2==1,m=l+h+2;m<w;m++)if(parseInt(t[m],10)){D=1;break}if(D)for(var L=h;L>=0;L--)if(++d[L]>9&&(d[L]=0,0===L)){if(!(E<6111))return new e($e.from(n?nt:it));E+=1,d[L]=1}}if(g=ne.fromNumber(0),v=ne.fromNumber(0),0===s)g=ne.fromNumber(0),v=ne.fromNumber(0);else if(h-_<17){var M=_;for(v=ne.fromNumber(d[M++]),g=new ne(0,0);M<=h;M++)v=(v=v.multiply(ne.fromNumber(10))).add(ne.fromNumber(d[M]))}else{var P=_;for(g=ne.fromNumber(d[P++]);P<=h-17;P++)g=(g=g.multiply(ne.fromNumber(10))).add(ne.fromNumber(d[P]));for(v=ne.fromNumber(d[P++]);P<=h;P++)v=(v=v.multiply(ne.fromNumber(10))).add(ne.fromNumber(d[P]))}var U=function(e,t){if(!e&&!t)return{high:ne.fromNumber(0),low:ne.fromNumber(0)};var r=e.shiftRightUnsigned(32),n=new ne(e.getLowBits(),0),i=t.shiftRightUnsigned(32),o=new ne(t.getLowBits(),0),s=r.multiply(i),a=r.multiply(o),u=n.multiply(i),c=n.multiply(o);return s=s.add(a.shiftRightUnsigned(32)),a=new ne(a.getLowBits(),0).add(u).add(c.shiftRightUnsigned(32)),{high:s=s.add(a.shiftRightUnsigned(32)),low:c=a.shiftLeft(32).add(new ne(c.getLowBits(),0))}}(g,ne.fromString("100000000000000000"));U.low=U.low.add(v),function(e,t){var r=e.high>>>0,n=t.high>>>0;return r<n||r===n&&e.low>>>0<t.low>>>0}(U.low,v)&&(U.high=U.high.add(ne.fromNumber(1))),r=E+6176;var x={low:ne.fromNumber(0),high:ne.fromNumber(0)};U.high.shiftRightUnsigned(49).and(ne.fromNumber(1)).equals(ne.fromNumber(1))?(x.high=x.high.or(ne.fromNumber(3).shiftLeft(61)),x.high=x.high.or(ne.fromNumber(r).and(ne.fromNumber(16383).shiftLeft(47))),x.high=x.high.or(U.high.and(ne.fromNumber(0x7fffffffffff)))):(x.high=x.high.or(ne.fromNumber(16383&r).shiftLeft(49)),x.high=x.high.or(U.high.and(ne.fromNumber(562949953421311)))),x.low=U.low,n&&(x.high=x.high.or(ne.fromString("9223372036854775808")));var B=$e.alloc(16);return S=0,B[S++]=255&x.low.low,B[S++]=x.low.low>>8&255,B[S++]=x.low.low>>16&255,B[S++]=x.low.low>>24&255,B[S++]=255&x.low.high,B[S++]=x.low.high>>8&255,B[S++]=x.low.high>>16&255,B[S++]=x.low.high>>24&255,B[S++]=255&x.high.low,B[S++]=x.high.low>>8&255,B[S++]=x.high.low>>16&255,B[S++]=x.high.low>>24&255,B[S++]=255&x.high.high,B[S++]=x.high.high>>8&255,B[S++]=x.high.high>>16&255,B[S++]=x.high.high>>24&255,new e(B)};return e.prototype.toString=function(){for(var e,t,r,n,i,o,s=0,a=new Array(36),u=0;u<a.length;u++)a[u]=0;var c,l,d,f,p,_=0,h=!1,E={parts:new Array(4)},m=[];_=0;var g=this.bytes;if(n=g[_++]|g[_++]<<8|g[_++]<<16|g[_++]<<24,r=g[_++]|g[_++]<<8|g[_++]<<16|g[_++]<<24,t=g[_++]|g[_++]<<8|g[_++]<<16|g[_++]<<24,e=g[_++]|g[_++]<<8|g[_++]<<16|g[_++]<<24,_=0,{low:new ne(n,r),high:new ne(t,e)}.high.lessThan(ne.ZERO)&&m.push("-"),(i=e>>26&31)>>3==3){if(30===i)return m.join("")+"Infinity";if(31===i)return"NaN";o=e>>15&16383,d=8+(e>>14&1)}else d=e>>14&7,o=e>>17&16383;if(c=o-6176,E.parts[0]=(16383&e)+((15&d)<<14),E.parts[1]=t,E.parts[2]=r,E.parts[3]=n,0===E.parts[0]&&0===E.parts[1]&&0===E.parts[2]&&0===E.parts[3])h=!0;else for(p=3;p>=0;p--){var v=0,S=at(E);if(E=S.quotient,v=S.rem.low)for(f=8;f>=0;f--)a[9*p+f]=v%10,v=Math.floor(v/10)}if(h)s=1,a[_]=0;else for(s=36;!a[_];)s-=1,_+=1;if((l=s-1+c)>=34||l<=-7||c>0){if(s>34)return m.push(0),c>0?m.push("E+"+c):c<0&&m.push("E"+c),m.join("");m.push(a[_++]),(s-=1)&&m.push(".");for(var y=0;y<s;y++)m.push(a[_++]);m.push("E"),l>0?m.push("+"+l):m.push(l)}else if(c>=0)for(var T=0;T<s;T++)m.push(a[_++]);else{var A=s+c;if(A>0)for(var b=0;b<A;b++)m.push(a[_++]);else m.push("0");for(m.push(".");A++<0;)m.push("0");for(var C=0;C<s-Math.max(A-1,0);C++)m.push(a[_++])}return m.join("")},e.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},e.fromExtendedJSON=function(t){return e.fromString(t.$numberDecimal)},Object.defineProperty(e.prototype,"_bsontype",{value:"Decimal128"}),e}(),lt=function(){function e(){ie(this,e)}return se(e,[{key:"toExtendedJSON",value:function(){return{$minKey:1}}}],[{key:"fromExtendedJSON",value:function(){return new e}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"MinKey"}),e}(),dt=function(){function e(){ie(this,e)}return se(e,[{key:"toExtendedJSON",value:function(){return{$maxKey:1}}}],[{key:"fromExtendedJSON",value:function(){return new e}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"MaxKey"}),e}(),ft=function(){function e(t,r,n,i){ie(this,e);var o=t.split(".");2===o.length&&(n=o.shift(),t=o.shift()),this.collection=t,this.oid=r,this.db=n,this.fields=i||{}}return se(e,[{key:"toJSON",value:function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(e.$db=this.db),e}},{key:"toExtendedJSON",value:function(e){e=e||{};var t={$ref:this.collection,$id:this.oid};return e.legacy?t:(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields))}}],[{key:"fromExtendedJSON",value:function(t){var r=Object.assign({},t);return["$ref","$id","$db"].forEach(function(e){return delete r[e]}),new e(t.$ref,t.$id,t.$db,r)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"DBRef"}),Object.defineProperty(e.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},configurable:!1}),e}(),pt=(()=>re.Buffer)(),_t=function(){function e(r,n){if(ie(this,e),!(null==r||"string"==typeof r||pt.isBuffer(r)||r instanceof Uint8Array||Array.isArray(r)))throw new TypeError("only String, Buffer, Uint8Array or Array accepted");if(this.sub_type=null==n?t:n,this.position=0,null==r||r instanceof Number)void 0!==pt?this.buffer=pt.alloc(e.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(e.BUFFER_SIZE)):this.buffer=new Array(e.BUFFER_SIZE);else{if("string"==typeof r)if(void 0!==pt)this.buffer=pt.from(r);else{if("undefined"==typeof Uint8Array&&!Array.isArray(r))throw new TypeError("only String, Buffer, Uint8Array or Array accepted");this.buffer=function(e){for(var t="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(r)}else this.buffer=r;this.position=r.length}}se(e,[{key:"put",value:function(t){if(null!=t.length&&"number"!=typeof t&&1!==t.length)throw new TypeError("only accepts single character String, Uint8Array or Array");if("number"!=typeof t&&t<0||t>255)throw new TypeError("only accepts number in a valid unsigned byte range 0-255");var n=null;if(n="string"==typeof t?t.charCodeAt(0):null!=t.length?t[0]:t,this.buffer.length>this.position)this.buffer[this.position++]=n;else if(void 0!==pt&&pt.isBuffer(this.buffer)){var i=pt.alloc(e.BUFFER_SIZE+this.buffer.length);this.buffer.copy(i,0,0,this.buffer.length),this.buffer=i,this.buffer[this.position++]=n}else{var o=null;o=r(this.buffer)?new Uint8Array(new ArrayBuffer(e.BUFFER_SIZE+this.buffer.length)):new Array(e.BUFFER_SIZE+this.buffer.length);for(var s=0;s<this.buffer.length;s++)o[s]=this.buffer[s];this.buffer=o,this.buffer[this.position++]=n}}},{key:"write",value:function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var n=null;if(void 0!==pt&&pt.isBuffer(this.buffer))n=pt.alloc(this.buffer.length+e.length),this.buffer.copy(n,0,0,this.buffer.length);else if(r(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+e.length));for(var i=0;i<this.position;i++)n[i]=this.buffer[i]}this.buffer=n}if(void 0!==pt&&pt.isBuffer(e)&&pt.isBuffer(this.buffer))e.copy(this.buffer,t,0,e.length),this.position=t+e.length>this.position?t+e.length:this.position;else if(void 0!==pt&&"string"==typeof e&&pt.isBuffer(this.buffer))this.buffer.write(e,t,"binary"),this.position=t+e.length>this.position?t+e.length:this.position;else if(r(e)||Array.isArray(e)&&"string"!=typeof e){for(var o=0;o<e.length;o++)this.buffer[t++]=e[o];this.position=t>this.position?t:this.position}else if("string"==typeof e){for(var s=0;s<e.length;s++)this.buffer[t++]=e.charCodeAt(s);this.position=t>this.position?t:this.position}}},{key:"read",value:function(e,t){if(t=t&&t>0?t:this.position,this.buffer.slice)return this.buffer.slice(e,e+t);for(var r="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t)):new Array(t),n=0;n<t;n++)r[n]=this.buffer[e++];return r}},{key:"value",value:function(e){if((e=null!=e&&e)&&void 0!==pt&&pt.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(void 0!==pt&&pt.isBuffer(this.buffer))return e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(e){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var t=r(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)t[n]=this.buffer[n];return t}return function(e,t,r){for(var n="",i=t;i<r;i++)n+=String.fromCharCode(e[i]);return n}(this.buffer,0,this.position)}},{key:"length",value:function(){return this.position}},{key:"toJSON",value:function(){return null!=this.buffer?this.buffer.toString("base64"):""}},{key:"toString",value:function(e){return null!=this.buffer?this.buffer.slice(0,this.position).toString(e):""}},{key:"toExtendedJSON",value:function(e){e=e||{};var t=pt.isBuffer(this.buffer)?this.buffer.toString("base64"):pt.from(this.buffer).toString("base64"),r=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:1===r.length?"0"+r:r}:{$binary:{base64:t,subType:1===r.length?"0"+r:r}}}}],[{key:"fromExtendedJSON",value:function(t,r){var n,i;return(r=r||{}).legacy?(i=t.$type?parseInt(t.$type,16):0,n=pt.from(t.$binary,"base64")):(i=t.$binary.subType?parseInt(t.$binary.subType,16):0,n=pt.from(t.$binary.base64,"base64")),new e(n,i)}}]);var t=0;function r(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}return e.BUFFER_SIZE=256,e.SUBTYPE_DEFAULT=0,e.SUBTYPE_FUNCTION=1,e.SUBTYPE_BYTE_ARRAY=2,e.SUBTYPE_UUID_OLD=3,e.SUBTYPE_UUID=4,e.SUBTYPE_MD5=5,e.SUBTYPE_USER_DEFINED=128,Object.defineProperty(e.prototype,"_bsontype",{value:"Binary"}),e}(),ht={BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648,BSON_INT64_MAX:Math.pow(2,63)-1,BSON_INT64_MIN:-Math.pow(2,63),JS_INT_MAX:9007199254740992,JS_INT_MIN:-9007199254740992,BSON_DATA_NUMBER:1,BSON_DATA_STRING:2,BSON_DATA_OBJECT:3,BSON_DATA_ARRAY:4,BSON_DATA_BINARY:5,BSON_DATA_UNDEFINED:6,BSON_DATA_OID:7,BSON_DATA_BOOLEAN:8,BSON_DATA_DATE:9,BSON_DATA_NULL:10,BSON_DATA_REGEXP:11,BSON_DATA_DBPOINTER:12,BSON_DATA_CODE:13,BSON_DATA_SYMBOL:14,BSON_DATA_CODE_W_SCOPE:15,BSON_DATA_INT:16,BSON_DATA_TIMESTAMP:17,BSON_DATA_LONG:18,BSON_DATA_DECIMAL128:19,BSON_DATA_MIN_KEY:255,BSON_DATA_MAX_KEY:127,BSON_BINARY_SUBTYPE_DEFAULT:0,BSON_BINARY_SUBTYPE_FUNCTION:1,BSON_BINARY_SUBTYPE_BYTE_ARRAY:2,BSON_BINARY_SUBTYPE_UUID:3,BSON_BINARY_SUBTYPE_MD5:4,BSON_BINARY_SUBTYPE_USER_DEFINED:128},Et={$oid:Ve,$binary:_t,$symbol:Xe,$numberInt:ze,$numberDecimal:ct,$numberDouble:ae,$numberLong:ne,$minKey:lt,$maxKey:dt,$regex:Je,$regularExpression:Je,$timestamp:fe};function mt(e,t){var r=this;return"boolean"==typeof(t=Object.assign({},{relaxed:!0,legacy:!1},t)).relaxed&&(t.strict=!t.relaxed),"boolean"==typeof t.strict&&(t.relaxed=!t.strict),JSON.parse(e,function(e,n){return function e(t,r,n,i){if("number"==typeof n){if(i.relaxed||i.legacy)return n;if(Math.floor(n)===n){if(n>=vt&&n<=gt)return new ze(n);if(n>=yt&&n<=St)return new ne.fromNumber(n)}return new ae(n)}if(null==n||"object"!==ue(n))return n;if(n.$undefined)return null;for(var o=Object.keys(n).filter(function(e){return e.startsWith("$")&&null!=n[e]}),s=0;s<o.length;s++){var a=Et[o[s]];if(a)return a.fromExtendedJSON(n,i)}if(null!=n.$date){var u=n.$date,c=new Date;return i.legacy?"number"==typeof u?c.setTime(u):"string"==typeof u&&c.setTime(Date.parse(u)):"string"==typeof u?c.setTime(Date.parse(u)):ne.isLong(u)?c.setTime(u.toNumber()):"number"==typeof u&&i.relaxed&&c.setTime(u),c}if(null!=n.$code){var l=Object.assign({},n);return n.$scope&&(l.$scope=e(t,null,n.$scope)),Qe.fromExtendedJSON(n)}if(null!=n.$ref||null!=n.$dbPointer){var d=n.$ref?n:n.$dbPointer;if(d instanceof ft)return d;var f=!0;if(Object.keys(d).filter(function(e){return e.startsWith("$")}).forEach(function(e){-1===["$ref","$id","$db"].indexOf(e)&&(f=!1)}),f)return ft.fromExtendedJSON(d)}return n}(r,0,n,t)})}var gt=2147483647,vt=-2147483648,St=0x8000000000000000,yt=-0x8000000000000000;function Tt(e,t,r,n){null!=r&&"object"===ue(r)&&(n=r,r=0),null==t||"object"!==ue(t)||Array.isArray(t)||(n=t,t=null,r=0),n=Object.assign({},{relaxed:!0,legacy:!1},n);var i=Array.isArray(e)?At(e,n):It(e,n);return JSON.stringify(i,t,r)}function At(e,t){return e.map(function(e){return Ct(e,t)})}function bt(e){var t=e.toISOString();return 0!==e.getUTCMilliseconds()?t:t.slice(0,-5)+"Z"}function Ct(e,t){if(Array.isArray(e))return At(e,t);if(void 0===e)return null;if(e instanceof Date){var r=e.getTime(),n=r>-1&&r<2534023188e5;return t.legacy?t.relaxed&&n?{$date:e.getTime()}:{$date:bt(e)}:t.relaxed&&n?{$date:bt(e)}:{$date:{$numberLong:e.getTime().toString()}}}if("number"==typeof e&&!t.relaxed){if(Math.floor(e)===e){var i=e>=yt&&e<=St;if(e>=vt&&e<=gt)return{$numberInt:e.toString()};if(i)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp){var o=e.flags;return void 0===o&&(o=e.toString().match(/[gimuy]*$/)[0]),new Je(e.source,o).toExtendedJSON(t)}return null!=e&&"object"===ue(e)?It(e,t):e}var Ot={Binary:function(e){return new _t(e.value(),e.subtype)},Code:function(e){return new Qe(e.code,e.scope)},DBRef:function(e){return new ft(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new ct(e.bytes)},Double:function(e){return new ae(e.value)},Int32:function(e){return new ze(e.value)},Long:function(e){return ne.fromBits(null!=e.low?e.low:e.low_,null!=e.low?e.high:e.high_,null!=e.low?e.unsigned:e.unsigned_)},MaxKey:function(){return new dt},MinKey:function(){return new lt},ObjectID:function(e){return new Ve(e)},ObjectId:function(e){return new Ve(e)},BSONRegExp:function(e){return new Je(e.pattern,e.options)},Symbol:function(e){return new Xe(e.value)},Timestamp:function(e){return fe.fromBits(e.low,e.high)}};function It(e,t){if(null==e||"object"!==ue(e))throw new Error("not an object instance");var r=e._bsontype;if(void 0===r){var n={};for(var i in e)n[i]=Ct(e[i],t);return n}if("string"==typeof r){var o=e;if("function"!=typeof o.toExtendedJSON){var s=Ot[r];if(!s)throw new TypeError("Unrecognized or invalid _bsontype: "+r);o=s(o)}return"Code"===r&&o.scope?o=new Qe(o.code,Ct(o.scope,t)):"DBRef"===r&&o.oid&&(o=new ft(o.collection,Ct(o.oid,t),o.db,o.fields)),o.toExtendedJSON(t)}throw new Error("_bsontype must be a string, but was: "+ue(r))}var Rt={parse:mt,deserialize:function(e,t){return t=t||{},mt(JSON.stringify(e),t)},serialize:function(e,t){return t=t||{},JSON.parse(Tt(e,t))},stringify:Tt};ht.JS_INT_MAX,ht.JS_INT_MIN;t.EJSON=Rt}).call(this,r("../../node_modules/.pnpm/webpack@4.46.0_webpack-command@0.4.2/node_modules/webpack/buildin/global.js"),r("../../node_modules/.pnpm/buffer@4.9.2/node_modules/buffer/index.js").Buffer)},"./src/vendor/snappy.js":function(e,t,r){(function(t,r){var n,i={};!function e(t,r,i){function o(a,u){if(!r[a]){if(!t[a]){if(!u&&("function"==typeof n&&n))return n(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return o(r||e)},l,l.exports,e,t,r,i)}return r[a].exports}for(var s="function"==typeof n&&n,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,r){i.uncompress=e("./index").uncompress,i.compress=e("./index").compress},{"./index":2}],2:[function(e,n,i){function o(){return"object"==typeof t&&"object"==typeof t.versions&&void 0!==t.versions.node}function s(e){return e instanceof Uint8Array&&(!o()||!r.isBuffer(e))}function a(e){return e instanceof ArrayBuffer}function u(e){return!!o()&&r.isBuffer(e)}var c=e("./snappy_decompressor").SnappyDecompressor,l=e("./snappy_compressor").SnappyCompressor,d="Argument compressed must be type of ArrayBuffer, Buffer, or Uint8Array";i.uncompress=function(e){if(!s(e)&&!a(e)&&!u(e))throw new TypeError(d);var t=!1,n=!1;s(e)?t=!0:a(e)&&(n=!0,e=new Uint8Array(e));var i,o,l=new c(e),f=l.readUncompressedLength();if(-1===f)throw new Error("Invalid Snappy bitstream");if(t){if(i=new Uint8Array(f),!l.uncompressToBuffer(i))throw new Error("Invalid Snappy bitstream")}else if(n){if(i=new ArrayBuffer(f),o=new Uint8Array(i),!l.uncompressToBuffer(o))throw new Error("Invalid Snappy bitstream")}else if(i=r.alloc(f),!l.uncompressToBuffer(i))throw new Error("Invalid Snappy bitstream");return i},i.compress=function(e){if(!s(e)&&!a(e)&&!u(e))throw new TypeError(d);var t=!1,n=!1;s(e)?t=!0:a(e)&&(n=!0,e=new Uint8Array(e));var i,o,c,f=new l(e),p=f.maxCompressedLength();return t?(i=new Uint8Array(p),c=f.compressToBuffer(i)):n?(i=new ArrayBuffer(p),o=new Uint8Array(i),c=f.compressToBuffer(o)):(i=r.alloc(p),c=f.compressToBuffer(i)),i.slice(0,c)}},{"./snappy_compressor":3,"./snappy_decompressor":4}],3:[function(e,t,r){function n(e,t){return 506832829*e>>>t}function i(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)}function o(e,t,r){return e[t]===e[r]&&e[t+1]===e[r+1]&&e[t+2]===e[r+2]&&e[t+3]===e[r+3]}function s(e,t,r,n,i){return r<=60?(n[i]=r-1<<2,i+=1):r<256?(n[i]=240,n[i+1]=r-1,i+=2):(n[i]=244,n[i+1]=r-1&255,n[i+2]=r-1>>>8,i+=3),function(e,t,r,n,i){var o;for(o=0;o<i;o++)r[n+o]=e[t+o]}(e,t,n,i,r),i+r}function a(e,t,r,n){return n<12&&r<2048?(e[t]=1+(n-4<<2)+(r>>>8<<5),e[t+1]=255&r,t+2):(e[t]=2+(n-1<<2),e[t+1]=255&r,e[t+2]=r>>>8,t+3)}function u(e,t,r,n){for(;n>=68;)t=a(e,t,r,64),n-=64;return n>64&&(t=a(e,t,r,60),n-=60),a(e,t,r,n)}function c(e,t,r,a,c){for(var l=1;1<<l<=r&&l<=d;)l+=1;var p=32-(l-=1);void 0===f[l]&&(f[l]=new Uint16Array(1<<l));var _,h=f[l];for(_=0;_<h.length;_++)h[_]=0;var E,m,g,v,S,y,T,A,b,C,O=t+r,I=t,R=t,w=!0;if(r>=15)for(E=O-15,g=n(i(e,t+=1),p);w;){y=32,v=t;do{if(m=g,T=y>>>5,y+=1,v=(t=v)+T,t>E){w=!1;break}g=n(i(e,v),p),S=I+h[m],h[m]=t-I}while(!o(e,t,S));if(!w)break;c=s(e,R,t-R,a,c);do{for(A=t,b=4;t+b<O&&e[t+b]===e[S+b];)b+=1;if(t+=b,c=u(a,c,A-S,b),R=t,t>=E){w=!1;break}h[n(i(e,t-1),p)]=t-1-I,S=I+h[C=n(i(e,t),p)],h[C]=t-I}while(o(e,t,S));if(!w)break;g=n(i(e,t+=1),p)}return R<O&&(c=s(e,R,O-R,a,c)),c}function l(e){this.array=e}var d=14,f=new Array(d+1);l.prototype.maxCompressedLength=function(){var e=this.array.length;return 32+e+Math.floor(e/6)},l.prototype.compressToBuffer=function(e){var t,r=this.array,n=r.length,i=0,o=0;for(o=function(e,t,r){do{t[r]=127&e,(e>>>=7)>0&&(t[r]+=128),r+=1}while(e>0);return r}(n,e,o);i<n;)o=c(r,i,t=Math.min(n-i,65536),e,o),i+=t;return o},r.SnappyCompressor=l},{}],4:[function(e,t,r){function n(e,t,r,n,i){var o;for(o=0;o<i;o++)r[n+o]=e[t+o]}function i(e,t,r,n){var i;for(i=0;i<n;i++)e[t+i]=e[t-r+i]}function o(e){this.array=e,this.pos=0}var s=[0,255,65535,16777215,4294967295];o.prototype.readUncompressedLength=function(){for(var e,t,r=0,n=0;n<32&&this.pos<this.array.length;){if(e=this.array[this.pos],this.pos+=1,(t=127&e)<<n>>>n!==t)return-1;if(r|=t<<n,e<128)return r;n+=7}return-1},o.prototype.uncompressToBuffer=function(e){for(var t,r,o,a,u=this.array,c=u.length,l=this.pos,d=0;l<u.length;)if(t=u[l],l+=1,0==(3&t)){if((r=1+(t>>>2))>60){if(l+3>=c)return!1;o=r-60,r=1+((r=u[l]+(u[l+1]<<8)+(u[l+2]<<16)+(u[l+3]<<24))&s[o]),l+=o}if(l+r>c)return!1;n(u,l,e,d,r),l+=r,d+=r}else{switch(3&t){case 1:r=4+(t>>>2&7),a=u[l]+(t>>>5<<8),l+=1;break;case 2:if(l+1>=c)return!1;r=1+(t>>>2),a=u[l]+(u[l+1]<<8),l+=2;break;case 3:if(l+3>=c)return!1;r=1+(t>>>2),a=u[l]+(u[l+1]<<8)+(u[l+2]<<16)+(u[l+3]<<24),l+=4}if(0===a||a>d)return!1;i(e,d,a,r),d+=r}return!0},r.SnappyDecompressor=o},{}]},{},[1]),e.exports=i}).call(this,r("../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js"),r("../../node_modules/.pnpm/buffer@4.9.2/node_modules/buffer/index.js").Buffer)},"@web":function(e,t){e.exports={}}});
  var __sdk__ = Object.assign({
    // private api is not available in cloud: true
    isUsedCache: () => false,
    reportCallContainer: () => {},
    private_getUserAgent: cb => cb(''),
    request: wx.request,
  }, wx)
  __sdk__.wx = __sdk__
  __cloudSDK__.setDefaultSDK(__sdk__)

  var apis = __cloudSDK__.getCloudAPI()
  if (!wx.cloud) {
    wx.cloud = apis
  } else {
    for (var api in apis) {
      wx.cloud[api] = apis[api]
    }
  }

  __sdk__.cloud = wx.cloud
  // wxlib under 2.5.x, using plugins in app.json, property overwrite will not work, this is an escape hatch
  wx.__cloud__ = apis
  var loadEnd = Date.now()
  Object.defineProperty(wx.cloud, 'profile', {
    value: { loadStart, loadEnd },
    configurable: true,
  })
  console.log('using cloud: true (build ts 1685330827011)')
} catch(err) {
  console.error('cloud sdk (build ts 1685330827011) injection failed with error', err)
}
})();
