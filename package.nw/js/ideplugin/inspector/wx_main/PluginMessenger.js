import Messenger from"./Messenger.js";import{uniqId,isFn}from"../third_party/licia.js";export default class PluginMessenger{constructor(s){this._messenger=new Messenger(s),this._callbacks={},this._onEvents={},this._messenger.registerCallback(s=>{const{command:e,data:t}=s;if("INVOKE_CALLBACK"===e){const{callbackID:s,res:e}=t,n=this._callbacks[s];n&&(n.resolve(e),delete this._callbacks[s])}else"ON_EVENT"===e&&this.triggerOnEvent(t)})}triggerOnEvent(s){const{eventName:e,res:t}=s,n=this._onEvents[e]||[];for(let s=0,e=n.length;s<e;s++){const e=n[s];isFn(e)&&e(t)}}on(s,e){const t=this._onEvents[s]||[];t.push(e),this._onEvents[s]=t}send(s,e={}){return new Promise(t=>{const n=uniqId();this._callbacks[n]={resolve:t},this._messenger.send({command:s,data:e,callbackID:n})})}}