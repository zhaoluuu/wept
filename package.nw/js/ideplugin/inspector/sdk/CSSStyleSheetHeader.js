import*as Common from"../common/common.js";import*as TextUtils from"../text_utils/text_utils.js";import{CSSModel}from"./CSSModel.js";import{DeferredDOMNode}from"./DOMModel.js";import{FrameAssociated}from"./FrameAssociated.js";import{PageResourceLoadInitiator}from"./PageResourceLoader.js";import{ResourceTreeModel}from"./ResourceTreeModel.js";export class CSSStyleSheetHeader{constructor(e,t){this._cssModel=e,this.id=t.styleSheetId,this.frameId=t.frameId,this.sourceURL=t.sourceURL,this.hasSourceURL=!!t.hasSourceURL,this.origin=t.origin,this.title=t.title,this.disabled=t.disabled,this.isInline=t.isInline,this.isMutable=t.isMutable,this.startLine=t.startLine,this.startColumn=t.startColumn,this.endLine=t.endLine,this.endColumn=t.endColumn,this.contentLength=t.length,t.ownerNode&&(this.ownerNode=new DeferredDOMNode(e.target(),t.ownerNode)),this.sourceMapURL=t.sourceMapURL,this._originalContentProvider=null}originalContentProvider(){if(!this._originalContentProvider){const e=async()=>{const e=await this._cssModel.originalStyleSheetText(this);return null===e?{content:null,error:ls`Could not find the original style sheet.`,isEncoded:!1}:{content:e,isEncoded:!1}};this._originalContentProvider=new TextUtils.StaticContentProvider.StaticContentProvider(this.contentURL(),this.contentType(),e)}return this._originalContentProvider}setSourceMapURL(e){this.sourceMapURL=e}cssModel(){return this._cssModel}isAnonymousInlineStyleSheet(){return!this.resourceURL()&&!this._cssModel.sourceMapManager().sourceMapForClient(this)}resourceURL(){return this.isViaInspector()?this._viaInspectorResourceURL():this.sourceURL}_viaInspectorResourceURL(){const e=this._cssModel.target().model(ResourceTreeModel).frameForId(this.frameId);console.assert(e);const t=new Common.ParsedURL.ParsedURL(e.url);let r="inspector://"+t.host+t.folderPathComponents;return r.endsWith("/")||(r+="/"),r+="inspector-stylesheet",r}lineNumberInSource(e){return this.startLine+e}columnNumberInSource(e,t){return(e?0:this.startColumn)+t}containsLocation(e,t){const r=e===this.startLine&&t>=this.startColumn||e>this.startLine,s=e<this.endLine||e===this.endLine&&t<=this.endColumn;return r&&s}contentURL(){return this.resourceURL()}contentType(){return Common.ResourceType.resourceTypes.Stylesheet}contentEncoded(){return Promise.resolve(!1)}async requestContent(){try{return{content:await this._cssModel.getStyleSheetText(this.id),isEncoded:!1}}catch(e){return{content:null,error:ls`There was an error retrieving the source styles.`,isEncoded:!1}}}async searchInContent(e,t,r){const s=await this.requestContent();return null===s.content?[]:TextUtils.TextUtils.performSearchInContent(s.content,e,t,r)}isViaInspector(){return"inspector"===this.origin}createPageResourceLoadInitiator(){return{target:null,frameId:this.frameId,initiatorUrl:this.hasSourceURL?"":this.sourceURL}}}