import{ls}from"../common/common.js";import{Issue,IssueCategory,IssueDescription,IssueKind}from"./Issue.js";export function isCrossOriginEmbedderPolicyIssue(e){switch(e){case Protocol.Audits.BlockedByResponseReason.CoepFrameResourceNeedsCoepHeader:case Protocol.Audits.BlockedByResponseReason.CoopSandboxedIFrameCannotNavigateToCoopPage:case Protocol.Audits.BlockedByResponseReason.CorpNotSameOrigin:case Protocol.Audits.BlockedByResponseReason.CorpNotSameOriginAfterDefaultedToSameOriginByCoep:case Protocol.Audits.BlockedByResponseReason.CorpNotSameSite:return!0}return!1}export class CrossOriginEmbedderPolicyIssue extends Issue{constructor(e){super("CrossOriginEmbedderPolicy::"+e.reason),this._details=e}primaryKey(){return`${this.code()}-(${this._details.request.requestId})`}blockedByResponseDetails(){return[this._details]}requests(){return[this._details.request]}getCategory(){return IssueCategory.CrossOriginEmbedderPolicy}getDescription(){const e=issueDescriptions.get(this.code());return e||null}}function CorpNotSameOriginAfterDefaultedToSameOriginByCoepMessage(){const e=document.createElement("div");e.classList.add("message"),e.createChild("p").textContent=ls`Because your site has the Cross-Origin Embedder Policy (COEP) enabled, each resource must specify a suitable Cross-Origin Resource Policy (CORP).
   This behavior prevents a document from loading cross-origin resources which don't explicitly grant permission to be loaded.`;const s=e.createChild("p");s.createChild("span").textContent=ls`To solve this, add the following to the resource’s response header:`;const t=s.createChild("ul","resolutions-list"),o=t.createChild("li");o.createChild("code").textContent="Cross-Origin-Resource-Policy: same-site",o.createChild("span").textContent=" ",o.createChild("span").textContent=ls`if the resource and your site are served from the same site.`;const i=t.createChild("li");return i.createChild("code").textContent="Cross-Origin-Resource-Policy: cross-origin",i.createChild("span").textContent=" ",i.createChild("span").textContent=ls`if the resource is served from another location than your website. ⚠️If you set this header, any website can embed this resource.`,e}function CoepFrameResourceNeedsCoepHeaderMessage(){const e=document.createElement("div");e.classList.add("message"),e.createChild("p").textContent=ls`Because your site has the Cross-Origin Embedder Policy (COEP) enabled, each embedded iframe must also specify this policy.
  This behavior protects private data from being exposed to untrusted third party sites.`;const s=e.createChild("p");return s.createChild("span").textContent=ls`To solve this, add the following to the embedded frame’s HTML response header:`+" ",s.createChild("code").textContent="Cross-Origin-Embedder-Policy: require-corp",e}function CorpNotSameSiteMessage(){const e=document.createElement("div");e.classList.add("message"),e.createChild("p").textContent=ls`Your site tries to access an external resource that only allows same-site usage.
  This behavior prevents a document from loading any non-same-site resources which don't explicitly grant permission to be loaded.`;const s=e.createChild("p");return s.createChild("span").textContent=ls`To solve this, add the following to the resource’s HTML response header:`+" ",s.createChild("code").textContent="Cross-Origin-Embedder-Policy: cross-origin",s.createChild("span").textContent=" "+ls`⚠️If you set this header, any website can embed this resource.`,e}function CorpNotSameOriginMessage(){const e=document.createElement("div");e.classList.add("message"),e.createChild("p").textContent=ls`Your site tries to access an external resource that only allows same-origin usage.
  This behavior prevents a document from loading any non-same-origin resources which don't explicitly grant permission to be loaded.`;const s=e.createChild("p");s.createChild("span").textContent=ls`To solve this, add the following to the resource’s HTML response header:`;const t=s.createChild("ul","resolutions-list"),o=t.createChild("li");o.createChild("code").textContent="Cross-Origin-Resource-Policy: same-site",o.createChild("span").textContent=" ",o.createChild("span").textContent=ls`if the resource and your site are served from the same site.`;const i=t.createChild("li");return i.createChild("code").textContent="Cross-Origin-Resource-Policy: cross-origin",i.createChild("span").textContent=" ",i.createChild("span").textContent=ls`if the resource is served from another location than your website. ⚠️If you set this header, any website can embed this resource.`,e}function textOnlyMessage(e){const s=document.createElement("div");return s.classList.add("message"),s.textContent=e,s}const issueDescriptions=new Map([["CrossOriginEmbedderPolicy::CorpNotSameOriginAfterDefaultedToSameOriginByCoep",{title:ls`Specify a Cross-Origin Resource Policy to prevent a resource from being blocked`,message:CorpNotSameOriginAfterDefaultedToSameOriginByCoepMessage,issueKind:IssueKind.BreakingChange,links:[{link:"https://web.dev/coop-coep/",linkTitle:ls`COOP and COEP`},{link:"https://web.dev/same-site-same-origin/",linkTitle:ls`Same-Site and Same-Origin`}]}],["CrossOriginEmbedderPolicy::CoepFrameResourceNeedsCoepHeader",{title:ls`Specify a Cross-Origin Embedder Policy to prevent this frame from being blocked`,message:CoepFrameResourceNeedsCoepHeaderMessage,issueKind:IssueKind.BreakingChange,links:[{link:"https://web.dev/coop-coep/",linkTitle:ls`COOP and COEP`}]}],["CrossOriginEmbedderPolicy::CoopSandboxedIframeCannotNavigateToCoopPage",{title:ls`An iframe navigation to a document with a Cross-Origin Opener Policy was blocked`,message:()=>textOnlyMessage(ls`A document with a Cross-Origin Opener Policy (COOP) was blocked from loading in an iframe, because the iframe specifies a sandbox attribute.
  This protects COOP-enabled documents from inheriting properties from its opener.`),issueKind:IssueKind.BreakingChange,links:[{link:"https://web.dev/coop-coep/",linkTitle:ls`COOP and COEP`}]}],["CrossOriginEmbedderPolicy::CorpNotSameSite",{title:ls`Specify a more permissive Cross-Origin Resource Policy to prevent a resource from being blocked`,message:CorpNotSameSiteMessage,issueKind:IssueKind.BreakingChange,links:[{link:"https://web.dev/coop-coep/",linkTitle:ls`COOP and COEP`},{link:"https://web.dev/same-site-same-origin/",linkTitle:ls`Same-Site and Same-Origin`}]}],["CrossOriginEmbedderPolicy::CorpNotSameOrigin",{title:ls`Specify a more permissive Cross-Origin Resource Policy to prevent a resource from being blocked`,message:CorpNotSameOriginMessage,issueKind:IssueKind.BreakingChange,links:[{link:"https://web.dev/coop-coep/",linkTitle:ls`COOP and COEP`},{link:"https://web.dev/same-site-same-origin/",linkTitle:ls`Same-Site and Same-Origin`}]}]]);