export function defineCommonExtensionSymbols(e){e.panels||(e.panels={}),e.panels.SearchAction={CancelSearch:"cancelSearch",PerformSearch:"performSearch",NextSearchResult:"nextSearchResult",PreviousSearchResult:"previousSearchResult"},e.Events={ButtonClicked:"button-clicked-",PanelObjectSelected:"panel-objectSelected-",NetworkRequestFinished:"network-request-finished",OpenResource:"open-resource",PanelSearch:"panel-search-",RecordingStarted:"trace-recording-started-",RecordingStopped:"trace-recording-stopped-",ResourceAdded:"resource-added",ResourceContentCommitted:"resource-content-committed",ViewShown:"view-shown-",ViewHidden:"view-hidden-"},e.Commands={AddRequestHeaders:"addRequestHeaders",AddTraceProvider:"addTraceProvider",ApplyStyleSheet:"applyStyleSheet",CompleteTraceSession:"completeTraceSession",CreatePanel:"createPanel",CreateSidebarPane:"createSidebarPane",CreateToolbarButton:"createToolbarButton",EvaluateOnInspectedPage:"evaluateOnInspectedPage",ForwardKeyboardEvent:"_forwardKeyboardEvent",GetHAR:"getHAR",GetPageResources:"getPageResources",GetRequestContent:"getRequestContent",GetResourceContent:"getResourceContent",InspectedURLChanged:"inspectedURLChanged",OpenResource:"openResource",Reload:"Reload",Subscribe:"subscribe",SetOpenResourceHandler:"setOpenResourceHandler",SetResourceContent:"setResourceContent",SetSidebarContent:"setSidebarContent",SetSidebarHeight:"setSidebarHeight",SetSidebarPage:"setSidebarPage",ShowPanel:"showPanel",Unsubscribe:"unsubscribe",UpdateButton:"updateButton",RegisterLanguageExtensionPlugin:"registerLanguageExtensionPlugin"},e.LanguageExtensionPluginCommands={AddRawModule:"addRawModule",RemoveRawModule:"removeRawModule",SourceLocationToRawLocation:"sourceLocationToRawLocation",RawLocationToSourceLocation:"rawLocationToSourceLocation",ListVariablesInScope:"listVariablesInScope",EvaluateVariable:"evaluateVariable"}}self.injectedExtensionAPI=function(e,t,n,o,s,i){const r=new Set(o),a=window.chrome||{};if(Object.getOwnPropertyDescriptor(a,"devtools"))return;const c={};defineCommonExtensionSymbols(c);const d=c.Commands,u=c.LanguageExtensionPluginCommands,l=c.Events;let p=!1;function h(e,t){this._type=e,this._listeners=[],this._customDispatch=t}function m(){this.onRequestFinished=new C(l.NetworkRequestFinished,(function(e){const t=e.arguments[1];t.__proto__=new O(e.arguments[0]),this._fire(t)})),y(this,"network","onFinished","onRequestFinished"),this.onNavigated=new C(l.InspectedURLChanged)}function f(e){this._id=e}function g(){const e={elements:new E,sources:new j};function t(t){return e[t]}for(const n in e)Object.defineProperty(this,n,{get:t.bind(null,n),enumerable:!0});this.applyStyleSheet=function(e){J.sendRequest({command:d.ApplyStyleSheet,styleSheet:e})}}function w(e){this._id=e,e&&(this.onShown=new C(l.ViewShown+e,(function(e){const t=e.arguments[0];"number"==typeof t?this._fire(window.parent.frames[t]):this._fire()})),this.onHidden=new C(l.ViewHidden+e))}function _(e){w.call(this,null),this._hostPanelName=e,this.onSelectionChanged=new C(l.PanelObjectSelected+e)}function R(){this._plugins=new Map}function b(e){return function(){const t={__proto__:e.prototype};e.apply(t,arguments),F(this,t)}}function y(e,t,n,o){let s=!1;e.__defineGetter__(n,(function(){return s||(console.warn(t+"."+n+" is deprecated. Use "+t+"."+o+" instead"),s=!0),e[o]}))}function S(e){const t=e[e.length-1];return"function"==typeof t?t:void 0}h.prototype={addListener:function(e){if("function"!=typeof e)throw"addListener: callback is not a function";0===this._listeners.length&&J.sendRequest({command:d.Subscribe,type:this._type}),this._listeners.push(e),J.registerHandler("notify-"+this._type,this._dispatch.bind(this))},removeListener:function(e){const t=this._listeners;for(let n=0;n<t.length;++n)if(t[n]===e){t.splice(n,1);break}0===this._listeners.length&&J.sendRequest({command:d.Unsubscribe,type:this._type})},_fire:function(e){const t=this._listeners.slice();for(let e=0;e<t.length;++e)t[e].apply(null,arguments)},_dispatch:function(e){this._customDispatch?this._customDispatch.call(this,e):this._fire.apply(this,e.arguments)}},m.prototype={getHAR:function(e){J.sendRequest({command:d.GetHAR},e&&function(t){const n=t&&t.entries||[];for(let e=0;e<n.length;++e)n[e].__proto__=new O(n[e]._requestId),delete n[e]._requestId;e(t)})},addRequestHeaders:function(e){J.sendRequest({command:d.AddRequestHeaders,headers:e,extensionId:window.location.hostname})}},f.prototype={getContent:function(e){J.sendRequest({command:d.GetRequestContent,id:this._id},e&&function(t){e(t.content,t.encoding)})}},g.prototype={create:function(e,t,n,o){const s="extension-panel-"+J.nextObjectId(),i={command:d.CreatePanel,id:s,title:e,icon:t,page:n};J.sendRequest(i,o&&o.bind(this,new q(s)))},setOpenResourceHandler:function(e){const t=J.hasHandler(l.OpenResource);e?J.registerHandler(l.OpenResource,(function(t){p=!0;try{e.call(null,new L(t.resource),t.lineNumber)}finally{p=!1}})):J.unregisterHandler(l.OpenResource),t===!e&&J.sendRequest({command:d.SetOpenResourceHandler,handlerPresent:!!e})},openResource:function(e,t,n){J.sendRequest({command:d.OpenResource,url:e,lineNumber:t},n)},get SearchAction(){return c.panels.SearchAction}},_.prototype={createSidebarPane:function(e,t){const n="extension-sidebar-"+J.nextObjectId(),o={command:d.CreateSidebarPane,panel:this._hostPanelName,id:n,title:e};J.sendRequest(o,t&&function(){t(new I(n))})},__proto__:w.prototype},R.prototype={registerLanguageExtensionPlugin:function(e,t,n){if(this._plugins.has(e))throw new Error("Tried to register a plugin twice");const o=new MessageChannel,s=o.port1;this._plugins.set(e,s),s.onmessage=({data:{requestId:t,method:n,parameters:o}})=>{(function(t,n){switch(t){case u.AddRawModule:return e.addRawModule(n.rawModuleId,n.symbolsURL,n.rawModule);case u.RemoveRawModule:return e.removeRawModule(n.rawModuleId);case u.SourceLocationToRawLocation:return e.sourceLocationToRawLocation(n.sourceLocation);case u.RawLocationToSourceLocation:return e.rawLocationToSourceLocation(n.rawLocation);case u.ListVariablesInScope:return e.listVariablesInScope(n.rawLocation);case u.EvaluateVariable:return e.evaluateVariable(n.name,n.location)}throw new Error("Unknown language plugin method "+t)})(n,o).then(e=>s.postMessage({requestId:t,result:e})).catch(e=>s.postMessage({requestId:t,error:{message:e.message}}))},J.sendRequest({command:d.RegisterLanguageExtensionPlugin,pluginName:t,port:o.port2,supportedScriptTypes:n},void 0,[o.port2])}};const v=b(R),P=b(H),C=b(h),q=b(A),I=b(T),x=b(_),O=b(f),L=b(V),k=b(K);class E extends x{constructor(){super("elements")}}class j extends x{constructor(){super("sources")}}function A(e){w.call(this,e),this.onSearch=new C(l.PanelSearch+e)}function T(e){w.call(this,e)}function H(e){this._id=e,this.onClicked=new C(l.ButtonClicked+e)}function M(){}function K(e){this._id=e}function N(e){this.onRecordingStarted=new C(l.RecordingStarted+e,(function(e){const t=e.arguments[0];this._fire(new k(t))})),this.onRecordingStopped=new C(l.RecordingStopped+e)}function U(){this.onResourceAdded=new C(l.ResourceAdded,(function(e){this._fire(new L(e.arguments[0]))})),this.onResourceContentCommitted=new C(l.ResourceContentCommitted,(function(e){this._fire(new L(e.arguments[0]),e.arguments[1])}))}function V(e){this._url=e.url,this._type=e.type}A.prototype={createStatusBarButton:function(e,t,n){const o="button-"+J.nextObjectId(),s={command:d.CreateToolbarButton,panel:this._id,id:o,icon:e,tooltip:t,disabled:!!n};return J.sendRequest(s),new P(o)},show:function(){if(!p)return;const e={command:d.ShowPanel,id:this._id};J.sendRequest(e)},__proto__:w.prototype},T.prototype={setHeight:function(e){J.sendRequest({command:d.SetSidebarHeight,id:this._id,height:e})},setExpression:function(e,t,n){const o={command:d.SetSidebarContent,id:this._id,expression:e,rootTitle:t,evaluateOnPage:!0};"object"==typeof n&&(o.evaluateOptions=n),J.sendRequest(o,S(arguments))},setObject:function(e,t,n){J.sendRequest({command:d.SetSidebarContent,id:this._id,expression:e,rootTitle:t},n)},setPage:function(e){J.sendRequest({command:d.SetSidebarPage,id:this._id,page:e})},__proto__:w.prototype},H.prototype={update:function(e,t,n){const o={command:d.UpdateButton,id:this._id,icon:e,tooltip:t,disabled:!!n};J.sendRequest(o)}},M.prototype={addTraceProvider:function(e,t){const n="extension-trace-provider-"+J.nextObjectId();return J.sendRequest({command:d.AddTraceProvider,id:n,categoryName:e,categoryTooltip:t}),new N(n)}},K.prototype={complete:function(e,t){const n={command:d.CompleteTraceSession,id:this._id,url:e||"",timeOffset:t||0};J.sendRequest(n)}},U.prototype={reload:function(e){let t=null;"object"==typeof e?t=e:"string"==typeof e&&(t={userAgent:e},console.warn("Passing userAgent as string parameter to inspectedWindow.reload() is deprecated. Use inspectedWindow.reload({ userAgent: value}) instead.")),J.sendRequest({command:d.Reload,options:t})},eval:function(e,t){const n=S(arguments);function o(e){e.isError||e.isException?n(void 0,e):n(e.value)}const s={command:d.EvaluateOnInspectedPage,expression:e};return"object"==typeof t&&(s.evaluateOptions=t),J.sendRequest(s,n&&o),null},getResources:function(e){function t(e){return new L(e)}J.sendRequest({command:d.GetPageResources},e&&function(n){e(n.map(t))})}},V.prototype={get url(){return this._url},get type(){return this._type},getContent:function(e){J.sendRequest({command:d.GetResourceContent,url:this._url},e&&function(t){e(t.content,t.encoding)})},setContent:function(e,t,n){J.sendRequest({command:d.SetResourceContent,url:this._url,content:e,commit:t},n)}};let B=[],G=null;function W(){G=null;const e={command:d.ForwardKeyboardEvent,entries:B};J.sendRequest(e),B=[]}function D(){this._callbacks={},this._handlers={},this._lastRequestId=0,this._lastObjectId=0,this.registerHandler("callback",this._onCallback.bind(this));const e=new MessageChannel;this._port=e.port1,this._port.addEventListener("message",this._onMessage.bind(this),!1),this._port.start(),window.parent.postMessage("registerExtension","*",[e.port2])}function F(e,t){for(const n in t){if("_"===n.charAt(0))continue;let o=null;for(let e=t;e&&!o;e=e.__proto__)o=Object.getOwnPropertyDescriptor(e,n);o&&("function"==typeof o.value?e[n]=o.value.bind(t):"function"==typeof o.get?e.__defineGetter__(n,o.get.bind(t)):Object.defineProperty(e,n,o))}}document.addEventListener("keydown",(function(e){const t=document.activeElement;if(t){if(("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName)&&!(e.ctrlKey||e.altKey||e.metaKey))return}let n=0;e.shiftKey&&(n|=1),e.ctrlKey&&(n|=2),e.altKey&&(n|=4),e.metaKey&&(n|=8);const o=255&e.keyCode|n<<8;if(!r.has(o))return;e.preventDefault();const s={eventType:e.type,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,shiftKey:e.shiftKey,keyIdentifier:e.keyIdentifier,key:e.key,code:e.code,location:e.location,keyCode:e.keyCode};B.push(s),G||(G=setTimeout(W,0))}),!1),D.prototype={sendRequest:function(e,t,n){"function"==typeof t&&(e.requestId=this._registerCallback(t)),this._port.postMessage(e,n)},hasHandler:function(e){return!!this._handlers[e]},registerHandler:function(e,t){this._handlers[e]=t},unregisterHandler:function(e){delete this._handlers[e]},nextObjectId:function(){return i.toString()+"_"+ ++this._lastObjectId},_registerCallback:function(e){const t=++this._lastRequestId;return this._callbacks[t]=e,t},_onCallback:function(e){if(e.requestId in this._callbacks){const t=this._callbacks[e.requestId];delete this._callbacks[e.requestId],t(e.result)}},_onMessage:function(e){const t=e.data,n=this._handlers[t.command];n&&n.call(this,t)}};const J=new D,X=new function(){this.inspectedWindow=new U,this.panels=new g,this.network=new m,this.timeline=new M,this.languageServices=new v,y(this,"webInspector","resources","network")};if(Object.defineProperty(a,"devtools",{value:{},enumerable:!0}),a.devtools.inspectedWindow={},Object.defineProperty(a.devtools.inspectedWindow,"tabId",{get:function(){return t}}),a.devtools.inspectedWindow.__proto__=X.inspectedWindow,a.devtools.network=X.network,a.devtools.panels=X.panels,a.devtools.panels.themeName=n,a.devtools.languageServices=new v,!1!==e.exposeExperimentalAPIs){a.experimental=a.experimental||{},a.experimental.devtools=a.experimental.devtools||{};const e=Object.getOwnPropertyNames(X);for(let t=0;t<e.length;++t){const n=Object.getOwnPropertyDescriptor(X,e[t]);n&&Object.defineProperty(a.experimental.devtools,e[t],n)}a.experimental.devtools.inspectedWindow=a.devtools.inspectedWindow}e.exposeWebInspectorNamespace&&(window.webInspector=X),s(J,X)},self.buildExtensionAPIInjectedScript=function(e,t,n,o,s){const i=[e,t||null,n,o].map(e=>JSON.stringify(e)).join(",");return s||(s=()=>{}),"(function(injectedScriptId){ "+defineCommonExtensionSymbols.toString()+";("+self.injectedExtensionAPI.toString()+")("+i+","+s+", injectedScriptId);})"};