import*as UI from"../ui/ui.js";import*as Host from"../host/host.js";import*as Common from"../common/common.js";import*as InlineEditor from"../inline_editor/inline_editor.js";import*as ColorPicker from"../color_picker/color_picker.js";import{extend,each,contain}from"../third_party/licia.js";import JSONEditor from"../third_party/jsoneditor.js";class JSONEditorView extends UI.Widget.VBox{constructor(t){super(!0),this.registerRequiredCSS("third_party/jsoneditor.css");const e=t.data||{};this.contentElement.style.padding="2px",this._jsonEditor=new JSONEditor(this.contentElement,extend({mainMenuBar:!1,navigationBar:!1,statusBar:!1,language:"en",enableSort:!1,enableTransform:!1,sortObjectKeys:!0,ContextMenu:ContextMenu,onColorPicker:(t,e,o)=>{this._swatchPopoverHelper||(this._swatchPopoverHelper=new InlineEditor.SwatchPopoverHelper.SwatchPopoverHelper),this._spectrum||(this._spectrum=new ColorPicker.Spectrum.Spectrum),e=Common.Color.Color.parse(e),this._spectrum.setColor(e,e.format()),this._swatchPopoverHelper.show(this._spectrum,t,()=>{o(this._spectrum.colorString())})}},t),e)}destroy(){this.detach(),this._jsonEditor.destroy()}getJSONEditor(){return this._jsonEditor}}class ContextMenu{constructor(t,e,o){const n=new UI.ContextMenu.ContextMenu(t);this._onClose=function(){o.close(),Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.removeEventListener(Host.InspectorFrontendHostAPI.Events.ContextMenuItemSelected,this._onClose,this),document.removeEventListener("mousedown",this._onClose,!0)},this._contextMenu=n,this._options=o,this._initItems(n,e)}show(){this._contextMenu.show(),Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(Host.InspectorFrontendHostAPI.Events.ContextMenuItemSelected,this._onClose,this),document.addEventListener("mousedown",this._onClose,!0)}_initItems(t,e){each(e,e=>{if("separator"===e.type)t.defaultSection().appendSeparator();else if(e.submenu){const o=t.defaultSection().appendSubMenuItem(e.text);this._initItems(o,e.submenu)}else contain(e.className||"","jsoneditor-selected")?t.defaultSection().appendCheckboxItem(e.text,e.click,!0):t.defaultSection().appendItem(e.text,e.click)})}}export class JSONEditorFactory{createEditor(t){return new JSONEditorView(t)}}export const jsonEditorFactory=new JSONEditorFactory;