import*as Common from"../common/common.js";import*as UI from"../ui/ui.js";const MessageLevelBitfield={Error:1,Warning:2,Info:4,Debug:8,Default:7,All:15,Custom:0};let SelectableLevel;class MessageLevelSelector extends Common.ObjectWrapper.ObjectWrapper{constructor(e,t){super(),this._items=e,this._view=t,this._itemMap=new Map,this._hiddenLevels=[],this._bitFieldValue=MessageLevelBitfield.Default,this._savedBitFieldValue=MessageLevelBitfield.Default,this._defaultTitle=ls`Default`,this._customTitle=ls`Custom`,this._allTitle=ls`All`}defaultTitle(){return this._defaultTitle}setDefault(e){e.selectItem(this._items.at(0))}populate(){this._items.insert(this._items.length,{title:this._defaultTitle,overwrite:!0,stringValue:"",value:MessageLevelBitfield.Default}),this._items.insert(this._items.length,{title:this._allTitle,overwrite:!0,stringValue:"",value:MessageLevelBitfield.All}),this._items.insert(this._items.length,{title:ls`Error`,overwrite:!1,stringValue:"error",value:MessageLevelBitfield.Error}),this._items.insert(this._items.length,{title:ls`Warning`,overwrite:!1,stringValue:"warning",value:MessageLevelBitfield.Warning}),this._items.insert(this._items.length,{title:ls`Info`,overwrite:!1,stringValue:"info",value:MessageLevelBitfield.Info}),this._items.insert(this._items.length,{title:ls`Debug`,overwrite:!1,stringValue:"debug",value:MessageLevelBitfield.Debug})}_updateCheckMarks(){this._hiddenLevels=[];for(const[e,t]of this._itemMap)t.overwrite||(t.element.firstChild&&t.element.firstChild.remove(),e&this._bitFieldValue?t.element.createChild("div").createTextChild("âœ“"):this._hiddenLevels.push(t.stringValue))}titleFor(e){if(e.overwrite?this._bitFieldValue=e.value:this._bitFieldValue^=e.value,this._bitFieldValue===MessageLevelBitfield.Default)return this._defaultTitle;if(this._bitFieldValue===MessageLevelBitfield.All)return this._allTitle;const t=this._itemMap.get(this._bitFieldValue);return t?t.title:this._customTitle}createElementForItem(e){const t=document.createElementWithClass("div"),s=UI.Utils.createShadowRootWithCoreStyles(t,"media/playerMessagesView.css").createChild("div","media-messages-level-dropdown-element"),i=s.createChild("div","media-messages-level-dropdown-checkbox");return s.createChild("span","media-messages-level-dropdown-text").createTextChild(e.title),e.element=i,this._itemMap.set(e.value,e),this._updateCheckMarks(),this._view.regenerateMessageDisplayCss(this._hiddenLevels),t}isItemSelectable(e){return!0}itemSelected(e){this._updateCheckMarks(),this._view.regenerateMessageDisplayCss(this._hiddenLevels)}highlightedItemChanged(e,t,s,i){}}export class PlayerMessagesView extends UI.Widget.VBox{constructor(){super(),this.registerRequiredCSS("media/playerMessagesView.css"),this._headerPanel=this.contentElement.createChild("div","media-messages-header"),this._bodyPanel=this.contentElement.createChild("div","media-messages-body"),this._buildToolbar()}_buildToolbar(){const e=new UI.Toolbar.Toolbar("media-messages-toolbar",this._headerPanel);e.appendText(ls`Log Level:`),e.appendToolbarItem(this._createDropdown()),e.appendSeparator(),e.appendToolbarItem(this._createFilterInput())}_createDropdown(){const e=new UI.ListModel.ListModel;this._messageLevelSelector=new MessageLevelSelector(e,this);const t=new UI.SoftDropDown.SoftDropDown(e,this._messageLevelSelector);t.setRowHeight(18),this._messageLevelSelector.populate(),this._messageLevelSelector.setDefault(t);const s=new UI.Toolbar.ToolbarItem(t.element);return s.element.classList.add("toolbar-has-dropdown"),s.setEnabled(!0),s.setTitle(this._messageLevelSelector.defaultTitle()),s}_createFilterInput(){const e=new UI.Toolbar.ToolbarInput(ls`filter log messages`);return e.addEventListener(UI.Toolbar.ToolbarInput.Event.TextChanged,this._filterByString,this),e}regenerateMessageDisplayCss(e){const t=this._bodyPanel.getElementsByClassName("media-messages-message-container");for(const s of t)this._matchesHiddenLevels(s,e)?s.classList.add("media-messages-message-unselected"):s.classList.remove("media-messages-message-unselected")}_matchesHiddenLevels(e,t){for(const s of t)if(e.classList.contains("media-message-"+s))return!0;return!1}_filterByString(e){const t=e.data,s=this._bodyPanel.getElementsByClassName("media-messages-message-container");for(const e of s)""===t||e.textContent.includes(t)?e.classList.remove("media-messages-message-filtered"):e.classList.add("media-messages-message-filtered")}addMessage(e){this._bodyPanel.createChild("div","media-messages-message-container media-message-"+e.level).createTextChild(e.message)}}