import*as Common from"../common/common.js";import*as Host from"../host/host.js";import*as SDK from"../sdk/sdk.js";import*as UI from"../ui/ui.js";import{ProfilesPanel}from"./ProfilesPanel.js";import{instance}from"./ProfileTypeRegistry.js";export class HeapProfilerPanel extends ProfilesPanel{constructor(){const e=instance,o=[e.heapSnapshotProfileType,e.trackingHeapSnapshotProfileType,e.samplingHeapProfileType];Root.Runtime.experiments.isEnabled("nativeHeapProfiler")&&(o.push(e.samplingNativeHeapProfileType),o.push(e.samplingNativeHeapSnapshotRendererType),o.push(e.samplingNativeHeapSnapshotBrowserType)),super("heap_profiler",o,"profiler.heap-toggle-recording")}appendApplicableItems(e,o,t){if(!(t instanceof SDK.RemoteObject.RemoteObject))return;if(!this.isShowing())return;const n=t;if(!n.objectId)return;const r=n.objectId;if(!instance.heapSnapshotProfileType.getProfiles().length)return;const i=n.runtimeModel().heapProfilerModel();i&&o.revealSection().appendItem(Common.UIString.UIString("Reveal in Summary view"),function(e){i.snapshotObjectIdForObjectId(r).then(o=>{this.isShowing()&&o&&this.showObject(o,e)})}.bind(this,"Summary"))}handleAction(e,o){const t=UI.Context.Context.instance().flavor(HeapProfilerPanel);return console.assert(t&&t instanceof HeapProfilerPanel),t.toggleRecord(),!0}wasShown(){UI.Context.Context.instance().setFlavor(HeapProfilerPanel,this),Host.userMetrics.panelLoaded("heap_profiler","DevTools.Launch.HeapProfiler")}willHide(){UI.Context.Context.instance().setFlavor(HeapProfilerPanel,null)}showObject(e,o){const t=instance.heapSnapshotProfileType.getProfiles();for(let n=0;n<t.length;n++){const r=t[n];if(r.maxJSObjectId>=e){this.showProfile(r);this.viewForProfile(r).selectLiveObject(o,e);break}}}}