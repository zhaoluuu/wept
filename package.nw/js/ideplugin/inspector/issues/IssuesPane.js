import*as BrowserSDK from"../browser_sdk/browser_sdk.js";import*as Common from"../common/common.js";import*as Components from"../components/components.js";import*as Elements from"../elements/elements.js";import*as Network from"../network/network.js";import*as SDK from"../sdk/sdk.js";import*as UI from"../ui/ui.js";import{AggregatedIssue,Events as IssueAggregatorEvents,IssueAggregator}from"./IssueAggregator.js";import{createIssueDescriptionFromMarkdown}from"./MarkdownIssueDescription.js";const extractShortPath=e=>(/[^/]+$/.exec(e)||/[^/]+\/$/.exec(e)||[""])[0];class AffectedResourcesView extends UI.TreeOutline.TreeElement{constructor(e,t){super(),this.toggleOnClick=!0,this._parent=e,this._resourceName=t,this._affectedResourcesCountElement=this.createAffectedResourcesCounter(),this._affectedResources=this.createAffectedResources(),this._affectedResourcesCount=0,this._networkListener=null,this._frameListeners=[],this._unresolvedRequestIds=new Set,this._unresolvedFrameIds=new Set}createAffectedResourcesCounter(){const e=document.createElement("div");return e.classList.add("affected-resource-label"),this.listItemElement.appendChild(e),e}createAffectedResources(){const e=new UI.TreeOutline.TreeElement,t=document.createElement("table");return t.classList.add("affected-resource-list"),e.listItemElement.appendChild(t),this.appendChild(e),t}getResourceName(e){return 1===e?this._resourceName.singular:this._resourceName.plural}updateAffectedResourceCount(e){this._affectedResourcesCount=e,this._affectedResourcesCountElement.textContent=`${e} ${this.getResourceName(e)}`,this.hidden=0===this._affectedResourcesCount,this._parent.updateAffectedResourceVisibility()}isEmpty(){return 0===this._affectedResourcesCount}clear(){this._affectedResources.textContent=""}expandIfOneResource(){1===this._affectedResourcesCount&&this.expand()}_resolveRequestId(e){const t=SDK.NetworkLog.NetworkLog.instance().requestsForId(e);return t.length||(this._unresolvedRequestIds.add(e),this._networkListener||(this._networkListener=SDK.NetworkLog.NetworkLog.instance().addEventListener(SDK.NetworkLog.Events.RequestAdded,this._onRequestAdded,this))),t}_onRequestAdded(e){const t=e.data,s=this._unresolvedRequestIds.delete(t.requestId());0===this._unresolvedRequestIds.size&&this._networkListener&&(Common.EventTarget.EventTarget.removeEventListeners([this._networkListener]),this._networkListener=null),s&&this.update()}_resolveFrameId(e){const t=SDK.FrameManager.FrameManager.instance().getFrame(e);if(!(t&&t.url||(this._unresolvedFrameIds.add(e),this._frameListeners.length))){const e=SDK.FrameManager.FrameManager.instance().addEventListener(SDK.FrameManager.Events.FrameAddedToTarget,this._onFrameChanged,this),t=SDK.FrameManager.FrameManager.instance().addEventListener(SDK.FrameManager.Events.FrameNavigated,this._onFrameChanged,this);this._frameListeners=[e,t]}return t}_onFrameChanged(e){const t=e.data.frame;if(!t.url)return;const s=this._unresolvedFrameIds.delete(t.id);0===this._unresolvedFrameIds.size&&this._frameListeners.length&&(Common.EventTarget.EventTarget.removeEventListeners(this._frameListeners),this._frameListeners=[]),s&&this.update()}_createFrameCell(e){const t=this._resolveFrameId(e),s=t&&(t.unreachableUrl()||t.url)||ls`unknown`,n=document.createElement("td");if(n.classList.add("affected-resource-cell"),t){const t=UI.Icon.Icon.create("mediumicon-elements-panel","icon");t.classList.add("link"),t.onclick=async()=>{const t=SDK.FrameManager.FrameManager.instance().getFrame(e);if(t){const e=await t.getOwnerDOMNodeOrDocument();e&&Common.Revealer.reveal(e)}},UI.Tooltip.Tooltip.install(t,ls`Click to reveal the frame's DOM node in the Elements panel`),n.appendChild(t)}return n.appendChild(document.createTextNode(s)),n.onmouseenter=()=>{const t=SDK.FrameManager.FrameManager.instance().getFrame(e);t&&t.highlight()},n.onmouseleave=()=>SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight(),n}_createRequestCell(e){let t=e.url,s=t?extractShortPath(t):"";const n=document.createElement("td");n.classList.add("affected-resource-cell");const i=UI.Icon.Icon.create("mediumicon-network-panel","icon");n.appendChild(i);const o=this._resolveRequestId(e.requestId);if(o.length){const e=o[0];n.onclick=()=>{Network.NetworkPanel.NetworkPanel.selectAndShowRequest(e,Network.NetworkItemView.Tabs.Headers)},n.classList.add("link"),i.classList.add("link"),t=e.url(),s=extractShortPath(t),i.title=ls`Click to show request in the network panel`}else i.title=ls`Request unavailable in the network panel, try reloading the inspected page`,i.classList.add("unavailable");return t&&(n.title=t),n.appendChild(document.createTextNode(s)),n}update(){throw new Error("This should never be called, did you forget to override?")}}class AffectedElementsView extends AffectedResourcesView{constructor(e,t){super(e,{singular:ls`element`,plural:ls`elements`}),this._issue=t}async _appendAffectedElements(e){let t=0;for(const s of e)await this._appendAffectedElement(s),t++;this.updateAffectedResourceCount(t)}async _appendAffectedElement({backendNodeId:e,nodeName:t}){const s=SDK.SDKModel.TargetManager.instance().mainTarget(),n=new SDK.DOMModel.DeferredDOMNode(s,e),i=await Common.Linkifier.Linkifier.linkify(n);i.textContent=t;const o=document.createElement("td");o.classList.add("affected-resource-element","devtools-link"),o.appendChild(i);const a=document.createElement("tr");a.appendChild(o),this._affectedResources.appendChild(a)}update(){this.clear(),this._appendAffectedElements(this._issue.elements())}}class AffectedDirectivesView extends AffectedResourcesView{constructor(e,t){super(e,{singular:ls`directive`,plural:ls`directives`}),this._issue=t}_appendDirectiveColumnTitle(e){const t=document.createElement("td");t.classList.add("affected-resource-header"),t.textContent=ls`Directive`,e.appendChild(t)}_appendURLColumnTitle(e){const t=document.createElement("td");t.classList.add("affected-resource-header"),t.classList.add("affected-resource-directive-info-header"),t.textContent=ls`Resource`,e.appendChild(t)}_appendElementColumnTitle(e){const t=document.createElement("td");t.classList.add("affected-resource-header"),t.textContent=ls`Element`,e.appendChild(t)}_appendSourceCodeColumnTitle(e){const t=document.createElement("td");t.classList.add("affected-resource-header"),t.textContent=ls`Source code`,e.appendChild(t)}_appendStatusColumnTitle(e){const t=document.createElement("td");t.classList.add("affected-resource-header"),t.textContent=ls`Status`,e.appendChild(t)}_appendBlockedStatus(e){const t=document.createElement("td");t.classList.add("affected-resource-blocked-status"),t.textContent=ls`blocked`,e.appendChild(t)}_appendViolatedDirective(e,t){const s=document.createElement("td");s.textContent=t,e.appendChild(s)}_appendBlockedURL(e,t){const s=document.createElement("td");s.classList.add("affected-resource-directive-info"),s.textContent=t,e.appendChild(s)}_appendBlockedElement(e,t,s){const n=document.createElement("td");if(n.classList.add("affected-resource-csp-info-node"),t){const e=t,i=UI.Icon.Icon.create("largeicon-node-search","icon");i.classList.add("element-reveal-icon"),i.onclick=()=>{const t=s.getTargetIfNotDisposed();if(t){const s=new SDK.DOMModel.DeferredDOMNode(t,e);Common.Revealer.reveal(s)}},UI.Tooltip.Tooltip.install(i,ls`Click to reveal the violating DOM node in the Elements panel`),n.appendChild(i),n.onmouseenter=()=>{const t=s.getTargetIfNotDisposed();if(t){const s=new SDK.DOMModel.DeferredDOMNode(t,e);s&&s.highlight()}},n.onmouseleave=()=>SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight()}e.appendChild(n)}_appendSourceLocation(e,t){const s=document.createElement("td");if(t){const e=40,n=new Components.Linkifier.Linkifier(e).linkifyScriptLocation(null,null,t.url,t.lineNumber);s.appendChild(n)}e.appendChild(s)}_appendAffectedContentSecurityPolicyDetails(e){const t=document.createElement("tr");if(this._issue.code()===SDK.ContentSecurityPolicyIssue.inlineViolationCode)this._appendDirectiveColumnTitle(t),this._appendElementColumnTitle(t),this._appendSourceCodeColumnTitle(t),this._appendStatusColumnTitle(t);else if(this._issue.code()===SDK.ContentSecurityPolicyIssue.urlViolationCode)this._appendURLColumnTitle(t),this._appendStatusColumnTitle(t),this._appendDirectiveColumnTitle(t),this._appendSourceCodeColumnTitle(t);else{if(this._issue.code()!==SDK.ContentSecurityPolicyIssue.evalViolationCode)return void this.updateAffectedResourceCount(0);this._appendSourceCodeColumnTitle(t),this._appendDirectiveColumnTitle(t),this._appendStatusColumnTitle(t)}this._affectedResources.appendChild(t);let s=0;for(const t of e)s++,this._appendAffectedContentSecurityPolicyDetail(t);this.updateAffectedResourceCount(s)}_appendAffectedContentSecurityPolicyDetail(e){const t=document.createElement("tr");t.classList.add("affected-resource-directive");const s=e.details();if(this._issue.code()===SDK.ContentSecurityPolicyIssue.inlineViolationCode)this._appendViolatedDirective(t,s.violatedDirective),this._appendBlockedElement(t,s.violatingNodeId,e.model()),this._appendSourceLocation(t,s.sourceCodeLocation),this._appendBlockedStatus(t);else if(this._issue.code()===SDK.ContentSecurityPolicyIssue.urlViolationCode){const e=s.blockedURL?s.blockedURL:"";this._appendBlockedURL(t,e),this._appendBlockedStatus(t),this._appendViolatedDirective(t,s.violatedDirective),this._appendSourceLocation(t,s.sourceCodeLocation)}else{if(this._issue.code()!==SDK.ContentSecurityPolicyIssue.evalViolationCode)return;this._appendSourceLocation(t,s.sourceCodeLocation),this._appendViolatedDirective(t,s.violatedDirective),this._appendBlockedStatus(t)}this._affectedResources.appendChild(t)}update(){this.clear(),this._appendAffectedContentSecurityPolicyDetails(this._issue.cspIssues())}}class AffectedCookiesView extends AffectedResourcesView{constructor(e,t){super(e,{singular:ls`cookie`,plural:ls`cookies`}),this._issue=t}_appendAffectedCookies(e){const t=document.createElement("tr"),s=document.createElement("td");s.classList.add("affected-resource-header"),s.textContent="Name",t.appendChild(s);const n=document.createElement("td");n.classList.add("affected-resource-header"),n.classList.add("affected-resource-cookie-info-header"),n.textContent=ls`Domain`+" & "+ls`Path`,t.appendChild(n),this._affectedResources.appendChild(t);let i=0;for(const t of e)i++,this.appendAffectedCookie(t.cookie,t.hasRequest);this.updateAffectedResourceCount(i)}appendAffectedCookie(e,t){const s=document.createElement("tr");s.classList.add("affected-resource-cookie");const n=document.createElement("td");t?n.appendChild(UI.UIUtils.createTextButton(e.name,()=>{Network.NetworkPanel.NetworkPanel.revealAndFilter([{filterType:"cookie-domain",filterValue:e.domain},{filterType:"cookie-name",filterValue:e.name},{filterType:"cookie-path",filterValue:e.path}])},"link-style devtools-link")):n.textContent=e.name;const i=document.createElement("td");i.classList.add("affected-resource-cookie-info"),i.textContent=`${e.domain}${e.path}`,s.appendChild(n),s.appendChild(i),this._affectedResources.appendChild(s)}update(){this.clear(),this._appendAffectedCookies(this._issue.cookiesWithRequestIndicator())}}class AffectedRequestsView extends AffectedResourcesView{constructor(e,t){super(e,{singular:ls`request`,plural:ls`requests`}),this._issue=t}_appendAffectedRequests(e){let t=0;for(const s of e)for(const e of this._resolveRequestId(s.requestId))t++,this._appendNetworkRequest(e);this.updateAffectedResourceCount(t)}_appendNetworkRequest(e){const t=e.name().trimMiddle(100),s=document.createElement("td"),n=issueTypeToNetworkHeaderMap.get(this._issue.getCategory())||Network.NetworkItemView.Tabs.Headers;s.appendChild(UI.UIUtils.createTextButton(t,()=>{Network.NetworkPanel.NetworkPanel.selectAndShowRequest(e,n)},"link-style devtools-link"));const i=document.createElement("tr");i.classList.add("affected-resource-request"),i.appendChild(s),this._affectedResources.appendChild(i)}update(){this.clear();for(const e of this._issue.blockedByResponseDetails())return void this.updateAffectedResourceCount(0);this._appendAffectedRequests(this._issue.requests())}}class AffectedSourcesView extends AffectedResourcesView{constructor(e,t){super(e,{singular:ls`source`,plural:ls`sources`}),this._issue=t}_appendAffectedSources(e){let t=0;for(const s of e)this._appendAffectedSource(s),t++;this.updateAffectedResourceCount(t)}_appendAffectedSource({url:e,lineNumber:t,columnNumber:s}){const n=document.createElement("td"),i={columnNumber:s,lineNumber:t,tabStop:!0},o=Components.Linkifier.Linkifier.linkifyURL(e,i);n.appendChild(o);const a=document.createElement("tr");a.classList.add("affected-resource-source"),a.appendChild(n),this._affectedResources.appendChild(a)}update(){this.clear(),this._appendAffectedSources(this._issue.sources())}}const issueTypeToNetworkHeaderMap=new Map([[SDK.Issue.IssueCategory.SameSiteCookie,Network.NetworkItemView.Tabs.Cookies],[SDK.Issue.IssueCategory.CrossOriginEmbedderPolicy,Network.NetworkItemView.Tabs.Headers],[SDK.Issue.IssueCategory.MixedContent,Network.NetworkItemView.Tabs.Headers]]);class AffectedMixedContentView extends AffectedResourcesView{constructor(e,t){super(e,{singular:ls`resource`,plural:ls`resources`}),this._issue=t}_appendAffectedMixedContents(e){const t=document.createElement("tr"),s=document.createElement("td");s.classList.add("affected-resource-header"),s.textContent=ls`Name`,t.appendChild(s);const n=document.createElement("td");n.classList.add("affected-resource-header"),n.textContent=ls`Restriction Status`,t.appendChild(n),this._affectedResources.appendChild(t);let i=0;for(const t of e)t.request?this._resolveRequestId(t.request.requestId).forEach(e=>{this.appendAffectedMixedContent(t,e),i++}):(this.appendAffectedMixedContent(t),i++);this.updateAffectedResourceCount(i)}appendAffectedMixedContent(e,t=null){const s=document.createElement("tr");s.classList.add("affected-resource-mixed-content");const n=extractShortPath(e.insecureURL),i=document.createElement("td");if(t){const e=t,s=issueTypeToNetworkHeaderMap.get(this._issue.getCategory())||Network.NetworkItemView.Tabs.Headers;i.appendChild(UI.UIUtils.createTextButton(n,()=>{Network.NetworkPanel.NetworkPanel.selectAndShowRequest(e,s)},"link-style devtools-link"))}else i.classList.add("affected-resource-mixed-content-info"),i.textContent=n;UI.Tooltip.Tooltip.install(i,e.insecureURL),s.appendChild(i);const o=document.createElement("td");o.classList.add("affected-resource-mixed-content-info"),o.textContent=SDK.MixedContentIssue.MixedContentIssue.translateStatus(e.resolutionStatus),s.appendChild(o),this._affectedResources.appendChild(s)}update(){this.clear(),this._appendAffectedMixedContents(this._issue.mixedContents())}}class AffectedHeavyAdView extends AffectedResourcesView{constructor(e,t){super(e,{singular:ls`resource`,plural:ls`resources`}),this._issue=t}_appendAffectedHeavyAds(e){const t=document.createElement("tr"),s=document.createElement("td");s.classList.add("affected-resource-header"),s.textContent=ls`Limit exceeded`,t.appendChild(s);const n=document.createElement("td");n.classList.add("affected-resource-header"),n.textContent=ls`Resolution Status`,t.appendChild(n);const i=document.createElement("td");i.classList.add("affected-resource-header"),i.textContent=ls`Frame URL`,t.appendChild(i),this._affectedResources.appendChild(t);let o=0;for(const t of e)this._appendAffectedHeavyAd(t),o++;this.updateAffectedResourceCount(o)}_statusToString(e){switch(e){case Protocol.Audits.HeavyAdResolutionStatus.HeavyAdBlocked:return ls`Removed`;case Protocol.Audits.HeavyAdResolutionStatus.HeavyAdWarning:return ls`Warned`}return""}_limitToString(e){switch(e){case Protocol.Audits.HeavyAdReason.CpuPeakLimit:return ls`CPU peak limit`;case Protocol.Audits.HeavyAdReason.CpuTotalLimit:return ls`CPU total limit`;case Protocol.Audits.HeavyAdReason.NetworkTotalLimit:return ls`Network limit`}return""}_appendAffectedHeavyAd(e){const t=document.createElement("tr");t.classList.add("affected-resource-heavy-ad");const s=document.createElement("td");s.classList.add("affected-resource-heavy-ad-info"),s.textContent=this._limitToString(e.reason),t.appendChild(s);const n=document.createElement("td");n.classList.add("affected-resource-heavy-ad-info"),n.textContent=this._statusToString(e.resolution),t.appendChild(n);const i=e.frame.frameId,o=this._createFrameCell(i);t.appendChild(o),this._affectedResources.appendChild(t)}update(){this.clear(),this._appendAffectedHeavyAds(this._issue.heavyAds())}}class AffectedBlockedByResponseView extends AffectedResourcesView{constructor(e,t){super(e,{singular:ls`request`,plural:ls`requests`}),this._issue=t}_appendDetails(e){const t=document.createElement("tr"),s=document.createElement("td");s.classList.add("affected-resource-header"),s.textContent=ls`Request`,t.appendChild(s);const n=document.createElement("td");n.classList.add("affected-resource-header"),n.textContent=ls`Parent Frame`,t.appendChild(n);const i=document.createElement("td");i.classList.add("affected-resource-header"),i.textContent=ls`Blocked Resource`,t.appendChild(i),this._affectedResources.appendChild(t);let o=0;for(const t of e)this._appendDetail(t),o++;this.updateAffectedResourceCount(o)}_appendDetail(e){const t=document.createElement("tr");t.classList.add("affected-resource-row");const s=this._createRequestCell(e.request);if(t.appendChild(s),e.parentFrame){const s=this._createFrameCell(e.parentFrame.frameId);t.appendChild(s)}else t.appendChild(document.createElement("td"));if(e.blockedFrame){const s=this._createFrameCell(e.blockedFrame.frameId);t.appendChild(s)}else t.appendChild(document.createElement("td"));this._affectedResources.appendChild(t)}update(){this.clear(),this._appendDetails(this._issue.blockedByResponseDetails())}}class IssueView extends UI.TreeOutline.TreeElement{constructor(e,t,s){super(),this._parent=e,this._issue=t,this._description=s,this.toggleOnClick=!0,this.listItemElement.classList.add("issue"),this.childrenListElement.classList.add("body"),this._affectedResources=this._createAffectedResources(),this._affectedResourceViews=[new AffectedCookiesView(this,this._issue),new AffectedElementsView(this,this._issue),new AffectedRequestsView(this,this._issue),new AffectedMixedContentView(this,this._issue),new AffectedSourcesView(this,this._issue),new AffectedHeavyAdView(this,this._issue),new AffectedDirectivesView(this,this._issue),new AffectedBlockedByResponseView(this,this._issue)],this._aggregatedIssuesCount=null,this._hasBeenExpandedBefore=!1}getIssueTitle(){return this._description.title}onattach(){this._appendHeader(),this._createBody(),this.appendChild(this._affectedResources);for(const e of this._affectedResourceViews)this.appendAffectedResource(e),e.update();this._createReadMoreLinks(),this.updateAffectedResourceVisibility()}appendAffectedResource(e){this._affectedResources.appendChild(e)}_appendHeader(){const e=document.createElement("div");e.classList.add("header");const t=UI.Icon.Icon.create("largeicon-breaking-change","icon");this._aggregatedIssuesCount=document.createElement("span");const s=Elements.Adorner.Adorner.create(this._aggregatedIssuesCount,"countWrapper");s.classList.add("aggregated-issues-count"),this._aggregatedIssuesCount.textContent=""+this._issue.getAggregatedIssuesCount(),e.appendChild(t),e.appendChild(s);const n=document.createElement("div");n.classList.add("title"),n.textContent=this._description.title,e.appendChild(n),this.listItemElement.appendChild(e)}onexpand(){if(!this._hasBeenExpandedBefore){this._hasBeenExpandedBefore=!0;for(const e of this._affectedResourceViews)e.expandIfOneResource()}}_updateAggregatedIssuesCount(){this._aggregatedIssuesCount&&(this._aggregatedIssuesCount.textContent=""+this._issue.getAggregatedIssuesCount())}updateAffectedResourceVisibility(){const e=this._affectedResourceViews.every(e=>e.isEmpty());this._affectedResources.hidden=e}_createAffectedResources(){const e=new UI.TreeOutline.TreeElement;return e.setCollapsible(!1),e.setExpandable(!0),e.expand(),e.selectable=!1,e.listItemElement.classList.add("affected-resources-label"),e.listItemElement.textContent=ls`Affected Resources`,e.childrenListElement.classList.add("affected-resources"),e}_createBody(){const e=new UI.TreeOutline.TreeElement;e.setCollapsible(!1),e.selectable=!1;const t=this._description.message();e.listItemElement.appendChild(t),this.appendChild(e)}_createReadMoreLinks(){if(0===this._description.links.length)return;const e=new UI.TreeOutline.TreeElement;e.setCollapsible(!1),e.listItemElement.classList.add("link-wrapper");const t=e.listItemElement.createChild("ul","link-list");for(const e of this._description.links){const s=UI.XLink.XLink.create(e.link,ls`Learn more: ${e.linkTitle}`,"link"),n=UI.Icon.Icon.create("largeicon-link","link-icon");s.prepend(n);t.createChild("li").appendChild(s)}this.appendChild(e)}update(){this._affectedResourceViews.forEach(e=>e.update()),this.updateAffectedResourceVisibility(),this._updateAggregatedIssuesCount()}toggle(e){e||void 0===e&&!this.expanded?this.expand():this.collapse()}}export class IssuesPaneImpl extends UI.Widget.VBox{constructor(){super(!0),this.registerRequiredCSS("issues/issuesPane.css"),this.contentElement.classList.add("issues-pane"),this._issueViews=new Map;const{toolbarContainer:e,updateToolbarIssuesCount:t}=this._createToolbars();this._issuesToolbarContainer=e,this._updateToolbarIssuesCount=t,this._issuesTree=new UI.TreeOutline.TreeOutlineInShadow,this._issuesTree.registerRequiredCSS("issues/issuesTree.css"),this._issuesTree.setShowSelectionOnKeyboardFocus(!0),this._issuesTree.contentElement.classList.add("issues"),this.contentElement.appendChild(this._issuesTree.element),this._noIssuesMessageDiv=document.createElement("div"),this._noIssuesMessageDiv.classList.add("issues-pane-no-issues"),this.contentElement.appendChild(this._noIssuesMessageDiv),this._issuesManager=BrowserSDK.IssuesManager.IssuesManager.instance(),this._aggregator=new IssueAggregator(this._issuesManager),this._aggregator.addEventListener(IssueAggregatorEvents.AggregatedIssueUpdated,this._issueUpdated,this),this._aggregator.addEventListener(IssueAggregatorEvents.FullUpdateRequired,this._fullUpdate,this);for(const e of this._aggregator.aggregatedIssues())this._updateIssueView(e);this._issuesManager.addEventListener(BrowserSDK.IssuesManager.Events.IssuesCountUpdated,this._updateCounts,this),this._updateCounts()}elementsToRestoreScrollPositionsFor(){return[this._issuesTree.element]}_createToolbars(){const e=this.contentElement.createChild("div","issues-toolbar-container");new UI.Toolbar.Toolbar("issues-toolbar-left",e);const t=new UI.Toolbar.Toolbar("issues-toolbar-right",e),s=SDK.Issue.getShowThirdPartyIssuesSetting(),n=new UI.Toolbar.ToolbarSettingCheckbox(s,ls`Include cookie Issues caused by third-party sites`,ls`Include third-party cookie issues`);t.appendToolbarItem(n),t.appendSeparator();const i=document.createElement("div");i.classList.add("toolbar-warnings");const o=UI.Icon.Icon.create("largeicon-breaking-change");i.appendChild(o);const a=i.createChild("span","warnings-count-label"),d=new UI.Toolbar.ToolbarItem(i);t.appendToolbarItem(d);return{toolbarContainer:e,updateToolbarIssuesCount:e=>{a.textContent=""+e,1===e?d.setTitle(ls`Issues pertaining to ${e} operation detected.`):d.setTitle(ls`Issues pertaining to ${e} operations detected.`)}}}_issueUpdated(e){const t=e.data;this._updateIssueView(t)}_updateIssueView(e){if(!this._issueViews.has(e.code())){let t=e.getDescription();if(!t)return void console.warn("Could not find description for issue code:",e.code());"file"in t&&(t=createIssueDescriptionFromMarkdown(t));const s=new IssueView(this,e,t);this._issueViews.set(e.code(),s),this._issuesTree.appendChild(s,(e,t)=>e instanceof IssueView&&t instanceof IssueView?e.getIssueTitle().localeCompare(t.getIssueTitle()):(console.error("The issues tree should only contain IssueView objects as direct children"),0))}this._issueViews.get(e.code()).update(),this._updateCounts()}_fullUpdate(){for(const e of this._issueViews.values())this._issuesTree.removeChild(e);if(this._issueViews.clear(),this._aggregator)for(const e of this._aggregator.aggregatedIssues())this._updateIssueView(e);this._updateCounts()}_updateCounts(){const e=this._issuesManager.numberOfIssues();this._updateToolbarIssuesCount(e),this._showIssuesTreeOrNoIssuesDetectedMessage(e)}_showIssuesTreeOrNoIssuesDetectedMessage(e){if(e>0)this._issuesTree.element.hidden=!1,this._noIssuesMessageDiv.style.display="none";else{this._issuesTree.element.hidden=!0;const e=this._issuesManager.numberOfAllStoredIssues()>0;this._noIssuesMessageDiv.textContent=e?ls`Only third-party cookie issues detected so far`:ls`No issues detected so far`,this._noIssuesMessageDiv.style.display="flex"}}revealByCode(e){const t=this._issueViews.get(e);t&&(t.expand(),t.reveal())}}