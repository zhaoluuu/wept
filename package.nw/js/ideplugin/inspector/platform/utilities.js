import{escapeCharacters,sprintf}from"./string-utilities.js";String.sprintf=sprintf,String.regexSpecialCharacters=function(){return"^[]{}()\\.^$*+?|-,"},String.prototype.escapeForRegExp=function(){return escapeCharacters(this,String.regexSpecialCharacters())},String.filterRegex=function(t){const e=String.regexSpecialCharacters();let r="";for(let n=0;n<t.length;++n){let o=t.charAt(n);-1!==e.indexOf(o)&&(o="\\"+o),n&&(r+="[^\\0"+o+"]*"),r+=o}return new RegExp(r,"i")},String.prototype.trimMiddle=function(t){if(this.length<=t)return String(this);let e=t>>1,r=t-e-1;return this.codePointAt(this.length-r-1)>=65536&&(--r,++e),e>0&&this.codePointAt(e-1)>=65536&&--e,this.substr(0,e)+"…"+this.substr(this.length-r,r)},String.prototype.trimEndWithMaxLength=function(t){return this.length<=t?String(this):this.substr(0,t-1)+"…"},String.prototype.compareTo=function(t){return this>t?1:this<t?-1:0},String.hashCode=function(t){if(!t)return 0;const e=4294967291;let r=0,n=1;for(let o=0;o<t.length;o++){r=(r+n*(1506996573*t.charCodeAt(o)))%e,n=1345575271*n%e}return r=(r+n*(e-1))%e,Math.abs(0|r)},String.naturalOrderComparator=function(t,e){const r=/^\d+|^\D+/;let n,o,i,s;for(;;){if(!t)return e?-1:0;if(!e)return 1;if(n=t.match(r)[0],o=e.match(r)[0],i=!isNaN(n),s=!isNaN(o),i&&!s)return-1;if(s&&!i)return 1;if(i&&s){const t=n-o;if(t)return t;if(n.length!==o.length)return+n||+o?o.length-n.length:n.length-o.length}else if(n!==o)return n<o?-1:1;t=t.substring(n.length),e=e.substring(o.length)}},String.caseInsensetiveComparator=function(t,e){return(t=t.toUpperCase())===(e=e.toUpperCase())?0:t>e?1:-1},Number.toFixedIfFloating=function(t){if(!t||isNaN(t))return t;const e=Number(t);return e%1?e.toFixed(3):String(e)},function(){const t={value:function(t,e,r,n){function o(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}const i=this[n];o(this,r,n);let s=e;for(let n=e;n<r;++n)t(this[n],i)<0&&(o(this,s,n),++s);return o(this,r,s),s},configurable:!0};Object.defineProperty(Array.prototype,"partition",t),Object.defineProperty(Uint32Array.prototype,"partition",t);const e={value:function(t,e,r,n,o){return 0===e&&r===this.length-1&&0===n&&o>=r?this.sort(t):function t(e,r,n,o,i,s){if(o<=n)return;const a=Math.floor(Math.random()*(o-n))+n,u=e.partition(r,n,o,a);i<u&&t(e,r,n,u-1,i,s),u<s&&t(e,r,u+1,o,i,s)}(this,t,e,r,n,o),this},configurable:!0};Object.defineProperty(Array.prototype,"sortRange",e),Object.defineProperty(Uint32Array.prototype,"sortRange",e)}(),Object.defineProperty(Array.prototype,"lowerBound",{value:function(t,e,r,n){e=e||function(t,e){return t<e?-1:t>e?1:0};let o=r||0,i=void 0!==n?n:this.length;for(;o<i;){const r=o+i>>1;e(t,this[r])>0?o=r+1:i=r}return i},configurable:!0}),Object.defineProperty(Array.prototype,"upperBound",{value:function(t,e,r,n){e=e||function(t,e){return t<e?-1:t>e?1:0};let o=r||0,i=void 0!==n?n:this.length;for(;o<i;){const r=o+i>>1;e(t,this[r])>=0?o=r+1:i=r}return i},configurable:!0}),Object.defineProperty(Uint32Array.prototype,"lowerBound",{value:Array.prototype.lowerBound,configurable:!0}),Object.defineProperty(Uint32Array.prototype,"upperBound",{value:Array.prototype.upperBound,configurable:!0}),Object.defineProperty(Int32Array.prototype,"lowerBound",{value:Array.prototype.lowerBound,configurable:!0}),Object.defineProperty(Int32Array.prototype,"upperBound",{value:Array.prototype.upperBound,configurable:!0}),Object.defineProperty(Float64Array.prototype,"lowerBound",{value:Array.prototype.lowerBound,configurable:!0}),Object.defineProperty(Array.prototype,"binaryIndexOf",{value:function(t,e){const r=this.lowerBound(t,e);return r<this.length&&0===e(t,this[r])?r:-1},configurable:!0}),Object.defineProperty(Array.prototype,"peekLast",{value:function(){return this[this.length-1]},configurable:!0}),function(){function t(t,e,r,n){const o=[];let i=0,s=0;for(;i<t.length&&s<e.length;){const a=r(t[i],e[s]);!n&&a||o.push(a<=0?t[i]:e[s]),a<=0&&i++,a>=0&&s++}if(n){for(;i<t.length;)o.push(t[i++]);for(;s<e.length;)o.push(e[s++])}return o}Object.defineProperty(Array.prototype,"intersectOrdered",{value:function(e,r){return t(this,e,r,!1)},configurable:!0}),Object.defineProperty(Array.prototype,"mergeOrdered",{value:function(e,r){return t(this,e,r,!0)},configurable:!0})}(),self.createSearchRegex=function(t,e,r){const n=e?"g":"gi";let o;if(r)try{o=new RegExp(t,n)}catch(t){}return o||(o=self.createPlainTextSearchRegex(t,n)),o},self.createPlainTextSearchRegex=function(t,e){const r=String.regexSpecialCharacters();let n="";for(let e=0;e<t.length;++e){const o=t.charAt(e);-1!==r.indexOf(o)&&(n+="\\"),n+=o}return new RegExp(n,e||"")},self.spacesPadding=function(t){return" ".repeat(t)},self.numberToStringWithSpacesPadding=function(t,e){const r=t.toString(),n=Math.max(0,e-r.length);return self.spacesPadding(n)+r},Set.prototype.firstValue=function(){return this.size?this.values().next().value:null},Map.prototype.inverse=function(){const t=new Platform.Multimap;for(const e of this.keys()){const r=this.get(e);t.set(r,e)}return t};export class Multimap{constructor(){this._map=new Map}set(t,e){let r=this._map.get(t);r||(r=new Set,this._map.set(t,r)),r.add(e)}get(t){return this._map.get(t)||new Set}has(t){return this._map.has(t)}hasValue(t,e){const r=this._map.get(t);return!!r&&r.has(e)}get size(){return this._map.size}delete(t,e){const r=this.get(t);if(!r)return!1;const n=r.delete(e);return r.size||this._map.delete(t),n}deleteAll(t){this._map.delete(t)}keysArray(){return[...this._map.keys()]}valuesArray(){const t=[];for(const e of this._map.values())t.push(...e.values());return t}clear(){this._map.clear()}}self.suppressUnused=function(t){},self.setImmediate=function(t){const e=[...arguments].slice(1);return Promise.resolve().then(()=>t(...e)),0},self.runOnWindowLoad=function(t){"complete"===document.readyState||"interactive"===document.readyState?t():self.addEventListener("DOMContentLoaded",(function e(){self.removeEventListener("DOMContentLoaded",e,!1),t()}),!1)};const _singletonSymbol=Symbol("singleton");self.singleton=function(t){if(_singletonSymbol in t)return t[_singletonSymbol];const e=new t;return t[_singletonSymbol]=e,e},self.base64ToSize=function(t){if(!t)return 0;let e=3*t.length/4;return"="===t[t.length-1]&&e--,t.length>1&&"="===t[t.length-2]&&e--,e},self.unescapeCssString=function(t){return t.replace(/(?<!\\)\\(?:([a-fA-F0-9]{1,6})|(.))[\n\t\x20]?/gs,(t,e,r)=>{if(r)return r;const n=parseInt(e,16);return 55296<=n&&n<=57343||0===n||n>1114111?"�":String.fromCodePoint(n)})},self.Platform=self.Platform||{},Platform=Platform||{},Platform.Multimap=Multimap;