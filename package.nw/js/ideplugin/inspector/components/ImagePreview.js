import*as Common from"../common/common.js";import*as Platform from"../platform/platform.js";import*as UI from"../ui/ui.js";export class ImagePreview{static build(e,r,t,n={}){const{precomputedFeatures:i,imageAltText:o}=n,s=e.model(SDK.ResourceTreeModel);if(!s)return Promise.resolve(null);let a,c=s.resourceForURL(r),l=r;if(!u(c)&&i&&i.currentSrc&&(l=i.currentSrc,c=s.resourceForURL(l)),!u(c))return Promise.resolve(null);const d=new Promise(e=>{a=e}),m=createElement("img");return m.addEventListener("load",(function(){const e=createElement("table");UI.Utils.appendStyle(e,"components/imagePreview.css"),e.className="image-preview-container";const n=m.naturalWidth,o=m.naturalHeight,s=i?i.renderedWidth:n,c=i?i.renderedHeight:o;let d;t&&(d=c!==o||s!==n?ls`${s} × ${c} pixels (intrinsic: ${n} × ${o} pixels)`:ls`${s} × ${c} pixels`);e.createChild("tr").createChild("td","image-container").appendChild(m),d&&(e.createChild("tr").createChild("td").createChild("span","description").textContent=d);l!==r&&(e.createChild("tr").createChild("td").createChild("span","description").textContent=Platform.StringUtilities.sprintf("currentSrc: %s",l.trimMiddle(100)));a(e)}),!1),m.addEventListener("error",()=>a(null),!1),o&&(m.alt=o),c.populateImageSource(m),d;function u(e){return!!e&&e.resourceType()===Common.ResourceType.resourceTypes.Image}}static async loadDimensionsForNode(e){if(!e.nodeName()||"img"!==e.nodeName().toLowerCase())return;const r=await e.resolveToObject("");if(!r)return;const t=r.callFunctionJSON((function(){return{renderedWidth:this.width,renderedHeight:this.height,currentSrc:this.currentSrc}}),void 0);return r.release(),t}static defaultAltTextForImageURL(e){const r=new Common.ParsedURL.ParsedURL(e),t=r.isValid?r.displayName:ls`unknown source`;return ls`Image from ${t}`}}