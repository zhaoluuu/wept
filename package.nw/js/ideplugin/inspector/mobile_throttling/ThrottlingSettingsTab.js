import*as Common from"../common/common.js";import*as SDK from"../sdk/sdk.js";import*as UI from"../ui/ui.js";export class ThrottlingSettingsTab extends UI.Widget.VBox{constructor(){super(!0),this.registerRequiredCSS("mobile_throttling/throttlingSettingsTab.css");const t=this.contentElement.createChild("div","header");t.textContent=ls`Network Throttling Profiles`,UI.ARIAUtils.markAsHeading(t,1);const i=UI.UIUtils.createTextButton(Common.UIString.UIString("Add custom profile..."),this._addButtonClicked.bind(this),"add-conditions-button");this.contentElement.appendChild(i),this._list=new UI.ListWidget.ListWidget(this),this._list.element.classList.add("conditions-list"),this._list.registerRequiredCSS("mobile_throttling/throttlingSettingsTab.css"),this._list.show(this.contentElement),this._customSetting=Common.Settings.Settings.instance().moduleSetting("customNetworkConditions"),this._customSetting.addChangeListener(this._conditionsUpdated,this),this.setDefaultFocusedElement(i)}wasShown(){super.wasShown(),this._conditionsUpdated()}_conditionsUpdated(){this._list.clear();const t=this._customSetting.get();for(let i=0;i<t.length;++i)this._list.appendItem(t[i],!0);this._list.appendSeparator()}_addButtonClicked(){this._list.addNewItem(this._customSetting.get().length,{title:"",download:-1,upload:-1,latency:0})}renderItem(t,i){const e=t,n=document.createElement("div");n.classList.add("conditions-list-item");const s=n.createChild("div","conditions-list-text conditions-list-title").createChild("div","conditions-list-title-text");return s.textContent=e.title,s.title=e.title,n.createChild("div","conditions-list-separator"),n.createChild("div","conditions-list-text").textContent=throughputText(e.download),n.createChild("div","conditions-list-separator"),n.createChild("div","conditions-list-text").textContent=throughputText(e.upload),n.createChild("div","conditions-list-separator"),n.createChild("div","conditions-list-text").textContent=Common.UIString.UIString("%dms",e.latency),n}removeItemRequested(t,i){const e=this._customSetting.get();e.splice(i,1),this._customSetting.set(e)}commitEdit(t,i,e){const n=t;n.title=i.control("title").value.trim();const s=i.control("download").value.trim();n.download=s?128*parseInt(s,10):-1;const o=i.control("upload").value.trim();n.upload=o?128*parseInt(o,10):-1;const l=i.control("latency").value.trim();n.latency=l?parseInt(l,10):0;const d=this._customSetting.get();e&&d.push(n),this._customSetting.set(d)}beginEdit(t){const i=t,e=this._createEditor();return e.control("title").value=i.title,e.control("download").value=i.download<=0?"":String(i.download/128),e.control("upload").value=i.upload<=0?"":String(i.upload/128),e.control("latency").value=i.latency?String(i.latency):"",e}_createEditor(){if(this._editor)return this._editor;const t=new UI.ListWidget.Editor;this._editor=t;const i=t.contentElement(),e=i.createChild("div","conditions-edit-row"),n=e.createChild("div","conditions-list-text conditions-list-title"),s=ls`Profile Name`;n.textContent=s,e.createChild("div","conditions-list-separator conditions-list-separator-invisible");const o=e.createChild("div","conditions-list-text"),l=ls`Download`;o.textContent=l,e.createChild("div","conditions-list-separator conditions-list-separator-invisible");const d=e.createChild("div","conditions-list-text"),r=ls`Upload`;d.textContent=r,e.createChild("div","conditions-list-separator conditions-list-separator-invisible");const c=e.createChild("div","conditions-list-text"),a=ls`Latency`;c.textContent=a;const h=i.createChild("div","conditions-edit-row"),u=t.createInput("title","text","",(function(t,i,e){const n=e.value.trim(),s=n.length>0&&n.length<=49;if(!s){const t=ls`Profile Name characters length must be between 1 to ${49} inclusive`;return{valid:s,errorMessage:t}}return{valid:s}}));UI.ARIAUtils.setAccessibleName(u,s),h.createChild("div","conditions-list-text conditions-list-title").appendChild(u),h.createChild("div","conditions-list-separator conditions-list-separator-invisible");let m=h.createChild("div","conditions-list-text");const p=t.createInput("download","text",ls`kb/s`,b);m.appendChild(p),UI.ARIAUtils.setAccessibleName(p,l);const g=m.createChild("div","conditions-edit-optional"),C=ls`optional`;g.textContent=C,UI.ARIAUtils.setDescription(p,C),h.createChild("div","conditions-list-separator conditions-list-separator-invisible"),m=h.createChild("div","conditions-list-text");const v=t.createInput("upload","text",ls`kb/s`,b);UI.ARIAUtils.setAccessibleName(v,r),m.appendChild(v);m.createChild("div","conditions-edit-optional").textContent=C,UI.ARIAUtils.setDescription(v,C),h.createChild("div","conditions-list-separator conditions-list-separator-invisible"),m=h.createChild("div","conditions-list-text");const I=t.createInput("latency","text",ls`ms`,(function(t,i,e){const n=e.value.trim(),s=Number(n),o=Number.isInteger(s)&&s>=0&&s<=1e6;if(!o){const t=ls`Latency must be an integer between ${0}ms to ${1e6}ms inclusive`;return{valid:o,errorMessage:t}}return{valid:o}}));UI.ARIAUtils.setAccessibleName(I,a),m.appendChild(I);return m.createChild("div","conditions-edit-optional").textContent=C,UI.ARIAUtils.setDescription(I,C),t;function b(t,i,e){const n=e.value.trim(),s=Number(n),o=e.getAttribute("aria-label"),l=!Number.isNaN(s)&&s>=0&&s<=1e7;if(!l){return{valid:l,errorMessage:ls`${o} must be a number between ${0}kb/s to ${1e7}kb/s inclusive`}}return{valid:l}}}}export function throughputText(t,i){if(t<0)return"";const e=t/128,n=i?"":" ";return e<1024?Common.UIString.UIString("%d%skb/s",e,n):e<10240?Common.UIString.UIString("%.1f%sMb/s",e/1024,n):Common.UIString.UIString("%d%sMb/s",e/1024|0,n)}