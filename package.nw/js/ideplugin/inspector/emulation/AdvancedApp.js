import*as Common from"../common/common.js";import*as Host from"../host/host.js";import*as UI from"../ui/ui.js";import{DeviceModeWrapper}from"./DeviceModeWrapper.js";import{Events,instance}from"./InspectedPagePlaceholder.js";let _appInstance;export class AdvancedApp{constructor(){self.UI.dockController.addEventListener(UI.DockController.Events.BeforeDockSideChanged,this._openToolboxWindow,this)}static _instance(){return _appInstance||(_appInstance=new AdvancedApp),_appInstance}presentUI(e){const t=new UI.RootView.RootView;this._rootSplitWidget=new UI.SplitWidget.SplitWidget(!1,!0,"InspectorView.splitViewState",555,300,!0),this._rootSplitWidget.show(t.element),this._rootSplitWidget.setSidebarWidget(self.UI.inspectorView),this._rootSplitWidget.setDefaultFocusedChild(self.UI.inspectorView),self.UI.inspectorView.setOwnerSplit(this._rootSplitWidget),this._inspectedPagePlaceholder=instance(),this._inspectedPagePlaceholder.addEventListener(Events.Update,this._onSetInspectedPageBounds.bind(this),this),this._deviceModeView=new DeviceModeWrapper(this._inspectedPagePlaceholder),self.UI.dockController.addEventListener(UI.DockController.Events.BeforeDockSideChanged,this._onBeforeDockSideChange,this),self.UI.dockController.addEventListener(UI.DockController.Events.DockSideChanged,this._onDockSideChange,this),self.UI.dockController.addEventListener(UI.DockController.Events.AfterDockSideChanged,this._onAfterDockSideChange,this),this._onDockSideChange(),console.timeStamp("AdvancedApp.attachToBody"),t.attachToDocument(e),t.focus(),this._inspectedPagePlaceholder.update()}_openToolboxWindow(e){if(e.data.to!==UI.DockController.State.Undocked)return;if(this._toolboxWindow)return;const t=window.location.href.replace("devtools_app.html","toolbox.html");this._toolboxWindow=window.open(t,void 0)}toolboxLoaded(e){UI.UIUtils.initializeUIUtils(e,Common.Settings.Settings.instance().createSetting("uiTheme","default")),UI.UIUtils.installComponentRootStyles(e.body),UI.ContextMenu.ContextMenu.installHandler(e),UI.Tooltip.Tooltip.installHandler(e),this._toolboxRootView=new UI.RootView.RootView,this._toolboxRootView.attachToDocument(e),this._updateDeviceModeView()}_updateDeviceModeView(){this._isDocked()?this._rootSplitWidget.setMainWidget(this._deviceModeView):this._toolboxRootView&&this._deviceModeView.show(this._toolboxRootView.element)}_onBeforeDockSideChange(e){e.data.to===UI.DockController.State.Undocked&&this._toolboxRootView&&(this._rootSplitWidget.hideSidebar(),this._inspectedPagePlaceholder.update()),this._changingDockSide=!0}_onDockSideChange(e){this._updateDeviceModeView();const t=e?e.data.to:self.UI.dockController.dockSide();t===UI.DockController.State.Undocked?this._updateForUndocked():this._toolboxRootView&&e&&e.data.from===UI.DockController.State.Undocked?this._rootSplitWidget.hideSidebar():this._updateForDocked(t)}_onAfterDockSideChange(e){this._changingDockSide&&(e.data.from===UI.DockController.State.Undocked&&this._updateForDocked(e.data.to),this._changingDockSide=!1,this._inspectedPagePlaceholder.update())}_updateForDocked(e){this._rootSplitWidget.resizerElement().style.transform=e===UI.DockController.State.DockedToRight?"translateX(2px)":e===UI.DockController.State.DockedToLeft?"translateX(-2px)":"",this._rootSplitWidget.setVertical(e===UI.DockController.State.DockedToRight||e===UI.DockController.State.DockedToLeft),this._rootSplitWidget.setSecondIsSidebar(e===UI.DockController.State.DockedToRight||e===UI.DockController.State.DockedToBottom),this._rootSplitWidget.toggleResizer(this._rootSplitWidget.resizerElement(),!0),this._rootSplitWidget.toggleResizer(self.UI.inspectorView.topResizerElement(),e===UI.DockController.State.DockedToBottom),this._rootSplitWidget.showBoth()}_updateForUndocked(){this._rootSplitWidget.toggleResizer(this._rootSplitWidget.resizerElement(),!1),this._rootSplitWidget.toggleResizer(self.UI.inspectorView.topResizerElement(),!1),this._rootSplitWidget.hideMain()}_isDocked(){return self.UI.dockController.dockSide()!==UI.DockController.State.Undocked}_onSetInspectedPageBounds(e){if(this._changingDockSide)return;const t=this._inspectedPagePlaceholder.element.window();if(!t.innerWidth||!t.innerHeight)return;if(!this._inspectedPagePlaceholder.isShowing())return;const o=e.data;console.timeStamp("AdvancedApp.setInspectedPageBounds"),Host.InspectorFrontendHost.InspectorFrontendHostInstance.setInspectedPageBounds(o)}}export class AdvancedAppProvider{createApp(){return AdvancedApp._instance()}}