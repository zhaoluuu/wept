import*as Common from"../common/common.js";import*as SDK from"../sdk/sdk.js";import*as UI from"../ui/ui.js";import{DeveloperResourcesListView}from"./DeveloperResourcesListView.js";export class DeveloperResourcesView extends UI.Widget.VBox{constructor(){super(!0),this.registerRequiredCSS("developer_resources/developerResourcesView.css");const e=this.contentElement.createChild("div","developer-resource-view-toolbar-container"),t=new UI.Toolbar.Toolbar("developer-resource-view-toolbar",e);this._textFilterRegExp=null;this._filterInput=new UI.Toolbar.ToolbarInput(ls`Enter text to search the URL and Error columns`,"",1),this._filterInput.addEventListener(UI.Toolbar.ToolbarInput.Event.TextChanged,this._onFilterChanged,this),t.appendToolbarItem(this._filterInput),this._coverageResultsElement=this.contentElement.createChild("div","developer-resource-view-results"),this._listView=new DeveloperResourcesListView(this._isVisible.bind(this)),this._listView.show(this._coverageResultsElement),this._statusToolbarElement=this.contentElement.createChild("div","developer-resource-view-toolbar-summary"),this._statusMessageElement=this._statusToolbarElement.createChild("div","developer-resource-view-message"),this._throttler=new Common.Throttler.Throttler(100),this._loader=SDK.PageResourceLoader.PageResourceLoader.instance(),this._loader.addEventListener(SDK.PageResourceLoader.Events.Update,this._onUpdate,this),this._onUpdate()}_onUpdate(){this._throttler.schedule(this._update.bind(this))}async _update(){this._listView.reset(),this._listView.update(this._loader.getResourcesLoaded().values()),this._updateStats()}_updateStats(){const{loading:e,resources:t}=this._loader.getNumberOfResources();this._statusMessageElement.textContent=e>0?`${t} resources, ${e} currently loading`:t+" resources"}_isVisible(e){return!this._textFilterRegExp||this._textFilterRegExp.test(e.url)||this._textFilterRegExp.test(e.errorMessage||"")}_onFilterChanged(){if(!this._listView)return;const e=this._filterInput.value();this._textFilterRegExp=e?createPlainTextSearchRegex(e,"i"):null,this._listView.updateFilterAndHighlight(this._textFilterRegExp),this._updateStats()}}