import{noop,uniqId,each,clone}from"../third_party/licia.js";import*as DOM from"./DomainDOM.js";import*as CSS from"./DomainCSS.js";import*as Overlay from"./DomainOverlay.js";import*as SDK from"../sdk/sdk.js";import{InspectorBackend}from"../protocol_client/protocol_client.js";const methods={"CSS.enable":CSS.enable,"CSS.getInlineStylesForNode":CSS.getInlineStylesForNode,"CSS.getMatchedStylesForNode":CSS.getMatchedStylesForNode,"CSS.getComputedStyleForNode":CSS.getComputedStyleForNode,"CSS.setStyleTexts":CSS.setStyleTexts,"CSS.getPlatformFontsForNode":noop,"CSS.getBackgroundColors":noop,"CSS.getStyleSheetText":noop,"DOM.enable":DOM.enable,"DOM.getDocument":DOM.getDocument,"DOM.requestChildNodes":DOM.requestChildNodes,"DOM.setAttributesAsText":DOM.setAttributesAsText,"DOM.setInspectedNode":DOM.setInspectedNode,"DOM.getComponentData":DOM.getComponentData,"DOM.scrollIntoView":DOM.scrollIntoView,"DOM.setHideElement":DOM.setHideElement,"DOM.setNodeValue":DOM.setNodeValue,"DOM.pushNodesByBackendIdsToFrontend":DOM.pushNodesByBackendIdsToFrontend,"DOM.removeNode":DOM.removeNode,"DOM.setAttributeValue":DOM.setAttributeValue,"DOM.collectClassNamesFromSubtree":DOM.collectClassNamesFromSubtree,"DOM.performSearch":DOM.performSearch,"DOM.getSearchResults":DOM.getSearchResults,"DOM.discardSearchResults":DOM.discardSearchResults,"DOM.pushNodeByPathToFrontend":DOM.pushNodeByPathToFrontend,"DOM.markUndoableState":noop,"DOM.undo":noop,"Overlay.enable":noop,"Overlay.highlightNode":Overlay.highlightNode,"Overlay.setShowViewportSizeOnResize":noop,"Overlay.hideHighlight":Overlay.hideHighlight,"Overlay.setInspectMode":Overlay.setInspectMode,"Runtime.enable":noop,"Runtime.getIsolateId":noop,"Debugger.enable":noop,"Debugger.setBreakpointsActive":noop,"Debugger.setSkipAllPauses":noop,"Debugger.setPauseOnExceptions":noop,"Debugger.setAsyncCallStackDepth":noop,"Debugger.setBlackboxPatterns":noop,"Debugger.resume":noop,"Network.enable":noop,"Page.enable":noop,"Page.getResourceTree":noop,"Profiler.enable":noop,"Emulation.setEmulatedMedia":noop,"Log.enable":noop,"Log.startViolationsReport":noop,"ServiceWorker.enable":noop,"Inspector.enable":noop,"Target.setAutoAttach":noop,"Target.setDiscoverTargets":noop,"Target.setRemoteLocations":noop,"Network.setCacheDisabled":noop,"Audits.enable":noop};InspectorBackend.inspectorBackend.registerCommand("DOM.getComponentData",[{name:"nodeId",type:"number",optional:!1}],[],!1),InspectorBackend.inspectorBackend.registerCommand("DOM.scrollIntoView",[{name:"nodeId",type:"number",optional:!1}],[],!1),InspectorBackend.inspectorBackend.registerCommand("DOM.setHideElement",[{name:"nodeId",type:"number",optional:!1},{name:"hide",type:"boolean",optional:!1}],[],!1);class Connection{constructor(){this._onMessage=noop,this._resolves={}}resolveAllMessages(){const e=clone(this._resolves);each(e,e=>e()),this._resolves={}}setOnMessage(e){this._onMessage=function(o){wxMain.isFeatureEnabled("logWxmlConnection")&&console.log("%c↓%c wxml "+o,"color:#E65100;",""),e(o)}}setOnDisconnect(e){this._onDisconnect=e}async sendRawMessage(e){wxMain.isFeatureEnabled("logWxmlConnection")&&console.log("%c↑%c wxml "+e,"color:#080;",""),e=JSON.parse(e);const{method:o,params:t,id:n}=e,s={id:n};return new Promise(e=>{let n=!1;const r=uniqId(),a=()=>{n||(n=!0,this._onMessage(JSON.stringify(s)),e(),delete this._resolves[r])};this._resolves[r]=a,this._callMethod(o,t).then(e=>{s.result=e||{},a()},e=>{s.error={message:e.message},e.code?s.error.code=e.code:console.error(e),a()})})}trigger(e,o={}){this._onMessage(JSON.stringify({method:e,params:o}))}disconnect(){}async _callMethod(e,o){if(methods[e])return methods[e](o);throw Error(e+" unimplemented")}}self.Wxml=self.Wxml||{},Wxml=Wxml||{},Wxml.targetManager=new SDK.SDKModel.TargetManager,Wxml.connection=new Connection;const oldFactory=InspectorBackend.Connection.getFactory();InspectorBackend.Connection.setFactory(()=>Wxml.connection),Wxml.target=Wxml.targetManager.createTarget("wxml","Wxml",SDK.SDKModel.Type.Frame,null,"",!1),InspectorBackend.Connection.setFactory(oldFactory);