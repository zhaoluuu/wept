import*as UI from"../ui/ui.js";import*as Common from"../common/common.js";import*as SDK from"../sdk/sdk.js";import*as JSONEditor from"../features/JSONEditor.js";export class ComponentDataWidget extends UI.ThrottledWidget.ThrottledWidget{constructor(){super(!0),this._emptyElement=this.contentElement.createChild("div","gray-info-message"),this._emptyElement.textContent=Common.UIString.UIString("No component data"),UI.Context.Context.instance().addFlavorChangeListener(SDK.DOMModel.DOMNode,this._update,this),this._update(),Wxml.wxmlMessenger.on("COMPONENT_DATA",e=>{const{componentData:t,exparseNodeId:n}=e;this._exparseNodeId=n,this._render(t)}),Wxml.remoteMessenger.on("message",({method:e,params:t})=>{switch(e){case"WxComponent.componentDataChanged":const{componentData:e,exparseNodeId:n}=t;this._exparseNodeId=n,this._render(e)}})}async _update(){const e=UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode);e?await Wxml.target.domAgent().getComponentData(e.id):this._render(null)}async _render(e){let t=this._jsonEditor;if(t||(t=JSONEditor.jsonEditorFactory.createEditor({onChange:()=>{const e=t.getJSONEditor().get();Wxml.wxmlMessenger.send("WXML_MODIFY_COMPONENT_DATA",{componentData:e,id:this._exparseNodeId,webviewId:Wxml.remoteMessenger.getDebuggee().targetId})}}),t.contentElement.addEventListener("focus",()=>{this._isEditing=!0},!0),t.contentElement.addEventListener("blur",()=>{this._isEditing=!1},!0),this._jsonEditor=t),!e)return t.detach(),t.getJSONEditor().set({}),void this._emptyElement.classList.remove("hidden");this._emptyElement.classList.add("hidden"),this._isEditing||t.getJSONEditor().update(e),t.show(this.contentElement)}}