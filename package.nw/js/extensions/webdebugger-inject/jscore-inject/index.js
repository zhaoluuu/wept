(()=>{"use strict";var e={5673:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(8422),o=navigator.userAgent.match(/webview\/([\w]*)/),a=o?o[1]:"",r=`${Date.now()}${Math.floor(1e4*Math.random())}`;let i;const c=()=>{if(i)return i;return i=new n(`WEBDEBUGGER_${r}`),i.send({command:"WEBDEBUGGER_MESSAGER_READY",webviewID:a,runtimeID:r}),i};t.default={send(e){e.webviewID=a,e.runtimeID=r;c().send(e)},registerCallback(e){c().registerCallback(e)}}},8422:e=>{const t=window.navigator||window.__global.navigator,s=window.WebSocket||window.__global.WebSocket,n=window.prompt||window.__global.prompt,o=t.userAgent.match(/port\/(\d*)/),a=o?parseInt(o[1]):9974,r=`ws://127.0.0.1:${a}`;window.__maxConnectTryTime=10;e.exports=class{constructor(e,t=!0){this._protocol=e,this._needToken=t,this._ws=null,this._msgQueue=[],this._callback=new Set,this._parseJson=null,this.tryTime=0,"complete"===document.readyState?setTimeout((()=>{this.connect()})):window.addEventListener("load",(()=>{this.connect()}))}connect(){if(!a)return;if(this.tryTime++,this.tryTime>=window.__maxConnectTryTime)return void console.error("当前应用通道断开且重连次数已满，请重新编译应用");let e=this._protocol;if(this._needToken){e=`${e}#${n("GET_MESSAGE_TOKEN")}#`}this._ws=new s(r,e),this._ws.onopen=()=>{const e=[].concat(this._msgQueue);this._msgQueue=[],e.forEach((e=>{this.send(e)}))},this._ws.onclose=()=>{this._ws=null,setTimeout((()=>{this.connect()}),150)},this._ws.onmessage=e=>{try{const t=this._parseJson?this._parseJson(e.data):JSON.parse(e.data);this._callback.forEach((e=>{try{e.call(this,t)}catch(e){console.error("onmessage",e)}}))}catch(e){console.error("onmessage",e)}}}send(e){this._ws&&this._ws.readyState===s.OPEN?this._ws.send(JSON.stringify(e)):this._msgQueue.push(e)}registerCallback(e){"function"==typeof e&&this._callback.add(e)}removeCallback(e){this._callback.delete(e)}}},8253:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=s(8422),o=navigator.userAgent.match(/webview\/([\w]*)/),a=o?o[1]:"",r=`${Date.now()}${Math.floor(1e4*Math.random())}`;let i;const c=()=>{if(i)return i;return i=new n(`JSCOREWEBVIEW_${r}`),i};t.default={send(e){e.webviewID=a,e.runtimeID=r;c().send(e)},registerCallback(e){c().registerCallback(e)}}}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}(()=>{const e=s(5673),t=s(8253);!function(s){let n="";const o=()=>(n||(n=s.location.hash.match(/#id_([a-zA-Z]+)/)[1]),n);s.getComptName=o;s.__webcompt={invoke:e=>{const s=o(),n=JSON.parse(e);t.default.send({command:"JSCORE_INVOKE",data:Object.assign({id:s},n)})},sendMessage:t=>{e.default.send({command:"JSCORE_TO_WEBDEBUGGER",data:t})},idkey(){},idkeyList(){},kv(){},cgi:(e,s)=>{console.log("cgi",e,s);const n=o(),a=JSON.parse(s);t.default.send({command:"CGI_INVOKE",data:Object.assign(Object.assign({id:n},a),{__callback_id:e})})},log(){},errReport(){},performance(){},refreshA8Key(){}}}(self)})()})();
//# sourceURL=ide:///extensions/webdebugger-inject/jscore-inject/index.js