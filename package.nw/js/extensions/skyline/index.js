(()=>{"use strict";var e={8422:e=>{const t=window.navigator||window.__global.navigator,r=window.WebSocket||window.__global.WebSocket,s=window.prompt||window.__global.prompt,n=t.userAgent.match(/port\/(\d*)/),a=n?parseInt(n[1]):9974,i=`ws://127.0.0.1:${a}`;window.__maxConnectTryTime=10;e.exports=class{constructor(e,t=!0){this._protocol=e,this._needToken=t,this._ws=null,this._msgQueue=[],this._callback=new Set,this._parseJson=null,this.tryTime=0,"complete"===document.readyState?setTimeout((()=>{this.connect()})):window.addEventListener("load",(()=>{this.connect()}))}connect(){if(!a)return;if(this.tryTime++,this.tryTime>=window.__maxConnectTryTime)return void console.error("当前应用通道断开且重连次数已满，请重新编译应用");let e=this._protocol;if(this._needToken){e=`${e}#${s("GET_MESSAGE_TOKEN")}#`}this._ws=new r(i,e),this._ws.onopen=()=>{const e=[].concat(this._msgQueue);this._msgQueue=[],e.forEach((e=>{this.send(e)}))},this._ws.onclose=()=>{this._ws=null,setTimeout((()=>{this.connect()}),150)},this._ws.onmessage=e=>{try{const t=this._parseJson?this._parseJson(e.data):JSON.parse(e.data);this._callback.forEach((e=>{try{e.call(this,t)}catch(e){console.error("onmessage",e)}}))}catch(e){console.error("onmessage",e)}}}send(e){this._ws&&this._ws.readyState===r.OPEN?this._ws.send(JSON.stringify(e)):this._msgQueue.push(e)}registerCallback(e){"function"==typeof e&&this._callback.add(e)}removeCallback(e){this._callback.delete(e)}}},1772:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DOMToGLFWKeyCode=void 0,t.DOMToGLFWKeyCode=function(e){switch(e){case 32:return 32;case 222:return 39;case 188:return 44;case 173:case 189:return 45;case 190:return 46;case 191:return 47;case 48:return 48;case 49:return 49;case 50:return 50;case 51:return 51;case 52:return 52;case 53:return 53;case 54:return 54;case 55:return 55;case 56:return 56;case 57:return 57;case 59:return 59;case 61:case 187:return 61;case 65:return 65;case 66:return 66;case 67:return 67;case 68:return 68;case 69:return 69;case 70:return 70;case 71:return 71;case 72:return 72;case 73:return 73;case 74:return 74;case 75:return 75;case 76:return 76;case 77:return 77;case 78:return 78;case 79:return 79;case 80:return 80;case 81:return 81;case 82:return 82;case 83:return 83;case 84:return 84;case 85:return 85;case 86:return 86;case 87:return 87;case 88:return 88;case 89:return 89;case 90:return 90;case 219:return 91;case 220:return 92;case 221:return 93;case 192:return 96;case 27:return 256;case 13:return 257;case 9:return 258;case 8:return 259;case 45:return 260;case 46:return 261;case 39:return 262;case 37:return 263;case 40:return 264;case 38:return 265;case 33:return 266;case 34:return 267;case 36:return 268;case 35:return 269;case 20:return 280;case 145:return 281;case 144:return 282;case 44:return 283;case 19:return 284;case 112:return 290;case 113:return 291;case 114:return 292;case 115:return 293;case 116:return 294;case 117:return 295;case 118:return 296;case 119:return 297;case 120:return 298;case 121:return 299;case 122:return 300;case 123:return 301;case 124:return 302;case 125:return 303;case 126:return 304;case 127:return 305;case 128:return 306;case 129:return 307;case 130:return 308;case 131:return 309;case 132:return 310;case 133:return 311;case 134:return 312;case 135:return 313;case 136:return 314;case 96:return 320;case 97:return 321;case 98:return 322;case 99:return 323;case 100:return 324;case 101:return 325;case 102:return 326;case 103:return 327;case 104:return 328;case 105:return 329;case 110:return 330;case 111:return 331;case 106:return 332;case 109:return 333;case 107:return 334;case 16:return 340;case 17:return 341;case 18:return 342;case 91:return 343;case 93:return 348;default:return-1}}},3267:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=void 0,t.debounce=function(e,t){let r=null;return function(){const s=this,n=arguments;clearTimeout(r),r=setTimeout((()=>{e.apply(s,n)}),t)}}},3190:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const r="win32"===window.__global.platform;t.default=class{constructor(e,t,r,s,n,a,i,c,o){this.render=null,this.width=null,this.height=null,this.active=!1,this.focus=!0,this.justRunCallback=!1,this.callback=()=>{},this.currentFrameId=0;const u=window.__vueglobaldocument||document;this.canvas=u.createElement("canvas"),this.canvas,this.id=e,this.canvas.id=e,this.canvas.__id=e,this.canvas.__style=this.canvas.style,this.canvas.width=r,this.canvas.height=s,this.canvas.__style.width=`${n}px`,this.canvas.__style.height=`${a}px`,this.width=r,this.height=s,this.sharedBufferView=t,this.active=!1,this.getBufferFrameId=i,this.callback=o||(()=>{}),this.justRunCallback=!0===c,this.init()}reset(e,t,r,s,n,a){this.sharedBufferView=n,this.width=e,this.height=t,"gameWebglCanvas"!==this.id&&(this.canvas.width=Math.ceil(this.width),this.canvas.height=Math.ceil(this.height)),this.canvas.__style.width=`${Math.ceil(r)}px`,this.canvas.__style.height=`${Math.ceil(s)}px`,a&&"function"==typeof a&&(this.callback=a)}_resizeCanvasWidthHeight(e,t){this.canvas.__style.width=`${Math.ceil(e)}px`,this.canvas.__style.height=`${Math.ceil(t)}px`}setIsFocus(e){this.focus=e}init(){const e=`#version 100\n    precision mediump float;\n    varying vec2 v_texcoord;\n    uniform sampler2D u_texture;\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_texcoord)${r?".bgra":""};\n    }\n    `,t=this.canvas.getContext("webgl"),s=t.createTexture(),n=t.createProgram(),a=t.createBuffer(),i=t.createBuffer(),c=t.createShader(t.VERTEX_SHADER);t.shaderSource(c,"#version 100\n    attribute vec2 a_position;\n    attribute vec2 a_texcoord;\n    varying vec2 v_texcoord;\n    void main() {\n      gl_Position = vec4(a_position, 1.0, 1.0);\n      v_texcoord = a_texcoord;\n    }\n    "),t.compileShader(c);const o=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(o,e),t.compileShader(o),t.attachShader(n,c),t.attachShader(n,o),t.linkProgram(n),t.useProgram(n);t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,1,1,1,0,0,1,0]),t.STATIC_DRAW),this.sharedBufferView&&(this.render=()=>{const e=this.getBufferFrameId();if(e===this.currentFrameId)return void requestAnimationFrame(this.render);if(!this.active||!this.focus)return void requestAnimationFrame(this.render);if(this.justRunCallback)return void requestAnimationFrame(this.render);this.callback&&this.callback();const r=this.sharedBufferView(),c=r.length/(this.width*this.height*4);let o=this.width,u=this.height;c>1&&(o=this.width*c/2,u=this.height*c/2),t.viewport(0,0,this.width,this.height),t.scissor(0,0,this.width,this.height),t.useProgram(n),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,o,u,0,t.RGBA,t.UNSIGNED_BYTE,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const h=t.getAttribLocation(n,"a_position");t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribPointer(h,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(h);const d=t.getAttribLocation(n,"a_texcoord");t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribPointer(d,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(d);const l=t.getUniformLocation(n,"u_texture");t.uniform1i(l,0),t.drawArrays(t.TRIANGLES,0,6),this.render&&requestAnimationFrame(this.render),this.currentFrameId=e},this.render())}}},1837:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.webviewID=void 0;const r=navigator.userAgent,s=r.indexOf(" devtoolsedit")>0,n=r.indexOf(" appservicedevtools")>0;if(t.webviewID="",s)t.webviewID="devtoolsedit";else if(n)t.webviewID="appservicedevtools";else{const e=r.match(/webview\/(\d*)/);if(e){const r=parseInt(e[1],10);isNaN(r)||(t.webviewID=r)}}},9741:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setJSONParser=t.setPageframeReady=t.removeCallback=t.registerCallback=t.send=t.getMessager=void 0;const s=r(1837),n=r(8422);let a,i=!1,c=[],o=!1;const u=new Set;t.getMessager=()=>{if(a)return a;const e=`WEBVIEW_${s.webviewID}`;return a=new n(e),a};const h=e=>{u.forEach((t=>{try{t(e)}catch(e){}}))},d=e=>{if(i)h(e);else{const{command:t}=e;switch(t){case"WEBVIEW_ON_EVENT":case"APPSERVICE_PUBLISH":case"APPSERVICE_PUBLISH_SYNC":c.push(e);break;default:h(e)}}};function l(e){e.fromWebviewID=s.webviewID;t.getMessager().send(e)}function _(e){if(u.add(e),!o){t.getMessager().registerCallback(d),o=!0}}function w(e){if(u.delete(e),!o){t.getMessager().registerCallback(d),o=!0}}function v(e,r){if(i===e)return;i=e;t.getMessager()._parseJson=r,e&&(c.forEach((e=>h(e))),c=[])}t.send=l,t.registerCallback=_,t.removeCallback=w,t.setPageframeReady=v,t.setJSONParser=function(e){t.getMessager()._parseJson=e},t.default={send:l,registerCallback:_,removeCallback:w,setPageframeReady:v}}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,r),a.exports}(()=>{const e=r(9741),t=r(1772),s=r(3267),n=r(3190);document.title="skyline_renderer";class a{constructor(e){this.options=e,this.webglRenderer=null,document.body.style.width=`${e.width}px`,document.body.style.height=`${e.height}px`,e.width&&(e.height||e.sharedMemoryKey)?(this.installEventListener(),this.render()):console.error("[skyline-devtools] create skyline renderer failed, options:",e)}static startRender(e){if(console.log("[skyline-devtools] startRender",e),a.instance)throw new Error("[skyline-devtools] SkylineRenderer.instance exists");a.instance=new a(e)}render(){const{width:e,height:t,dpr:r,sharedMemoryKey:s}=this.options;if(e&&t&&s){const a=this.getSharedMemory(s);if(this.webglRenderer)console.error("[skyline-devtools] call render twice");else{const s=()=>new Uint32Array(a.buffer,0,1)[0],i=()=>{const e=new Uint32Array(a.buffer,4,1)[0];return new Uint8Array(a.buffer,8,e)};this.webglRenderer=new n.default("skyline_renderer",i,e*r,t*r,e,t,s,!1),this.webglRenderer.active=!0,document.body.append(this.webglRenderer.canvas)}}}getSharedMemory(e){const t=window.__global.safeSkylineRequire("sharedMemory/sharedMemory.node"),r=t.getMemory(e);if(!r)throw new Error(`sharedMemory get failed, sharedMemoryKey: ${e}`);const s=new Uint8Array(r);return t.removeMemory(e),s}dispatchEvent(t,r){e.default.send({command:"SKYLINE_DISPATCH_EVENT",data:{windowId:this.options.windowId,eventName:t,args:r}})}installEventListener(){let e={x:0,y:0};const r=(e,r)=>{const s=t.DOMToGLFWKeyCode(r.keyCode);let n;!function(e){e[e.GLFW_RELEASE=0]="GLFW_RELEASE",e[e.GLFW_PRESS=1]="GLFW_PRESS",e[e.GLFW_REPEAT=2]="GLFW_REPEAT"}(n||(n={}));const a=r.which,i=r.repeat?n.GLFW_REPEAT:"keydown"===e?n.GLFW_PRESS:n.GLFW_RELEASE;let c=0;r.shiftKey&&(c|=1),r.ctrlKey&&(c|=2),r.altKey&&(c|=4),this.dispatchEvent("keyboard",[s,a,i,c])},n={touchstart:t=>{e={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dispatchEvent("touchStart",[t.touches[0].clientX,t.touches[0].clientY])},touchmove:t=>{e={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dispatchEvent("touchMove",[t.touches[0].clientX,t.touches[0].clientY])},touchend:t=>{this.dispatchEvent("touchEnd",t.touches[0]?[t.touches[0].clientX,t.touches[0].clientY]:[e.x,e.y])},touchcancel:()=>{this.dispatchEvent("touchCancel",[])},mousemove:s.debounce((e=>{this.dispatchEvent("mousemove",[e.clientX,e.clientY])}),50),click:e=>{this.dispatchEvent("click",[e.clientX,e.clientY])},wheel:e=>{this.dispatchEvent("wheel",[e.clientX,e.clientY,e.deltaX,e.deltaY])},keydown:e=>{r("keydown",e)},keyup:e=>{r("keyup",e)},keypress:e=>{var t=e.charCode;0===t||t>=0&&t<=31||this.dispatchEvent("char",[t])}};Object.keys(n).forEach((e=>{window.document.addEventListener(e,n[e],{capture:!0})}))}}window.SkylineRenderer=a})()})();
//# sourceURL=ide:///extensions/skyline/index.js