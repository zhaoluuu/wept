(()=>{"use strict";var e={6366:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.INativeWorkerOnMessageType=r.INativeWorkerPushMessageType=void 0,function(e){e[e.Run=0]="Run",e[e.InitWorker=1]="InitWorker",e[e.TriggerOnMessage=2]="TriggerOnMessage",e[e.InvokeJS=3]="InvokeJS",e[e.TriggerOnEvent=4]="TriggerOnEvent"}(r.INativeWorkerPushMessageType||(r.INativeWorkerPushMessageType={})),function(e){e.WeixinWorkerInvoke="WeixinWorkerInvoke"}(r.INativeWorkerOnMessageType||(r.INativeWorkerOnMessageType={}))},6488:(e,r)=>{function t(e){return new Int32Array(e).reduce(((e,r)=>e+String.fromCharCode(r)),"")}function o(e){let r="";const t=new Uint8Array(e),o=t.byteLength;for(let e=0;e<o;e++)r+=String.fromCharCode(t[e]);return __global.btoa(r)}Object.defineProperty(r,"__esModule",{value:!0}),r.coverRes=r.isSyncSDK=r.arrayBufferToBase64=r.int32Array2Str=r.str2Int32Array=r.str2ab=r.ab2str=void 0,r.ab2str=t,r.str2ab=function(e){const r=new ArrayBuffer(4*e.length),t=new Int32Array(r);for(let r=0,o=e.length;r<o;r++)t[r]=e.charCodeAt(r);return r},r.str2Int32Array=function(e){const r=new ArrayBuffer(4*e.length),t=new Int32Array(r);for(let r=0,o=e.length;r<o;r++)t[r]=e.charCodeAt(r);return t},r.int32Array2Str=function(e,r,o=1){const n=e.load(r,1),a=new ArrayBuffer(4*n),s=new Int32Array(a);for(let t=o;t<n+o;t++){const n=e.load(r,t);s[t-o]=n}return t(a)},r.arrayBufferToBase64=o;const n={getSystemInfo:!0,getBackgroundAudioState:!0,setBackgroundAudioState:!0,operateBackgroundAudio:!0,createRequestTask:!0,createUploadTask:!0,createDownloadTask:!0,createSocketTask:!0,operateSocketTask:!0,createAudioInstance:!0,unlink:!0};r.isSyncSDK=function(e){return!!n[e]||/Sync$/.test(e)},r.coverRes=function(e){for(const t in e)if(r=e[t],"[object ArrayBuffer]"===Object.prototype.toString.call(r)){const r=o(e[t]);e.__nativeBuffers__=[{key:t,base64:r}],delete e[t]}var r;return e}}},r={};function t(o){var n=r[o];if(void 0!==n)return n.exports;var a=r[o]={exports:{}};return e[o](a,a.exports,t),a.exports}(()=>{const e=t(6366),r=t(6488);((t,o)=>{const n={};let a=1;const s=new __global.SharedArrayBuffer(1048576),i=new Int32Array(s),c=__global.Atomics,g=new Map,u="function"==typeof encodeURIComponent?encodeURIComponent:o.encodeURIComponent,k=t=>{var o,a;if(t.data&&t.data.type===e.INativeWorkerOnMessageType.WeixinWorkerInvoke)switch(t.data.method){case"postMsgToAppService":(null===(o=t.data.arguments)||void 0===o?void 0:o.length)&&WeixinWorker.workerMsgHandler&&WeixinWorker.workerMsgHandler.apply(WeixinWorker,t.data.arguments);break;case"postMsgToWorker":(null===(a=t.data.arguments)||void 0===a?void 0:a.length)&&__global.WeixinWorker.postMsgToWorker.apply(__global.WeixinWorker,t.data.arguments);break;case"invokeJS":if(t.data.api){const{api:o,args:a={},callbackId:s,__workerId__:g}=t.data;__global.WeixinJSBridge.invoke(o,a,(t=>{if(r.isSyncSDK(o)){const e=r.str2Int32Array(JSON.stringify(r.coverRes(t)));c.store(i,1,e.length);for(let r=0;r<e.length;r++)c.store(i,2+r,e[r]);c.store(i,0,1),c.notify(i,0,1)}else{const a=n[g];if(a){const n=r.coverRes(t);a.postMessage({type:e.INativeWorkerPushMessageType.InvokeJS,data:n,api:o,callbackId:s})}}}))}}},l=e=>{const r="__WORKER__/worker.js"+(e?`?libName=${u(e)}`:""),t=new __global.Worker(r),o=a++;return n[o]=t,t.onmessage=k,[o,t]};__global.WeixinJSBridge.on("triggerWorkerEvent",((t,o)=>{Object.values(n).forEach((n=>{(g.get(n)||[]).includes(t)&&n.postMessage({type:e.INativeWorkerPushMessageType.TriggerOnEvent,eventName:t,data:r.coverRes(o)})}))})),t.terminate=e=>{const r=n[e];r&&(r.terminate(),delete n[e])},t.postMsgToWorker=(r,t)=>{const o=n[r];if(o)try{"string"==typeof t&&(t=JSON.parse(t)),o.postMessage({type:e.INativeWorkerPushMessageType.TriggerOnMessage,msg:t})}catch(e){console.error("post msg to worker err: [workerId] ",r," [msg] ",t)}},t.create=(r,t={})=>{const[o,n]=l();return g.set(n,t.APIList||[]),n.postMessage({type:e.INativeWorkerPushMessageType.InitWorker,__workerId__:o,options:t,sab:s}),o},t.createWXLibWorker=function(r,t){let o={};try{o=JSON.parse(t)}catch(e){}const[n,a]=l(r);return g.set(a,o.APIList||[]),a.postMessage({type:e.INativeWorkerPushMessageType.InitWorker,__workerId__:n,options:o,sab:s,wxLibWorker:!0}),n}})(WeixinWorker,function(){return this}())})()})();
//# sourceURL=ide:///extensions/worker/asdebug/index.js