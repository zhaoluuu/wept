!function(require, directRequire){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.transWXSSToJS=exports.getWxssFilesAndContent=void 0;const tslib_1=require("tslib"),path_1=tslib_1.__importDefault(require("path")),packOptionsHelper_1=tslib_1.__importDefault(require("../../../utils/packOptionsHelper")),locales_1=tslib_1.__importDefault(require("../../../utils/locales/locales")),appconfig_1=tslib_1.__importDefault(require("../utils/appconfig/appconfig")),tools_1=require("../../../utils/tools"),apperrcode_config_1=require("../config/apperrcode.config"),checkcustomcomponent_1=require("../utils/appconfig/checkcustomcomponent"),compilewxss_1=require("./wxss/compilewxss");function formatError(o){const e=new Error(locales_1.default.config.COMPILE_WXSS_ERROR_CONSOLE);return e.code=apperrcode_config_1.appErrCode.TRANS_WXSS_JS_ERR,e.msgForConsole=o.message,e}async function wxssToJS(o,e,t){try{return await _wxssToJS(o,e,t)}catch(o){if("CustomError"===(null==o?void 0:o.type))throw o;throw formatError(o)}}async function getWxssFilesAndContent(o,e,t){const{config:s}=t,n=await e.getPackageWxssFiles((null==s?void 0:s.root)||"__APP__"),i=packOptionsHelper_1.default.filter(n.wxssFiles),{content:a}=n;return{wxssFiles:i,content:a}}async function _wxssToJS(o,e,t){const{appConfig:s,config:n,lazyload:i}=t,a=await e.getPackageWxssFiles((null==n?void 0:n.root)||"__APP__"),r=packOptionsHelper_1.default.filter(a.wxssFiles),c={};r.forEach(o=>{c[o]=!0});const l=(null==n?void 0:n.pages.map(o=>path_1.default.posix.join(n.root,o)))||s.pages,p=[];let u=0;l.forEach(o=>{c[o+".wxss"]&&(u++,p.push(`./${o}.wxss`),delete c[o+".wxss"])});(await(0,checkcustomcomponent_1.getWxssCompileConfig)(o,e,s,n)).forEach(o=>{c[o+".wxss"]&&(u++,p.push(`./${o}.wxss`),delete c[o+".wxss"])});for(const o in c)p.push("./"+o);let _;return a&&(_=a.content),await(0,compilewxss_1.compileWxss)({pageCount:u,files:p,cwd:o.srcPath,subPackage:null==n?void 0:n.root,lazyload:i,replaceContent:_})}async function transWXSSToJS(o,e,t={}){packOptionsHelper_1.default.updateState(o);const{app:s,page:n}=t,i=await appconfig_1.default.getAppConfig(o,e);if(s){const t=await wxssToJS(o,e,{appConfig:i})||{};return{comm:(null==t?void 0:t.comm)||""}}const a=`./${n}.wxss`,r=(0,tools_1.checkIsInSubPackage)(i,n);if(!r){const t=await wxssToJS(o,e,{appConfig:i});return{comm:null==t?void 0:t.comm,page:(null==t?void 0:t[a])||""}}const c=await wxssToJS(o,e,{appConfig:i,config:r});return{comm:(null==c?void 0:c.comm)||"",page:(null==c?void 0:c[a])||""}}exports.getWxssFilesAndContent=getWxssFilesAndContent,exports.transWXSSToJS=transWXSSToJS;
}(require("licia/lazyImport")(require), require)