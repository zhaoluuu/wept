!function(require, directRequire){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.compileMiniProgramJS=exports.getCompiledJS=void 0;const tools_1=require("../../../utils/tools"),babel_helper_1=require("../../../utils/babel_helper"),transformsourcemap_1=require("../utils/transformsourcemap"),path=require("path"),_=require("lodash"),getBabelRoot=e=>(0,babel_helper_1.getBabelOutputPath)(e),transformMap=(e,t)=>{let i,o="",s="";if(t)try{i="string"==typeof t?JSON.parse(t):t,i=Object.assign(Object.assign({},i),{mappings:";"+i.mappings}),o=JSON.stringify(i),s=JSON.stringify(Object.assign(Object.assign({},i),{sources:(0,transformsourcemap_1.transformSourceMapSources)(i.sources)})),e="\n"+e}catch(e){o="",s="",i=void 0}return{code:e,map:i,mapString:o,basenameMapString:s}};async function defaultCompileJS(e,t,i,o){var s,r,a;const{relativePath:n,fileName:l,resultType:p}=i,c=await t.compileJS({root:n,filePath:l,babelRoot:o,sourceCode:i.sourceCode,setting:{es7:(null===(s=e.setting)||void 0===s?void 0:s.enhance)||!1,es6:(null===(r=e.setting)||void 0===r?void 0:r.es6)||!1,minify:"dev"!==p&&((null===(a=e.setting)||void 0===a?void 0:a.minified)||!1),disableUseStrict:!!e.setting.disableUseStrict}}),{code:m}=c;return Object.assign(Object.assign(Object.assign({},c),transformMap(m,c.map)),{customTranslated:!c.isBabelIgnore&&!c.isLargeFile})}const compileJS=async(e,t,i)=>{const o=getBabelRoot(e);return await defaultCompileJS(e,t,i,o)},getCompiledJS=async(e,t,i)=>{const{relativePath:o,fileName:s,onAfterRun:r}=i,a=(0,tools_1.normalizePath)(path.posix.join(e.projectPath,o,s)),n=await compileJS(e,t,Object.assign({},i));return n.filePath=a,"function"==typeof r&&r(),_.cloneDeep(Object.assign(Object.assign({},n),{helpers:n.helpers.reduce((e,t)=>(e[t]=!0,e),{})}))};exports.getCompiledJS=getCompiledJS;const compileMiniProgramJS=async(e,t,i)=>await(0,exports.getCompiledJS)(e,t,{fileName:i,relativePath:e.miniprogramRoot||"",resultType:"dev",type:"miniProgram"});exports.compileMiniProgramJS=compileMiniProgramJS;
}(require("licia/lazyImport")(require), require)