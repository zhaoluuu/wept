!function(require, directRequire){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSubpackageAppServiceBuildCore=void 0;const tslib_1=require("tslib"),transwxmltojs_1=require("../trans/transwxmltojs"),handleError_1=require("../utils/handleerror/handleError"),getjsfile_1=tslib_1.__importDefault(require("./getjsfile")),getappservice_1=require("./getappservice"),getSubPkgSortedJSFiles=require("./getsubpkgsortedjsfiles");async function getSubpackageAppServiceBuild(e,t,r){try{return{success:!0,content:await getSubpackageAppServiceBuildCore(e,t,r)}}catch(r){return{success:!1,content:await(0,handleError_1.handleError)(e,t,r)}}}async function getSubpackageAppServiceBuildCore(e,t,r){const i=[],a=r.root,s=await getWXMLJS(e,t,a,i),{allFiles:n,componentFiles:o,pageFiles:c}=await getSubPkgSortedJSFiles(e,t,a);await getJSCodeBuild(e,t,i,n),await(0,getappservice_1.getAppCode)(e,t,i,s,o,c);return i.join("\n")}async function getJSCodeBuild(e,t,r,i){const a=[(await Promise.all(i.map(r=>{const i=(0,getjsfile_1.default)(e,t,r+".js",{});return new Promise(e=>{i.then(t=>{e(Object.assign(Object.assign({},t),{scriptLink:r}))})})}))).map(e=>e.code).join("\n")];r.push(a.join("\n"))}async function getWXMLJS(e,t,r,i){const a=await(0,transwxmltojs_1.transWXMLToJS)(e,t,{page:r,app:!1});return i.push(a.code),a}exports.default=getSubpackageAppServiceBuild,exports.getSubpackageAppServiceBuildCore=getSubpackageAppServiceBuildCore;
}(require("licia/lazyImport")(require), require)