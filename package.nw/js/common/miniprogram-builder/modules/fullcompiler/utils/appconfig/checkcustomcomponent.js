!function(require, directRequire){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCustomComponentsConfig=exports.getFileListJustInPack=exports.getWxssCompileConfig=exports.getWxmlCompileConfig=void 0;const tslib_1=require("tslib"),tools_1=require("../../../../utils/tools"),packOptionsHelper_1=tslib_1.__importDefault(require("../../../../utils/packOptionsHelper")),pagejson_1=tslib_1.__importDefault(require("./pagejson")),path=require("path"),friendlyPathMake=(t,o)=>path.posix.normalize(path.join(t,o).replace(/^\/+/,"")).replace(/\\/g,"/"),trailing=(t,o)=>t.endsWith(o)?t:t+o;async function getWxmlCompileConfig(t,o,e,n){let s=[],i=0;const a=await getCustomComponentsConfig(t,o,e);for(const t in a){const o=a[t];if(!o)continue;if(!n&&o.config||n&&!o.config||n&&o.config&&n.root!==o.config.root)continue;const{pageJSON:e}=o;if(e&&(e.usingComponents||e.componentGenerics)){s.push(`./${t}.wxml`);const o=Object.assign(Object.assign({},e.usingComponents),e.componentGenerics);i++,s.push(Object.keys(o).length),s=s.concat(Object.keys(o))}}return s.unshift(i),s}async function getWxssCompileConfig(t,o,e,n){return await getFileListJustInPack(t,o,e,n)}async function getFileListJustInPack(t,o,e,n){const s=await getCustomComponentsConfig(t,o,e),i=[];for(const t in s){const o=s[t];n?o.config&&o.config.root===n.root&&i.push(t):o.config||i.push(t)}return[...i]}async function getCustomComponentsConfig(t,o,e){const n=await getAllJSON(t,o);if(e.pages){const t=new Set(n);for(const o of e.pages)t.has(o+".json")||n.push(o+".json")}const s=e.subPackages||e.subpackages;if(Array.isArray(s))for(const t of s)if(t&&"string"==typeof t.root&&Array.isArray(t.pages))for(const o of t.pages){const e=new Set(n),s=(i=t.root,a=String(o),path.posix.normalize(path.join(i,a).replace(/^\/+/,"")).replace(/\\/g,"/"));e.has(s+".json")||n.push(s+".json")}var i,a;const r={};for(const s of n){const n=s.replace(/\.json$/,"");if("app"===(0,tools_1.normalizePath)(n))continue;const i=await(0,pagejson_1.default)(t,o,n);if(i.usingComponents||i.componentGenerics||!0===i.component){const t=findSubpackageForFile(n,e);r[n]={config:t,file:s,pageJSON:i}}}return r}async function getAllJSON(t,o){let e=[];return e=await o.getAllPageAndComponent(),packOptionsHelper_1.default.updateState(t),e=packOptionsHelper_1.default.filter(e.map(t=>t+".json")),e}exports.getWxmlCompileConfig=getWxmlCompileConfig,exports.getWxssCompileConfig=getWxssCompileConfig,exports.getFileListJustInPack=getFileListJustInPack,exports.getCustomComponentsConfig=getCustomComponentsConfig;const findSubpackageForFile=(t,o)=>{let e;const n=o.subPackages||o.subpackages;if(Array.isArray(n))for(const o of n)if(o&&"string"==typeof o.root&&t.startsWith((s=o.root,i="/",s.endsWith(i)?s:s+i))){e=o;break}var s,i;return e};
}(require("licia/lazyImport")(require), require)