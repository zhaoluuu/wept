!function(require, directRequire){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getExtJSON=void 0;const tslib_1=require("tslib"),path_1=tslib_1.__importDefault(require("path")),lodash_1=require("lodash"),cache_1=require("../../../../../utils/cache"),common_1=require("../common"),common_2=require("../../../../../utils/common"),tools_1=require("../../../../../utils/tools"),projectconfig_1=require("../projectconfig"),locales_1=tslib_1.__importDefault(require("../../../../../utils/locales/locales")),schemaValidate_1=require("../../validate/schemaValidate"),theme_1=require("../theme"),reactiveCache_1=require("../reactiveCache"),checkAppFields_1=require("./checkAppFields");function checkExtPages(e){const{project:o,inputJSON:t,filePath:c,miniprogramRoot:a}=e,{extPages:i}=t;if(i)for(const e in i){const t=i[e];if(t){t.navigationBarBackgroundColor&&!(0,tools_1.isHexColor)(t.navigationBarBackgroundColor)&&(0,common_2.throwError)({msg:`["extPages"]["${e}"]["navigationBarBackgroundColor"]: "${t.navigationBarBackgroundColor}" is not hexColor`,filePath:c}),t.backgroundColor&&!(0,tools_1.isHexColor)(t.backgroundColor)&&(0,common_2.throwError)({msg:`["extPages"]["${e}"]["backgroundColor"]: "${t.backgroundColor}" is not hexColor`,filePath:c});try{(0,checkAppFields_1.checkComponentPath)({project:o,miniprogramRoot:a,inputJSON:t,filePath:e+".json"})}catch(o){(0,common_2.throwError)({msg:`["extPages"]["${e}"]${o.message}`,filePath:c})}}}}exports.getExtJSON=(0,reactiveCache_1.wrapCompileJSONFunc)(cache_1.CACHE_KEY.EXT_JSON,e=>{const o=(0,projectconfig_1.getProjectConfigJSON)(e),{miniprogramRoot:t=""}=o,c=e.attrSync(),a=(0,tools_1.normalizePath)(path_1.default.posix.join(t,"ext.json"));if(!e.exists(a))return;if(!c||!c.platform)return e.stat(t,"ext.json")?{__warning__:locales_1.default.config.EXT_JSON_INVALID.format(e.appid,"https://developers.weixin.qq.com/miniprogram/dev/devtools/ext.html")}:void 0;if(!e.stat(t,"ext.json"))return;const i=e.getFile(t,"ext.json"),r=(0,common_1.checkJSONFormat)((0,common_2.checkUTF8)(i,a),a);if(!r.extEnable)return{};const n=(0,theme_1.getThemeLocation)(e);let s={};n&&(s=(0,theme_1.checkThemeJSON)(e,{themeLocation:n}));const l=(0,theme_1.mergeThemeJSONToAppJSON)(s,r),h=(0,schemaValidate_1.schemaValidate)("ext",l.appJSONLight),p=(0,schemaValidate_1.schemaValidate)("ext",l.appJSONDark);h.warning&&(r.__warning__=locales_1.default.config.INVALID.format(h.warning)),p.warning&&(r.__warning__=locales_1.default.config.INVALID.format(p.warning)),(0,schemaValidate_1.transValidateResult)(a,h),(0,schemaValidate_1.transValidateResult)(a,p),r.extAppid||(0,common_2.throwError)({msg:""+locales_1.default.config.EXT_APPID_SHOULD_NOT_BE_EMPTY,filePath:a});const _={filePath:a,project:e,miniprogramRoot:t,inputJSON:r},m=(0,lodash_1.cloneDeep)(_);m.inputJSON=l.appJSONLight,m.mode="light";const g=(0,lodash_1.cloneDeep)(_);return g.inputJSON=l.appJSONDark,g.mode="dark",(0,checkAppFields_1.checkMainPkgPages)(_),(0,checkAppFields_1.checkMainPkgPages)(_),(0,checkAppFields_1.checkSubpackages)(_),(0,checkAppFields_1.checkTabbar)(m),(0,checkAppFields_1.checkTabbar)(g),(0,checkAppFields_1.checkWorkers)(_),(0,checkAppFields_1.checkFunctionalPages)(_),(0,checkAppFields_1.checkOpenLocationPagePath)(_),(0,checkAppFields_1.checkPlugins)(_),(0,checkAppFields_1.checkWindow)(m),(0,checkAppFields_1.checkWindow)(g),(0,checkAppFields_1.checkComponentPath)(_),checkExtPages(_),r});
}(require("licia/lazyImport")(require), require)