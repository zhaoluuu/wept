"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const config_1=require("../../../../config/config"),babel_helper_1=require("../../../../utils/babel_helper"),es6module_1=require("./base/es6module"),_transformRuntimeCustom=()=>require("../../../../utils/babel_transform_plugin"),_pluginTransformRuntime=()=>require("@babel/plugin-transform-runtime"),_pluginTransformWorklet=()=>require("../../../../utils/babel_plugin_worklet"),babel7=()=>require("@babel/core"),_presetEnv=()=>require("@babel/preset-env");function getEnhancePluginsList(e){const r=[[require("../../../../utils/babel_transform_plugin")],[require("@babel/plugin-transform-runtime"),{corejs:!1,helpers:!0,regenerator:!0,version:"7.21.0"}]].concat((0,babel_helper_1.getCustomPlugins)([]));return e.supportWorklet&&r.push([require("../../../../utils/babel_plugin_worklet")]),r}const enhance=(e,r)=>{const t=babel7(),o=e.sourceCode.includes('"worklet"')||e.sourceCode.includes("'worklet'");let n;try{const s={presets:[[require("@babel/preset-env"),{targets:{chrome:53,ios:8},modules:!1,include:["@babel/plugin-transform-computed-properties"]}]],babelrc:!1,plugins:getEnhancePluginsList({supportWorklet:o}),sourceFileName:r,inputSourceMap:!1,configFile:!1,code:!1,ast:!0,cloneInputAst:!1};if(e.astInfo){if(e.astInfo.type!==config_1.AstType.Babel)throw new Error("ast type is not babel");n=t.transformFromAstSync(e.astInfo.ast,e.sourceCode,s)}else{if(null===e.sourceCode)throw new Error("source.targetCode is null");n=babel7().transform(e.sourceCode,s)}}catch(e){const t=`file: ${r}\n ${e.message}`,o=new Error(t);throw o.code=config_1.BABEL_TRANS_JS_ERR,o}return{sourceCode:e.sourceCode,inputMap:e.inputMap,astInfo:{ast:n.ast,type:config_1.AstType.Babel}}};function default_1(e,r){return{name:"summer-enhance",workerMethods:{doTransform(e,r,t,o){const n=enhance(e,r),s=(0,es6module_1.transformES6ModuleAndGenCode)(n,r,t,o);return Object.assign(Object.assign({},n),{target:s})}},async transform(e,t,o,{independentRoot:n,isBabelIgnore:s}){if(t.endsWith(".js")&&!e.largeFile&&!s){const t=(0,es6module_1.getBabelRoot)(n);return await this.runWorkerMethod("doTransform",e,o,t,r.disableUseStrict)}return e}}}exports.default=default_1;