!function(require, directRequire){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRawAppJSON=exports.iOSAppJsonIsUsingIPadResizable=exports.iOSMiniAppJsonIsUsingGDT=exports.iOSMiniAppJsonIsUsingTpush=exports.writeMiniAppJson=exports.isNewMiniAppProject=exports.isMiniAppProject=exports.tryGetIOSMiniappJson=exports.tryGetAndroidMiniappJson=exports.getMiniappJson=exports.getRawMiniappJson=exports.identityServiceConfigToMiniAppJSON=exports.miniAppPlatformMap=void 0;const tools_1=require("./tools"),each=require("licia/each"),safeSet=require("licia/safeSet"),path=require("path"),fse=require("fs-extra"),_=require("lodash");function identityServiceConfigToMiniAppJSON(i,n={}){return n.identityServiceConfig={authorizeMiniprogramType:1,miniprogramLoginPath:i},n}function getRawMiniappJson(i){var n,o,e,t,p,s;i=(0,tools_1.unifyPath)(i);const r=path.posix.join(i,"project.miniapp.json");if(!fse.existsSync(r))return{};let a={};try{a=fse.readJsonSync(r)}catch(i){console.error(i)}return a.miniVersion&&"v1"!==a.miniVersion||((null===(n=a["mini-android"])||void 0===n?void 0:n.projectPath)&&!path.isAbsolute(null===(o=a["mini-android"])||void 0===o?void 0:o.projectPath)&&(a["mini-android"].projectPath=path.posix.join(i,null===(e=a["mini-android"])||void 0===e?void 0:e.projectPath)),(null===(t=a["mini-ios"])||void 0===t?void 0:t.projectPath)&&!path.isAbsolute(null===(p=a["mini-ios"])||void 0===p?void 0:p.projectPath)&&(a["mini-ios"].projectPath=path.posix.join(i,null===(s=a["mini-ios"])||void 0===s?void 0:s.projectPath))),a}function getMiniappJson(i,n="mini-weixin"){const o=Object.values(exports.miniAppPlatformMap),e=getRawMiniappJson(i),t=_.omit(e,o);return _.merge(t,e[n]||("mini-weixin"===n?e["mini-wechat"]:{}))}function tryGetAndroidMiniappJson(i){let n={};try{n=getMiniappJson(i,"mini-android")}catch(i){}return n}function tryGetIOSMiniappJson(i){return getMiniappJson(i,"mini-ios")||{}}function isMiniAppProject(i){const n=path.posix.join(i,"project.miniapp.json");return"multiPlatform"===fse.readJsonSync(n).projectArchitecture}function isNewMiniAppProject(i){const n=getRawMiniappJson(i);return isMiniAppProject(i)&&"v2"===n.miniVersion}function writeMiniAppJson(i,n){const o=path.posix.join(i,"project.miniapp.json");let e={};try{e=fse.readJsonSync(o)}catch(i){return}each(n,(i,n)=>{safeSet(e,n,i)}),fse.writeJSONSync(o,e,{spaces:2})}function iOSMiniAppJsonIsUsingTpush(i){const n=i.tpush&&!0===i.tpush.useExtendedLib_WeAppTPNS&&"number"==typeof i.tpush.accessID&&"string"==typeof i.tpush.accessKey&&"string"==typeof i.tpush.serviceBundleId;if(n&&(0,tools_1.compareVersion)(i.sdkVersion,"1.0.7")<=0)throw new Error(`can not use TPNS(消息推送) extendsdk in sdk version ${i.sdkVersion}, TPNS is supported in 1.0.8.`);return n}function iOSMiniAppJsonIsUsingGDT(i){const n=i.gdt&&!0===i.gdt.useExtendedLib_WeAppGDT&&"string"==typeof i.gdt.appid&&"string"==typeof i.gdt.splashAd_placementId;if(n&&(0,tools_1.compareVersion)(i.sdkVersion,"1.0.19")<=0)throw new Error(`can not use GDT(广告) extendsdk in sdk version ${i.sdkVersion}, GDT is supported in 1.0.20.`);return n}function iOSAppJsonIsUsingIPadResizable(i){return!0===getRawAppJSON(i).resizable}function getRawAppJSON(i){const n=(0,tools_1.normalizePath)(path.posix.join(i,"project.config.json"));let o,e,t;try{o=fse.readJsonSync(n)}catch(i){throw console.error(i),i}e=o.miniprogramRoot?path.posix.join(i,o.miniprogramRoot,"app.json"):path.posix.join(i,"app.json");try{t=fse.readJsonSync(e)}catch(i){throw console.error(i),i}return t}exports.miniAppPlatformMap={"mini-android":"mini-android","mini-ios":"mini-ios","mini-weixin":"mini-weixin"},exports.identityServiceConfigToMiniAppJSON=identityServiceConfigToMiniAppJSON,exports.getRawMiniappJson=getRawMiniappJson,exports.getMiniappJson=getMiniappJson,exports.tryGetAndroidMiniappJson=tryGetAndroidMiniappJson,exports.tryGetIOSMiniappJson=tryGetIOSMiniappJson,exports.isMiniAppProject=isMiniAppProject,exports.isNewMiniAppProject=isNewMiniAppProject,exports.writeMiniAppJson=writeMiniAppJson,exports.iOSMiniAppJsonIsUsingTpush=iOSMiniAppJsonIsUsingTpush,exports.iOSMiniAppJsonIsUsingGDT=iOSMiniAppJsonIsUsingGDT,exports.iOSAppJsonIsUsingIPadResizable=iOSAppJsonIsUsingIPadResizable,exports.getRawAppJSON=getRawAppJSON;
}(require("licia/lazyImport")(require), require)