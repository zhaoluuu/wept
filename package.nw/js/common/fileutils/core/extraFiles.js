"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getExtraFiles=void 0;const path=require("path"),glob=require("glob"),fse=require("fs-extra"),PROJECT_CONFIG_JSON="project.config.json",GAME_JSON="game.json",getExtraFiles=function(o){const t=[],s=path.posix.join(o,PROJECT_CONFIG_JSON);if(!fse.pathExistsSync(s))return t;let i;t.push(PROJECT_CONFIG_JSON);try{i=JSON.parse(fse.readFileSync(s,"utf8"))}catch(o){return console.error(`${PROJECT_CONFIG_JSON} parse失败`),t}if(i.miniprogramRoot){const s=path.posix.join(o,i.miniprogramRoot,GAME_JSON);if(fse.pathExistsSync(s)){t.push(path.posix.join(i.miniprogramRoot,GAME_JSON));const e=JSON.parse(fse.readFileSync(s,"utf8"));if(e.openDataContext){const s=path.posix.join(o,i.miniprogramRoot,e.openDataContext);if(fse.pathExistsSync(s)){const o=path.posix.join(i.miniprogramRoot,e.openDataContext);t.push(o);const n=getFolderFiles(s).map((t=>path.posix.join(o,t)));t.push(...n)}}if(e.workers){const s=path.posix.join(o,i.miniprogramRoot,e.workers);if(fse.pathExistsSync(s)){const o=path.posix.join(i.miniprogramRoot,e.workers);t.push(o);const n=getFolderFiles(s).map((t=>path.posix.join(o,t)));t.push(...n)}}if(e.subpackages&&(e.subPackages=e.subpackages),e.subPackages)for(const s of e.subPackages){const e=path.posix.join(o,i.miniprogramRoot,s.root);if(fse.pathExistsSync(e)){const o=path.posix.join(i.miniprogramRoot,s.root);t.push(o);const n=getFolderFiles(e).map((t=>path.posix.join(o,t)));t.push(...n)}}if(e.loadingImageInfo){const s=path.posix.join(o,i.miniprogramRoot,e.loadingImageInfo.path);if(fse.pathExistsSync(s)){const o=path.posix.join(i.miniprogramRoot,e.loadingImageInfo.path);t.push(o)}}}}return t};exports.getExtraFiles=getExtraFiles;const getFolderFiles=function(o){if(!fse.lstatSync(o).isDirectory())return[];return glob.sync("**",{nodir:!1,nosort:!0,strict:!1,silent:!0,cwd:o,absolute:!1,mark:!0,dot:!0})};